(()=>{var t={431:t=>{var e,i;e={version:"6.4.2.2",use_lines:!0,use_xyz:!1},i=!1,t.exports?(t.exports=e,i=!0):"undefined"!=typeof document?window.ClipperLib=e:self.ClipperLib=e,-1!=(i=i?"chrome":navigator.userAgent.toString().toLowerCase()).indexOf("chrome")&&i.indexOf("chromium"),i.indexOf("chromium"),-1!=i.indexOf("safari")&&-1==i.indexOf("chrome")&&i.indexOf("chromium"),i.indexOf("firefox"),i.indexOf("firefox/17"),i.indexOf("firefox/15"),i.indexOf("firefox/3"),i.indexOf("opera"),i.indexOf("msie 10"),i.indexOf("msie 9"),i.indexOf("msie 8"),i.indexOf("msie 7"),i.indexOf("msie "),i=function(t,e){var i;if(void 0===Object.getOwnPropertyNames)for(i in e.prototype)void 0!==t.prototype[i]&&t.prototype[i]!==Object.prototype[i]||(t.prototype[i]=e.prototype[i]);else for(var n=Object.getOwnPropertyNames(e.prototype),r=0;r<n.length;r++)void 0===Object.getOwnPropertyDescriptor(t.prototype,n[r])&&Object.defineProperty(t.prototype,n[r],Object.getOwnPropertyDescriptor(e.prototype,n[r]));for(i in e)void 0===t[i]&&(t[i]=e[i]);t.$baseCtor=e},e.Path=function(){return[]},e.Path.prototype.push=Array.prototype.push,e.Paths=function(){return[]},e.Paths.prototype.push=Array.prototype.push,e.PolyNode=function(){this.m_Parent=null,this.m_polygon=new e.Path,this.m_endtype=this.m_jointype=this.m_Index=0,this.m_Childs=[],this.IsOpen=!1},e.PolyNode.prototype.IsHoleNode=function(){for(var t=!0,e=this.m_Parent;null!==e;)t=!t,e=e.m_Parent;return t},e.PolyNode.prototype.ChildCount=function(){return this.m_Childs.length},e.PolyNode.prototype.Contour=function(){return this.m_polygon},e.PolyNode.prototype.AddChild=function(t){var e=this.m_Childs.length;this.m_Childs.push(t),t.m_Parent=this,t.m_Index=e},e.PolyNode.prototype.GetNext=function(){return 0<this.m_Childs.length?this.m_Childs[0]:this.GetNextSiblingUp()},e.PolyNode.prototype.GetNextSiblingUp=function(){return null===this.m_Parent?null:this.m_Index===this.m_Parent.m_Childs.length-1?this.m_Parent.GetNextSiblingUp():this.m_Parent.m_Childs[this.m_Index+1]},e.PolyNode.prototype.Childs=function(){return this.m_Childs},e.PolyNode.prototype.Parent=function(){return this.m_Parent},e.PolyNode.prototype.IsHole=function(){return this.IsHoleNode()},e.PolyTree=function(){this.m_AllPolys=[],e.PolyNode.call(this)},e.PolyTree.prototype.Clear=function(){for(var t=0,e=this.m_AllPolys.length;t<e;t++)this.m_AllPolys[t]=null;this.m_AllPolys.length=0,this.m_Childs.length=0},e.PolyTree.prototype.GetFirst=function(){return 0<this.m_Childs.length?this.m_Childs[0]:null},e.PolyTree.prototype.Total=function(){var t=this.m_AllPolys.length;return 0<t&&this.m_Childs[0]!==this.m_AllPolys[0]&&t--,t},i(e.PolyTree,e.PolyNode),e.Clear=function(t){t.length=0},e.PI=3.141592653589793,e.PI2=6.283185307179586,e.FPoint=function(){var t=arguments,i=t.length;this.Y=this.X=0,e.use_xyz?(this.Z=0,3===i?(this.X=t[0],this.Y=t[1],this.Z=t[2]):2===i?(this.X=t[0],this.Y=t[1],this.Z=0):1===i?t[0]instanceof e.FPoint?(t=t[0],this.X=t.X,this.Y=t.Y,this.Z=0):(void 0===(t=t[0]).Z&&(t.Z=0),this.X=t.X,this.Y=t.Y,this.Z=t.Z):this.Z=this.Y=this.X=0):2===i?(this.X=t[0],this.Y=t[1]):1===i?(t=t[0],this.X=t.X,this.Y=t.Y):this.Y=this.X=0},e.FPoint.op_Equality=function(t,e){return t.X===e.X&&t.Y===e.Y},e.FPoint.op_Inequality=function(t,e){return t.X!==e.X||t.Y!==e.Y},e.FPoint0=function(){this.Y=this.X=0,e.use_xyz&&(this.Z=0)},e.FPoint0.prototype=e.FPoint.prototype,e.FPoint1=function(t){this.X=t.X,this.Y=t.Y,e.use_xyz&&(this.Z=void 0===t.Z?0:t.Z)},e.FPoint1.prototype=e.FPoint.prototype,e.FPoint1dp=function(t){this.X=t.X,this.Y=t.Y,e.use_xyz&&(this.Z=0)},e.FPoint1dp.prototype=e.FPoint.prototype,e.FPoint2=function(t,i,n){this.X=t,this.Y=i,e.use_xyz&&(this.Z=void 0===n?0:n)},e.FPoint2.prototype=e.FPoint.prototype,e.FRect=function(){var t=arguments,e=t.length;4===e?(this.left=t[0],this.top=t[1],this.right=t[2],this.bottom=t[3]):1===e?(t=t[0],this.left=t.left,this.top=t.top,this.right=t.right,this.bottom=t.bottom):this.bottom=this.right=this.top=this.left=0},e.FRect0=function(){this.bottom=this.right=this.top=this.left=0},e.FRect0.prototype=e.FRect.prototype,e.FRect1=function(t){this.left=t.left,this.top=t.top,this.right=t.right,this.bottom=t.bottom},e.FRect1.prototype=e.FRect.prototype,e.FRect4=function(t,e,i,n){this.left=t,this.top=e,this.right=i,this.bottom=n},e.FRect4.prototype=e.FRect.prototype,e.ClipType={ctIntersection:0,ctUnion:1,ctDifference:2,ctXor:3},e.PolyType={ptSubject:0,ptClip:1},e.PolyFillType={pftEvenOdd:0,pftNonZero:1,pftPositive:2,pftNegative:3},e.JoinType={jtSquare:0,jtRound:1,jtMiter:2},e.EndType={etOpenSquare:0,etOpenRound:1,etOpenButt:2,etClosedLine:3,etClosedPolygon:4},e.EdgeSide={esLeft:0,esRight:1},e.Direction={dRightToLeft:0,dLeftToRight:1},e.TEdge=function(){this.Bot=new e.FPoint0,this.Curr=new e.FPoint0,this.Top=new e.FPoint0,this.Delta=new e.FPoint0,this.Dx=0,this.PolyTyp=e.PolyType.ptSubject,this.Side=e.EdgeSide.esLeft,this.OutIdx=this.WindCnt2=this.WindCnt=this.WindDelta=0,this.PrevInSEL=this.NextInSEL=this.PrevInAEL=this.NextInAEL=this.NextInLML=this.Prev=this.Next=null},e.IntersectNode=function(){this.Edge2=this.Edge1=null,this.Pt=new e.FPoint0},e.MyIntersectNodeSort=function(){},e.MyIntersectNodeSort.Compare=function(t,e){var i=e.Pt.Y-t.Pt.Y;return 0<i?1:0>i?-1:0},e.LocalMinima=function(){this.Y=0,this.Next=this.RightBound=this.LeftBound=null},e.Scanbeam=function(){this.Y=0,this.Next=null},e.Maxima=function(){this.X=0,this.Prev=this.Next=null},e.OutRec=function(){this.Idx=0,this.IsOpen=this.IsHole=!1,this.PolyNode=this.BottomPt=this.Pts=this.FirstLeft=null},e.OutPt=function(){this.Idx=0,this.Pt=new e.FPoint0,this.Prev=this.Next=null},e.Join=function(){this.OutPt2=this.OutPt1=null,this.OffPt=new e.FPoint0},e.ClipperBase=function(){this.m_CurrentLM=this.m_MinimaList=null,this.m_edges=[],this.PreserveCollinear=this.m_HasOpenPaths=!1,this.m_ActiveEdges=this.m_PolyOuts=this.m_Scanbeam=null},e.ClipperBase.horizontal=-34e37,e.ClipperBase.Skip=-2,e.ClipperBase.Unassigned=-1,e.ClipperBase.tolerance=1e-20,e.ClipperBase.maxValue=Math.sqrt(Number.MAX_VALUE),e.ClipperBase.minValue=Math.sqrt(Number.MIN_VALUE),e.ClipperBase.near_zero=function(t){return t>-e.ClipperBase.tolerance&&t<e.ClipperBase.tolerance},e.ClipperBase.IsHorizontal=function(t){return 0===t.Delta.Y},e.ClipperBase.prototype.PointIsVertex=function(t,i){var n=i;do{if(e.FPoint.op_Equality(n.Pt,t))return!0;n=n.Next}while(n!==i);return!1},e.ClipperBase.prototype.PointOnLineSegment=function(t,e,i){return t.X===e.X&&t.Y===e.Y||t.X===i.X&&t.Y===i.Y||t.X>e.X==t.X<i.X&&t.Y>e.Y==t.Y<i.Y&&(t.X-e.X)*(i.Y-e.Y)==(i.X-e.X)*(t.Y-e.Y)},e.ClipperBase.prototype.PointOnPolygon=function(t,e){for(var i=e;;){if(this.PointOnLineSegment(t,i.Pt,i.Next.Pt))return!0;if((i=i.Next)===e)break}return!1},e.ClipperBase.prototype.SlopesEqual=e.ClipperBase.SlopesEqual=function(){var t=arguments,e=t.length;if(2===e)return e=t[0],t=t[1],e.Delta.Y*t.Delta.X==e.Delta.X*t.Delta.Y;if(3===e){e=t[0];var i=t[1],n=t[2];return 0==(e.Y-i.Y)*(i.X-n.X)-(e.X-i.X)*(i.Y-n.Y)}return e=t[0],i=t[1],n=t[2],t=t[3],0==(e.Y-i.Y)*(n.X-t.X)-(e.X-i.X)*(n.Y-t.Y)},e.ClipperBase.SlopesEqual3=function(t,e){return t.Delta.Y*e.Delta.X==t.Delta.X*e.Delta.Y},e.ClipperBase.SlopesEqual4=function(t,e,i){return 0==(t.Y-e.Y)*(e.X-i.X)-(t.X-e.X)*(e.Y-i.Y)},e.ClipperBase.SlopesEqual5=function(t,e,i,n){return 0==(t.Y-e.Y)*(i.X-n.X)-(t.X-e.X)*(i.Y-n.Y)},e.ClipperBase.prototype.Clear=function(){this.DisposeLocalMinimaList();for(var t=0,i=this.m_edges.length;t<i;++t){for(var n=0,r=this.m_edges[t].length;n<r;++n)this.m_edges[t][n]=null;e.Clear(this.m_edges[t])}e.Clear(this.m_edges),this.m_HasOpenPaths=!1},e.ClipperBase.prototype.DisposeLocalMinimaList=function(){for(;null!==this.m_MinimaList;){var t=this.m_MinimaList.Next;this.m_MinimaList=null,this.m_MinimaList=t}this.m_CurrentLM=null},e.ClipperBase.prototype.RangeTest=function(t){(t.X>e.ClipperBase.maxValue||t.X<-e.ClipperBase.maxValue||t.Y>e.ClipperBase.maxValue||t.Y<-e.ClipperBase.maxValue||0<t.X&&t.X<e.ClipperBase.minValue||0<t.Y&&t.Y<e.ClipperBase.minValue||0>t.X&&t.X>-e.ClipperBase.minValue||0>t.Y&&t.Y>-e.ClipperBase.minValue)&&e.Error("Coordinate outside allowed range in RangeTest().")},e.ClipperBase.prototype.InitEdge=function(t,i,n,r){t.Next=i,t.Prev=n,t.Curr.X=r.X,t.Curr.Y=r.Y,e.use_xyz&&(t.Curr.Z=r.Z),t.OutIdx=-1},e.ClipperBase.prototype.InitEdge2=function(t,i){t.Curr.Y>=t.Next.Curr.Y?(t.Bot.X=t.Curr.X,t.Bot.Y=t.Curr.Y,e.use_xyz&&(t.Bot.Z=t.Curr.Z),t.Top.X=t.Next.Curr.X,t.Top.Y=t.Next.Curr.Y,e.use_xyz&&(t.Top.Z=t.Next.Curr.Z)):(t.Top.X=t.Curr.X,t.Top.Y=t.Curr.Y,e.use_xyz&&(t.Top.Z=t.Curr.Z),t.Bot.X=t.Next.Curr.X,t.Bot.Y=t.Next.Curr.Y,e.use_xyz&&(t.Bot.Z=t.Next.Curr.Z)),this.SetDx(t),t.PolyTyp=i},e.ClipperBase.prototype.FindNextLocMin=function(t){for(var i;;){for(;e.FPoint.op_Inequality(t.Bot,t.Prev.Bot)||e.FPoint.op_Equality(t.Curr,t.Top);)t=t.Next;if(t.Dx!==e.ClipperBase.horizontal&&t.Prev.Dx!==e.ClipperBase.horizontal)break;for(;t.Prev.Dx===e.ClipperBase.horizontal;)t=t.Prev;for(i=t;t.Dx===e.ClipperBase.horizontal;)t=t.Next;if(t.Top.Y!==t.Prev.Bot.Y){i.Prev.Bot.X<t.Bot.X&&(t=i);break}}return t},e.ClipperBase.prototype.ProcessBound=function(t,i){var n,r=t;if(r.OutIdx===e.ClipperBase.Skip){if(t=r,i){for(;t.Top.Y===t.Next.Bot.Y;)t=t.Next;for(;t!==r&&t.Dx===e.ClipperBase.horizontal;)t=t.Prev}else{for(;t.Top.Y===t.Prev.Bot.Y;)t=t.Prev;for(;t!==r&&t.Dx===e.ClipperBase.horizontal;)t=t.Next}if(t===r)r=i?t.Next:t.Prev;else{t=i?r.Next:r.Prev;var o=new e.LocalMinima;o.Next=null,o.Y=t.Bot.Y,o.LeftBound=null,o.RightBound=t,t.WindDelta=0,r=this.ProcessBound(t,i),this.InsertLocalMinima(o)}return r}if(t.Dx===e.ClipperBase.horizontal&&((o=i?t.Prev:t.Next).Dx===e.ClipperBase.horizontal?o.Bot.X!==t.Bot.X&&o.Top.X!==t.Bot.X&&this.ReverseHorizontal(t):o.Bot.X!==t.Bot.X&&this.ReverseHorizontal(t)),o=t,i){for(;r.Top.Y===r.Next.Bot.Y&&r.Next.OutIdx!==e.ClipperBase.Skip;)r=r.Next;if(r.Dx===e.ClipperBase.horizontal&&r.Next.OutIdx!==e.ClipperBase.Skip){for(n=r;n.Prev.Dx===e.ClipperBase.horizontal;)n=n.Prev;n.Prev.Top.X>r.Next.Top.X&&(r=n.Prev)}for(;t!==r;)t.NextInLML=t.Next,t.Dx===e.ClipperBase.horizontal&&t!==o&&t.Bot.X!==t.Prev.Top.X&&this.ReverseHorizontal(t),t=t.Next;t.Dx===e.ClipperBase.horizontal&&t!==o&&t.Bot.X!==t.Prev.Top.X&&this.ReverseHorizontal(t),r=r.Next}else{for(;r.Top.Y===r.Prev.Bot.Y&&r.Prev.OutIdx!==e.ClipperBase.Skip;)r=r.Prev;if(r.Dx===e.ClipperBase.horizontal&&r.Prev.OutIdx!==e.ClipperBase.Skip){for(n=r;n.Next.Dx===e.ClipperBase.horizontal;)n=n.Next;(n.Next.Top.X===r.Prev.Top.X||n.Next.Top.X>r.Prev.Top.X)&&(r=n.Next)}for(;t!==r;)t.NextInLML=t.Prev,t.Dx===e.ClipperBase.horizontal&&t!==o&&t.Bot.X!==t.Next.Top.X&&this.ReverseHorizontal(t),t=t.Prev;t.Dx===e.ClipperBase.horizontal&&t!==o&&t.Bot.X!==t.Next.Top.X&&this.ReverseHorizontal(t),r=r.Prev}return r},e.ClipperBase.prototype.AddPath=function(t,i,n){e.use_lines?n||i!==e.PolyType.ptClip||e.Error("AddPath: Open paths must be subject."):n||e.Error("AddPath: Open paths have been disabled.");var r=t.length-1;if(n)for(;0<r&&e.FPoint.op_Equality(t[r],t[0]);)--r;for(;0<r&&e.FPoint.op_Equality(t[r],t[r-1]);)--r;if(n&&2>r||!n&&1>r)return!1;for(var o=[],s=0;s<=r;s++)o.push(new e.TEdge);var a=!0;for(o[1].Curr.X=t[1].X,o[1].Curr.Y=t[1].Y,e.use_xyz&&(o[1].Curr.Z=t[1].Z),this.RangeTest(t[0]),this.RangeTest(t[r]),this.InitEdge(o[0],o[1],o[r],t[0]),this.InitEdge(o[r],o[0],o[r-1],t[r]),s=r-1;1<=s;--s)this.RangeTest(t[s]),this.InitEdge(o[s],o[s+1],o[s-1],t[s]);for(s=t=r=o[0];;)if(t.Curr!==t.Next.Curr||!n&&t.Next===r){if(t.Prev===t.Next)break;if(n&&e.ClipperBase.SlopesEqual4(t.Prev.Curr,t.Curr,t.Next.Curr)&&(!this.PreserveCollinear||!this.Pt2IsBetweenPt1AndPt3(t.Prev.Curr,t.Curr,t.Next.Curr))){t===r&&(r=t.Next),s=t=(t=this.RemoveEdge(t)).Prev;continue}if((t=t.Next)===s||!n&&t.Next===r)break}else{if(t===t.Next)break;t===r&&(r=t.Next),s=t=this.RemoveEdge(t)}if(!n&&t===t.Next||n&&t.Prev===t.Next)return!1;n||(this.m_HasOpenPaths=!0,r.Prev.OutIdx=e.ClipperBase.Skip),t=r;do{this.InitEdge2(t,i),t=t.Next,a&&t.Curr.Y!==r.Curr.Y&&(a=!1)}while(t!==r);if(a){if(n)return!1;for(t.Prev.OutIdx=e.ClipperBase.Skip,(i=new e.LocalMinima).Next=null,i.Y=t.Bot.Y,i.LeftBound=null,i.RightBound=t,i.RightBound.Side=e.EdgeSide.esRight,i.RightBound.WindDelta=0;t.Bot.X!==t.Prev.Top.X&&this.ReverseHorizontal(t),t.Next.OutIdx!==e.ClipperBase.Skip;)t=t.NextInLML=t.Next;return this.InsertLocalMinima(i),this.m_edges.push(o),!0}for(this.m_edges.push(o),a=null,e.FPoint.op_Equality(t.Prev.Bot,t.Prev.Top)&&(t=t.Next);(t=this.FindNextLocMin(t))!==a;)null===a&&(a=t),(i=new e.LocalMinima).Next=null,i.Y=t.Bot.Y,t.Dx<t.Prev.Dx?(i.LeftBound=t.Prev,i.RightBound=t,o=!1):(i.LeftBound=t,i.RightBound=t.Prev,o=!0),i.LeftBound.Side=e.EdgeSide.esLeft,i.RightBound.Side=e.EdgeSide.esRight,i.LeftBound.WindDelta=n?i.LeftBound.Next===i.RightBound?-1:1:0,i.RightBound.WindDelta=-i.LeftBound.WindDelta,(t=this.ProcessBound(i.LeftBound,o)).OutIdx===e.ClipperBase.Skip&&(t=this.ProcessBound(t,o)),(r=this.ProcessBound(i.RightBound,!o)).OutIdx===e.ClipperBase.Skip&&(r=this.ProcessBound(r,!o)),i.LeftBound.OutIdx===e.ClipperBase.Skip?i.LeftBound=null:i.RightBound.OutIdx===e.ClipperBase.Skip&&(i.RightBound=null),this.InsertLocalMinima(i),o||(t=r);return!0},e.ClipperBase.prototype.AddPaths=function(t,e,i){for(var n=!1,r=0,o=t.length;r<o;++r)this.AddPath(t[r],e,i)&&(n=!0);return n},e.ClipperBase.prototype.Pt2IsBetweenPt1AndPt3=function(t,i,n){return!(e.FPoint.op_Equality(t,n)||e.FPoint.op_Equality(t,i)||e.FPoint.op_Equality(n,i))&&(t.X!==n.X?i.X>t.X==i.X<n.X:i.Y>t.Y==i.Y<n.Y)},e.ClipperBase.prototype.RemoveEdge=function(t){t.Prev.Next=t.Next,t.Next.Prev=t.Prev;var e=t.Next;return t.Prev=null,e},e.ClipperBase.prototype.SetDx=function(t){t.Delta.X=t.Top.X-t.Bot.X,t.Delta.Y=t.Top.Y-t.Bot.Y,t.Dx=0===t.Delta.Y?e.ClipperBase.horizontal:t.Delta.X/t.Delta.Y},e.ClipperBase.prototype.InsertLocalMinima=function(t){if(null===this.m_MinimaList)this.m_MinimaList=t;else if(t.Y>=this.m_MinimaList.Y)t.Next=this.m_MinimaList,this.m_MinimaList=t;else{for(var e=this.m_MinimaList;null!==e.Next&&t.Y<e.Next.Y;)e=e.Next;t.Next=e.Next,e.Next=t}},e.ClipperBase.prototype.PopLocalMinima=function(t,e){return e.v=this.m_CurrentLM,null!==this.m_CurrentLM&&this.m_CurrentLM.Y===t&&(this.m_CurrentLM=this.m_CurrentLM.Next,!0)},e.ClipperBase.prototype.ReverseHorizontal=function(t){var i=t.Top.X;t.Top.X=t.Bot.X,t.Bot.X=i,e.use_xyz&&(i=t.Top.Z,t.Top.Z=t.Bot.Z,t.Bot.Z=i)},e.ClipperBase.prototype.Reset=function(){if(this.m_CurrentLM=this.m_MinimaList,null!==this.m_CurrentLM){this.m_Scanbeam=null;for(var t=this.m_MinimaList;null!==t;){this.InsertScanbeam(t.Y);var i=t.LeftBound;null!==i&&(i.Curr.X=i.Bot.X,i.Curr.Y=i.Bot.Y,e.use_xyz&&(i.Curr.Z=i.Bot.Z),i.OutIdx=e.ClipperBase.Unassigned),null!==(i=t.RightBound)&&(i.Curr.X=i.Bot.X,i.Curr.Y=i.Bot.Y,e.use_xyz&&(i.Curr.Z=i.Bot.Z),i.OutIdx=e.ClipperBase.Unassigned),t=t.Next}this.m_ActiveEdges=null}},e.ClipperBase.prototype.InsertScanbeam=function(t){if(null===this.m_Scanbeam)this.m_Scanbeam=new e.Scanbeam,this.m_Scanbeam.Next=null,this.m_Scanbeam.Y=t;else if(t>this.m_Scanbeam.Y){var i=new e.Scanbeam;i.Y=t,i.Next=this.m_Scanbeam,this.m_Scanbeam=i}else{for(i=this.m_Scanbeam;null!==i.Next&&t<=i.Next.Y;)i=i.Next;if(t!==i.Y){var n=new e.Scanbeam;n.Y=t,n.Next=i.Next,i.Next=n}}},e.ClipperBase.prototype.PopScanbeam=function(t){return null===this.m_Scanbeam?(t.v=0,!1):(t.v=this.m_Scanbeam.Y,this.m_Scanbeam=this.m_Scanbeam.Next,!0)},e.ClipperBase.prototype.LocalMinimaPending=function(){return null!==this.m_CurrentLM},e.ClipperBase.prototype.CreateOutRec=function(){var t=new e.OutRec;return t.Idx=e.ClipperBase.Unassigned,t.IsHole=!1,t.IsOpen=!1,t.FirstLeft=null,t.Pts=null,t.BottomPt=null,t.PolyNode=null,this.m_PolyOuts.push(t),t.Idx=this.m_PolyOuts.length-1,t},e.ClipperBase.prototype.DisposeOutRec=function(t){this.m_PolyOuts[t].Pts=null,this.m_PolyOuts[t]=null},e.ClipperBase.prototype.UpdateEdgeIntoAEL=function(t){null===t.NextInLML&&e.Error("UpdateEdgeIntoAEL: invalid call");var i=t.PrevInAEL,n=t.NextInAEL;return t.NextInLML.OutIdx=t.OutIdx,null!==i?i.NextInAEL=t.NextInLML:this.m_ActiveEdges=t.NextInLML,null!==n&&(n.PrevInAEL=t.NextInLML),t.NextInLML.Side=t.Side,t.NextInLML.WindDelta=t.WindDelta,t.NextInLML.WindCnt=t.WindCnt,t.NextInLML.WindCnt2=t.WindCnt2,(t=t.NextInLML).Curr.X=t.Bot.X,t.Curr.Y=t.Bot.Y,t.PrevInAEL=i,t.NextInAEL=n,e.ClipperBase.IsHorizontal(t)||this.InsertScanbeam(t.Top.Y),t},e.ClipperBase.prototype.SwapPositionsInAEL=function(t,e){if(t.NextInAEL!==t.PrevInAEL&&e.NextInAEL!==e.PrevInAEL){if(t.NextInAEL===e){var i=e.NextInAEL;null!==i&&(i.PrevInAEL=t);var n=t.PrevInAEL;null!==n&&(n.NextInAEL=e),e.PrevInAEL=n,e.NextInAEL=t,t.PrevInAEL=e,t.NextInAEL=i}else e.NextInAEL===t?(null!==(i=t.NextInAEL)&&(i.PrevInAEL=e),null!==(n=e.PrevInAEL)&&(n.NextInAEL=t),t.PrevInAEL=n,t.NextInAEL=e,e.PrevInAEL=t,e.NextInAEL=i):(i=t.NextInAEL,n=t.PrevInAEL,t.NextInAEL=e.NextInAEL,null!==t.NextInAEL&&(t.NextInAEL.PrevInAEL=t),t.PrevInAEL=e.PrevInAEL,null!==t.PrevInAEL&&(t.PrevInAEL.NextInAEL=t),e.NextInAEL=i,null!==e.NextInAEL&&(e.NextInAEL.PrevInAEL=e),e.PrevInAEL=n,null!==e.PrevInAEL&&(e.PrevInAEL.NextInAEL=e));null===t.PrevInAEL?this.m_ActiveEdges=t:null===e.PrevInAEL&&(this.m_ActiveEdges=e)}},e.ClipperBase.prototype.DeleteFromAEL=function(t){var e=t.PrevInAEL,i=t.NextInAEL;null===e&&null===i&&t!==this.m_ActiveEdges||(null!==e?e.NextInAEL=i:this.m_ActiveEdges=i,null!==i&&(i.PrevInAEL=e),t.NextInAEL=null,t.PrevInAEL=null)},e.Clipper=function(t){void 0===t&&(t=0),this.m_PolyOuts=null,this.m_ClipType=e.ClipType.ctIntersection,this.m_IntersectNodeComparer=this.m_IntersectList=this.m_SortedEdges=this.m_ActiveEdges=this.m_Maxima=this.m_Scanbeam=null,this.m_ExecuteLocked=!1,this.m_SubjFillType=this.m_ClipFillType=e.PolyFillType.pftEvenOdd,this.m_GhostJoins=this.m_Joins=null,this.StrictlySimple=this.ReverseSolution=this.m_UsingPolyTree=!1,e.ClipperBase.call(this),this.m_SortedEdges=this.m_ActiveEdges=this.m_Maxima=this.m_Scanbeam=null,this.m_IntersectList=[],this.m_IntersectNodeComparer=e.MyIntersectNodeSort.Compare,this.m_UsingPolyTree=this.m_ExecuteLocked=!1,this.m_PolyOuts=[],this.m_Joins=[],this.m_GhostJoins=[],this.ReverseSolution=0!=(1&t),this.StrictlySimple=0!=(2&t),this.PreserveCollinear=0!=(4&t),e.use_xyz&&(this.ZFillFunction=null)},e.Clipper.ioReverseSolution=1,e.Clipper.ioStrictlySimple=2,e.Clipper.ioPreserveCollinear=4,e.Clipper.prototype.Clear=function(){0!==this.m_edges.length&&(this.DisposeAllPolyPts(),e.ClipperBase.prototype.Clear.call(this))},e.Clipper.prototype.InsertMaxima=function(t){var i=new e.Maxima;if(i.X=t,null===this.m_Maxima)this.m_Maxima=i,this.m_Maxima.Next=null,this.m_Maxima.Prev=null;else if(t<this.m_Maxima.X)i.Next=this.m_Maxima,i.Prev=null,this.m_Maxima=i;else{for(var n=this.m_Maxima;null!==n.Next&&t>=n.Next.X;)n=n.Next;t!==n.X&&(i.Next=n.Next,i.Prev=n,null!==n.Next&&(n.Next.Prev=i),n.Next=i)}},e.Clipper.prototype.Execute=function(){var t,i=arguments,n=i.length,r=i[1]instanceof e.PolyTree;if(4===n&&!r){if(n=i[0],o=i[1],r=i[2],i=i[3],this.m_ExecuteLocked)return!1;this.m_HasOpenPaths&&e.Error("Error: PolyTree struct is needed for open path clipping."),this.m_ExecuteLocked=!0,e.Clear(o),this.m_SubjFillType=r,this.m_ClipFillType=i,this.m_ClipType=n,this.m_UsingPolyTree=!1;try{(t=this.ExecuteInternal())&&this.BuildResult(o)}finally{this.DisposeAllPolyPts(),this.m_ExecuteLocked=!1}return t}if(4===n&&r){n=i[0];var o=i[1];if(r=i[2],i=i[3],this.m_ExecuteLocked)return!1;this.m_ExecuteLocked=!0,this.m_SubjFillType=r,this.m_ClipFillType=i,this.m_ClipType=n,this.m_UsingPolyTree=!0;try{(t=this.ExecuteInternal())&&this.BuildResult2(o)}finally{this.DisposeAllPolyPts(),this.m_ExecuteLocked=!1}return t}if(2===n&&!r||2===n&&r)return n=i[0],o=i[1],this.Execute(n,o,e.PolyFillType.pftEvenOdd,e.PolyFillType.pftEvenOdd)},e.Clipper.prototype.FixHoleLinkage=function(t){if(null!==t.FirstLeft&&(t.IsHole===t.FirstLeft.IsHole||null===t.FirstLeft.Pts)){for(var e=t.FirstLeft;null!==e&&(e.IsHole===t.IsHole||null===e.Pts);)e=e.FirstLeft;t.FirstLeft=e}},e.Clipper.prototype.ExecuteInternal=function(){try{this.Reset(),this.m_Maxima=this.m_SortedEdges=null;var t,e={},i={};if(!this.PopScanbeam(e))return!1;for(this.InsertLocalMinimaIntoAEL(e.v);this.PopScanbeam(i)||this.LocalMinimaPending();){if(this.ProcessHorizontals(),this.m_GhostJoins.length=0,!this.ProcessIntersections(i.v))return!1;this.ProcessEdgesAtTopOfScanbeam(i.v),e.v=i.v,this.InsertLocalMinimaIntoAEL(e.v)}var n=0;for(t=this.m_PolyOuts.length;n<t;n++){var r=this.m_PolyOuts[n];null===r.Pts||r.IsOpen||(r.IsHole^this.ReverseSolution)==0<this.Area$1(r)&&this.ReversePolyPtLinks(r.Pts)}for(this.JoinCommonEdges(),n=0,t=this.m_PolyOuts.length;n<t;n++)null!==(r=this.m_PolyOuts[n]).Pts&&(r.IsOpen?this.FixupOutPolyline(r):this.FixupOutPolygon(r));return this.StrictlySimple&&this.DoSimplePolygons(),!0}finally{this.m_Joins.length=0,this.m_GhostJoins.length=0}},e.Clipper.prototype.DisposeAllPolyPts=function(){for(var t=0,i=this.m_PolyOuts.length;t<i;++t)this.DisposeOutRec(t);e.Clear(this.m_PolyOuts)},e.Clipper.prototype.AddJoin=function(t,i,n){var r=new e.Join;r.OutPt1=t,r.OutPt2=i,r.OffPt.X=n.X,r.OffPt.Y=n.Y,e.use_xyz&&(r.OffPt.Z=n.Z),this.m_Joins.push(r)},e.Clipper.prototype.AddGhostJoin=function(t,i){var n=new e.Join;n.OutPt1=t,n.OffPt.X=i.X,n.OffPt.Y=i.Y,e.use_xyz&&(n.OffPt.Z=i.Z),this.m_GhostJoins.push(n)},e.Clipper.prototype.SetZ=function(t,i,n){null!==this.ZFillFunction&&0===t.Z&&null!==this.ZFillFunction&&(e.FPoint.op_Equality(t,i.Bot)?t.Z=i.Bot.Z:e.FPoint.op_Equality(t,i.Top)?t.Z=i.Top.Z:e.FPoint.op_Equality(t,n.Bot)?t.Z=n.Bot.Z:e.FPoint.op_Equality(t,n.Top)?t.Z=n.Top.Z:this.ZFillFunction(i.Bot,i.Top,n.Bot,n.Top,t))},e.Clipper.prototype.InsertLocalMinimaIntoAEL=function(t){for(var i,n,r,o={};this.PopLocalMinima(t,o);){n=o.v.LeftBound,r=o.v.RightBound;var s=null;if(null===n?(this.InsertEdgeIntoAEL(r,null),this.SetWindingCount(r),this.IsContributing(r)&&(s=this.AddOutPt(r,r.Bot))):(null===r?(this.InsertEdgeIntoAEL(n,null),this.SetWindingCount(n),this.IsContributing(n)&&(s=this.AddOutPt(n,n.Bot))):(this.InsertEdgeIntoAEL(n,null),this.InsertEdgeIntoAEL(r,n),this.SetWindingCount(n),r.WindCnt=n.WindCnt,r.WindCnt2=n.WindCnt2,this.IsContributing(n)&&(s=this.AddLocalMinPoly(n,r,n.Bot))),this.InsertScanbeam(n.Top.Y)),null!==r&&(e.ClipperBase.IsHorizontal(r)?(null!==r.NextInLML&&this.InsertScanbeam(r.NextInLML.Top.Y),this.AddEdgeToSEL(r)):this.InsertScanbeam(r.Top.Y)),null!==n&&null!==r){if(null!==s&&e.ClipperBase.IsHorizontal(r)&&0<this.m_GhostJoins.length&&0!==r.WindDelta){i=0;for(var a=this.m_GhostJoins.length;i<a;i++){var l=this.m_GhostJoins[i];this.HorzSegmentsOverlap(l.OutPt1.Pt.X,l.OffPt.X,r.Bot.X,r.Top.X)&&this.AddJoin(l.OutPt1,s,l.OffPt)}}if(0<=n.OutIdx&&null!==n.PrevInAEL&&n.PrevInAEL.Curr.X===n.Bot.X&&0<=n.PrevInAEL.OutIdx&&e.ClipperBase.SlopesEqual5(n.PrevInAEL.Curr,n.PrevInAEL.Top,n.Curr,n.Top)&&0!==n.WindDelta&&0!==n.PrevInAEL.WindDelta&&(i=this.AddOutPt(n.PrevInAEL,n.Bot),this.AddJoin(s,i,n.Top)),n.NextInAEL!==r&&(0<=r.OutIdx&&0<=r.PrevInAEL.OutIdx&&e.ClipperBase.SlopesEqual5(r.PrevInAEL.Curr,r.PrevInAEL.Top,r.Curr,r.Top)&&0!==r.WindDelta&&0!==r.PrevInAEL.WindDelta&&(i=this.AddOutPt(r.PrevInAEL,r.Bot),this.AddJoin(s,i,r.Top)),null!==(s=n.NextInAEL)))for(;s!==r;)this.IntersectEdges(r,s,n.Curr),s=s.NextInAEL}}},e.Clipper.prototype.InsertEdgeIntoAEL=function(t,e){if(null===this.m_ActiveEdges)t.PrevInAEL=null,t.NextInAEL=null,this.m_ActiveEdges=t;else if(null===e&&this.E2InsertsBeforeE1(this.m_ActiveEdges,t))t.PrevInAEL=null,t.NextInAEL=this.m_ActiveEdges,this.m_ActiveEdges=this.m_ActiveEdges.PrevInAEL=t;else{for(null===e&&(e=this.m_ActiveEdges);null!==e.NextInAEL&&!this.E2InsertsBeforeE1(e.NextInAEL,t);)e=e.NextInAEL;t.NextInAEL=e.NextInAEL,null!==e.NextInAEL&&(e.NextInAEL.PrevInAEL=t),t.PrevInAEL=e,e.NextInAEL=t}},e.Clipper.prototype.E2InsertsBeforeE1=function(t,i){return i.Curr.X===t.Curr.X?i.Top.Y>t.Top.Y?i.Top.X<e.Clipper.TopX(t,i.Top.Y):t.Top.X>e.Clipper.TopX(i,t.Top.Y):i.Curr.X<t.Curr.X},e.Clipper.prototype.IsEvenOddFillType=function(t){return t.PolyTyp===e.PolyType.ptSubject?this.m_SubjFillType===e.PolyFillType.pftEvenOdd:this.m_ClipFillType===e.PolyFillType.pftEvenOdd},e.Clipper.prototype.IsEvenOddAltFillType=function(t){return t.PolyTyp===e.PolyType.ptSubject?this.m_ClipFillType===e.PolyFillType.pftEvenOdd:this.m_SubjFillType===e.PolyFillType.pftEvenOdd},e.Clipper.prototype.IsContributing=function(t){if(t.PolyTyp===e.PolyType.ptSubject)var i=this.m_SubjFillType,n=this.m_ClipFillType;else i=this.m_ClipFillType,n=this.m_SubjFillType;switch(i){case e.PolyFillType.pftEvenOdd:if(0===t.WindDelta&&1!==t.WindCnt)return!1;break;case e.PolyFillType.pftNonZero:if(1!==Math.abs(t.WindCnt))return!1;break;case e.PolyFillType.pftPositive:if(1!==t.WindCnt)return!1;break;default:if(-1!==t.WindCnt)return!1}switch(this.m_ClipType){case e.ClipType.ctIntersection:switch(n){case e.PolyFillType.pftEvenOdd:case e.PolyFillType.pftNonZero:return 0!==t.WindCnt2;case e.PolyFillType.pftPositive:return 0<t.WindCnt2;default:return 0>t.WindCnt2}case e.ClipType.ctUnion:switch(n){case e.PolyFillType.pftEvenOdd:case e.PolyFillType.pftNonZero:return 0===t.WindCnt2;case e.PolyFillType.pftPositive:return 0>=t.WindCnt2;default:return 0<=t.WindCnt2}case e.ClipType.ctDifference:if(t.PolyTyp===e.PolyType.ptSubject)switch(n){case e.PolyFillType.pftEvenOdd:case e.PolyFillType.pftNonZero:return 0===t.WindCnt2;case e.PolyFillType.pftPositive:return 0>=t.WindCnt2;default:return 0<=t.WindCnt2}else switch(n){case e.PolyFillType.pftEvenOdd:case e.PolyFillType.pftNonZero:return 0!==t.WindCnt2;case e.PolyFillType.pftPositive:return 0<t.WindCnt2;default:return 0>t.WindCnt2}case e.ClipType.ctXor:if(0===t.WindDelta)switch(n){case e.PolyFillType.pftEvenOdd:case e.PolyFillType.pftNonZero:return 0===t.WindCnt2;case e.PolyFillType.pftPositive:return 0>=t.WindCnt2;default:return 0<=t.WindCnt2}}return!0},e.Clipper.prototype.SetWindingCount=function(t){for(var i=t.PrevInAEL;null!==i&&(i.PolyTyp!==t.PolyTyp||0===i.WindDelta);)i=i.PrevInAEL;if(null===i)i=t.PolyTyp===e.PolyType.ptSubject?this.m_SubjFillType:this.m_ClipFillType,t.WindCnt=0===t.WindDelta?i===e.PolyFillType.pftNegative?-1:1:t.WindDelta,t.WindCnt2=0,i=this.m_ActiveEdges;else{if(0===t.WindDelta&&this.m_ClipType!==e.ClipType.ctUnion)t.WindCnt=1;else if(this.IsEvenOddFillType(t))if(0===t.WindDelta){for(var n=!0,r=i.PrevInAEL;null!==r;)r.PolyTyp===i.PolyTyp&&0!==r.WindDelta&&(n=!n),r=r.PrevInAEL;t.WindCnt=n?0:1}else t.WindCnt=t.WindDelta;else t.WindCnt=0>i.WindCnt*i.WindDelta?1<Math.abs(i.WindCnt)?0>i.WindDelta*t.WindDelta?i.WindCnt:i.WindCnt+t.WindDelta:0===t.WindDelta?1:t.WindDelta:0===t.WindDelta?0>i.WindCnt?i.WindCnt-1:i.WindCnt+1:0>i.WindDelta*t.WindDelta?i.WindCnt:i.WindCnt+t.WindDelta;t.WindCnt2=i.WindCnt2,i=i.NextInAEL}if(this.IsEvenOddAltFillType(t))for(;i!==t;)0!==i.WindDelta&&(t.WindCnt2=0===t.WindCnt2?1:0),i=i.NextInAEL;else for(;i!==t;)t.WindCnt2+=i.WindDelta,i=i.NextInAEL},e.Clipper.prototype.AddEdgeToSEL=function(t){null===this.m_SortedEdges?(this.m_SortedEdges=t,t.PrevInSEL=null,t.NextInSEL=null):(t.NextInSEL=this.m_SortedEdges,t.PrevInSEL=null,this.m_SortedEdges=this.m_SortedEdges.PrevInSEL=t)},e.Clipper.prototype.PopEdgeFromSEL=function(t){if(t.v=this.m_SortedEdges,null===t.v)return!1;var e=t.v;return this.m_SortedEdges=t.v.NextInSEL,null!==this.m_SortedEdges&&(this.m_SortedEdges.PrevInSEL=null),e.NextInSEL=null,e.PrevInSEL=null,!0},e.Clipper.prototype.CopyAELToSEL=function(){var t=this.m_ActiveEdges;for(this.m_SortedEdges=t;null!==t;)t.PrevInSEL=t.PrevInAEL,t=t.NextInSEL=t.NextInAEL},e.Clipper.prototype.SwapPositionsInSEL=function(t,e){if(!(null===t.NextInSEL&&null===t.PrevInSEL||null===e.NextInSEL&&null===e.PrevInSEL)){if(t.NextInSEL===e){var i=e.NextInSEL;null!==i&&(i.PrevInSEL=t);var n=t.PrevInSEL;null!==n&&(n.NextInSEL=e),e.PrevInSEL=n,e.NextInSEL=t,t.PrevInSEL=e,t.NextInSEL=i}else e.NextInSEL===t?(null!==(i=t.NextInSEL)&&(i.PrevInSEL=e),null!==(n=e.PrevInSEL)&&(n.NextInSEL=t),t.PrevInSEL=n,t.NextInSEL=e,e.PrevInSEL=t,e.NextInSEL=i):(i=t.NextInSEL,n=t.PrevInSEL,t.NextInSEL=e.NextInSEL,null!==t.NextInSEL&&(t.NextInSEL.PrevInSEL=t),t.PrevInSEL=e.PrevInSEL,null!==t.PrevInSEL&&(t.PrevInSEL.NextInSEL=t),e.NextInSEL=i,null!==e.NextInSEL&&(e.NextInSEL.PrevInSEL=e),e.PrevInSEL=n,null!==e.PrevInSEL&&(e.PrevInSEL.NextInSEL=e));null===t.PrevInSEL?this.m_SortedEdges=t:null===e.PrevInSEL&&(this.m_SortedEdges=e)}},e.Clipper.prototype.AddLocalMaxPoly=function(t,e,i){this.AddOutPt(t,i),0===e.WindDelta&&this.AddOutPt(e,i),t.OutIdx===e.OutIdx?(t.OutIdx=-1,e.OutIdx=-1):t.OutIdx<e.OutIdx?this.AppendPolygon(t,e):this.AppendPolygon(e,t)},e.Clipper.prototype.AddLocalMinPoly=function(t,i,n){if(e.ClipperBase.IsHorizontal(i)||t.Dx>i.Dx){var r=this.AddOutPt(t,n);i.OutIdx=t.OutIdx,t.Side=e.EdgeSide.esLeft,i.Side=e.EdgeSide.esRight;var o=t;t=o.PrevInAEL===i?i.PrevInAEL:o.PrevInAEL}else r=this.AddOutPt(i,n),t.OutIdx=i.OutIdx,t.Side=e.EdgeSide.esRight,i.Side=e.EdgeSide.esLeft,t=(o=i).PrevInAEL===t?t.PrevInAEL:o.PrevInAEL;if(null!==t&&0<=t.OutIdx&&t.Top.Y<n.Y&&o.Top.Y<n.Y){i=e.Clipper.TopX(t,n.Y);var s=e.Clipper.TopX(o,n.Y);i===s&&0!==o.WindDelta&&0!==t.WindDelta&&e.ClipperBase.SlopesEqual5(new e.FPoint2(i,n.Y),t.Top,new e.FPoint2(s,n.Y),o.Top)&&(n=this.AddOutPt(t,n),this.AddJoin(r,n,o.Top))}return r},e.Clipper.prototype.AddOutPt=function(t,i){if(0>t.OutIdx){var n=this.CreateOutRec();n.IsOpen=0===t.WindDelta;var r=new e.OutPt;n.Pts=r,r.Idx=n.Idx,r.Pt.X=i.X,r.Pt.Y=i.Y,e.use_xyz&&(r.Pt.Z=i.Z),r.Next=r,r.Prev=r,n.IsOpen||this.SetHoleState(t,n),t.OutIdx=n.Idx}else{var o=(n=this.m_PolyOuts[t.OutIdx]).Pts,s=t.Side===e.EdgeSide.esLeft;if(s&&e.FPoint.op_Equality(i,o.Pt))return o;if(!s&&e.FPoint.op_Equality(i,o.Prev.Pt))return o.Prev;(r=new e.OutPt).Idx=n.Idx,r.Pt.X=i.X,r.Pt.Y=i.Y,e.use_xyz&&(r.Pt.Z=i.Z),r.Next=o,r.Prev=o.Prev,r.Prev.Next=r,o.Prev=r,s&&(n.Pts=r)}return r},e.Clipper.prototype.GetLastOutPt=function(t){var i=this.m_PolyOuts[t.OutIdx];return t.Side===e.EdgeSide.esLeft?i.Pts:i.Pts.Prev},e.Clipper.prototype.SwapPoints=function(t,i){var n=new e.FPoint1(t.Value);t.Value.X=i.Value.X,t.Value.Y=i.Value.Y,e.use_xyz&&(t.Value.Z=i.Value.Z),i.Value.X=n.X,i.Value.Y=n.Y,e.use_xyz&&(i.Value.Z=n.Z)},e.Clipper.prototype.HorzSegmentsOverlap=function(t,e,i,n){if(t>e){var r=t;t=e,e=r}return i>n&&(r=i,i=n,n=r),t<n&&i<e},e.Clipper.prototype.SetHoleState=function(t,e){for(var i=t.PrevInAEL,n=null;null!==i;)0<=i.OutIdx&&0!==i.WindDelta&&(null===n?n=i:n.OutIdx===i.OutIdx&&(n=null)),i=i.PrevInAEL;null===n?(e.FirstLeft=null,e.IsHole=!1):(e.FirstLeft=this.m_PolyOuts[n.OutIdx],e.IsHole=!e.FirstLeft.IsHole)},e.Clipper.prototype.GetDx=function(t,i){return t.Y===i.Y?e.ClipperBase.horizontal:(i.X-t.X)/(i.Y-t.Y)},e.Clipper.prototype.FirstIsBottomPt=function(t,i){for(var n=t.Prev;e.FPoint.op_Equality(n.Pt,t.Pt)&&n!==t;)n=n.Prev;var r=Math.abs(this.GetDx(t.Pt,n.Pt));for(n=t.Next;e.FPoint.op_Equality(n.Pt,t.Pt)&&n!==t;)n=n.Next;var o=Math.abs(this.GetDx(t.Pt,n.Pt));for(n=i.Prev;e.FPoint.op_Equality(n.Pt,i.Pt)&&n!==i;)n=n.Prev;var s=Math.abs(this.GetDx(i.Pt,n.Pt));for(n=i.Next;e.FPoint.op_Equality(n.Pt,i.Pt)&&n!==i;)n=n.Next;return n=Math.abs(this.GetDx(i.Pt,n.Pt)),Math.max(r,o)===Math.max(s,n)&&Math.min(r,o)===Math.min(s,n)?0<this.Area(t):r>=s&&r>=n||o>=s&&o>=n},e.Clipper.prototype.GetBottomPt=function(t){for(var i=null,n=t.Next;n!==t;)n.Pt.Y>t.Pt.Y?(t=n,i=null):n.Pt.Y===t.Pt.Y&&n.Pt.X<=t.Pt.X&&(n.Pt.X<t.Pt.X?(i=null,t=n):n.Next!==t&&n.Prev!==t&&(i=n)),n=n.Next;if(null!==i)for(;i!==n;)for(this.FirstIsBottomPt(n,i)||(t=i),i=i.Next;e.FPoint.op_Inequality(i.Pt,t.Pt);)i=i.Next;return t},e.Clipper.prototype.GetLowermostRec=function(t,e){null===t.BottomPt&&(t.BottomPt=this.GetBottomPt(t.Pts)),null===e.BottomPt&&(e.BottomPt=this.GetBottomPt(e.Pts));var i=t.BottomPt,n=e.BottomPt;return i.Pt.Y>n.Pt.Y?t:i.Pt.Y<n.Pt.Y?e:i.Pt.X<n.Pt.X?t:i.Pt.X>n.Pt.X||i.Next===i?e:n.Next===n||this.FirstIsBottomPt(i,n)?t:e},e.Clipper.prototype.OutRec1RightOfOutRec2=function(t,e){do{if((t=t.FirstLeft)===e)return!0}while(null!==t);return!1},e.Clipper.prototype.GetOutRec=function(t){for(t=this.m_PolyOuts[t];t!==this.m_PolyOuts[t.Idx];)t=this.m_PolyOuts[t.Idx];return t},e.Clipper.prototype.AppendPolygon=function(t,i){var n=this.m_PolyOuts[t.OutIdx],r=this.m_PolyOuts[i.OutIdx],o=this.OutRec1RightOfOutRec2(n,r)?r:this.OutRec1RightOfOutRec2(r,n)?n:this.GetLowermostRec(n,r),s=n.Pts,a=s.Prev,l=r.Pts,h=l.Prev;for(t.Side===e.EdgeSide.esLeft?i.Side===e.EdgeSide.esLeft?(this.ReversePolyPtLinks(l),l.Next=s,s.Prev=l,a.Next=h,h.Prev=a,n.Pts=h):(h.Next=s,s.Prev=h,l.Prev=a,a.Next=l,n.Pts=l):i.Side===e.EdgeSide.esRight?(this.ReversePolyPtLinks(l),a.Next=h,h.Prev=a,l.Next=s,s.Prev=l):(a.Next=l,l.Prev=a,s.Prev=h,h.Next=s),n.BottomPt=null,o===r&&(r.FirstLeft!==n&&(n.FirstLeft=r.FirstLeft),n.IsHole=r.IsHole),r.Pts=null,r.BottomPt=null,r.FirstLeft=n,o=t.OutIdx,s=i.OutIdx,t.OutIdx=-1,i.OutIdx=-1,a=this.m_ActiveEdges;null!==a;){if(a.OutIdx===s){a.OutIdx=o,a.Side=t.Side;break}a=a.NextInAEL}r.Idx=n.Idx},e.Clipper.prototype.ReversePolyPtLinks=function(t){if(null!==t){var e=t;do{var i=e.Next;e.Next=e.Prev,e=e.Prev=i}while(e!==t)}},e.Clipper.SwapSides=function(t,e){var i=t.Side;t.Side=e.Side,e.Side=i},e.Clipper.SwapPolyIndexes=function(t,e){var i=t.OutIdx;t.OutIdx=e.OutIdx,e.OutIdx=i},e.Clipper.prototype.IntersectEdges=function(t,i,n){var r=0<=t.OutIdx,o=0<=i.OutIdx;if(e.use_xyz&&this.SetZ(n,t,i),!e.use_lines||0!==t.WindDelta&&0!==i.WindDelta){if(t.PolyTyp===i.PolyTyp)if(this.IsEvenOddFillType(t)){var s=t.WindCnt;t.WindCnt=i.WindCnt,i.WindCnt=s}else t.WindCnt=0===t.WindCnt+i.WindDelta?-t.WindCnt:t.WindCnt+i.WindDelta,i.WindCnt=0==i.WindCnt-t.WindDelta?-i.WindCnt:i.WindCnt-t.WindDelta;else this.IsEvenOddFillType(i)?t.WindCnt2=0===t.WindCnt2?1:0:t.WindCnt2+=i.WindDelta,this.IsEvenOddFillType(t)?i.WindCnt2=0===i.WindCnt2?1:0:i.WindCnt2-=t.WindDelta;if(t.PolyTyp===e.PolyType.ptSubject)var a=this.m_SubjFillType,l=this.m_ClipFillType;else a=this.m_ClipFillType,l=this.m_SubjFillType;if(i.PolyTyp===e.PolyType.ptSubject){var h=this.m_SubjFillType;s=this.m_ClipFillType}else h=this.m_ClipFillType,s=this.m_SubjFillType;switch(a){case e.PolyFillType.pftPositive:a=t.WindCnt;break;case e.PolyFillType.pftNegative:a=-t.WindCnt;break;default:a=Math.abs(t.WindCnt)}switch(h){case e.PolyFillType.pftPositive:h=i.WindCnt;break;case e.PolyFillType.pftNegative:h=-i.WindCnt;break;default:h=Math.abs(i.WindCnt)}if(r&&o)0!==a&&1!==a||0!==h&&1!==h||t.PolyTyp!==i.PolyTyp&&this.m_ClipType!==e.ClipType.ctXor?this.AddLocalMaxPoly(t,i,n):(this.AddOutPt(t,n),this.AddOutPt(i,n),e.Clipper.SwapSides(t,i),e.Clipper.SwapPolyIndexes(t,i));else if(r)0!==h&&1!==h||(this.AddOutPt(t,n),e.Clipper.SwapSides(t,i),e.Clipper.SwapPolyIndexes(t,i));else if(o)0!==a&&1!==a||(this.AddOutPt(i,n),e.Clipper.SwapSides(t,i),e.Clipper.SwapPolyIndexes(t,i));else if(!(0!==a&&1!==a||0!==h&&1!==h)){switch(l){case e.PolyFillType.pftPositive:r=t.WindCnt2;break;case e.PolyFillType.pftNegative:r=-t.WindCnt2;break;default:r=Math.abs(t.WindCnt2)}switch(s){case e.PolyFillType.pftPositive:o=i.WindCnt2;break;case e.PolyFillType.pftNegative:o=-i.WindCnt2;break;default:o=Math.abs(i.WindCnt2)}if(t.PolyTyp!==i.PolyTyp)this.AddLocalMinPoly(t,i,n);else if(1===a&&1===h)switch(this.m_ClipType){case e.ClipType.ctIntersection:0<r&&0<o&&this.AddLocalMinPoly(t,i,n);break;case e.ClipType.ctUnion:0>=r&&0>=o&&this.AddLocalMinPoly(t,i,n);break;case e.ClipType.ctDifference:(t.PolyTyp===e.PolyType.ptClip&&0<r&&0<o||t.PolyTyp===e.PolyType.ptSubject&&0>=r&&0>=o)&&this.AddLocalMinPoly(t,i,n);break;case e.ClipType.ctXor:this.AddLocalMinPoly(t,i,n)}else e.Clipper.SwapSides(t,i)}}else 0===t.WindDelta&&0===i.WindDelta||(t.PolyTyp===i.PolyTyp&&t.WindDelta!==i.WindDelta&&this.m_ClipType===e.ClipType.ctUnion?0===t.WindDelta?o&&(this.AddOutPt(t,n),r&&(t.OutIdx=-1)):r&&(this.AddOutPt(i,n),o&&(i.OutIdx=-1)):t.PolyTyp!==i.PolyTyp&&(0!==t.WindDelta||1!==Math.abs(i.WindCnt)||this.m_ClipType===e.ClipType.ctUnion&&0!==i.WindCnt2?0!==i.WindDelta||1!==Math.abs(t.WindCnt)||this.m_ClipType===e.ClipType.ctUnion&&0!==t.WindCnt2||(this.AddOutPt(i,n),o&&(i.OutIdx=-1)):(this.AddOutPt(t,n),r&&(t.OutIdx=-1))))},e.Clipper.prototype.DeleteFromSEL=function(t){var e=t.PrevInSEL,i=t.NextInSEL;null===e&&null===i&&t!==this.m_SortedEdges||(null!==e?e.NextInSEL=i:this.m_SortedEdges=i,null!==i&&(i.PrevInSEL=e),t.NextInSEL=null,t.PrevInSEL=null)},e.Clipper.prototype.ProcessHorizontals=function(){for(var t={};this.PopEdgeFromSEL(t);)this.ProcessHorizontal(t.v)},e.Clipper.prototype.GetHorzDirection=function(t,i){t.Bot.X<t.Top.X?(i.Left=t.Bot.X,i.Right=t.Top.X,i.Dir=e.Direction.dLeftToRight):(i.Left=t.Top.X,i.Right=t.Bot.X,i.Dir=e.Direction.dRightToLeft)},e.Clipper.prototype.ProcessHorizontal=function(t){var i,n={Dir:null,Left:null,Right:null};this.GetHorzDirection(t,n);var r=n.Dir,o=n.Left;n=n.Right;for(var s=0===t.WindDelta,a=t,l=null;null!==a.NextInLML&&e.ClipperBase.IsHorizontal(a.NextInLML);)a=a.NextInLML;null===a.NextInLML&&(l=this.GetMaximaPair(a));var h=this.m_Maxima;if(null!==h)if(r===e.Direction.dLeftToRight){for(;null!==h&&h.X<=t.Bot.X;)h=h.Next;null!==h&&h.X>=a.Top.X&&(h=null)}else{for(;null!==h.Next&&h.Next.X<t.Bot.X;)h=h.Next;h.X<=a.Top.X&&(h=null)}for(var u=null;;){for(var p=t===a,c=this.GetNextInAEL(t,r);null!==c;){if(null!==h)if(r===e.Direction.dLeftToRight)for(;null!==h&&h.X<c.Curr.X;)0<=t.OutIdx&&!s&&this.AddOutPt(t,new e.FPoint2(h.X,t.Bot.Y)),h=h.Next;else for(;null!==h&&h.X>c.Curr.X;)0<=t.OutIdx&&!s&&this.AddOutPt(t,new e.FPoint2(h.X,t.Bot.Y)),h=h.Prev;if(r===e.Direction.dLeftToRight&&c.Curr.X>n||r===e.Direction.dRightToLeft&&c.Curr.X<o)break;if(c.Curr.X===t.Top.X&&null!==t.NextInLML&&c.Dx<t.NextInLML.Dx)break;if(0<=t.OutIdx&&!s){for(e.use_xyz&&(r===e.Direction.dLeftToRight?this.SetZ(c.Curr,t,c):this.SetZ(c.Curr,c,t)),u=this.AddOutPt(t,c.Curr),i=this.m_SortedEdges;null!==i;){if(0<=i.OutIdx&&this.HorzSegmentsOverlap(t.Bot.X,t.Top.X,i.Bot.X,i.Top.X)){var d=this.GetLastOutPt(i);this.AddJoin(d,u,i.Top)}i=i.NextInSEL}this.AddGhostJoin(u,t.Bot)}if(c===l&&p)return 0<=t.OutIdx&&this.AddLocalMaxPoly(t,l,t.Top),this.DeleteFromAEL(t),void this.DeleteFromAEL(l);r===e.Direction.dLeftToRight?(d=new e.FPoint2(c.Curr.X,t.Curr.Y),this.IntersectEdges(t,c,d)):(d=new e.FPoint2(c.Curr.X,t.Curr.Y),this.IntersectEdges(c,t,d)),d=this.GetNextInAEL(c,r),this.SwapPositionsInAEL(t,c),c=d}if(null===t.NextInLML||!e.ClipperBase.IsHorizontal(t.NextInLML))break;0<=(t=this.UpdateEdgeIntoAEL(t)).OutIdx&&this.AddOutPt(t,t.Bot),n={Dir:r,Left:o,Right:n},this.GetHorzDirection(t,n),r=n.Dir,o=n.Left,n=n.Right}if(0<=t.OutIdx&&null===u){for(u=this.GetLastOutPt(t),i=this.m_SortedEdges;null!==i;)0<=i.OutIdx&&this.HorzSegmentsOverlap(t.Bot.X,t.Top.X,i.Bot.X,i.Top.X)&&(d=this.GetLastOutPt(i),this.AddJoin(d,u,i.Top)),i=i.NextInSEL;this.AddGhostJoin(u,t.Top)}null!==t.NextInLML?0<=t.OutIdx?(u=this.AddOutPt(t,t.Top),0!==(t=this.UpdateEdgeIntoAEL(t)).WindDelta&&(r=t.PrevInAEL,d=t.NextInAEL,null!==r&&r.Curr.X===t.Bot.X&&r.Curr.Y===t.Bot.Y&&0===r.WindDelta&&0<=r.OutIdx&&r.Curr.Y>r.Top.Y&&e.ClipperBase.SlopesEqual3(t,r)?(d=this.AddOutPt(r,t.Bot),this.AddJoin(u,d,t.Top)):null!==d&&d.Curr.X===t.Bot.X&&d.Curr.Y===t.Bot.Y&&0!==d.WindDelta&&0<=d.OutIdx&&d.Curr.Y>d.Top.Y&&e.ClipperBase.SlopesEqual3(t,d)&&(d=this.AddOutPt(d,t.Bot),this.AddJoin(u,d,t.Top)))):this.UpdateEdgeIntoAEL(t):(0<=t.OutIdx&&this.AddOutPt(t,t.Top),this.DeleteFromAEL(t))},e.Clipper.prototype.GetNextInAEL=function(t,i){return i===e.Direction.dLeftToRight?t.NextInAEL:t.PrevInAEL},e.Clipper.prototype.IsMinima=function(t){return null!==t&&t.Prev.NextInLML!==t&&t.Next.NextInLML!==t},e.Clipper.prototype.IsMaxima=function(t,e){return null!==t&&t.Top.Y===e&&null===t.NextInLML},e.Clipper.prototype.IsIntermediate=function(t,e){return t.Top.Y===e&&null!==t.NextInLML},e.Clipper.prototype.GetMaximaPair=function(t){return e.FPoint.op_Equality(t.Next.Top,t.Top)&&null===t.Next.NextInLML?t.Next:e.FPoint.op_Equality(t.Prev.Top,t.Top)&&null===t.Prev.NextInLML?t.Prev:null},e.Clipper.prototype.GetMaximaPairEx=function(t){return null===(t=this.GetMaximaPair(t))||t.OutIdx===e.ClipperBase.Skip||t.NextInAEL===t.PrevInAEL&&!e.ClipperBase.IsHorizontal(t)?null:t},e.Clipper.prototype.ProcessIntersections=function(t){if(null===this.m_ActiveEdges)return!0;try{if(this.BuildIntersectList(t),0===this.m_IntersectList.length)return!0;if(1!==this.m_IntersectList.length&&!this.FixupIntersectionOrder())return!1;this.ProcessIntersectList()}catch(t){this.m_SortedEdges=null,this.m_IntersectList.length=0,e.Error("ProcessIntersections error")}return this.m_SortedEdges=null,!0},e.Clipper.prototype.BuildIntersectList=function(t){if(null!==this.m_ActiveEdges){var i=this.m_ActiveEdges;for(this.m_SortedEdges=i;null!==i;)i.PrevInSEL=i.PrevInAEL,i.NextInSEL=i.NextInAEL,i.Curr.X=e.Clipper.TopX(i,t),i=i.NextInAEL;for(var n=!0;n&&null!==this.m_SortedEdges;){for(n=!1,i=this.m_SortedEdges;null!==i.NextInSEL;){var r=i.NextInSEL,o=new e.FPoint0;i.Curr.X>r.Curr.X?(this.IntersectPoint(i,r,o),o.Y<t&&(o=new e.FPoint2(e.Clipper.TopX(i,t),t)),(n=new e.IntersectNode).Edge1=i,n.Edge2=r,n.Pt.X=o.X,n.Pt.Y=o.Y,e.use_xyz&&(n.Pt.Z=o.Z),this.m_IntersectList.push(n),this.SwapPositionsInSEL(i,r),n=!0):i=r}if(null===i.PrevInSEL)break;i.PrevInSEL.NextInSEL=null}this.m_SortedEdges=null}},e.Clipper.prototype.EdgesAdjacent=function(t){return t.Edge1.NextInSEL===t.Edge2||t.Edge1.PrevInSEL===t.Edge2},e.Clipper.IntersectNodeSort=function(t,e){return e.Pt.Y-t.Pt.Y},e.Clipper.prototype.FixupIntersectionOrder=function(){this.m_IntersectList.sort(this.m_IntersectNodeComparer),this.CopyAELToSEL();for(var t=this.m_IntersectList.length,e=0;e<t;e++){if(!this.EdgesAdjacent(this.m_IntersectList[e])){for(var i=e+1;i<t&&!this.EdgesAdjacent(this.m_IntersectList[i]);)i++;if(i===t)return!1;var n=this.m_IntersectList[e];this.m_IntersectList[e]=this.m_IntersectList[i],this.m_IntersectList[i]=n}this.SwapPositionsInSEL(this.m_IntersectList[e].Edge1,this.m_IntersectList[e].Edge2)}return!0},e.Clipper.prototype.ProcessIntersectList=function(){for(var t=0,e=this.m_IntersectList.length;t<e;t++){var i=this.m_IntersectList[t];this.IntersectEdges(i.Edge1,i.Edge2,i.Pt),this.SwapPositionsInAEL(i.Edge1,i.Edge2)}this.m_IntersectList.length=0},e.Clipper.TopX=function(t,e){return e===t.Top.Y?t.Top.X:t.Bot.X+t.Dx*(e-t.Bot.Y)},e.Clipper.prototype.IntersectPoint=function(t,i,n){if(n.X=0,n.Y=0,t.Dx===i.Dx)n.Y=t.Curr.Y,n.X=e.Clipper.TopX(t,n.Y);else{if(0===t.Delta.X)if(n.X=t.Bot.X,e.ClipperBase.IsHorizontal(i))n.Y=i.Bot.Y;else{var r=i.Bot.Y-i.Bot.X/i.Dx;n.Y=n.X/i.Dx+r}else if(0===i.Delta.X)if(n.X=i.Bot.X,e.ClipperBase.IsHorizontal(t))n.Y=t.Bot.Y;else{var o=t.Bot.Y-t.Bot.X/t.Dx;n.Y=n.X/t.Dx+o}else{o=t.Bot.X-t.Bot.Y*t.Dx;var s=((r=i.Bot.X-i.Bot.Y*i.Dx)-o)/(t.Dx-i.Dx);n.Y=s,n.X=Math.abs(t.Dx)<Math.abs(i.Dx)?t.Dx*s+o:i.Dx*s+r}if(n.Y<t.Top.Y||n.Y<i.Top.Y){if(t.Top.Y>i.Top.Y)return n.Y=t.Top.Y,n.X=e.Clipper.TopX(i,t.Top.Y),n.X<t.Top.X;n.Y=i.Top.Y,n.X=Math.abs(t.Dx)<Math.abs(i.Dx)?e.Clipper.TopX(t,n.Y):e.Clipper.TopX(i,n.Y)}n.Y>t.Curr.Y&&(n.Y=t.Curr.Y,n.X=Math.abs(t.Dx)>Math.abs(i.Dx)?e.Clipper.TopX(i,n.Y):e.Clipper.TopX(t,n.Y))}},e.Clipper.prototype.ProcessEdgesAtTopOfScanbeam=function(t){for(var i,n,r=this.m_ActiveEdges;null!==r;)if((n=this.IsMaxima(r,t))&&(n=null===(n=this.GetMaximaPairEx(r))||!e.ClipperBase.IsHorizontal(n)),n)this.StrictlySimple&&this.InsertMaxima(r.Top.X),i=r.PrevInAEL,this.DoMaxima(r),r=null===i?this.m_ActiveEdges:i.NextInAEL;else{if(this.IsIntermediate(r,t)&&e.ClipperBase.IsHorizontal(r.NextInLML)?(0<=(r=this.UpdateEdgeIntoAEL(r)).OutIdx&&this.AddOutPt(r,r.Bot),this.AddEdgeToSEL(r)):(r.Curr.X=e.Clipper.TopX(r,t),r.Curr.Y=t),e.use_xyz&&(r.Curr.Z=r.Top.Y===t?r.Top.Z:r.Bot.Y===t?r.Bot.Z:0),this.StrictlySimple&&(i=r.PrevInAEL,0<=r.OutIdx&&0!==r.WindDelta&&null!==i&&0<=i.OutIdx&&i.Curr.X===r.Curr.X&&0!==i.WindDelta)){var o=new e.FPoint1(r.Curr);e.use_xyz&&this.SetZ(o,i,r),n=this.AddOutPt(i,o),i=this.AddOutPt(r,o),this.AddJoin(n,i,o)}r=r.NextInAEL}for(this.ProcessHorizontals(),this.m_Maxima=null,r=this.m_ActiveEdges;null!==r;)this.IsIntermediate(r,t)&&(n=null,0<=r.OutIdx&&(n=this.AddOutPt(r,r.Top)),i=(r=this.UpdateEdgeIntoAEL(r)).PrevInAEL,o=r.NextInAEL,null!==i&&i.Curr.X===r.Bot.X&&i.Curr.Y===r.Bot.Y&&null!==n&&0<=i.OutIdx&&i.Curr.Y===i.Top.Y&&e.ClipperBase.SlopesEqual5(r.Curr,r.Top,i.Curr,i.Top)&&0!==r.WindDelta&&0!==i.WindDelta?(i=this.AddOutPt(ePrev2,r.Bot),this.AddJoin(n,i,r.Top)):null!==o&&o.Curr.X===r.Bot.X&&o.Curr.Y===r.Bot.Y&&null!==n&&0<=o.OutIdx&&o.Curr.Y===o.Top.Y&&e.ClipperBase.SlopesEqual5(r.Curr,r.Top,o.Curr,o.Top)&&0!==r.WindDelta&&0!==o.WindDelta&&(i=this.AddOutPt(o,r.Bot),this.AddJoin(n,i,r.Top))),r=r.NextInAEL},e.Clipper.prototype.DoMaxima=function(t){var i=this.GetMaximaPairEx(t);if(null===i)0<=t.OutIdx&&this.AddOutPt(t,t.Top),this.DeleteFromAEL(t);else{for(var n=t.NextInAEL;null!==n&&n!==i;)this.IntersectEdges(t,n,t.Top),this.SwapPositionsInAEL(t,n),n=t.NextInAEL;-1===t.OutIdx&&-1===i.OutIdx?(this.DeleteFromAEL(t),this.DeleteFromAEL(i)):0<=t.OutIdx&&0<=i.OutIdx?(0<=t.OutIdx&&this.AddLocalMaxPoly(t,i,t.Top),this.DeleteFromAEL(t),this.DeleteFromAEL(i)):e.use_lines&&0===t.WindDelta?(0<=t.OutIdx&&(this.AddOutPt(t,t.Top),t.OutIdx=e.ClipperBase.Unassigned),this.DeleteFromAEL(t),0<=i.OutIdx&&(this.AddOutPt(i,t.Top),i.OutIdx=e.ClipperBase.Unassigned),this.DeleteFromAEL(i)):e.Error("DoMaxima error")}},e.Clipper.ReversePaths=function(t){for(var e=0,i=t.length;e<i;e++)t[e].reverse()},e.Clipper.Orientation=function(t){return 0<=e.Clipper.Area(t)},e.Clipper.prototype.PointCount=function(t){if(null===t)return 0;var e=0,i=t;do{e++,i=i.Next}while(i!==t);return e},e.Clipper.prototype.BuildResult=function(t){e.Clear(t);for(var i=0,n=this.m_PolyOuts.length;i<n;i++){var r=this.m_PolyOuts[i];if(null!==r.Pts){r=r.Pts.Prev;var o=this.PointCount(r);if(!(2>o)){for(var s=Array(o),a=0;a<o;a++)s[a]=r.Pt,r=r.Prev;t.push(s)}}}},e.Clipper.prototype.BuildResult2=function(t){t.Clear();for(var i=0,n=this.m_PolyOuts.length;i<n;i++){var r=this.m_PolyOuts[i],o=this.PointCount(r.Pts);if(!(r.IsOpen&&2>o||!r.IsOpen&&3>o)){this.FixHoleLinkage(r);var s=new e.PolyNode;t.m_AllPolys.push(s),r.PolyNode=s,s.m_polygon.length=o,r=r.Pts.Prev;for(var a=0;a<o;a++)s.m_polygon[a]=r.Pt,r=r.Prev}}for(i=0,n=this.m_PolyOuts.length;i<n;i++)null!==(r=this.m_PolyOuts[i]).PolyNode&&(r.IsOpen?(r.PolyNode.IsOpen=!0,t.AddChild(r.PolyNode)):null!==r.FirstLeft&&null!==r.FirstLeft.PolyNode?r.FirstLeft.PolyNode.AddChild(r.PolyNode):t.AddChild(r.PolyNode))},e.Clipper.prototype.FixupOutPolyline=function(t){for(var i=t.Pts,n=i.Prev;i!==n;)if(i=i.Next,e.FPoint.op_Equality(i.Pt,i.Prev.Pt)){i===n&&(n=i.Prev);var r=i.Prev;r.Next=i.Next,i=i.Next.Prev=r}i===i.Prev&&(t.Pts=null)},e.Clipper.prototype.FixupOutPolygon=function(t){var i=null;t.BottomPt=null;for(var n=t.Pts,r=this.PreserveCollinear||this.StrictlySimple;;){if(n.Prev===n||n.Prev===n.Next)return void(t.Pts=null);if(e.FPoint.op_Equality(n.Pt,n.Next.Pt)||e.FPoint.op_Equality(n.Pt,n.Prev.Pt)||e.ClipperBase.SlopesEqual4(n.Prev.Pt,n.Pt,n.Next.Pt)&&(!r||!this.Pt2IsBetweenPt1AndPt3(n.Prev.Pt,n.Pt,n.Next.Pt)))i=null,n.Prev.Next=n.Next,n=n.Next.Prev=n.Prev;else{if(n===i)break;null===i&&(i=n),n=n.Next}}t.Pts=n},e.Clipper.prototype.DupOutPt=function(t,i){var n=new e.OutPt;return n.Pt.X=t.Pt.X,n.Pt.Y=t.Pt.Y,e.use_xyz&&(n.Pt.Z=t.Pt.Z),n.Idx=t.Idx,i?(n.Next=t.Next,n.Prev=t,t.Next.Prev=n,t.Next=n):(n.Prev=t.Prev,n.Next=t,t.Prev.Next=n,t.Prev=n),n},e.Clipper.prototype.GetOverlap=function(t,e,i,n,r){return t<e?i<n?(r.Left=Math.max(t,i),r.Right=Math.min(e,n)):(r.Left=Math.max(t,n),r.Right=Math.min(e,i)):i<n?(r.Left=Math.max(e,i),r.Right=Math.min(t,n)):(r.Left=Math.max(e,n),r.Right=Math.min(t,i)),r.Left<r.Right},e.Clipper.prototype.JoinHorz=function(t,i,n,r,o,s){var a=t.Pt.X>i.Pt.X?e.Direction.dRightToLeft:e.Direction.dLeftToRight;if(a===(r=n.Pt.X>r.Pt.X?e.Direction.dRightToLeft:e.Direction.dLeftToRight))return!1;if(a===e.Direction.dLeftToRight){for(;t.Next.Pt.X<=o.X&&t.Next.Pt.X>=t.Pt.X&&t.Next.Pt.Y===o.Y;)t=t.Next;s&&t.Pt.X!==o.X&&(t=t.Next),i=this.DupOutPt(t,!s),e.FPoint.op_Inequality(i.Pt,o)&&((t=i).Pt.X=o.X,t.Pt.Y=o.Y,e.use_xyz&&(t.Pt.Z=o.Z),i=this.DupOutPt(t,!s))}else{for(;t.Next.Pt.X>=o.X&&t.Next.Pt.X<=t.Pt.X&&t.Next.Pt.Y===o.Y;)t=t.Next;s||t.Pt.X===o.X||(t=t.Next),i=this.DupOutPt(t,s),e.FPoint.op_Inequality(i.Pt,o)&&((t=i).Pt.X=o.X,t.Pt.Y=o.Y,e.use_xyz&&(t.Pt.Z=o.Z),i=this.DupOutPt(t,s))}if(r===e.Direction.dLeftToRight){for(;n.Next.Pt.X<=o.X&&n.Next.Pt.X>=n.Pt.X&&n.Next.Pt.Y===o.Y;)n=n.Next;s&&n.Pt.X!==o.X&&(n=n.Next),r=this.DupOutPt(n,!s),e.FPoint.op_Inequality(r.Pt,o)&&((n=r).Pt.X=o.X,n.Pt.Y=o.Y,e.use_xyz&&(n.Pt.Z=o.Z),r=this.DupOutPt(n,!s))}else{for(;n.Next.Pt.X>=o.X&&n.Next.Pt.X<=n.Pt.X&&n.Next.Pt.Y===o.Y;)n=n.Next;s||n.Pt.X===o.X||(n=n.Next),r=this.DupOutPt(n,s),e.FPoint.op_Inequality(r.Pt,o)&&((n=r).Pt.X=o.X,n.Pt.Y=o.Y,e.use_xyz&&(n.Pt.Z=o.Z),r=this.DupOutPt(n,s))}return a===e.Direction.dLeftToRight===s?(t.Prev=n,n.Next=t,i.Next=r,r.Prev=i):(t.Next=n,n.Prev=t,i.Prev=r,r.Next=i),!0},e.Clipper.prototype.JoinPoints=function(t,i,n){var r,o=t.OutPt1;new e.OutPt;var s,a=t.OutPt2;if(new e.OutPt,(s=t.OutPt1.Pt.Y===t.OffPt.Y)&&e.FPoint.op_Equality(t.OffPt,t.OutPt1.Pt)&&e.FPoint.op_Equality(t.OffPt,t.OutPt2.Pt)){if(i!==n)return!1;for(r=t.OutPt1.Next;r!==o&&e.FPoint.op_Equality(r.Pt,t.OffPt);)r=r.Next;for(r=r.Pt.Y>t.OffPt.Y,s=t.OutPt2.Next;s!==a&&e.FPoint.op_Equality(s.Pt,t.OffPt);)s=s.Next;return r!==s.Pt.Y>t.OffPt.Y&&(r?(r=this.DupOutPt(o,!1),s=this.DupOutPt(a,!0),o.Prev=a,a.Next=o,r.Next=s,s.Prev=r):(r=this.DupOutPt(o,!0),s=this.DupOutPt(a,!1),o.Next=a,a.Prev=o,r.Prev=s,s.Next=r),t.OutPt1=o,t.OutPt2=r,!0)}if(s){for(r=o;o.Prev.Pt.Y===o.Pt.Y&&o.Prev!==r&&o.Prev!==a;)o=o.Prev;for(;r.Next.Pt.Y===r.Pt.Y&&r.Next!==o&&r.Next!==a;)r=r.Next;if(r.Next===o||r.Next===a)return!1;for(s=a;a.Prev.Pt.Y===a.Pt.Y&&a.Prev!==s&&a.Prev!==r;)a=a.Prev;for(;s.Next.Pt.Y===s.Pt.Y&&s.Next!==a&&s.Next!==o;)s=s.Next;if(s.Next===a||s.Next===o)return!1;if(n={Left:null,Right:null},!this.GetOverlap(o.Pt.X,r.Pt.X,a.Pt.X,s.Pt.X,n))return!1;i=n.Left;var l=n.Right;return n=new e.FPoint0,o.Pt.X>=i&&o.Pt.X<=l?(n.X=o.Pt.X,n.Y=o.Pt.Y,e.use_xyz&&(n.Z=o.Pt.Z),i=o.Pt.X>r.Pt.X):a.Pt.X>=i&&a.Pt.X<=l?(n.X=a.Pt.X,n.Y=a.Pt.Y,e.use_xyz&&(n.Z=a.Pt.Z),i=a.Pt.X>s.Pt.X):r.Pt.X>=i&&r.Pt.X<=l?(n.X=r.Pt.X,n.Y=r.Pt.Y,e.use_xyz&&(n.Z=r.Pt.Z),i=r.Pt.X>o.Pt.X):(n.X=s.Pt.X,n.Y=s.Pt.Y,e.use_xyz&&(n.Z=s.Pt.Z),i=s.Pt.X>a.Pt.X),t.OutPt1=o,t.OutPt2=a,this.JoinHorz(o,r,a,s,n,i)}for(r=o.Next;e.FPoint.op_Equality(r.Pt,o.Pt)&&r!==o;)r=r.Next;if(l=r.Pt.Y>o.Pt.Y||!e.ClipperBase.SlopesEqual4(o.Pt,r.Pt,t.OffPt)){for(r=o.Prev;e.FPoint.op_Equality(r.Pt,o.Pt)&&r!==o;)r=r.Prev;if(r.Pt.Y>o.Pt.Y||!e.ClipperBase.SlopesEqual4(o.Pt,r.Pt,t.OffPt))return!1}for(s=a.Next;e.FPoint.op_Equality(s.Pt,a.Pt)&&s!==a;)s=s.Next;var h=s.Pt.Y>a.Pt.Y||!e.ClipperBase.SlopesEqual4(a.Pt,s.Pt,t.OffPt);if(h){for(s=a.Prev;e.FPoint.op_Equality(s.Pt,a.Pt)&&s!==a;)s=s.Prev;if(s.Pt.Y>a.Pt.Y||!e.ClipperBase.SlopesEqual4(a.Pt,s.Pt,t.OffPt))return!1}return r!==o&&s!==a&&r!==s&&(i!==n||l!==h)&&(l?(r=this.DupOutPt(o,!1),s=this.DupOutPt(a,!0),o.Prev=a,a.Next=o,r.Next=s,s.Prev=r):(r=this.DupOutPt(o,!0),s=this.DupOutPt(a,!1),o.Next=a,a.Prev=o,r.Prev=s,s.Next=r),t.OutPt1=o,t.OutPt2=r,!0)},e.Clipper.GetBounds=function(t){for(var i=0,n=t.length;i<n&&0===t[i].length;)i++;if(i===n)return new e.FRect(0,0,0,0);var r=new e.FRect;for(r.left=t[i][0].X,r.right=r.left,r.top=t[i][0].Y,r.bottom=r.top;i<n;i++)for(var o=0,s=t[i].length;o<s;o++)t[i][o].X<r.left?r.left=t[i][o].X:t[i][o].X>r.right&&(r.right=t[i][o].X),t[i][o].Y<r.top?r.top=t[i][o].Y:t[i][o].Y>r.bottom&&(r.bottom=t[i][o].Y);return r},e.Clipper.prototype.GetBounds2=function(t){var i=t,n=new e.FRect;for(n.left=t.Pt.X,n.right=t.Pt.X,n.top=t.Pt.Y,n.bottom=t.Pt.Y,t=t.Next;t!==i;)t.Pt.X<n.left&&(n.left=t.Pt.X),t.Pt.X>n.right&&(n.right=t.Pt.X),t.Pt.Y<n.top&&(n.top=t.Pt.Y),t.Pt.Y>n.bottom&&(n.bottom=t.Pt.Y),t=t.Next;return n},e.Clipper.PointInPolygon=function(t,e){var i=0,n=e.length;if(3>n)return 0;for(var r=e[0],o=1;o<=n;++o){var s=o===n?e[0]:e[o];if(s.Y===t.Y&&(s.X===t.X||r.Y===t.Y&&s.X>t.X==r.X<t.X))return-1;if(r.Y<t.Y!=s.Y<t.Y)if(r.X>=t.X)if(s.X>t.X)i=1-i;else{var a=(r.X-t.X)*(s.Y-t.Y)-(s.X-t.X)*(r.Y-t.Y);if(0===a)return-1;0<a==s.Y>r.Y&&(i=1-i)}else if(s.X>t.X){if(0==(a=(r.X-t.X)*(s.Y-t.Y)-(s.X-t.X)*(r.Y-t.Y)))return-1;0<a==s.Y>r.Y&&(i=1-i)}r=s}return i},e.Clipper.prototype.PointInPolygon=function(t,e){var i=0,n=e,r=t.X,o=t.Y,s=e.Pt.X,a=e.Pt.Y;do{var l=(e=e.Next).Pt.X,h=e.Pt.Y;if(h===o&&(l===r||a===o&&l>r==s<r))return-1;if(a<o!=h<o)if(s>=r)if(l>r)i=1-i;else{if(0==(s=(s-r)*(h-o)-(l-r)*(a-o)))return-1;0<s==h>a&&(i=1-i)}else if(l>r){if(0==(s=(s-r)*(h-o)-(l-r)*(a-o)))return-1;0<s==h>a&&(i=1-i)}s=l,a=h}while(n!==e);return i},e.Clipper.prototype.Poly2ContainsPoly1=function(t,e){var i=t;do{var n=this.PointInPolygon(i.Pt,e);if(0<=n)return 0<n;i=i.Next}while(i!==t);return!0},e.Clipper.prototype.FixupFirstLefts1=function(t,i){for(var n,r,o=0,s=this.m_PolyOuts.length;o<s;o++)n=this.m_PolyOuts[o],r=e.Clipper.ParseFirstLeft(n.FirstLeft),null!==n.Pts&&r===t&&this.Poly2ContainsPoly1(n.Pts,i.Pts)&&(n.FirstLeft=i)},e.Clipper.prototype.FixupFirstLefts2=function(t,i){for(var n,r,o=i.FirstLeft,s=0,a=this.m_PolyOuts.length;s<a;s++)null!==(n=this.m_PolyOuts[s]).Pts&&n!==i&&n!==t&&((r=e.Clipper.ParseFirstLeft(n.FirstLeft))===o||r===t||r===i)&&(this.Poly2ContainsPoly1(n.Pts,t.Pts)?n.FirstLeft=t:this.Poly2ContainsPoly1(n.Pts,i.Pts)?n.FirstLeft=i:n.FirstLeft!==t&&n.FirstLeft!==i||(n.FirstLeft=o))},e.Clipper.prototype.FixupFirstLefts3=function(t,i){for(var n,r,o=0,s=this.m_PolyOuts.length;o<s;o++)n=this.m_PolyOuts[o],r=e.Clipper.ParseFirstLeft(n.FirstLeft),null!==n.Pts&&r===t&&(n.FirstLeft=i)},e.Clipper.ParseFirstLeft=function(t){for(;null!==t&&null===t.Pts;)t=t.FirstLeft;return t},e.Clipper.prototype.JoinCommonEdges=function(){for(var t=0,e=this.m_Joins.length;t<e;t++){var i=this.m_Joins[t],n=this.GetOutRec(i.OutPt1.Idx),r=this.GetOutRec(i.OutPt2.Idx);if(null!==n.Pts&&null!==r.Pts&&!n.IsOpen&&!r.IsOpen){var o=n===r?n:this.OutRec1RightOfOutRec2(n,r)?r:this.OutRec1RightOfOutRec2(r,n)?n:this.GetLowermostRec(n,r);this.JoinPoints(i,n,r)&&(n===r?(n.Pts=i.OutPt1,n.BottomPt=null,(r=this.CreateOutRec()).Pts=i.OutPt2,this.UpdateOutPtIdxs(r),this.Poly2ContainsPoly1(r.Pts,n.Pts)?(r.IsHole=!n.IsHole,r.FirstLeft=n,this.m_UsingPolyTree&&this.FixupFirstLefts2(r,n),(r.IsHole^this.ReverseSolution)==0<this.Area$1(r)&&this.ReversePolyPtLinks(r.Pts)):this.Poly2ContainsPoly1(n.Pts,r.Pts)?(r.IsHole=n.IsHole,n.IsHole=!r.IsHole,r.FirstLeft=n.FirstLeft,n.FirstLeft=r,this.m_UsingPolyTree&&this.FixupFirstLefts2(n,r),(n.IsHole^this.ReverseSolution)==0<this.Area$1(n)&&this.ReversePolyPtLinks(n.Pts)):(r.IsHole=n.IsHole,r.FirstLeft=n.FirstLeft,this.m_UsingPolyTree&&this.FixupFirstLefts1(n,r))):(r.Pts=null,r.BottomPt=null,r.Idx=n.Idx,n.IsHole=o.IsHole,o===r&&(n.FirstLeft=r.FirstLeft),r.FirstLeft=n,this.m_UsingPolyTree&&this.FixupFirstLefts3(r,n)))}}},e.Clipper.prototype.UpdateOutPtIdxs=function(t){var e=t.Pts;do{e.Idx=t.Idx,e=e.Prev}while(e!==t.Pts)},e.Clipper.prototype.DoSimplePolygons=function(){for(var t=0;t<this.m_PolyOuts.length;){var i=this.m_PolyOuts[t++],n=i.Pts;if(null!==n&&!i.IsOpen)do{for(var r=n.Next;r!==i.Pts;){if(e.FPoint.op_Equality(n.Pt,r.Pt)&&r.Next!==n&&r.Prev!==n){var o=n.Prev,s=r.Prev;n.Prev=s,s.Next=n,r.Prev=o,o.Next=r,i.Pts=n,(o=this.CreateOutRec()).Pts=r,this.UpdateOutPtIdxs(o),this.Poly2ContainsPoly1(o.Pts,i.Pts)?(o.IsHole=!i.IsHole,o.FirstLeft=i,this.m_UsingPolyTree&&this.FixupFirstLefts2(o,i)):this.Poly2ContainsPoly1(i.Pts,o.Pts)?(o.IsHole=i.IsHole,i.IsHole=!o.IsHole,o.FirstLeft=i.FirstLeft,i.FirstLeft=o,this.m_UsingPolyTree&&this.FixupFirstLefts2(i,o)):(o.IsHole=i.IsHole,o.FirstLeft=i.FirstLeft,this.m_UsingPolyTree&&this.FixupFirstLefts1(i,o)),r=n}r=r.Next}n=n.Next}while(n!==i.Pts)}},e.Clipper.Area=function(t){if(!Array.isArray(t))return 0;var e=t.length;if(3>e)return 0;for(var i=0,n=0,r=e-1;n<e;++n)i+=(t[r].X+t[n].X)*(t[r].Y-t[n].Y),r=n;return.5*-i},e.Clipper.prototype.Area=function(t){var e=t;if(null===t)return 0;var i=0;do{i+=(t.Prev.Pt.X+t.Pt.X)*(t.Prev.Pt.Y-t.Pt.Y),t=t.Next}while(t!==e);return.5*i},e.Clipper.prototype.Area$1=function(t){return this.Area(t.Pts)},e.Clipper.SimplifyPolygon=function(t,i){var n=[],r=new e.Clipper(0);return r.StrictlySimple=!0,r.AddPath(t,e.PolyType.ptSubject,!0),r.Execute(e.ClipType.ctUnion,n,i,i),n},e.Clipper.SimplifyPolygons=function(t,i){void 0===i&&(i=e.PolyFillType.pftEvenOdd);var n=[],r=new e.Clipper(0);return r.StrictlySimple=!0,r.AddPaths(t,e.PolyType.ptSubject,!0),r.Execute(e.ClipType.ctUnion,n,i,i),n},e.Clipper.DistanceSqrd=function(t,e){var i=t.X-e.X,n=t.Y-e.Y;return i*i+n*n},e.Clipper.DistanceFromLineSqrd=function(t,e,i){var n=e.Y-i.Y;return i=i.X-e.X,e=n*e.X+i*e.Y,(e=n*t.X+i*t.Y-e)*e/(n*n+i*i)},e.Clipper.SlopesNearCollinear=function(t,i,n,r){return Math.abs(t.X-i.X)>Math.abs(t.Y-i.Y)?t.X>i.X==t.X<n.X?e.Clipper.DistanceFromLineSqrd(t,i,n)<r:i.X>t.X==i.X<n.X?e.Clipper.DistanceFromLineSqrd(i,t,n)<r:e.Clipper.DistanceFromLineSqrd(n,t,i)<r:t.Y>i.Y==t.Y<n.Y?e.Clipper.DistanceFromLineSqrd(t,i,n)<r:i.Y>t.Y==i.Y<n.Y?e.Clipper.DistanceFromLineSqrd(i,t,n)<r:e.Clipper.DistanceFromLineSqrd(n,t,i)<r},e.Clipper.PointsAreClose=function(t,e,i){var n=t.X-e.X;return n*n+(t=t.Y-e.Y)*t<=i},e.Clipper.ExcludeOp=function(t){var e=t.Prev;return e.Next=t.Next,t.Next.Prev=e,e.Idx=0,e},e.Clipper.CleanPolygon=function(t,i){void 0===i&&(i=1.415);var n=t.length;if(0===n)return[];for(var r=Array(n),o=0;o<n;++o)r[o]=new e.OutPt;for(o=0;o<n;++o)r[o].Pt=t[o],r[o].Next=r[(o+1)%n],r[o].Next.Prev=r[o],r[o].Idx=0;for(o=i*i,r=r[0];0===r.Idx&&r.Next!==r.Prev;)e.Clipper.PointsAreClose(r.Pt,r.Prev.Pt,o)?(r=e.Clipper.ExcludeOp(r),n--):e.Clipper.PointsAreClose(r.Prev.Pt,r.Next.Pt,o)?(e.Clipper.ExcludeOp(r.Next),r=e.Clipper.ExcludeOp(r),n-=2):e.Clipper.SlopesNearCollinear(r.Prev.Pt,r.Pt,r.Next.Pt,o)?(r=e.Clipper.ExcludeOp(r),n--):(r.Idx=1,r=r.Next);3>n&&(n=0);var s=Array(n);for(o=0;o<n;++o)s[o]=new e.FPoint1(r.Pt),r=r.Next;return s},e.Clipper.CleanPolygons=function(t,i){for(var n=Array(t.length),r=0,o=t.length;r<o;r++)n[r]=e.Clipper.CleanPolygon(t[r],i);return n},e.Clipper.Minkowski=function(t,i,n,r){r=r?1:0;var o=t.length,s=i.length,a=[];if(n)for(n=0;n<s;n++){for(var l=Array(o),h=0,u=t.length,p=t[h];h<u;p=t[++h])l[h]=new e.FPoint2(i[n].X+p.X,i[n].Y+p.Y);a.push(l)}else for(n=0;n<s;n++){for(l=Array(o),h=0,u=t.length,p=t[h];h<u;p=t[++h])l[h]=new e.FPoint2(i[n].X-p.X,i[n].Y-p.Y);a.push(l)}for(t=[],n=0;n<s-1+r;n++)for(h=0;h<o;h++)(i=[]).push(a[n%s][h%o]),i.push(a[(n+1)%s][h%o]),i.push(a[(n+1)%s][(h+1)%o]),i.push(a[n%s][(h+1)%o]),e.Clipper.Orientation(i)||i.reverse(),t.push(i);return t},e.Clipper.MinkowskiSum=function(t,i,n){if(i[0]instanceof Array){var r=i,o=new e.Paths;i=new e.Clipper;for(var s=0;s<r.length;++s){var a=e.Clipper.Minkowski(t,r[s],!0,n);i.AddPaths(a,e.PolyType.ptSubject,!0),n&&(a=e.Clipper.TranslatePath(r[s],t[0]),i.AddPath(a,e.PolyType.ptClip,!0))}return i.Execute(e.ClipType.ctUnion,o,e.PolyFillType.pftNonZero,e.PolyFillType.pftNonZero),o}return r=e.Clipper.Minkowski(t,i,!0,n),(i=new e.Clipper).AddPaths(r,e.PolyType.ptSubject,!0),i.Execute(e.ClipType.ctUnion,r,e.PolyFillType.pftNonZero,e.PolyFillType.pftNonZero),r},e.Clipper.TranslatePath=function(t,i){for(var n=new e.Path,r=0;r<t.length;r++)n.push(new e.FPoint2(t[r].X+i.X,t[r].Y+i.Y));return n},e.Clipper.MinkowskiDiff=function(t,i){var n=e.Clipper.Minkowski(t,i,!1,!0),r=new e.Clipper;return r.AddPaths(n,e.PolyType.ptSubject,!0),r.Execute(e.ClipType.ctUnion,n,e.PolyFillType.pftNonZero,e.PolyFillType.pftNonZero),n},e.Clipper.PolyTreeToPaths=function(t){var i=[];return e.Clipper.AddPolyNodeToPaths(t,e.Clipper.NodeType.ntAny,i),i},e.Clipper.AddPolyNodeToPaths=function(t,i,n){var r=!0;switch(i){case e.Clipper.NodeType.ntOpen:return;case e.Clipper.NodeType.ntClosed:r=!t.IsOpen}0<t.m_polygon.length&&r&&n.push(t.m_polygon),r=0;for(var o=(t=t.Childs()).length,s=t[r];r<o;s=t[++r])e.Clipper.AddPolyNodeToPaths(s,i,n)},e.Clipper.OpenPathsFromPolyTree=function(t){for(var i=new e.Paths,n=0,r=t.ChildCount();n<r;n++)t.Childs()[n].IsOpen&&i.push(t.Childs()[n].m_polygon);return i},e.Clipper.ClosedPathsFromPolyTree=function(t){var i=new e.Paths;return e.Clipper.AddPolyNodeToPaths(t,e.Clipper.NodeType.ntClosed,i),i},i(e.Clipper,e.ClipperBase),e.Clipper.NodeType={ntAny:0,ntOpen:1,ntClosed:2},e.ClipperOffset=function(t,i){void 0===t&&(t=2),void 0===i&&(i=e.ClipperOffset.def_arc_tolerance),this.m_destPolys=new e.Paths,this.m_srcPoly=new e.Path,this.m_destPoly=new e.Path,this.m_normals=[],this.m_StepsPerRad=this.m_miterLim=this.m_cos=this.m_sin=this.m_sinA=this.m_delta=0,this.m_lowest=new e.FPoint0,this.m_polyNodes=new e.PolyNode,this.MiterLimit=t,this.ArcTolerance=i,this.m_lowest.X=-1},e.ClipperOffset.two_pi=6.28318530717959,e.ClipperOffset.def_arc_tolerance=.25,e.ClipperOffset.prototype.Clear=function(){e.Clear(this.m_polyNodes.Childs()),this.m_lowest.X=-1},e.ClipperOffset.prototype.AddPath=function(t,i,n){var r=t.length-1;if(!(0>r)){var o=new e.PolyNode;if(o.m_jointype=i,o.m_endtype=n,n===e.EndType.etClosedLine||n===e.EndType.etClosedPolygon)for(;0<r&&e.FPoint.op_Equality(t[0],t[r]);)r--;o.m_polygon.push(t[0]);var s=0;i=0;for(var a=1;a<=r;a++)e.FPoint.op_Inequality(o.m_polygon[s],t[a])&&(s++,o.m_polygon.push(t[a]),t[a].Y>o.m_polygon[i].Y||t[a].Y===o.m_polygon[i].Y&&t[a].X<o.m_polygon[i].X)&&(i=s);n===e.EndType.etClosedPolygon&&2>s||(this.m_polyNodes.AddChild(o),n!==e.EndType.etClosedPolygon)||(0>this.m_lowest.X?this.m_lowest=new e.FPoint2(this.m_polyNodes.ChildCount()-1,i):(t=this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon[this.m_lowest.Y],(o.m_polygon[i].Y>t.Y||o.m_polygon[i].Y===t.Y&&o.m_polygon[i].X<t.X)&&(this.m_lowest=new e.FPoint2(this.m_polyNodes.ChildCount()-1,i))))}},e.ClipperOffset.prototype.AddPaths=function(t,e,i){for(var n=0,r=t.length;n<r;n++)this.AddPath(t[n],e,i)},e.ClipperOffset.prototype.FixOrientations=function(){if(0<=this.m_lowest.X&&!e.Clipper.Orientation(this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon))for(var t=0;t<this.m_polyNodes.ChildCount();t++){var i=this.m_polyNodes.Childs()[t];(i.m_endtype===e.EndType.etClosedPolygon||i.m_endtype===e.EndType.etClosedLine&&e.Clipper.Orientation(i.m_polygon))&&i.m_polygon.reverse()}else for(t=0;t<this.m_polyNodes.ChildCount();t++)(i=this.m_polyNodes.Childs()[t]).m_endtype!==e.EndType.etClosedLine||e.Clipper.Orientation(i.m_polygon)||i.m_polygon.reverse()},e.ClipperOffset.GetUnitNormal=function(t,i){var n=i.X-t.X,r=i.Y-t.Y;if(0===n&&0===r)return new e.FPoint2(0,0);var o=1/Math.sqrt(n*n+r*r);return new e.FPoint2(r*o,-n*o)},e.ClipperOffset.prototype.DoOffset=function(t){var i;if(this.m_destPolys=[],this.m_delta=t,e.ClipperBase.near_zero(t))for(var n=0;n<this.m_polyNodes.ChildCount();n++){var r=this.m_polyNodes.Childs()[n];r.m_endtype===e.EndType.etClosedPolygon&&this.m_destPolys.push(r.m_polygon)}else{this.m_miterLim=2<this.MiterLimit?2/(this.MiterLimit*this.MiterLimit):.5;var o=3.14159265358979/Math.acos(1-(0>=this.ArcTolerance?e.ClipperOffset.def_arc_tolerance:this.ArcTolerance>Math.abs(t)*e.ClipperOffset.def_arc_tolerance?Math.abs(t)*e.ClipperOffset.def_arc_tolerance:this.ArcTolerance)/Math.abs(t));for(this.m_sin=Math.sin(e.ClipperOffset.two_pi/o),this.m_cos=Math.cos(e.ClipperOffset.two_pi/o),this.m_StepsPerRad=o/e.ClipperOffset.two_pi,0>t&&(this.m_sin=-this.m_sin),n=0;n<this.m_polyNodes.ChildCount();n++){r=this.m_polyNodes.Childs()[n],this.m_srcPoly=r.m_polygon;var s=this.m_srcPoly.length;if(!(0===s||0>=t&&(3>s||r.m_endtype!==e.EndType.etClosedPolygon))){if(this.m_destPoly=[],1===s)if(r.m_jointype===e.JoinType.jtRound)for(s=1,r=0,i=1;i<=o;i++){this.m_destPoly.push(new e.FPoint2(this.m_srcPoly[0].X+s*t,this.m_srcPoly[0].Y+r*t));var a=s;s=s*this.m_cos-this.m_sin*r,r=a*this.m_sin+r*this.m_cos}else for(r=s=-1,i=0;4>i;++i)this.m_destPoly.push(new e.FPoint2(this.m_srcPoly[0].X+s*t,this.m_srcPoly[0].Y+r*t)),0>s?s=1:0>r?r=1:s=-1;else{for(i=this.m_normals.length=0;i<s-1;i++)this.m_normals.push(e.ClipperOffset.GetUnitNormal(this.m_srcPoly[i],this.m_srcPoly[i+1]));if(r.m_endtype===e.EndType.etClosedLine||r.m_endtype===e.EndType.etClosedPolygon?this.m_normals.push(e.ClipperOffset.GetUnitNormal(this.m_srcPoly[s-1],this.m_srcPoly[0])):this.m_normals.push(new e.FPoint1(this.m_normals[s-2])),r.m_endtype===e.EndType.etClosedPolygon)for(a=s-1,i=0;i<s;i++)a=this.OffsetPoint(i,a,r.m_jointype);else if(r.m_endtype===e.EndType.etClosedLine){for(a=s-1,i=0;i<s;i++)a=this.OffsetPoint(i,a,r.m_jointype);for(this.m_destPolys.push(this.m_destPoly),this.m_destPoly=[],a=this.m_normals[s-1],i=s-1;0<i;i--)this.m_normals[i]=new e.FPoint2(-this.m_normals[i-1].X,-this.m_normals[i-1].Y);for(this.m_normals[0]=new e.FPoint2(-a.X,-a.Y),a=0,i=s-1;0<=i;i--)a=this.OffsetPoint(i,a,r.m_jointype)}else{for(a=0,i=1;i<s-1;++i)a=this.OffsetPoint(i,a,r.m_jointype);for(r.m_endtype===e.EndType.etOpenButt?(i=s-1,a=new e.FPoint2(this.m_srcPoly[i].X+this.m_normals[i].X*t,this.m_srcPoly[i].Y+this.m_normals[i].Y*t),this.m_destPoly.push(a),a=new e.FPoint2(this.m_srcPoly[i].X-this.m_normals[i].X*t,this.m_srcPoly[i].Y-this.m_normals[i].Y*t),this.m_destPoly.push(a)):(i=s-1,a=s-2,this.m_sinA=0,this.m_normals[i]=new e.FPoint2(-this.m_normals[i].X,-this.m_normals[i].Y),r.m_endtype===e.EndType.etOpenSquare?this.DoSquare(i,a):this.DoRound(i,a)),i=s-1;0<i;i--)this.m_normals[i]=new e.FPoint2(-this.m_normals[i-1].X,-this.m_normals[i-1].Y);for(this.m_normals[0]=new e.FPoint2(-this.m_normals[1].X,-this.m_normals[1].Y),i=(a=s-1)-1;0<i;--i)a=this.OffsetPoint(i,a,r.m_jointype);r.m_endtype===e.EndType.etOpenButt?(a=new e.FPoint2(this.m_srcPoly[0].X-this.m_normals[0].X*t,this.m_srcPoly[0].Y-this.m_normals[0].Y*t),this.m_destPoly.push(a),a=new e.FPoint2(this.m_srcPoly[0].X+this.m_normals[0].X*t,this.m_srcPoly[0].Y+this.m_normals[0].Y*t),this.m_destPoly.push(a)):(this.m_sinA=0,r.m_endtype===e.EndType.etOpenSquare?this.DoSquare(0,1):this.DoRound(0,1))}}this.m_destPolys.push(this.m_destPoly)}}}},e.ClipperOffset.prototype.Execute=function(){var t=arguments;if(t[0]instanceof e.PolyTree){var i=t[0],n=t[1];if(i.Clear(),this.FixOrientations(),this.DoOffset(n),(t=new e.Clipper(0)).AddPaths(this.m_destPolys,e.PolyType.ptSubject,!0),0<n)t.Execute(e.ClipType.ctUnion,i,e.PolyFillType.pftPositive,e.PolyFillType.pftPositive);else{var r=e.Clipper.GetBounds(this.m_destPolys);if((n=new e.Path).push(new e.FPoint2(r.left-10,r.bottom+10)),n.push(new e.FPoint2(r.right+10,r.bottom+10)),n.push(new e.FPoint2(r.right+10,r.top-10)),n.push(new e.FPoint2(r.left-10,r.top-10)),t.AddPath(n,e.PolyType.ptSubject,!0),t.ReverseSolution=!0,t.Execute(e.ClipType.ctUnion,i,e.PolyFillType.pftNegative,e.PolyFillType.pftNegative),1===i.ChildCount()&&0<i.Childs()[0].ChildCount())for(t=i.Childs()[0],i.Childs()[0]=t.Childs()[0],i.Childs()[0].m_Parent=i,n=1;n<t.ChildCount();n++)i.AddChild(t.Childs()[n]);else i.Clear()}}else i=t[0],n=t[1],e.Clear(i),this.FixOrientations(),this.DoOffset(n),(t=new e.Clipper(0)).AddPaths(this.m_destPolys,e.PolyType.ptSubject,!0),0<n?t.Execute(e.ClipType.ctUnion,i,e.PolyFillType.pftPositive,e.PolyFillType.pftPositive):(r=e.Clipper.GetBounds(this.m_destPolys),(n=new e.Path).push(new e.FPoint2(r.left-10,r.bottom+10)),n.push(new e.FPoint2(r.right+10,r.bottom+10)),n.push(new e.FPoint2(r.right+10,r.top-10)),n.push(new e.FPoint2(r.left-10,r.top-10)),t.AddPath(n,e.PolyType.ptSubject,!0),t.ReverseSolution=!0,t.Execute(e.ClipType.ctUnion,i,e.PolyFillType.pftNegative,e.PolyFillType.pftNegative),0<i.length&&i.splice(0,1))},e.ClipperOffset.prototype.OffsetPoint=function(t,i,n){if(this.m_sinA=this.m_normals[i].X*this.m_normals[t].Y-this.m_normals[t].X*this.m_normals[i].Y,0===this.m_sinA)return i;if(1<this.m_sinA?this.m_sinA=1:-1>this.m_sinA&&(this.m_sinA=-1),0>this.m_sinA*this.m_delta)this.m_destPoly.push(new e.FPoint2(this.m_srcPoly[t].X+this.m_normals[i].X*this.m_delta,this.m_srcPoly[t].Y+this.m_normals[i].Y*this.m_delta)),this.m_destPoly.push(new e.FPoint1(this.m_srcPoly[t])),this.m_destPoly.push(new e.FPoint2(this.m_srcPoly[t].X+this.m_normals[t].X*this.m_delta,this.m_srcPoly[t].Y+this.m_normals[t].Y*this.m_delta));else switch(n){case e.JoinType.jtMiter:(n=this.m_normals[t].X*this.m_normals[i].X+this.m_normals[t].Y*this.m_normals[i].Y+1)>=this.m_miterLim?this.DoMiter(t,i,n):this.DoSquare(t,i);break;case e.JoinType.jtSquare:this.DoSquare(t,i);break;case e.JoinType.jtRound:this.DoRound(t,i)}return t},e.ClipperOffset.prototype.DoSquare=function(t,i){var n=Math.tan(Math.atan2(this.m_sinA,this.m_normals[i].X*this.m_normals[t].X+this.m_normals[i].Y*this.m_normals[t].Y)/4);this.m_destPoly.push(new e.FPoint2(this.m_srcPoly[t].X+this.m_delta*(this.m_normals[i].X-this.m_normals[i].Y*n),this.m_srcPoly[t].Y+this.m_delta*(this.m_normals[i].Y+this.m_normals[i].X*n))),this.m_destPoly.push(new e.FPoint2(this.m_srcPoly[t].X+this.m_delta*(this.m_normals[t].X+this.m_normals[t].Y*n),this.m_srcPoly[t].Y+this.m_delta*(this.m_normals[t].Y-this.m_normals[t].X*n)))},e.ClipperOffset.prototype.DoMiter=function(t,i,n){n=this.m_delta/n,this.m_destPoly.push(new e.FPoint2(this.m_srcPoly[t].X+(this.m_normals[i].X+this.m_normals[t].X)*n,this.m_srcPoly[t].Y+(this.m_normals[i].Y+this.m_normals[t].Y)*n))},e.ClipperOffset.prototype.DoRound=function(t,i){for(var n,r=Math.max(Math.round(this.m_StepsPerRad*Math.abs(Math.atan2(this.m_sinA,this.m_normals[i].X*this.m_normals[t].X+this.m_normals[i].Y*this.m_normals[t].Y))),1),o=this.m_normals[i].X,s=this.m_normals[i].Y,a=0;a<r;++a)this.m_destPoly.push(new e.FPoint2(this.m_srcPoly[t].X+o*this.m_delta,this.m_srcPoly[t].Y+s*this.m_delta)),n=o,o=o*this.m_cos-this.m_sin*s,s=n*this.m_sin+s*this.m_cos;this.m_destPoly.push(new e.FPoint2(this.m_srcPoly[t].X+this.m_normals[t].X*this.m_delta,this.m_srcPoly[t].Y+this.m_normals[t].Y*this.m_delta))},e.Error=function(t){try{throw Error(t)}catch(t){alert(t.message)}},e.JS={},e.JS.AreaOfPolygon=function(t){return e.Clipper.Area(t)},e.JS.AreaOfPolygons=function(t){for(var i=0,n=0;n<t.length;n++)i+=e.Clipper.Area(t[n]);return i},e.JS.BoundsOfPath=function(t){return e.JS.BoundsOfPaths([t])},e.JS.BoundsOfPaths=function(t){return e.Clipper.GetBounds(t)},e.JS.Clean=function(t,i){if(!(t instanceof Array))return[];var n=t[0]instanceof Array;if(t=e.JS.Clone(t),"number"!=typeof i||null===i)return e.Error("Delta is not a number in Clean()."),t;if(0===t.length||1===t.length&&0===t[0].length||0>i)return t;n||(t=[t]);for(var r,o,s,a,l,h,u,p=t.length,c=[],d=0;d<p;d++)if(0!==(r=(o=t[d]).length))if(3>r)s=o,c.push(s);else{for(s=o,a=i*i,l=o[0],u=h=1;u<r;u++)(o[u].X-l.X)*(o[u].X-l.X)+(o[u].Y-l.Y)*(o[u].Y-l.Y)<=a||(s[h]=o[u],l=o[u],h++);l=o[h-1],(o[0].X-l.X)*(o[0].X-l.X)+(o[0].Y-l.Y)*(o[0].Y-l.Y)<=a&&h--,h<r&&s.splice(h,r-h),s.length&&c.push(s)}return!n&&c.length?c=c[0]:n||0!==c.length?n&&0===c.length&&(c=[[]]):c=[],c},e.JS.Clone=function(t){if(!(t instanceof Array)||0===t.length)return[];if(1===t.length&&0===t[0].length)return[[]];var e=t[0]instanceof Array;e||(t=[t]);var i,n,r=t.length,o=Array(r);for(i=0;i<r;i++){var s=t[i].length,a=Array(s);for(n=0;n<s;n++)a[n]={X:t[i][n].X,Y:t[i][n].Y};o[i]=a}return e||(o=o[0]),o},e.JS.Lighten=function(t,i){if(!(t instanceof Array))return[];if("number"!=typeof i||null===i)return e.Error("Tolerance is not a number in Lighten()."),e.JS.Clone(t);if(0===t.length||1===t.length&&0===t[0].length||0>i)return e.JS.Clone(t);var n=t[0]instanceof Array;n||(t=[t]);var r,o,s,a=t.length,l=i*i,h=[];for(r=0;r<a;r++){var u=t[r],p=u.length;if(0!==p){for(s=0;1e6>s;s++){var c=[];if(u[(p=u.length)-1].X!==u[0].X||u[p-1].Y!==u[0].Y){var d=1;u.push({X:u[0].X,Y:u[0].Y}),p=u.length}else d=0;var y=[];for(o=0;o<p-2;o++){var f=u[o],v=u[o+1],g=u[o+2],m=f.X,P=f.Y;f=g.X-m;var x=g.Y-P;if(0!==f||0!==x){var C=((v.X-m)*f+(v.Y-P)*x)/(f*f+x*x);1<C?(m=g.X,P=g.Y):0<C&&(m+=f*C,P+=x*C)}(g=(f=v.X-m)*f+(x=v.Y-P)*x)<=l&&(y[o+1]=1,o++)}for(c.push({X:u[0].X,Y:u[0].Y}),o=1;o<p-1;o++)y[o]||c.push({X:u[o].X,Y:u[o].Y});if(c.push({X:u[p-1].X,Y:u[p-1].Y}),d&&u.pop(),!y.length)break;u=c}c[(p=c.length)-1].X===c[0].X&&c[p-1].Y===c[0].Y&&c.pop(),2<c.length&&h.push(c)}}return n||(h=h[0]),void 0===h&&(h=[]),h},e.JS.PerimeterOfPath=function(t,e){if(void 0===t)return 0;var i=Math.sqrt,n=0,r=t.length;if(2>r)return 0;for(e&&(t[r]=t[0],r++);--r;){var o=t[r],s=o.X;o=o.Y;var a=t[r-1],l=a.X;n+=i((s-l)*(s-l)+(o-(a=a.Y))*(o-a))}return e&&t.pop(),n},e.JS.PerimeterOfPaths=function(t,i){for(var n=0,r=0;r<t.length;r++)n+=e.JS.PerimeterOfPath(t[r],i);return n},e.ExPolygons=function(){return[]},e.ExPolygon=function(){this.holes=this.outer=null},e.JS.AddOuterPolyNodeToExPolygons=function(t,i){var n=new e.ExPolygon;n.outer=t.Contour();var r,o,s=t.Childs(),a=s.length;for(n.holes=Array(a),r=0;r<a;r++){var l=s[r];n.holes[r]=l.Contour();var h=0,u=l.Childs();for(o=u.length;h<o;h++)l=u[h],e.JS.AddOuterPolyNodeToExPolygons(l,i)}i.push(n)},e.JS.ExPolygonsToPaths=function(t){var i,n,r=new e.Paths,o=0;for(i=t.length;o<i;o++){r.push(t[o].outer);var s=0;for(n=t[o].holes.length;s<n;s++)r.push(t[o].holes[s])}return r},e.JS.PolyTreeToExPolygons=function(t){var i,n=new e.ExPolygons,r=0,o=t.Childs();for(i=o.length;r<i;r++)t=o[r],e.JS.AddOuterPolyNodeToExPolygons(t,n);return n}},299:(t,e)=>{var i,n,r,o;function s(t){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s(t)}o=function(){return function t(e,i,n){function r(s,a){if(!i[s]){if(!e[s]){if(o)return o(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var h=i[s]={exports:{}};e[s][0].call(h.exports,(function(t){return r(e[s][1][t]||t)}),h,h.exports,t,e,i,n)}return i[s].exports}for(var o=void 0,s=0;s<n.length;s++)r(n[s]);return r}({1:[function(t,e,i){"use strict";function n(t,e,i){i=i||2;var n,a,l,h,u,d,f,v=e&&e.length,g=v?e[0]*i:t.length,m=r(t,0,g,i,!0),P=[];if(!m||m.next===m.prev)return P;if(v&&(m=function(t,e,i,n){var s,a,l,h=[];for(s=0,a=e.length;s<a;s++)(l=r(t,e[s]*n,s<a-1?e[s+1]*n:t.length,n,!1))===l.next&&(l.steiner=!0),h.push(y(l));for(h.sort(p),s=0;s<h.length;s++)c(h[s],i),i=o(i,i.next);return i}(t,e,m,i)),t.length>80*i){n=l=t[0],a=h=t[1];for(var x=i;x<g;x+=i)(u=t[x])<n&&(n=u),(d=t[x+1])<a&&(a=d),l<u&&(l=u),h<d&&(h=d);f=0!==(f=Math.max(l-n,h-a))?1/f:0}return s(m,P,i,n,a,f),P}function r(t,e,i,n,r){var o,s;if(r===0<I(t,e,i,n))for(o=e;o<i;o+=n)s=S(o,t[o],t[o+1],s);else for(o=i-n;e<=o;o-=n)s=S(o,t[o],t[o+1],s);return s&&g(s,s.next)&&(b(s),s=s.next),s}function o(t,e){if(!t)return t;e=e||t;var i,n=t;do{if(i=!1,n.steiner||!g(n,n.next)&&0!==v(n.prev,n,n.next))n=n.next;else{if(b(n),(n=e=n.prev)===n.next)break;i=!0}}while(i||n!==e);return e}function s(t,e,i,n,r,p,c){if(t){!c&&p&&function(t,e,i,n){for(var r=t;null===r.z&&(r.z=d(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,(r=r.next)!==t;);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e,i,n,r,o,s,a,l,h=1;do{for(i=t,o=t=null,s=0;i;){for(s++,n=i,e=a=0;e<h&&(a++,n=n.nextZ);e++);for(l=h;0<a||0<l&&n;)0!==a&&(0===l||!n||i.z<=n.z)?(i=(r=i).nextZ,a--):(n=(r=n).nextZ,l--),o?o.nextZ=r:t=r,r.prevZ=o,o=r;i=n}o.nextZ=null,h*=2}while(1<s)}(r)}(t,n,r,p);for(var y,f,v=t;t.prev!==t.next;)if(y=t.prev,f=t.next,p?l(t,n,r,p):a(t))e.push(y.i/i),e.push(t.i/i),e.push(f.i/i),b(t),t=f.next,v=f.next;else if((t=f)===v){c?1===c?s(t=h(o(t),e,i),e,i,n,r,p,2):2===c&&u(t,e,i,n,r,p):s(o(t),e,i,n,r,p,1);break}}}function a(t){var e=t.prev,i=t,n=t.next;if(0<=v(e,i,n))return!1;for(var r=t.next.next;r!==t.prev;){if(f(e.x,e.y,i.x,i.y,n.x,n.y,r.x,r.y)&&0<=v(r.prev,r,r.next))return!1;r=r.next}return!0}function l(t,e,i,n){var r=t.prev,o=t,s=t.next;if(0<=v(r,o,s))return!1;for(var a=r.x<o.x?r.x<s.x?r.x:s.x:o.x<s.x?o.x:s.x,l=r.y<o.y?r.y<s.y?r.y:s.y:o.y<s.y?o.y:s.y,h=r.x>o.x?r.x>s.x?r.x:s.x:o.x>s.x?o.x:s.x,u=r.y>o.y?r.y>s.y?r.y:s.y:o.y>s.y?o.y:s.y,p=d(a,l,e,i,n),c=d(h,u,e,i,n),y=t.prevZ,g=t.nextZ;y&&y.z>=p&&g&&g.z<=c;){if(y!==t.prev&&y!==t.next&&f(r.x,r.y,o.x,o.y,s.x,s.y,y.x,y.y)&&0<=v(y.prev,y,y.next))return!1;if(y=y.prevZ,g!==t.prev&&g!==t.next&&f(r.x,r.y,o.x,o.y,s.x,s.y,g.x,g.y)&&0<=v(g.prev,g,g.next))return!1;g=g.nextZ}for(;y&&y.z>=p;){if(y!==t.prev&&y!==t.next&&f(r.x,r.y,o.x,o.y,s.x,s.y,y.x,y.y)&&0<=v(y.prev,y,y.next))return!1;y=y.prevZ}for(;g&&g.z<=c;){if(g!==t.prev&&g!==t.next&&f(r.x,r.y,o.x,o.y,s.x,s.y,g.x,g.y)&&0<=v(g.prev,g,g.next))return!1;g=g.nextZ}return!0}function h(t,e,i){var n=t;do{var r=n.prev,s=n.next.next;!g(r,s)&&m(r,n,n.next,s)&&C(r,s)&&C(s,r)&&(e.push(r.i/i),e.push(n.i/i),e.push(s.i/i),b(n),b(n.next),n=t=s),n=n.next}while(n!==t);return o(n)}function u(t,e,i,n,r,a){var l,h,u=t;do{for(var p=u.next.next;p!==u.prev;){if(u.i!==p.i&&(h=p,(l=u).next.i!==h.i&&l.prev.i!==h.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&m(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(l,h)&&(C(l,h)&&C(h,l)&&function(t,e){for(var i=t,n=!1,r=(t.x+e.x)/2,o=(t.y+e.y)/2;i.y>o!=i.next.y>o&&i.next.y!==i.y&&r<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(n=!n),(i=i.next)!==t;);return n}(l,h)&&(v(l.prev,l,h.prev)||v(l,h.prev,h))||g(l,h)&&0<v(l.prev,l,l.next)&&0<v(h.prev,h,h.next)))){var c=E(u,p);return u=o(u,u.next),c=o(c,c.next),s(u,e,i,n,r,a),void s(c,e,i,n,r,a)}p=p.next}u=u.next}while(u!==t)}function p(t,e){return t.x-e.x}function c(t,e){if(e=function(t,e){var i,n=e,r=t.x,o=t.y,s=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var a=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=r&&s<a){if((s=a)===r){if(o===n.y)return n;if(o===n.next.y)return n.next}i=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!i)return null;if(r===s)return i;var l,h,u,p=i,c=i.x,d=i.y,y=1/0;for(n=i;r>=n.x&&n.x>=c&&r!==n.x&&f(o<d?r:s,o,c,d,o<d?s:r,o,n.x,n.y)&&(l=Math.abs(o-n.y)/(r-n.x),C(n,t)&&(l<y||l===y&&(n.x>i.x||n.x===i.x&&(u=n,v((h=i).prev,h,u.prev)<0&&v(u.next,h,h.next)<0)))&&(i=n,y=l)),(n=n.next)!==p;);return i}(t,e)){var i=E(e,t);o(i,i.next)}}function d(t,e,i,n,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function y(t){for(var e=t,i=t;(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),(e=e.next)!==t;);return i}function f(t,e,i,n,r,o,s,a){return 0<=(r-s)*(e-a)-(t-s)*(o-a)&&0<=(t-s)*(n-a)-(i-s)*(e-a)&&0<=(i-s)*(o-a)-(r-s)*(n-a)}function v(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function g(t,e){return t.x===e.x&&t.y===e.y}function m(t,e,i,n){var r=x(v(t,e,i)),o=x(v(t,e,n)),s=x(v(i,n,t)),a=x(v(i,n,e));return r!==o&&s!==a||!(0!==r||!P(t,i,e))||!(0!==o||!P(t,n,e))||!(0!==s||!P(i,t,n))||!(0!==a||!P(i,e,n))}function P(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function x(t){return 0<t?1:t<0?-1:0}function C(t,e){return v(t.prev,t,t.next)<0?0<=v(t,e,t.next)&&0<=v(t,t.prev,e):v(t,e,t.prev)<0||v(t,t.next,e)<0}function E(t,e){var i=new T(t.i,t.x,t.y),n=new T(e.i,e.x,e.y),r=t.next,o=e.prev;return(t.next=e).prev=t,(i.next=r).prev=i,(n.next=i).prev=n,(o.next=n).prev=o,n}function S(t,e,i,n){var r=new T(t,e,i);return n?(r.next=n.next,(r.prev=n).next.prev=r,n.next=r):(r.prev=r).next=r,r}function b(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function T(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function I(t,e,i,n){for(var r=0,o=e,s=i-n;o<i;o+=n)r+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;return r}e.exports=n,(e.exports.default=n).deviation=function(t,e,i,n){var r=e&&e.length,o=r?e[0]*i:t.length,s=Math.abs(I(t,0,o,i));if(r)for(var a=0,l=e.length;a<l;a++){var h=e[a]*i,u=a<l-1?e[a+1]*i:t.length;s-=Math.abs(I(t,h,u,i))}var p=0;for(a=0;a<n.length;a+=3){var c=n[a]*i,d=n[a+1]*i,y=n[a+2]*i;p+=Math.abs((t[c]-t[y])*(t[1+d]-t[1+c])-(t[c]-t[d])*(t[1+y]-t[1+c]))}return 0===s&&0===p?0:Math.abs((p-s)/s)},n.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},n=0,r=0;r<t.length;r++){for(var o=0;o<t[r].length;o++)for(var s=0;s<e;s++)i.vertices.push(t[r][o][s]);0<r&&(n+=t[r-1].length,i.holes.push(n))}return i}},{}]},{},[1])(1)},"object"==s(e)?t.exports=o():(n=[],void 0===(r="function"==typeof(i=o)?i.apply(e,n):i)||(t.exports=r))},490:(t,e,i)=>{"use strict";i.d(e,{Z:()=>a});var n=i(537),r=i.n(n),o=i(645),s=i.n(o)()(r());s.push([t.id,".adsk-viewing-viewer .edge-gizmo:hover \r\n{  \r\n    background-color: lime; \r\n}\r\n.adsk-viewing-viewer .edge-gizmo \r\n{  \r\n    position: absolute;\r\n    background-color: #009bff;\r\n    box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.25);\r\n    border-radius: 8px;\r\n    cursor: move;\r\n    z-index: 1;\r\n    /* Place above the viewer but below the measure labels, which are at 2 */\r\n    -webkit-tap-highlight-color: rgba(0, 0, 0, 0); }\r\n\r\n.adsk-viewing-viewer .edge-gizmo.selected {\r\n    background-color: lime; }\r\n    \r\n.adsk-viewing-viewer .vertex-gizmo:hover.vertex-gizmo.enable-hover {\r\n    border-color: lime; }\r\n    \r\n.adsk-viewing-viewer .vertex-gizmo {\r\n    display: inline-block;\r\n    position: absolute;\r\n    width: 7px;\r\n    height: 7px;\r\n    left: -2px;\r\n    top: -2px;\r\n    background-color: #009bff;\r\n    border-style: solid;\r\n    border-width: 2px;\r\n    border-color: #FFFFFF;\r\n    border-radius: 100px;\r\n    box-shadow: 0 2px 5px 0 #182A3D;\r\n    z-index: 1;\r\n     /* Place above the viewer but below the measure labels, which are at 2 */\r\n     cursor: move; \r\n    }\r\n     \r\n.adsk-viewing-viewer .vertex-gizmo.selected {\r\n    border-color: lime; \r\n}\r\n    \r\n.adsk-viewing-viewer .edge-move-gizmo \r\n{\r\n    width: 20px;\r\n      /* width along the edge */\r\n    height: 6px;\r\n     /* height vertical to the edge */ \r\n    }","",{version:3,sources:["webpack://./Edit2D/Edit2D.css"],names:[],mappings:"AAAA;;IAEI,sBAAsB;AAC1B;AACA;;IAEI,kBAAkB;IAClB,yBAAyB;IACzB,+CAA+C;IAC/C,kBAAkB;IAClB,YAAY;IACZ,UAAU;IACV,wEAAwE;IACxE,6CAA6C,EAAE;;AAEnD;IACI,sBAAsB,EAAE;;AAE5B;IACI,kBAAkB,EAAE;;AAExB;IACI,qBAAqB;IACrB,kBAAkB;IAClB,UAAU;IACV,WAAW;IACX,UAAU;IACV,SAAS;IACT,yBAAyB;IACzB,mBAAmB;IACnB,iBAAiB;IACjB,qBAAqB;IACrB,oBAAoB;IACpB,+BAA+B;IAC/B,UAAU;KACT,wEAAwE;KACxE,YAAY;IACb;;AAEJ;IACI,kBAAkB;AACtB;;AAEA;;IAEI,WAAW;MACT,yBAAyB;IAC3B,WAAW;KACV,gCAAgC;IACjC",sourcesContent:[".adsk-viewing-viewer .edge-gizmo:hover \r\n{  \r\n    background-color: lime; \r\n}\r\n.adsk-viewing-viewer .edge-gizmo \r\n{  \r\n    position: absolute;\r\n    background-color: #009bff;\r\n    box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.25);\r\n    border-radius: 8px;\r\n    cursor: move;\r\n    z-index: 1;\r\n    /* Place above the viewer but below the measure labels, which are at 2 */\r\n    -webkit-tap-highlight-color: rgba(0, 0, 0, 0); }\r\n\r\n.adsk-viewing-viewer .edge-gizmo.selected {\r\n    background-color: lime; }\r\n    \r\n.adsk-viewing-viewer .vertex-gizmo:hover.vertex-gizmo.enable-hover {\r\n    border-color: lime; }\r\n    \r\n.adsk-viewing-viewer .vertex-gizmo {\r\n    display: inline-block;\r\n    position: absolute;\r\n    width: 7px;\r\n    height: 7px;\r\n    left: -2px;\r\n    top: -2px;\r\n    background-color: #009bff;\r\n    border-style: solid;\r\n    border-width: 2px;\r\n    border-color: #FFFFFF;\r\n    border-radius: 100px;\r\n    box-shadow: 0 2px 5px 0 #182A3D;\r\n    z-index: 1;\r\n     /* Place above the viewer but below the measure labels, which are at 2 */\r\n     cursor: move; \r\n    }\r\n     \r\n.adsk-viewing-viewer .vertex-gizmo.selected {\r\n    border-color: lime; \r\n}\r\n    \r\n.adsk-viewing-viewer .edge-move-gizmo \r\n{\r\n    width: 20px;\r\n      /* width along the edge */\r\n    height: 6px;\r\n     /* height vertical to the edge */ \r\n    }"],sourceRoot:""}]);const a=s},645:t=>{"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var i="",n=void 0!==e[5];return e[4]&&(i+="@supports (".concat(e[4],") {")),e[2]&&(i+="@media ".concat(e[2]," {")),n&&(i+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),i+=t(e),n&&(i+="}"),e[2]&&(i+="}"),e[4]&&(i+="}"),i})).join("")},e.i=function(t,i,n,r,o){"string"==typeof t&&(t=[[null,t,void 0]]);var s={};if(n)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(s[l]=!0)}for(var h=0;h<t.length;h++){var u=[].concat(t[h]);n&&s[u[0]]||(void 0!==o&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=o),i&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=i):u[2]=i),r&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=r):u[4]="".concat(r)),e.push(u))}},e}},537:t=>{"use strict";t.exports=function(t){var e=t[1],i=t[3];if(!i)return e;if("function"==typeof btoa){var n=btoa(unescape(encodeURIComponent(JSON.stringify(i)))),r="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(n),o="/*# ".concat(r," */"),s=i.sources.map((function(t){return"/*# sourceURL=".concat(i.sourceRoot||"").concat(t," */")}));return[e].concat(s).concat([o]).join("\n")}return[e].join("\n")}},379:t=>{"use strict";var e=[];function i(t){for(var i=-1,n=0;n<e.length;n++)if(e[n].identifier===t){i=n;break}return i}function n(t,n){for(var o={},s=[],a=0;a<t.length;a++){var l=t[a],h=n.base?l[0]+n.base:l[0],u=o[h]||0,p="".concat(h," ").concat(u);o[h]=u+1;var c=i(p),d={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==c)e[c].references++,e[c].updater(d);else{var y=r(d,n);n.byIndex=a,e.splice(a,0,{identifier:p,updater:y,references:1})}s.push(p)}return s}function r(t,e){var i=e.domAPI(e);return i.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;i.update(t=e)}else i.remove()}}t.exports=function(t,r){var o=n(t=t||[],r=r||{});return function(t){t=t||[];for(var s=0;s<o.length;s++){var a=i(o[s]);e[a].references--}for(var l=n(t,r),h=0;h<o.length;h++){var u=i(o[h]);0===e[u].references&&(e[u].updater(),e.splice(u,1))}o=l}}},569:t=>{"use strict";var e={};t.exports=function(t,i){var n=function(t){if(void 0===e[t]){var i=document.querySelector(t);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(t){i=null}e[t]=i}return e[t]}(t);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(i)}},216:t=>{"use strict";t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},565:(t,e,i)=>{"use strict";t.exports=function(t){var e=i.nc;e&&t.setAttribute("nonce",e)}},795:t=>{"use strict";t.exports=function(t){var e=t.insertStyleElement(t);return{update:function(i){!function(t,e,i){var n="";i.supports&&(n+="@supports (".concat(i.supports,") {")),i.media&&(n+="@media ".concat(i.media," {"));var r=void 0!==i.layer;r&&(n+="@layer".concat(i.layer.length>0?" ".concat(i.layer):""," {")),n+=i.css,r&&(n+="}"),i.media&&(n+="}"),i.supports&&(n+="}");var o=i.sourceMap;o&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),e.styleTagTransform(n,t,e.options)}(e,t,i)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},589:t=>{"use strict";t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}}},e={};function i(n){var r=e[n];if(void 0!==r)return r.exports;var o=e[n]={id:n,exports:{}};return t[n](o,o.exports,i),o.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.nc=void 0;var n={};(()=>{"use strict";i.r(n),i.d(n,{default:()=>In});var t={numIterations:100,minSegLenFraction:.05};function e(e,i,n,r,o,s,a,l,h,u,p){p=p||t;for(var c=(u=u||1/p.minSegLenFraction)*p.minSegLenFraction,d=1/p.numIterations,y=d*d*d,f=3*d,v=f*d,g=v+v,m=6*y,P=i-2*r+s,x=n-2*o+a,C=3*(r-s)-i+l,E=3*(o-a)-n+h,S=i,b=n,T=(r-i)*f+P*v+C*y,I=(o-n)*f+x*v+E*y,_=P*g+C*m,L=x*g+E*m,w=C*m,k=E*m,A=0,O=0|1/d-.5,N=0;N<O;N++)S+=T,b+=I,T+=_,I+=L,L+=k,_+=w,(A+=Math.sqrt(T*T+I*I))>=c&&(e.lineTo(S,b),A=0);e.lineTo(l,h)}function r(e,i,n,r,o,s,a,l,h){h=h||t;for(var u=(l=l||1/h.minSegLenFraction)*h.minSegLenFraction,p=1/h.numIterations,c=p*p,d=i-2*r+s,y=n-2*o+a,f=i,v=n,g=2*(r-i)*p+d*c,m=2*(o-n)*p+y*c,P=2*d*c,x=2*y*c,C=0,E=0|1/p-.5,S=0;S<E;S++)f+=g,v+=m,g+=P,m+=x,(C+=Math.sqrt(g*g+m*m))>=u&&(e.lineTo(f,v),C=0);e.lineTo(s,a)}var o=i(431),s=i.n(o),a=i(299),l=i.n(a),h=new THREE.Vector2,u=new THREE.Box2;function p(t){this.segTypes=[],this.segData=[],this.hasCurves=!1,this.bbox=new THREE.Box2,this.precisionTolerance=t}function c(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function d(t,e,i){return e&&c(t.prototype,e),i&&c(t,i),t}p.prototype.setTessParams=function(t){this.tessParams=t},p.prototype.closePath=function(){this.segTypes.length&&7===this.segTypes[this.segTypes.length-1]||this.segTypes.push(7)},p.prototype.moveTo=function(t,e){this.segTypes.push(0),this.segData.push(t,e),this.bbox.expandByPoint(h.set(t,e))},p.prototype.lineTo=function(t,e){this.segTypes.push(1),this.segData.push(t,e),this.bbox.expandByPoint(h.set(t,e))},p.prototype.arc=function(t,e,i,n,r,o){this.hasCurves=!0,this.segTypes.push(2),this.segData.push(t,e,i,n,r,o),this.bbox.expandByPoint(h.set(t,e))},p.prototype.arcTo=function(t,e,i,n,r){this.hasCurves=!0,this.segTypes.push(3),this.segData.push(t,e,i,n,r),this.bbox.expandByPoint(h.set(t,e)),this.bbox.expandByPoint(h.set(i,n))},p.prototype.quadraticCurveTo=function(t,e,i,n){this.hasCurves=!0,this.segTypes.push(4),this.segData.push(t,e,i,n),this.bbox.expandByPoint(h.set(t,e)),this.bbox.expandByPoint(h.set(i,n))},p.prototype.bezierCurveTo=function(t,e,i,n,r,o){this.hasCurves=!0,this.segTypes.push(5),this.segData.push(t,e,i,n,r,o),this.bbox.expandByPoint(h.set(t,e)),this.bbox.expandByPoint(h.set(i,n)),this.bbox.expandByPoint(h.set(r,o))},p.prototype.flatten=function(t){for(var i=new p(this.precisionTolerance),n=0,o=0,s=0,a=o,l=s,h=this.segTypes,u=this.segData,c=this.bbox.size().length(),d=0;d<h.length;d++)switch(h[d]){case 0:t&&(o===a&&s===l||i.closePath()),a=o=u[n++],l=s=u[n++],i.moveTo(o,s);break;case 7:i.closePath();break;case 1:var y=u[n++],f=u[n++];y===o&&f===s||(i.lineTo(y,f),o=y,s=f);break;case 4:r(i,o,s,u[n++],u[n++],y=u[n++],f=u[n++],c,this.tessParams),o=y,s=f;break;case 5:e(i,o,s,u[n++],u[n++],u[n++],u[n++],y=u[n++],f=u[n++],c,this.tessParams),o=y,s=f;break;case 2:console.warn("not implemented: arc"),n+=6;break;case 3:console.warn("not implemented: arcto"),n+=4}return t&&(o===a&&s===l||i.closePath()),i},p.prototype.applyTransform=function(t,e){for(var i=0;i<this.segData.length;i+=2){var n=this.segData[i],r=this.segData[i+1];this.segData[i]=t.tx(n,r,e),this.segData[i+1]=t.ty(n,r,e)}},p.prototype.stroke=function(t,e,i,n,r,o,a,l){var h=this,u=null!=o,c=this;(a||this.hasCurves)&&(c=this.flatten(!1));var d=this;if(u){for(var y,f=[],v=0,g=0;g<c.segTypes.length;g++)0==c.segTypes[g]?(y=new p(this.precisionTolerance),f.push(y),y.moveTo(c.segData[v++],c.segData[v++])):1==c.segTypes[g]?y.lineTo(c.segData[v++],c.segData[v++]):7==c.segTypes[g]&&y.closePath();var m=o.flattened||o.flatten(!0),P=m.toClipperPath(t,!1);f.map((function(o){var u=d.preCheckForClipping(t,m,o,a,!0);if(!u.needCancel)if(u.needClipping){var p=o.toClipperPath(t,a)[0];if(!p)return;var c=new(s().PolyTree),y=new(s().Clipper),f=p[0].X==p[p.length-1].X&&p[0].Y==p[p.length-1].Y;y.AddPath(p,s().PolyType.ptSubject,f),y.AddPaths(P,s().PolyType.ptClip,!0),y.Execute(s().ClipType.ctIntersection,c,s().PolyFillType.pftEvenOdd,s().PolyFillType.pftEvenOdd),function(o){for(var s=o.GetFirst();s;)d.strokeClipperContour(t,s.Contour(),s.IsOpen,i,e,n,r,t.currentVpId,l,!1),s=s.GetNext()}(c)}else h.strokeFlattedPath(t,o,e,i,n,r,a,l)}))}else this.strokeFlattedPath(t,c,e,i,n,r,a,l)},p.prototype.strokeFlattedPath=function(t,e,i,n,r,o,s,a){var l,h=e.segData,u=e.segTypes;s&&(l=t.getCurrentTransform());for(var p=0,c=0,d=0,y=0,f=0,v=0;v<u.length;v++){var g=u[v];switch(g){case 0:var m=h[p++],P=h[p++];s?(y=t.tx(m,P,l),f=t.ty(m,P,l)):(y=m,f=P),c=y,d=f;break;case 7:case 1:var x=void 0,C=void 0;if(7===g)x=y,C=f;else{var E=h[p++],S=h[p++];s?(x=t.tx(E,S,l),C=t.ty(E,S,l)):(x=E,C=S)}x===c&&C===d||(t.flushBuffer(4),t.currentVbb.addSegment(c,d,x,C,0,i,n,r,o,t.currentVpId||0,a),c=x,d=C);break;default:console.error("Path must be flattened before rendering")}}},p.prototype.strokeClipperContour=function(t,e,i,n,r,o,s,a,l,h){var u,p=e.length,c=i?0:p-1,d=i?1:0;h&&(u=t.getCurrentTransform());for(var y=h?t.tx(e[c].X,e[c].Y,u):e[c].X,f=h?t.ty(e[c].X,e[c].Y,u):e[c].Y,v=d;v<p;v++){var g=h?t.tx(e[v].X,e[v].Y,u):e[v].X,m=h?t.ty(e[v].X,e[v].Y,u):e[v].Y;t.flushBuffer(4),t.currentVbb.addSegment(y,f,g,m,0,r,n,o,s,a,l),y=g,f=m}},p.prototype.isAABB=function(){var t=1e-10,e=.001,i=this.segTypes;if(6!==i.length&&5!==i.length)return!1;if(0!==i[0])return!1;if(6===i.length&&7!==i[5])return!1;if(5===i.length&&7!==i[4]&&1!==i[4])return!1;for(var n=1;n<i.length-1;n++)if(1!==i[n])return!1;var r=this.segData,o=r[2]-r[0],s=r[3]-r[1],a=r[6]-r[4],l=r[7]-r[5],h=Math.sqrt(o*o+s*s),u=Math.sqrt(a*a+l*l);if(Math.abs(h-u)>t)return!1;var p=(o/=h)*(a/=u)+(s/=h)*(l/=u);if(Math.abs(1+p)>e)return!1;var c=r[4]-r[2],d=r[5]-r[3],y=r[8]-r[6],f=r[9]-r[7],v=Math.sqrt(c*c+d*d),g=Math.sqrt(y*y+f*f);return!(Math.abs(v-g)>t||(p=(c/=v)*(y/=g)+(d/=v)*(f/=g),Math.abs(1+p)>e||(p=o*c+s*d,Math.abs(p)>e||Math.abs(o)>t&&Math.abs(s))))},p.prototype.isAABBContain=function(t){return this.isAABB()?function(t,e,i){if(t.containsBox(e))return 1;var n=i;return void 0===n&&(n=.001/t.size().length()),e.min.x-t.max.x>n||e.min.y-t.min.y>n||e.max.x-t.max.x<-n||e.max.y-t.max.y<-n?2:e.min.x-t.min.x<-n||e.min.y-t.min.y<-n||e.max.x-t.max.x>n||e.max.y-t.max.y>n?4:1}(this.bbox,t,this.precisionTolerance):4},p.prototype.clip=function(t,e){var i=t.flattened||t.flatten(!0),n=this.flattened||this.flatten(!0),r=this.preCheckForClipping(null,i,n,!1,!1);if(r.needCancel)return console.warn("No overlap between nested clip regions."),null;if(0==r.needClipping)return r.needSwapSubject?t:this;var o=i.toClipperPath(null,!1),a=n.toClipperPath(null,!1),l=new(s().PolyTree),h=new(s().Clipper);h.AddPaths(a,s().PolyType.ptSubject,!0),h.AddPaths(o,s().PolyType.ptClip,!0),h.Execute(s().ClipType.ctIntersection,l,s().PolyFillType.pftEvenOdd,s().PolyFillType.pftEvenOdd);for(var u=new p(this.precisionTolerance),c=l.GetFirst();c;){for(var d=c.Contour(),y=0;y<d.length;y++)0==y?u.moveTo(d[y].X,d[y].Y):u.lineTo(d[y].X,d[y].Y);d[d.length-1].X==d[0].X&&d[d.length-1].Y==d[0].Y||u.lineTo(d[0].X,d[0].Y),c=c.GetNext()}return u},p.prototype.isFillable=function(){var t=this.flattened||this.flatten(!0);if(t.segTypes.length<3)return!1;if(3!==t.segTypes.length){for(var e=!1,i=0;i<t.segTypes.length;i+=2)if(0!=t.segTypes[i]||1!=t.segTypes[i+1]){e=!0;break}return e}return(7!==t.segTypes[2]||1!==t.segTypes[1]||0!==t.segTypes[0])&&void 0},p.prototype.fill=function(t,e,i,n,r,o,a){if(this.isFillable()){var l=this.flattened||this.flatten(!0),h=this,u=function(){var e,i=null!=r,n=!1;if(i){var a=r.flattened||r.flatten(!0),u=h.preCheckForClipping(t,a,l,o,!1);if(u.needCancel)return;i=u.needClipping,n=u.needSwapSubject}if(i){var p=(a=r.flattened||r.flatten(!0)).toClipperPath(t,!1),c=l.toClipperPath(t,o),d=new(s().PolyTree);return(e=new(s().Clipper)).AddPaths(c,s().PolyType.ptSubject,!0),e.AddPaths(p,s().PolyType.ptClip,!0),e.Execute(s().ClipType.ctIntersection,d,s().PolyFillType.pftEvenOdd,s().PolyFillType.pftEvenOdd),{polygons:y=h.getPolygonFromClipperSolution(d),appliedTransform:o,needClipping:i}}if(l=n?a:l,h.cached)return{polygons:h.cached,appliedTransform:!1,needClipping:i,subjFlatted:l};c=l.toClipperPath(t,!1),d=new(s().PolyTree),(e=new(s().Clipper)).AddPaths(c,s().PolyType.ptSubject,!0),e.Execute(s().ClipType.ctUnion,d,s().PolyFillType.pftEvenOdd,s().PolyFillType.pftEvenOdd);var y=h.getPolygonFromClipperSolution(d);return n||(h.cached=y),{polygons:y,appliedTransform:n,needClipping:i,subjFlatted:l}}();u&&u.polygons.map((function(r){!function(r,o,s){var l=r.vertices;if(o){for(var p=t.getCurrentTransform(),c=[],d=0;d<l.length;d+=2){var y=t.tx(l[d],l[d+1],p),f=t.ty(l[d],l[d+1],p);c.push(y,f)}l=c}if(t.addPolyTriangle(l,r.indices,e,i,n,!1),!a)if(s||!h.isFontChar)for(var v in r.contours)h.strokeClipperContour(t,r.contours[v],!0,e,-.5,i,n,t.currentVpId,0,o);else h.strokeFlattedPath(t,u.subjFlatted,-.5,e,i,n,o,0)}(r,o&&!u.appliedTransform,u.needClipping)}))}},p.prototype.toClipperPath=function(t,e){var i,n=[],r=[],o=this.segTypes,s=this.segData,a=0;function l(n,r){if(e){var o=t.tx(r.X,r.Y,i),s=t.ty(r.X,r.Y,i);r.X=o,r.Y=s}(n.length>0&&(n[n.length-1].X!=r.X||n[n.length-1].Y!=r.Y)||0==n.length)&&n.push(r)}e&&(i=t.getCurrentTransform());for(var h=0;h<o.length;h++)0==o[h]?(r&&r.length>1&&n.push(r),l(r=[],{X:s[a++],Y:s[a++]})):1==o[h]?l(r,{X:s[a++],Y:s[a++]}):7==o[h]&&(r.push({X:r[0].X,Y:r[0].Y}),n.push(r),r=[]);return r&&r.length>1&&n.push(r),n},p.prototype.hasIntersection=function(t,e,i){return!(t.max.x-e.min.x<=-i||t.max.y-e.min.y<=-i||t.min.x-e.max.x>=i||t.min.y-e.max.y>=i)},p.prototype.preCheckForClipping=function(t,e,i,n,r){var o=e.bbox,s=i.bbox;if(n){var a=t.getCurrentTransform();s=t.transformBox(s,a,u)}return this.hasIntersection(o,s,this.precisionTolerance)?e.isAABB()&&o.containsBox(s)?{needClipping:!1}:i.isAABB()&&s.containsBox(o)?r?{needCancel:!0}:{needClipping:!1,needSwapSubject:!0}:{needClipping:!0}:{needCancel:!0}},p.prototype.getPolygonFromClipperSolution=function(t){function e(t,e,i){for(var n=0;n<i.length;n++)e.push(i[n].X,i[n].Y);t.push(i)}return s().JS.PolyTreeToExPolygons(t).map((function(t){var i=[],n=[],r=[];if(1==t.holes.length&&Math.abs(s().JS.AreaOfPolygons(t.holes))>Math.abs(s().JS.AreaOfPolygon(t.outer))){var o=t.holes[0];t.holes[0]=t.outer,t.outer=o}e(r,i,t.outer),t.holes.map((function(t){n.push(i.length/2),e(r,i,t)}));var a=l()(i,n);return{vertices:i,indices:a,holeIndices:n,contours:r}}))},p.prototype.msdfClipping=function(t){var e=(this.flattened||this.flatten(!0)).toClipperPath(null,!1),i=t.toClipperPath(null,!1),n=new(s().PolyTree),r=new(s().Clipper);return r.AddPaths(e,s().PolyType.ptSubject,!0),r.AddPaths(i,s().PolyType.ptClip,!0),r.Execute(s().ClipType.ctIntersection,n,s().PolyFillType.pftEvenOdd,s().PolyFillType.pftEvenOdd),this.getPolygonFromClipperSolution(n)};var y=Autodesk.Viewing,f=y.Private,v=f.VertexBufferBuilder,g=y.getGlobal().document,m=new Array(6),P=new THREE.Vector2,x=new THREE.Box2,C=new THREE.Vector3,E=new THREE.Quaternion,S=new THREE.Vector3,b=new THREE.Vector3,T=new THREE.Matrix4,I=function(){function e(i,n,r,o,s,a,l){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var h,u,p=g.createElement("canvas"),c=p.getContext("2d");if(p.height=i.height,p.width=i.width,this.canvasContext=c,this.viewport=i,this.toPageUnits=n,this.meshCallback=r,1==i.clipToViewport){var d=i.offsetX||0,f=i.offsetY||0;this.bounds=new THREE.Vector4(d*n,f*n,(i.width+d)*n,(i.height+f)*n)}this.currentMeshIndex=0,this.imageNumber=0,this.currentVbb=new v(!1),this._curPath=null,this._curClip=null,this.first=!0,this.states=[],this.glyphCache={},this.usingTextLayer=s,this.precisionTolerance=.1,this.dbId=-1,this.consecutiveIds=!1,y.isMobileDevice()&&(.1,void 0&&(t.numIterations=undefined),t.minSegLenFraction=.1),this.fontEngine=o,this.lineStyle=0,this.isScreenSpace=!1,h=c,u=this,["fillRect","strokeRect","clearRect","beginPath","closePath","moveTo","lineTo","arc","arcTo","quadraticCurveTo","bezierCurveTo","rect","fill","stroke","clip","strokeText","fillText","drawImage","save","restore","setLineDash","createPattern","beginMarkedContent","beginMarkedContentProps","endMarkedContent","setCurrentOperatorIndex","needDelegateInlineImageGroup","isLMVCanvasContext"].forEach((function(t){h["_original"+t]=h[t],h[t]=u[t].bind(u)})),this.layers={},this.defaultLayerId=0,this.currentLayerId=this.defaultLayerId,this.sequencedDbId=-1,this.taggedId=null,this.defaultVPId=0,this.currentVpId=this.defaultVPId,this.viewports=[this.createViewPortData((new THREE.Matrix4).elements)],this.viewportMap={},this.ocgStack=[],this.idRemap=[],this.idIndexMap={},this.msdfRender=!0,this.fontAtlas=a,this.pdfRefMap=l||{}}return d(e,null,[{key:"isRef",value:function(t){return null!=t&&"number"==typeof t.num&&"number"==typeof t.gen}},{key:"refKey",value:function(t){return"".concat(t.num,"-").concat(t.gen)}}]),d(e,[{key:"updateDBId",value:function(){null!=this.taggedId?null!=this.idIndexMap[this.taggedId]?this.dbId=this.idIndexMap[this.taggedId]:(this.sequencedDbId++,this.dbId=this.sequencedDbId,this.idRemap[this.dbId]=this.taggedId,this.idIndexMap[this.taggedId]=this.dbId):(this.consecutiveIds&&(this.sequencedDbId++,this.dbId=this.sequencedDbId),this.idRemap[this.dbId]=this.dbId)}},{key:"save",value:function(){this.states.push({clip:this._curClip,consecutiveIds:this.consecutiveIds,dbId:this.dbId,lineDashedDef:this.lineDashedDef,lineStyle:this.lineStyle}),this.canvasContext._originalsave()}},{key:"restore",value:function(){var t=this.states.pop();t&&(this._curClip=t.clip,this.consecutiveIds=t.consecutiveIds,this.dbId=t.dbId,this.lineDashedDef=t.lineDashedDef,this.lineStyle=t.lineStyle),this.canvasContext._originalrestore()}},{key:"flushBuffer",value:function(t,e,i){if(this.currentVbb.vcount||e){if((e||this.currentVbb.isFull(t))&&this.currentVbb.vcount){var n=this.currentVbb.toMesh();n.material={skipEllipticals:!this.currentVbb.numEllipticals,skipCircles:!this.currentVbb.numCirculars,skipTriangleGeoms:!this.currentVbb.numTriangleGeoms,useInstancing:this.currentVbb.useInstancing,isScreenSpace:!this.currentImage,hasLineStyles:this.currentVbb.hasLineStyles,msdfFontTexture:!!this.hasMSDFContent,viewportBounds:this.bounds,imageUVTexture:2===i},this.currentImage&&(n.material.image=this.currentImage,n.material.image.name=this.currentImage.cacheKey||this.imageNumber++,n.material.compositeOperation=this.canvasContext.globalCompositeOperation,n.material.compositeCanvasColor="#ffffff",n.material.opacity=this.canvasContext.globalAlpha,this.currentImage=null),this.meshCallback(n,this.currentMeshIndex++),this.currentVbb.reset(0),this.hasMSDFContent=!1}}}},{key:"addPolyTriangle",value:function(t,e,i,n,r,o){var s=this,a=null,l=this.currentVpId;function h(t,e){if(t>e){var i=t;t=e,e=i}if(a[t]){var n=a[t],r=n.lastIndexOf(e);-1==r?n.push(e):n[r]=-1}else a[t]=[e]}function u(e,o){if(e>o){var h=e;e=o,o=h}var u=a[e];u&&-1!=u.indexOf(o)&&(s.flushBuffer(4),s.currentVbb.addSegment(t[2*e],t[2*e+1],t[2*o],t[2*o+1],s.currentLayerId,-.5,i,n,r,l,s.lineStyle))}if(o){a=new Array(t.length/2);for(var p=0,c=e.length;p<c;p+=3){var d=e[p],y=e[p+1],f=e[p+2];h(d,y),h(y,f),h(f,d)}}if(isNaN(i)&&!0===i.isPattern){this.flushBuffer(0,!0);var v=i.image,g=t.length/2;this.flushBuffer(g);var m=(I=this.currentVbb).vcount,P=this.getCurrentTransform(),x=this.tx(0,0,P),C=this.ty(0,0,P),E=Math.abs(this.tx(v.width,v.height,P)-x),S=Math.abs(this.ty(v.width,v.height,P)-C);for(p=0;p<g;++p){var b=((_=t[2*p])-x)/E,T=((L=t[2*p+1])-C)/S;I.addVertexImagePolytriangle(_,L,b,T,4294967295,n,r,l)}this.currentImage=v,I.addIndices(e,m),this.flushBuffer(0,!0,2)}else if(this.currentVbb.useInstancing)for(g=e.length,p=0;p<g;p+=3)d=e[p],y=e[p+1],f=e[p+2],this.flushBuffer(4),this.currentVbb.addTriangleGeom(t[2*d],t[2*d+1],t[2*y],t[2*y+1],t[2*f],t[2*f+1],i,n,r,l),o&&(u(d,y),u(y,f),u(f,d));else{var I;for(g=t.length/2,this.flushBuffer(g),m=(I=this.currentVbb).vcount,p=0;p<g;++p){var _=t[2*p],L=t[2*p+1];I.addVertexPolytriangle(_,L,i,n,r,l)}I.addIndices(e,m),o&&function(){for(var e=0,o=a.length;e<o;e++){var h=a[e];if(h)for(var u=0;u<h.length;u++){var p=h[u];-1!=p&&(s.flushBuffer(4),s.currentVbb.addSegment(t[2*e],t[2*e+1],t[2*p],t[2*p+1],s.currentLayerId,-.5,i,n,r,l,s.lineStyle))}}}()}}},{key:"getFillColor",value:function(){if(this.canvasContext.fillStyle&&!0===this.canvasContext.fillStyle.isPattern)return this.canvasContext.fillStyle;if("string"!=typeof this.canvasContext.fillStyle)return console.warn("Unsupported fill style."),0;var t=parseInt(this.canvasContext.fillStyle.slice(1),16);return 255*this.canvasContext.globalAlpha<<24|(255&t)<<16|65280&t|t>>16&255}},{key:"getStrokeColor",value:function(){var t=this.canvasContext;if(this.lastStrokeStyle===t.strokeStyle&&t.globalAlpha===this.lastAlpha)return this.lastRgb;var e=parseInt(t.strokeStyle.slice(1),16),i=255*t.globalAlpha<<24|(255&e)<<16|65280&e|e>>16&255;return this.lastRgb=i,this.lastStrokeStyle=t.strokeStyle,this.lastAlpha=t.globalAlpha,i}},{key:"getCurrentTransform",value:function(){var t=this.canvasContext.mozCurrentTransform;if(this.isFontChar){var e=this.invXform,i=t[0],n=t[1],r=t[2],o=t[3],s=t[4],a=t[5];return m[0]=e[0]*i+e[2]*n,m[1]=e[1]*i+e[3]*n,m[2]=e[0]*r+e[2]*o,m[3]=e[1]*r+e[3]*o,m[4]=e[0]*s+e[2]*a+e[4],m[5]=e[1]*s+e[3]*a+e[5],m}return t}},{key:"tx",value:function(t,e,i){return(t*(i=i||this.getCurrentTransform())[0]+e*i[2]+i[4])*(this.isFontChar?1:this.toPageUnits)}},{key:"ty",value:function(t,e,i){return(t*(i=i||this.getCurrentTransform())[1]+e*i[3]+i[5])*(this.isFontChar?1:this.toPageUnits)}},{key:"scaleValue",value:function(t,e){return e=e||this.getCurrentTransform(),this.toPageUnits*Math.sqrt(Math.abs(e[0]*e[3]-e[1]*e[2]))*t}},{key:"transformBox",value:function(t,e,i){return e=e||this.getCurrentTransform(),x.makeEmpty(),P.set(this.tx(t.min.x,t.min.y,e),this.ty(t.min.x,t.min.y,e)),x.expandByPoint(P),P.set(this.tx(t.max.x,t.min.y,e),this.ty(t.max.x,t.min.y,e)),x.expandByPoint(P),P.set(this.tx(t.max.x,t.max.y,e),this.ty(t.max.x,t.max.y,e)),x.expandByPoint(P),P.set(this.tx(t.min.x,t.max.y,e),this.ty(t.min.x,t.max.y,e)),x.expandByPoint(P),i?(i.copy(x),i):x.clone()}},{key:"fillRect",value:function(t,e,i,n){this.updateDBId();var r=this.getCurrentTransform(),o=[this.tx(t,e,r),this.ty(t,e,r),this.tx(t+i,e,r),this.ty(t+i,e,r),this.tx(t+i,e+n,r),this.ty(t+i,e+n,r),this.tx(t,e+n,r),this.ty(t,e+n,r)],s=this.getFillColor(),a=this.first?-1:this.dbId;this.addPolyTriangle(o,[0,1,2,0,2,3],s,a,this.currentLayerId,!1),this.first=!1}},{key:"strokeRect",value:function(t,e,i,n){console.log("strokeRect")}},{key:"clearRect",value:function(t,e,i,n){console.log("clearRect")}},{key:"_beginTextChar",value:function(t,e,i,n,r){this.isFontChar=!0,this.invXform=this.canvasContext.mozCurrentTransformInverse,this.hashKey=t.charCodeAt(0)+"/"+n.loadedName+"/"+r,this.cachedGlyph=this.glyphCache[this.hashKey],this.cachedGlyph?this.skipPath=!0:this.skipPath=!1}},{key:"drawMSDFText",value:function(t,e,i,n,r){var o=n.name;function s(t,e,i,n,r,o){return Math.abs((o-n)*t-(r-i)*e+r*n-o*i)/Math.sqrt((o-n)*(o-n)+(r-i)*(r-i))}if(this.fontAtlas&&this.fontAtlas.charsMap&&this.fontAtlas.charsMap[o]){var a=this.fontAtlas.charsMap[o][t.charCodeAt(0)];if(null==a)return!1;this.currentVbb.isFull(4)&&this.flushBuffer(0,!0),this.hasMSDFContent=!0;var l=this.fontAtlas.chars[a];if(l.page>0)return!1;for(var h=this.fontAtlas.common[l.common],u=r/this.fontAtlas.info[l.info].size,c=l.width*(u+0),d=l.inverseYAxis?-1:1,y=l.height*(u+i)*d,f=l.txoffset*(u+0),v=l.tyoffset*(u+i)*-d,g=[f,v,f,v+y,f+c,v+y,f+c,v],m=[],P=0;P<g.length;P+=2)m.push(this.tx(g[P],g[P+1])),m.push(this.ty(g[P],g[P+1]));if(l.inverseYAxis)var x=[l.x/h.scaleW,1-l.y/h.scaleH,l.x/h.scaleW,1-(l.y+l.height)/h.scaleH,(l.x+l.width)/h.scaleW,1-(l.y+l.height)/h.scaleH,(l.x+l.width)/h.scaleW,1-l.y/h.scaleH];else x=[l.x/h.scaleW,1-(l.y+l.height)/h.scaleH,l.x/h.scaleW,1-l.y/h.scaleH,(l.x+l.width)/h.scaleW,1-l.y/h.scaleH,(l.x+l.width)/h.scaleW,1-(l.y+l.height)/h.scaleH];if(this._curClip){var C=new p(this.precisionTolerance),E=0;C.moveTo(m[E++],m[E++]),C.lineTo(m[E++],m[E++]),C.lineTo(m[E++],m[E++]),C.lineTo(m[E++],m[E++]),C.closePath();var S=C.flattened||C.flatten(!0),b=this._curClip.flattened||this._curClip.flatten(!0),T=C.preCheckForClipping(this,b,S,!1,!1);if(T.needClipping){for(var I=C.msdfClipping(b),_=m[0],L=m[1],w=m[6],k=m[7],A=m[2],O=m[3],N=Math.sqrt((w-_)*(w-_)+(k-L)*(k-L)),M=Math.sqrt((A-_)*(A-_)+(O-L)*(O-L)),D=0;D<I.length;D++){var B=I[D];this.currentVbb.isFull(B.vertices.length)&&this.flushBuffer(0,!0);for(var X=this.currentVbb.vcount,Y=0;Y<B.vertices.length;Y+=2){var F=B.vertices[Y],z=B.vertices[Y+1],R=s(F,z,_,L,w,k),V=s(F,z,_,L,A,O),G=x[0]+(x[4]-x[0])*(V/N),H=x[1]+(x[5]-x[1])*(R/M);this.currentVbb.addVertexMSDFPolytriangle(F,z,G,H,this.getFillColor(),this.dbId,this.currentLayerId,0)}this.currentVbb.addIndices(B.indices,X)}return this.currentImage=this.fontAtlas.pages[l.page],!0}if(T.needCancel)return!0}this.currentVbb.isFull(4)&&this.flushBuffer(0,!0);for(var W=this.currentVbb.vcount,j=g.length/2,U=0;U<j;U++)this.currentVbb.addVertexMSDFPolytriangle(m[2*U],m[2*U+1],x[2*U],x[2*U+1],this.getFillColor(),this.dbId,this.currentLayerId,0);return this.currentVbb.addIndices([0,2,1,0,2,3],W),this.currentImage=this.fontAtlas.pages[l.page],!0}return!1}},{key:"beginPath",value:function(t,e,i,n,r){this.updateDBId(),"string"==typeof t&&n&&r?this.fontAtlas&&this.drawMSDFText(t,e,i,n,r)||!0===this.usingTextLayer?this.skipPath=!0:this._beginTextChar(t,e,i,n,r):(this.skipPath=!1,this.isFontChar=!1,this.cachedGlyph=null),this.skipPath?this._curPath=null:(this._curPath=new p(this.isFontChar?1e-4:this.precisionTolerance),this._curPath.setTessParams(this.tessParams))}},{key:"closePath",value:function(){this.skipPath||(this._curPath.closePath(),this.cachedGlyph=null)}},{key:"moveTo",value:function(t,e){if(!this.skipPath){this._curPath||this.beginPath();var i=this.getCurrentTransform();this._curPath.moveTo(this.tx(t,e,i),this.ty(t,e,i))}}},{key:"lineTo",value:function(t,e){if(!this.skipPath){var i=this.getCurrentTransform();this._curPath.lineTo(this.tx(t,e,i),this.ty(t,e,i))}}},{key:"arc",value:function(t,e,i,n,r,o){this.skipPath||this._curPath.arc(t,e,i,n,r,o)}},{key:"arcTo",value:function(t,e,i,n,r){if(!this.skipPath){var o=this.getCurrentTransform();this._curPath.arcTo(this.tx(t,e,o),this.ty(t,e,o),this.tx(i,n,o),this.ty(i,n,o),this.scaleValue(r,o))}}},{key:"quadraticCurveTo",value:function(t,e,i,n){if(!this.skipPath){var r=this.getCurrentTransform();this._curPath.quadraticCurveTo(this.tx(t,e,r),this.ty(t,e,r),this.tx(i,n,r),this.ty(i,n,r))}}},{key:"bezierCurveTo",value:function(t,e,i,n,r,o){if(!this.skipPath){var s=this.getCurrentTransform();this._curPath.bezierCurveTo(this.tx(t,e,s),this.ty(t,e,s),this.tx(i,n,s),this.ty(i,n,s),this.tx(r,o,s),this.ty(r,o,s))}}},{key:"rect",value:function(t,e,i,n){if(!this.skipPath){var r=this.getCurrentTransform();this._curPath||this.beginPath(),this._curPath.moveTo(this.tx(t,e,r),this.ty(t,e,r)),this._curPath.lineTo(this.tx(t+i,e,r),this.ty(t+i,e,r)),this._curPath.lineTo(this.tx(t+i,e+n,r),this.ty(t+i,e+n,r)),this._curPath.lineTo(this.tx(t,e+n,r),this.ty(t,e+n,r)),this._curPath.closePath()}}},{key:"fill",value:function(){var t=!1;if(arguments.length){var e,i=(e=arguments.length-1)<0||arguments.length<=e?void 0:arguments[e];"boolean"==typeof i&&(t=i)}this.isFontChar&&!this.cachedGlyph&&(this.glyphCache[this.hashKey]=this._curPath,this.cachedGlyph=this._curPath,this.cachedGlyph.isFontChar=!0),this.isFontChar=!1,this.cachedGlyph?this.cachedGlyph.fill(this,this.getFillColor(),this.dbId,this.currentLayerId,this._curClip,!0):this._curPath&&this._curPath.fill(this,this.getFillColor(),this.dbId,this.currentLayerId,this._curClip,!1,t),this.skipPath=!1}},{key:"stroke",value:function(){this.isFontChar&&!this.cachedGlyph&&(this.glyphCache[this.hashKey]=this._curPath,this.cachedGlyph=this._curPath,this.cachedGlyph.isFontChar=!0),this.updateLineDashStyle(),this.isFontChar=!1;var t=this.isScreenSpace?-1:1;this.cachedGlyph?this.cachedGlyph.stroke(this,t*this.scaleValue(this.canvasContext.lineWidth),this.getStrokeColor(),this.dbId,this.currentLayerId,this._curClip,!0,this.lineStyle):this._curPath&&this._curPath.stroke(this,t*this.scaleValue(this.canvasContext.lineWidth),this.getStrokeColor(),this.dbId,this.currentLayerId,this._curClip,!1,this.lineStyle),this.skipPath=!1}},{key:"clip",value:function(t,e){void 0!==e&&void 0!==t?(this._curClip=t,console.log("Probably unsupported use case")):(this._curClip?this._curClip=this._curClip.clip(this._curPath,t):this._curClip=this._curPath,this._curPath=null)}},{key:"strokeText",value:function(t,e,i,n,r,o){var s=this.canvasContext;s.save(),s.translate(e,i),this.fontEngine.drawText(this,t,0,0,r,o),this.stroke(),s.restore()}},{key:"fillText",value:function(t,e,i,n,r,o){var s=this.canvasContext;s.save(),s.translate(e,i),this.fontEngine.drawText(this,t,0,0,r,o),this.fill(),s.restore()}},{key:"drawImage",value:function(t,e,i,n,r,o,s,a,l){if(this.inlineImageGroups&&null!=this.inlineImageGroups.map[this.currentOpIndex]){var h=this.inlineImageGroups.map[this.currentOpIndex],u=this.inlineImageGroups.groups[h];if(1==u.rendered)return;u.rendered=!0,t=u.canvas;var p=1/u.minScale;o=u.bounds.min.x,s=u.bounds.min.y,a=t.width/p,l=t.height/p}if(0!==t.width&&0!==t.height)if(void 0===o&&(o=e,s=i,a=n,l=r),void 0===a&&(a=t.width,l=t.height),a){var c=this.getCurrentTransform(),d=this.tx(o+a/2,s+l/2),y=this.ty(o+a/2,s+l/2);T.elements[0]=c[0],T.elements[1]=c[1],T.elements[4]=c[2],T.elements[5]=c[3],T.elements[12]=c[4],T.elements[13]=c[5],T.decompose(C,E,S);var f=a*S.x*this.toPageUnits,v=-l*S.y*this.toPageUnits,g=Math.sqrt(1-E.w*E.w);b.set(E.x/g,E.y/g,E.z/g);var m=2*Math.acos(Math.max(Math.min(1,E.w),-1));E.z<0&&(m=-m),m<0&&(m+=2*Math.PI),this.flushBuffer(0,!0),this.currentVbb.addTexturedQuad(d,y,f,v,m,4294902015,0,this.currentLayerId,0),this.currentImage=t,this.flushBuffer(0,!0,1)}else console.warn("Zero size image, skipping");else console.warn("Zero size image, skipping")}},{key:"_processProperties",value:function(t){for(var i in e.isRef(t)&&(t=this.pdfRefMap[e.refKey(t)]),t)e.isRef(t[i])&&(t[i]=this.pdfRefMap[e.refKey(t[i])]);return t}},{key:"beginMarkedContent",value:function(t){t&&(t=this._processProperties(t));var e=t.name||t.DBID;isNaN(e)?this.taggedId=null:this.taggedId=parseInt(e),null!=this.taggedId&&this.dbId!=this.taggedId&&this.updateDBId(),t.VP&&(this.currentVpId=this.viewports.length,this.viewports.push(this.createViewPortData(JSON.parse(t.VP),t.UNITS))),this.ocgStack.push({taggedId:this.taggedId,viewPortId:this.currentVpId})}},{key:"beginMarkedContentProps",value:function(t,e){if(e&&(e=this._processProperties(e)),"OC"===t){var i=e.ocgId,n=this.layers[i];null==n&&(n=this.defaultLayerId),this.currentLayerId=n,this.ocgStack.push({layerId:this.currentLayerId})}else isNaN(t)||(this.taggedId=parseInt(t),this.dbId!=this.taggedId&&this.updateDBId()),e?(e.VP&&(this.currentVpId=this.viewports.length,this.viewports.push(this.createViewPortData(JSON.parse(e.VP),e.UNITS))),this.ocgStack.push({viewPortId:this.currentVpId,taggedId:this.taggedId})):this.ocgStack.push({})}},{key:"endMarkedContent",value:function(){var t=this.ocgStack.pop(),e=this.taggedId;if(t&&(null!=t.taggedId&&(this.taggedId=null),t.layerId&&(this.currentLayerId=this.defaultLayerId),t.viewPortId&&(this.currentVpId=this.defaultVPId)),this.ocgStack.length>0){var i=this.ocgStack[this.ocgStack.length-1];null!=i.taggedId&&(this.taggedId=i.taggedId),null!=i.currentLayerId&&(this.currentLayerId=i.currentLayerId),null!=i.viewPortId&&(this.currentVpId=i.viewPortId)}else this.currentLayerId=this.defaultLayerId,this.taggedId=null,this.currentVpId=this.defaultVPId;e!=this.taggedId&&this.updateDBId()}},{key:"setLineStyleParam",value:function(t){if(!this.lineStyleInitialized){for(var e=f.LineStyleDefs.length,i=1,n=0;n<f.LineStyleDefs.length;n++)i=Math.max(f.LineStyleDefs[n].def.length,i);var r=f.createLinePatternTextureData(Math.max(t.width,i),t.height+e+1),o=r.tex,s=r.pw,a=r.lineStyleTex;for(this.lineStyleIndex=0,this.lineStylePw=s,this.lineStyleTexData=o,this.lineStyleTexture=a,this.lineStyleIndexMap={},n=0;n<f.LineStyleDefs.length;n++)this.addNewDashedLineStyle(f.LineStyleDefs[n],96);this.lineStyle=0,this.lineStyleInitialized=!0}}},{key:"addNewDashedLineStyle",value:function(t,e){var i=t.def.join("/");if(null!=this.lineStyleIndexMap[i])return this.lineStyleIndexMap[i];f.createLinePatternForDef(t,this.lineStyleTexData,this.lineStyleIndex,this.lineStylePw,e);var n=this.lineStyleIndex;return this.lineStyleIndexMap[i]=n,this.lineStyleIndex++,n}},{key:"setLineDash",value:function(t){this.lineStyleInitialized||this.setLineStyleParam({width:5,height:4}),this.lineDashedDef=t}},{key:"createPattern",value:function(t,e){var i=this.canvasContext._originalcreatePattern(t,e);return i.image=t,i.repetition=e,i.isPattern=!0,i}},{key:"updateLineDashStyle",value:function(){var t=this.lineDashedDef;if(t)if(t.length>0){for(var e=this.getCurrentTransform(),i=[],n=0;n<t.length;n++){var r=(t[n]*e[0]+t[n]*e[2])*this.toPageUnits;r=parseFloat(r.toFixed(6)),i.push(r)}this.lineStyle=this.addNewDashedLineStyle({def:i},96/72/this.toPageUnits)}else this.lineStyle=0}},{key:"setCircleInfo",value:function(t){this.circleInfo=t}},{key:"setCurrentOperatorIndex",value:function(t){if(this.currentOpIndex=t,this.circleInfo&&this.circleInfo[t]){var e=this.getCurrentTransform(),i=this.tx(this.circleInfo[t][0],this.circleInfo[t][1],e),n=this.ty(this.circleInfo[t][0],this.circleInfo[t][1],e),r=this.currentVbb.addVertexLine(i,n,0,1e-4,0,0,33554431,this.dbId,this.currentLayerId,this.currentVpId);this.currentVbb.finalizeQuad(r)}}},{key:"setInlineImageGroups",value:function(t){t&&t.groups.length>0&&(this.inlineImageGroups=t)}},{key:"needDelegateInlineImageGroup",value:function(){return this.inlineImageGroups&&null!=this.inlineImageGroups.map[this.currentOpIndex]}},{key:"setTessParams",value:function(t){this.tessParams=t}},{key:"finish",value:function(){this.flushBuffer(0,!0),this.fontAtlas=null}},{key:"createViewPortData",value:function(t,e){return{units:e||"feet and inches",transform:t,geom_metrics:this.initGeomMetrics()}}},{key:"isLMVCanvasContext",value:function(){return!0}},{key:"initGeomMetrics",value:function(){return{arcs:0,circles:0,circ_arcs:0,viewports:0,clips:0,colors:0,db_ids:0,dots:0,fills:0,layers:0,line_caps:0,line_joins:0,line_patterns:0,line_pat_refs:0,plines:0,pline_points:0,line_weights:0,links:0,miters:0,ptris:0,ptri_indices:0,ptri_points:0,rasters:0,texts:0,strings:[]}}}]),e}();function _(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var L=1,w=Autodesk.Viewing,k=function(){function t(e){var i,n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),w.EventDispatcher.prototype.apply(this),this.scene=new THREE.Scene,this.shapes=[],this.canvasGizmos=[],this.id=L++,this.context=new I({width:0,height:0},1,this._processMesh.bind(this),null),this.viewer=e,this.setGlobalManager(e.globalManager),this.autoUpdate=!0,this.toPageUnits=1,this.styleModifiers=[],(i=this.context.canvasContext).mozCurrentTransform||(i._originalSave=i.save,i._originalRestore=i.restore,i._originalRotate=i.rotate,i._originalScale=i.scale,i._originalTranslate=i.translate,i._originalTransform=i.transform,i._originalSetTransform=i.setTransform,i._transformMatrix=i._transformMatrix||[1,0,0,1,0,0],i._transformStack=[],Object.defineProperty(i,"mozCurrentTransform",{get:function(){return this._transformMatrix}}),Object.defineProperty(i,"mozCurrentTransformInverse",{get:function(){var t=this._transformMatrix,e=t[0],i=t[1],n=t[2],r=t[3],o=t[4],s=t[5],a=e*r-i*n,l=i*n-e*r;return[r/a,i/l,n/l,e/a,(r*o-n*s)/l,(i*o-e*s)/a]}}),i.save=function(){var t=this._transformMatrix;this._transformStack.push(t),this._transformMatrix=t.slice(0,6),this._originalSave()},i.restore=function(){var t=this._transformStack.pop();t&&(this._transformMatrix=t,this._originalRestore())},i.translate=function(t,e){var i=this._transformMatrix;i[4]=i[0]*t+i[2]*e+i[4],i[5]=i[1]*t+i[3]*e+i[5],this._originalTranslate(t,e)},i.scale=function(t,e){var i=this._transformMatrix;i[0]=i[0]*t,i[1]=i[1]*t,i[2]=i[2]*e,i[3]=i[3]*e,this._originalScale(t,e)},i.transform=function(t,e,n,r,o,s){var a=this._transformMatrix;this._transformMatrix=[a[0]*t+a[2]*e,a[1]*t+a[3]*e,a[0]*n+a[2]*r,a[1]*n+a[3]*r,a[0]*o+a[2]*s+a[4],a[1]*o+a[3]*s+a[5]],i._originalTransform(t,e,n,r,o,s)},i.setTransform=function(t,e,n,r,o,s){this._transformMatrix=[t,e,n,r,o,s],i._originalSetTransform(t,e,n,r,o,s)},i.rotate=function(t){var e=Math.cos(t),i=Math.sin(t),n=this._transformMatrix;this._transformMatrix=[n[0]*e+n[2]*i,n[1]*e+n[3]*i,n[0]*-i+n[2]*e,n[1]*-i+n[3]*e,n[4],n[5]],this._originalRotate(t)}),this.onCameraChange=function(){return n.updateCanvasGizmos()},this.viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChange),this.context.setTessParams({numIterations:100,minSegLenFraction:.01}),this.layerToWorld=new THREE.Matrix4,this.worldToLayer=new THREE.Matrix4,this.tmp_pWorld=new THREE.Vector3,this.tmp_p0=new THREE.Vector2,this.tmp_p1=new THREE.Vector2,this.tmp_ray=new THREE.Ray,this.is3d=!1,this.plane=new THREE.Plane,this._updatePlane()}var e,i;return e=t,i=[{key:"dtor",value:function(){this._clearScene(),this.viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChange)}},{key:"addShape",value:function(e){this.shapes.push(e),this.dispatchEvent({type:t.SHAPE_ADDED,shape:e}),this._onModified()}},{key:"removeShape",value:function(e){var i=this.shapes.indexOf(e);return-1!==i&&(this.shapes.splice(i,1),this.dispatchEvent({type:t.SHAPE_REMOVED,shape:e}),this._onModified(),!0)}},{key:"clear",value:function(){this.shapes.length=0,this.dispatchEvent({type:t.LAYER_CLEARED}),this._onModified()}},{key:"update",value:function(){this._clearScene();for(var t=0;t<this.shapes.length;t++){var e=this.shapes[t],i=this._getOverrideStyle(e);e.draw(this.context,i)}this.context.flushBuffer(0,!0),this.viewer.impl.invalidate(!1,!1,!0),this.updateCanvasGizmos()}},{key:"updateCanvasGizmos",value:function(){for(var t=0;t<this.canvasGizmos.length;t++)this.canvasGizmos[t].update()}},{key:"addCanvasGizmo",value:function(t){this.canvasGizmos.push(t)}},{key:"removeCanvasGizmo",value:function(t){var e=this.canvasGizmos.indexOf(t);return-1!==e&&(this.canvasGizmos.splice(e,1),!0)}},{key:"getViewport",value:function(){return this.viewport}},{key:"hitTest",value:function(t,e){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,n=this.shapes.length-1;n>=0;n--){var r=this.shapes[n],o=this.getLineHitRadius(r,i);if(r.hitTest(t,e,o))return r}}},{key:"getLineHitRadius",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,i=this.getUnitsPerPixel(),n=(t.style.isScreenSpace?i:1)*t.style.lineWidth;return Math.max(n,e*i)}},{key:"addStyleModifier",value:function(t){this.styleModifiers.push(t),this._onModified()}},{key:"removeStyleModifier",value:function(t){var e=this.styleModifiers.indexOf(t);return-1!=e&&(this.styleModifiers.splice(e,1),this._onModified(),!0)}},{key:"layerToCanvas",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new THREE.Vector2,n=this.tmp_pWorld.set(t,e,0).applyMatrix4(this.layerToWorld),r=this.viewer.impl.worldToClient(n);return i.set(r.x,r.y,0)}},{key:"getPixelsPerUnit",value:function(){var t=this.getWindow(),e=this.layerToCanvas(0,0,this.tmp_p0),i=this.layerToCanvas(1,0,this.tmp_p1);return e.distanceTo(i)/t.devicePixelRatio}},{key:"getUnitsPerPixel",value:function(){return 1/this.getPixelsPerUnit()}},{key:"canvasToLayer",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new THREE.Vector2,n=this.viewer.impl.clientToViewport(t,e),r=this.viewer.impl.viewportToRay(n,this.tmp_ray),o=r.intersectPlane(this.plane,this.tmp_pWorld);return o?(o.applyMatrix4(this.worldToLayer),i.set(o.x,o.y,0)):i.set(0,0)}},{key:"enumShapes",value:function(t,e){for(var i=0;i<this.shapes.length;i++){var n=this.shapes[i];n.updateBBox(),t.isIntersectionBox(n.bbox)&&e(n)}}},{key:"enumMeshes",value:function(t,e){for(var i=0;i<this.scene.children.length;i++){var n=this.scene.children[i],r=n.geometry.boundingBox;t.isIntersectionBox(r)&&e(n)}}},{key:"findShapeById",value:function(t){return this.shapes.find((function(e){return e.id==t}))}},{key:"setMatrix",value:function(t){this.layerToWorld.copy(t),this.worldToLayer.getInverse(t),this._updatePlane()}},{key:"_processMesh",value:function(t){var e={mesh:t,is2d:!0,packId:"0",meshIndex:0};Autodesk.Viewing.Private.BufferGeometryUtils.meshToGeometry(e);var i=e.geometry,n=this.viewer.impl.getMaterials(),r=n.create2DMaterial(null,t.material),o=n.findMaterial(null,r),s=new THREE.Mesh(i,o);s.matrix=this.layerToWorld,s.matrixAutoUpdate=!1,this.scene.children.push(s)}},{key:"_onModified",value:function(){this.autoUpdate&&this.update()}},{key:"_getOverrideStyle",value:function(t){for(var e=t.style,i=0;i<this.styleModifiers.length;i++)e=(0,this.styleModifiers[i])(t,e)||e;return e}},{key:"_clearScene",value:function(){for(var t=this.scene.children,e=0;e<t.length;e++)t[e].geometry.dispose();this.scene.children.length=0}},{key:"_updatePlane",value:function(){this.plane.normal.set(0,0,1),this.plane.constant=0,this.plane.applyMatrix4(this.layerToWorld)}}],i&&_(e.prototype,i),t}();w.GlobalManagerMixin.call(k.prototype),k.SHAPE_ADDED="shapeAdded",k.SHAPE_REMOVED="shapeRemoved",k.LAYER_CLEARED="layerCleared";var A,O=function(t,e,i){var n=(t.x-e.x)*i.x+(t.y-e.y)*i.y;t.set(e.x+n*i.x,e.y+n*i.y)},N=(A=new THREE.Vector2,function(t,e,i){return O(A.copy(t),e,i),t.distanceTo(A)}),M=function(t,e,i,n){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=i.x-e.x,s=i.y-e.y,a=Math.sqrt(o*o+s*s),l={v1:e,dx:o,dy:s,length:a,length2:a*a};return Autodesk.Extensions.CompGeom.pointOnLine(t.x,t.y,l,r,n)},D=function(t,e,i){return Math.abs(t-e)<i},B={getEdgeDirection:function(t,e,i){return(i=i||new THREE.Vector2).copy(e).sub(t).normalize()},projectToLine:O,pointLineDistance:N,intersectLines:function(t,e,i,n,r){var o=n.y*e.x-n.x*e.y;if(Math.abs(o)<1e-8)return!1;var s=t.x-i.x,a=t.y-i.y,l=n.x*a-n.y*s;return r&&(r.x=t.x+l/o*e.x,r.y=t.y+l/o*e.y),!0},rotateAround:function(t,e,i){var n=Math.cos(e),r=Math.sin(e);i&&t.sub(i);var o=t.x,s=t.y;return t.x=o*n-s*r,t.y=o*r+s*n,i&&t.add(i),t},angleBetweenDirections:function(t,e){var i=Math.atan2(t.y,t.x)-Math.atan2(e.y,e.x);return i<0&&(i+=2*Math.PI),i},getEdgeCenter:function(t,e,i){return(i=i||new THREE.Vector2).set(.5*(t.x+e.x),.5*(t.y+e.y))},getEdgeLength:function(t,e){var i=e.x-t.x,n=e.y-t.y;return Math.sqrt(i*i+n*n)},turnLeft:function(t){var e=t.x;return t.x=-t.y,t.y=e,t},isPointOnEdge:M,isPointOnLine:function(t,e,i,n){return M(t,e,i,n,!1)},pointDelta:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n={x:e.x-t.x,y:e.y-t.y};if(i){var r=Math.pow(10,i);n.x=Math.round(n.x*r)/r,n.y=Math.round(n.y*r)/r}if(n.x||n.y)return n},edgeIsDegenerated:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-10;return t.distanceToSquared(e)<i},mirrorPointOnPoint:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return(i=i||new THREE.Vector2).x=e.x-(t.x-e.x),i.y=e.y-(t.y-e.y),i},fuzzyEqual:D,collinear:function(t,e,i,n,r){var o=D(e.x,n.x,r)&&D(e.y,n.y,r),s=D(e.x,-n.x,r)&&D(e.y,-n.y,r);if(!o&&!s)return!1;var a=i.x-t.x,l=i.y-t.y,h=a*e.x+l*e.y;return Math.abs(h)<r}};function X(t){return X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},X(t)}function Y(t,e){return!e||"object"!==X(e)&&"function"!=typeof e?F(t):e}function F(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function z(t,e,i){return z="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=R(t)););return t}(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(i):r.value}},z(t,e,i||t)}function R(t){return R=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},R(t)}function V(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&G(t,e)}function G(t,e){return G=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},G(t,e)}function H(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function W(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function j(t,e,i){return e&&W(t.prototype,e),i&&W(t,i),t}var U=1,Z=Autodesk.Viewing,q=new DOMParser,J=function(t,e,i){return"rgb("+t+","+e+","+i+")"},K=Math.pow(10,4),$=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!t||null===e)return t;var i=4===e?K:Math.pow(10,e);return Math.round(t*i)/i},Q=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};H(this,t),this.lineColor=e.lineColor||e.color||"rgb(0,0,128)",this.lineAlpha=void 0!==e.lineAlpha?e.lineAlpha:void 0!==e.alpha?e.alpha:1,this.lineWidth=void 0!==e.lineWidth?e.lineWidth:3,this.fillColor=e.fillColor||e.color||"rgb(0,0,128)",this.fillAlpha=void 0!==e.fillAlpha?e.fillAlpha:void 0!==e.alpha?e.alpha:.2,this.lineStyle=e.lineStyle||0,this.isScreenSpace=void 0===e.isScreenSpace||e.isScreenSpace}return j(t,[{key:"setFillColor",value:function(t,e,i){this.fillColor=J(t,e,i)}},{key:"setLineColor",value:function(t,e,i){this.lineColor=J(t,e,i)}},{key:"clone",value:function(){return(new t).copy(this)}},{key:"copy",value:function(t){return this.lineColor=t.lineColor,this.lineAlpha=t.lineAlpha,this.lineWidth=t.lineWidth,this.fillColor=t.fillColor,this.fillAlpha=t.fillAlpha,this.lineStyle=t.lineStyle,this.isScreenSpace=t.isScreenSpace,this}}]),t}();Q.toColor=J;var tt=new Q,et=function(t,e){e.makeEmpty();for(var i=0;i<t.length;i++)e.expandByPoint(t[i])},it=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:tt.clone();H(this,t),this.style=e,this.id=U++,this.bbox=new THREE.Box2,this.bboxDirty=!0,this.name=this.id.toString()}return j(t,[{key:"draw",value:function(){}},{key:"hitTest",value:function(){}},{key:"move",value:function(){return this}},{key:"clone",value:function(){return(new t).copy(this)}},{key:"copy",value:function(t){return this.style=t.style.clone(),this}},{key:"toSVG",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=this.toSVGPath(t,e);if(i)return'<path d="'.concat(i.join(" "),'"/>')}},{key:"toSVGPath",value:function(){console.error("Must be implemented by derived class.")}},{key:"computeBBox",value:function(){console.error("Must be implemented by derived class.")}},{key:"modified",value:function(){this.bboxDirty=!0}},{key:"updateBBox",value:function(){this.bboxDirty&&(this.computeBBox(),this.bboxDirty=!1)}}],[{key:"fromSVG",value:function(t){if(t){var e=q.parseFromString(t,"application/xml");if(1!==e.childNodes.length)throw"Function does only support svg with a single element: path, circle";var i=e.firstChild;if("circle"===i.nodeName)return at._fromDOMNode(i);if("path"===i.nodeName)return st._fromDOMNode(i);throw"Unsupported svg node type: ".concat(i.nodeName)}}}]),t}();Z.GlobalManagerMixin.call(it.prototype);var nt=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:tt.clone();return H(this,e),(t=Y(this,R(e).call(this,n))).points=i,t}return V(e,t),j(e,[{key:"isPolygon",value:function(){return this instanceof rt}},{key:"isPolyline",value:function(){return this instanceof ot}},{key:"isPath",value:function(){return this instanceof st}},{key:"addPoint",value:function(t,e){var i={x:t,y:e};return this.points.push(i),this.modified(),i}},{key:"getPoint",value:function(t,e){return(e=e||new THREE.Vector2).copy(this.points[t])}},{key:"removePoint",value:function(t){this.points.splice(t,1)}},{key:"updatePoint",value:function(t,e,i){var n=this.points[t];n.x=e,n.y=i,this.modified()}},{key:"insertPoint",value:function(t,e){this.points.splice(t,0,e)}},{key:"duplicateVertex",value:function(t){var e=this.points[t];this.insertPoint(t+1,{x:e.x,y:e.y})}},{key:"clear",value:function(){this.points.length=0,this.modified()}},{key:"enumEdges",value:function(t){for(var e=this.getEdgeCount(),i=0;i<e;i++){var n=i,r=this.nextIndex(i);if(t(this.getPoint(n),this.getPoint(r),n,r))return}}},{key:"findEdgeIndex",value:function(t,e){var i=-1;return this.enumEdges((function(n,r,o){var s=B.isPointOnEdge(t,n,r,e);return s&&(i=o),s})),i}},{key:"move",value:function(t,e){for(var i=0;i<this.points.length;i++)this.points[i].x+=t,this.points[i].y+=e;return this.modified(),this}},{key:"copy",value:function(t){return z(R(e.prototype),"copy",this).call(this,t),this.points=t.points.map((function(t){return{x:t.x,y:t.y}})),this.modified(),this}},{key:"toSVGPath",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.vertexCount){var i=0,n=function(n,r,o,s){if(!o)return n.push("M ".concat($(r.x,e),",").concat($(r.y,e))),n;var a,l,h=s[i],u=B.pointDelta(h,r,e);return u?(Math.abs(u.x)<=t?(a="V",l=$(r.y,e)):Math.abs(u.y)<=t?(a="H",l=$(r.x,e)):(a="L",l="".concat($(r.x,e),",").concat($(r.y,e))),n.push("".concat(a," ").concat(l)),i=o,n):n},r=this.points.reduce(n,[]);return this.isPolygon()&&r.push("Z"),r}}},{key:"computeBBox",value:function(){et(this.points,this.bbox)}},{key:"nextIndex",value:function(t){return(t+1)%this.vertexCount}},{key:"prevIndex",value:function(t){return(t+this.vertexCount-1)%this.vertexCount}},{key:"edgeIndexValid",value:function(t){var e=this.getEdgeCount();return t>=0&&t<e}},{key:"getEdge",value:function(t,e,i){var n=t,r=this.nextIndex(t);this.getPoint(n,e),this.getPoint(r,i)}},{key:"getEdgeDirection",value:function(t,e){var i=t,n=this.nextIndex(t);return e=e||new THREE.Vector2,B.getEdgeDirection(this.points[i],this.points[n],e)}},{key:"getEdgeCount",value:function(){return this.isPolygon()?this.vertexCount:this.vertexCount-1}},{key:"getLength",value:function(t){for(var e=new THREE.Vector2,i=new THREE.Vector2,n=0,r=0;r<this.getEdgeCount();r++)this.getEdge(r,e,i),t&&(t.apply(e),t.apply(i)),n+=e.distanceTo(i);return n}},{key:"length",get:function(){return console.warn("poly.length is deprecated and will be removed. Please use poly.vertexCount property instead."),this.points.length}},{key:"vertexCount",get:function(){return this.points.length}}]),e}(it),rt=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:tt.clone();return H(this,e),Y(this,R(e).call(this,t,i))}return V(e,t),j(e,[{key:"draw",value:function(t,e){if(this.vertexCount){var i=e||this.style;t.dbId=this.id,t.lineStyle=i.lineStyle,t.isScreenSpace=i.isScreenSpace,t.beginPath(),t.moveTo(this.points[0].x,this.points[0].y);for(var n=1;n<this.points.length;n+=1)t.lineTo(this.points[n].x,this.points[n].y);t.closePath();var r=t.canvasContext;r.fillStyle=i.fillColor,r.globalAlpha=i.fillAlpha,t.fill(),r.strokeStyle=i.lineColor,r.globalAlpha=i.lineAlpha,r.lineWidth=i.lineWidth;var o=this.getWindow();i.isScreenSpace&&(r.lineWidth*=o.devicePixelRatio),t.stroke(),t.dbId=-1,t.lineStyle=0,t.isScreenSpace=!1}}},{key:"hitTest",value:function(t,e){for(var i=new Autodesk.Extensions.CompGeom.ComplexPolygon(this.points),n=[],r=0;r<this.vertexCount;r++)n.push(r);return i.pointInContour(t,e,n)}},{key:"clone",value:function(){return(new e).copy(this)}},{key:"getArea",value:function(t){if(this.points.length<3)return 0;var e=0;return this.enumEdges((function(i,n){t&&t.apply(i),t&&t.apply(n),e+=i.x*n.y-n.x*i.y})),Math.abs(.5*e)}}]),e}(nt),ot=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:tt.clone();return H(this,e),Y(this,R(e).call(this,t,i))}return V(e,t),j(e,[{key:"makeLine",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return 2!==this.vertexCount?(this.clear(),this.addPoint(t,e),this.addPoint(i,n)):(this.updatePoint(0,t,e),this.updatePoint(1,i,n)),this}},{key:"draw",value:function(t,e){if(this.vertexCount){var i=e||this.style;t.dbId=this.id,t.lineStyle=i.lineStyle,t.isScreenSpace=i.isScreenSpace,t.beginPath(),t.moveTo(this.points[0].x,this.points[0].y);for(var n=1;n<this.points.length;n++)t.lineTo(this.points[n].x,this.points[n].y);var r=t.canvasContext;r.strokeStyle=i.lineColor,r.globalAlpha=i.lineAlpha,r.lineWidth=i.lineWidth;var o=this.getWindow();i.isScreenSpace&&(r.lineWidth*=o.devicePixelRatio),t.stroke(),t.dbId=-1,t.lineStyle=0,t.isScreenSpace=!1}}},{key:"clone",value:function(){return(new e).copy(this)}},{key:"computeBBox",value:function(){et(this.points,this.bbox)}},{key:"hitTest",value:function(t,e,i){return-1!==this.findEdgeIndex({x:t,y:e},i)}}]),e}(nt),st=function(t){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:tt.clone();return H(this,e),Y(this,R(e).call(this,t,i))}return V(e,t),j(e,[{key:"updatePoint",value:function(t,e,i){var n=this.points[t],r=e-n.x,o=i-n.y;if(this.isBezierArc(t)&&(n.cp1x+=r,n.cp1y+=o),this.vertexCount>1){var s=this.prevIndex(t);if(this.isBezierArc(s)){var a=this.points[s];a.cp2x+=r,a.cp2y+=o}}n.x=e,n.y=i,this.modified()}},{key:"setBezierArc",value:function(t,e,i,n,r){var o=this.points[t];o.arcType=1,o.cp1x=e,o.cp1y=i,o.cp2x=n,o.cp2y=r}},{key:"isBezierArc",value:function(t){return 1===this.points[t].arcType}},{key:"getControlPoint",value:function(t,e,i){var n=i||new THREE.Vector2,r=this.points[t];return 1===e?(n.x=r.cp1x,n.y=r.cp1y):(n.x=r.cp2x,n.y=r.cp2y),n}},{key:"updateControlPoint",value:function(t,e,i,n){var r=this.points[t];1===e?(r.cp1x=i,r.cp1y=n):(r.cp2x=i,r.cp2y=n),this.modified()}},{key:"draw",value:function(t,e){if(this.vertexCount){var i=e||this.style;t.dbId=this.id,t.lineStyle=i.lineStyle,t.isScreenSpace=i.isScreenSpace,t.beginPath(),t.moveTo(this.points[0].x,this.points[0].y);for(var n=1;n<this.points.length;n+=1){var r=this.points[n-1],o=this.points[n];1===r.arcType?t.bezierCurveTo(r.cp1x,r.cp1y,r.cp2x,r.cp2y,o.x,o.y):t.lineTo(o.x,o.y)}var s=this.points[this.points.length-1],a=this.points[0];1===s.arcType?t.bezierCurveTo(s.cp1x,s.cp1y,s.cp2x,s.cp2y,a.x,a.y):t.lineTo(a.x,a.y),t.closePath();var l=t.canvasContext;l.fillStyle=i.fillColor,l.globalAlpha=i.fillAlpha,t.fill(),l.strokeStyle=i.lineColor,l.globalAlpha=i.lineAlpha,l.lineWidth=i.lineWidth,i.isScreenSpace&&(l.lineWidth*=window.devicePixelRatio),t.stroke(),t.dbId=-1,t.lineStyle=0,t.isScreenSpace=!1}}},{key:"hitTest",value:function(t,e){for(var i=new Autodesk.Extensions.CompGeom.ComplexPolygon(this.points),n=[],r=0;r<this.vertexCount;r++)n.push(r);return i.pointInContour(t,e,n)}},{key:"clone",value:function(){return(new e).copy(this)}},{key:"copy",value:function(t){z(R(e.prototype),"copy",this).call(this,t);for(var i=0;i<t.points.length;i++)if(t.isBezierArc(i)){var n=t.points[i],r=this.points[i];r.arcType=n.arcType,r.cp1x=n.cp1x,r.cp1y=n.cp1y,r.cp2x=n.cp2x,r.cp2y=n.cp2y}return this}},{key:"toSVGPath",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!this.vertexCount)return[];var i=[];i.push("M ".concat($(this.points[0].x,e),",").concat($(this.points[0].y,e)));for(var n=1;n<this.points.length;n+=1){var r=this.points[n-1],o=this.points[n],s=void 0;if(1===r.arcType)s="C ".concat($(r.cp1x,e),",").concat($(r.cp1y,e),",").concat($(r.cp2x,e),",").concat($(r.cp2y,e),",").concat($(o.x,e),",").concat($(o.y,e));else{var a=B.pointDelta(r,o,e);if(!a)continue;s=Math.abs(a.x)<=t?"V ".concat($(o.y,e)):Math.abs(a.y)<=t?"H ".concat($(o.x,e)):"L ".concat($(o.x,e),",").concat($(o.y,e))}i.push(s)}var l=this.points[this.points.length-1];if(1===l.arcType){var h=this.points[0],u="C ".concat($(l.cp1x,e),",").concat($(l.cp1y,e),",").concat($(l.cp2x,e),",").concat($(l.cp2y,e),",").concat($(h.x,e),",").concat($(h.y,e));i.push(u)}return i.push("Z"),i}},{key:"move",value:function(t,i){z(R(e.prototype),"move",this).call(this,t,i);for(var n=0;n<this.points.length;n++)if(this.isBezierArc(n)){var r=this.points[n];r.cp1x+=t,r.cp1y+=i,r.cp2x+=t,r.cp2y+=i}return this.modified(),this}}],[{key:"_fromDOMNode",value:function(t){var i=t.getAttribute("d");if(i){var n=e._parsePath(i),r=n.points,o=n.isPolygon;return r.find((function(t){return void 0!==t.arcType}))?new e(r):o?new rt(r):new ot(r)}}},{key:"_parsePath",value:function(t){for(var e,i=t.split(/ (?=[a-zA-Z])/gi),n={x:0,y:0},r=[],o=!1,s=0;s<i.length;s++){var a=i[s];if(!"MLHVCZ".contains(a[0]))throw'"'.concat(a[0],'" is not a supported or invalid glyph: ').concat(a);var l=a.substring(1);switch(a[0]){case"M":case"L":var h=l.split(",");e={x:parseFloat(h[0]),y:parseFloat(h[1])},"M"===a[0]&&r.shift();break;case"H":e={x:parseFloat(l),y:n.y};break;case"V":e={x:n.x,y:parseFloat(l)};break;case"C":var u=l.split(",");e={x:parseFloat(u[4]),y:parseFloat(u[5])},n.arcType=1,n.cp1x=parseFloat(u[0]),n.cp1y=parseFloat(u[1]),n.cp2x=parseFloat(u[2]),n.cp2y=parseFloat(u[3]);break;case"Z":o=!0;continue}n=e,r.push(e)}return B.pointDelta(r[0],r[r.length-1],0)||r.pop(),{points:r,isPolygon:o}}}]),e}(nt),at=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:tt.clone(),s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:20;return H(this,e),(t=Y(this,R(e).call(this,o))).polygon=new rt([],o),t.polygon.id=t.id,t.centerX=i,t.centerY=n,t.radius=r,t.tessSegments=s,t.needsUpdate=!0,t}return V(e,t),j(e,[{key:"draw",value:function(t,e){this.polygon.points.length=0;for(var i=360/this.tessSegments,n=0;n<360;n+=i){var r=n*Math.PI/180,o=this.radius*Math.cos(r),s=this.radius*Math.sin(r);this.polygon.addPoint(this.centerX+o,this.centerY+s)}this.needsUpdate=!1,this.polygon.draw(t,e)}},{key:"setCenter",value:function(t,e){this.centerX=t,this.centerY=e,this.modified()}},{key:"move",value:function(t,e){this.centerX+=t,this.centerY+=e,this.modified()}},{key:"hitTest",value:function(t,e){var i=t-this.centerX,n=e-this.centerY;return i*i+n*n<this.radius*this.radius}},{key:"clone",value:function(){return(new e).copy(this)}},{key:"copy",value:function(t){return z(R(e.prototype),"copy",this).call(this,t),this.polygon=t.polygon.clone(),this.centerX=t.centerX,this.centerY=t.centerY,this.radius=t.radius,this.tessSegments=t.tessSegments,this.modified(),this}},{key:"toSVG",value:function(){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return'<circle cx="'.concat($(this.centerX,t),'" cy="').concat($(this.centerY,t),'" r="').concat($(this.radius,t),'"/>')}},{key:"computeBBox",value:function(){this.bbox.min.set(this.centerX-this.radius,this.centerY-this.radius),this.bbox.max.set(this.centerX+this.radius,this.centerY+this.radius)}}],[{key:"_fromDOMNode",value:function(t){if(!t.hasAttributes||!t.hasAttributes())throw"No attributes available on the <circle/> node";for(var i=new e,n=t.attributes.length-1;n>=0;n--){var r=t.attributes[n];switch(r.name){case"cx":i.centerX=parseFloat(r.value);break;case"cy":i.centerY=parseFloat(r.value);break;case"r":i.radius=parseFloat(r.value)}}return i}}]),e}(it),lt=function(t){function e(t){var i;return H(this,e),(i=Y(this,R(e).call(this))).shape=t,Object.defineProperty(F(i),"bbox",{get:function(){return i.shape.bbox},set:function(t){i.shape.bbox=t}}),Object.defineProperty(F(i),"id",{get:function(){return i.shape.id},set:function(t){i.shape.id=t}}),Object.defineProperty(F(i),"bboxDirty",{get:function(){return i.shape.bboxDirty},set:function(t){i.shape.bboxDirty=t}}),Object.defineProperty(F(i),"name",{get:function(){return i.shape.name},set:function(t){i.shape.name=t}}),i}return V(e,t),j(e,[{key:"draw",value:function(){var t;return(t=this.shape).draw.apply(t,arguments)}},{key:"hitTest",value:function(){var t;return(t=this.shape).hitTest.apply(t,arguments)}},{key:"move",value:function(){var t;return(t=this.shape).move.apply(t,arguments)}},{key:"modified",value:function(){var t;return(t=this.shape).modified.apply(t,arguments)}},{key:"computeBBox",value:function(){var t;return(t=this.shape).computeBBox.apply(t,arguments)}},{key:"updateBBox",value:function(){var t;return(t=this.shape).updateBBox.apply(t,arguments)}},{key:"clone",value:function(){return new e(this.shape.clone())}},{key:"copy",value:function(t){this.shape.copy(t.shape)}}]),e}(it);function ht(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var ut=Autodesk.Viewing,pt=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),ut.EventDispatcher.prototype.apply(this),this.stack=[],this.current=0}var e,i;return e=t,(i=[{key:"run",value:function(e){this.stack.length=this.current,this.dispatchEvent({type:t.BEFORE_ACTION,action:e}),e.redo(),this.dispatchEvent({type:t.AFTER_ACTION,action:e}),this.stack.push(e),this.current=this.stack.length}},{key:"undo",value:function(){if(!this.current)return!1;this.current--;var e=this.stack[this.current];return this.dispatchEvent({type:t.BEFORE_ACTION,action:e,isUndo:!0}),e.undo(),this.dispatchEvent({type:t.AFTER_ACTION,action:e,isUndo:!0}),e.layer.update(),!0}},{key:"redo",value:function(){var e=this.stack[this.current];return!!e&&(this.dispatchEvent({type:t.BEFORE_ACTION,action:e,isUndo:!1}),e.redo(),this.dispatchEvent({type:t.AFTER_ACTION,action:e,isUndo:!1}),this.current++,e.layer.update(),!0)}},{key:"clear",value:function(){this.stack.length=0,this.current=0}}])&&ht(e.prototype,i),t}();function ct(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}pt.BEFORE_ACTION="beforeAction",pt.AFTER_ACTION="afterAction";var dt=Autodesk.Viewing,yt=function(){function t(e,i){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),dt.EventDispatcher.prototype.apply(this),this.isSelected={},this.hoveredId=0,this.tmpStyle=new Q,this.modifier=function(t,e){var i=n.isSelected[t.id],r=t.id===n.hoveredId;if(i||r)return n.tmpStyle.copy(e),i?(n.tmpStyle.fillAlpha=Math.min(n.tmpStyle.fillAlpha+.3,1),n.tmpStyle.lineWidth*=1.5):(n.tmpStyle.fillAlpha=Math.min(n.tmpStyle.fillAlpha+.2,1),n.tmpStyle.lineWidth*=1.5),n.tmpStyle},this.layer=e,this.onShapeRemoved=this.onShapeRemoved.bind(this),this.onLayerCleared=this.onLayerCleared.bind(this),this.layer.addEventListener(k.SHAPE_REMOVED,this.onShapeRemoved),this.layer.addEventListener(k.LAYER_CLEARED,this.onLayerCleared),this.layer.addStyleModifier(this.modifier),this.undoStack=i,this.onActionCb=function(t){return n.onAction(t)},this.undoStack.addEventListener(pt.AFTER_ACTION,this.onActionCb)}var e,i;return e=t,(i=[{key:"dtor",value:function(){this.layer.removeStyleModifier(this.modifier),this.undoStack.removeEventListener(pt.AFTER_ACTION,this.onActionCb),this.undoStack.removeEventListener(k.SHAPE_REMOVED,this.onShapeRemoved),this.undoStack.removeEventListener(k.LAYER_CLEARED,this.onLayerCleared)}},{key:"setSelection",value:function(t){t=t||[];var e=!1;if(this.getSelectedShapes().length!=t.length)e=!0;else for(var i=0;i<t.length;i++){var n=t[i];this.isSelected[n.id]||(e=!0)}if(e){this.isSelected={};for(var r=0;r<t.length;r++){var o=t[r];this.isSelected[o.id]=o}this.modified()}}},{key:"empty",value:function(){return!Object.keys(this.isSelected).length}},{key:"selectOnly",value:function(t){this.setSelection(t&&[t])}},{key:"clear",value:function(){this.setSelection([])}},{key:"getSelectedShapes",value:function(){return Object.values(this.isSelected)}},{key:"getSelectedIds",value:function(){return Object.keys(this.isSelected)}},{key:"modified",value:function(){this.layer.update(),this.dispatchEvent({type:t.Events.SELECTION_CHANGED})}},{key:"onAction",value:function(){if(!this.empty()){var t=this.getSelectedShapes();if(1!=t.length){var e={};this.layer.shapes.forEach((function(t){return e[t.id]=!0})),t=t.filter((function(t){return e[t.id]})),this.setSelection(t)}else this.layer.findShapeById(t[0].id)||this.clear()}}},{key:"onShapeRemoved",value:function(t){var e=t.shape;this.empty()||this.isSelected[e.id]&&(delete this.isSelected[e.id],this.modified())}},{key:"onLayerCleared",value:function(){this.empty()||this.clear()}},{key:"setHoveredId",value:function(t){t!==this.hoveredId&&(this.hoveredId=t,this.layer.update())}}])&&ct(e.prototype,i),t}();function ft(t){return ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ft(t)}function vt(t,e){return!e||"object"!==ft(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function gt(t){return gt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},gt(t)}function mt(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Pt(t,e)}function Pt(t,e){return Pt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Pt(t,e)}function xt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ct(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Et(t,e,i){return e&&Ct(t.prototype,e),i&&Ct(t,i),t}yt.Events={SELECTION_CHANGED:"selectionChanged"};var St=function(){function t(e){xt(this,t),this.layer=e}return Et(t,[{key:"undo",value:function(){throw new Error("Abstract method invoked")}},{key:"redo",value:function(){throw new Error("Abstract method invoked")}}]),t}(),bt={Action:St,AddShape:function(t){function e(t,i){var n;return xt(this,e),(n=vt(this,gt(e).call(this,t))).shape=i,n}return mt(e,t),Et(e,[{key:"undo",value:function(){this.layer.removeShape(this.shape)}},{key:"redo",value:function(){this.layer.addShape(this.shape)}}]),e}(St),AddShapes:function(t){function e(t,i){var n;return xt(this,e),(n=vt(this,gt(e).call(this,t))).shapes=i,n}return mt(e,t),Et(e,[{key:"undo",value:function(){var t=this;this.shapes.forEach((function(e){return t.layer.removeShape(e)}))}},{key:"redo",value:function(){var t=this;this.shapes.forEach((function(e){return t.layer.addShape(e)}))}}]),e}(St),MoveShape:function(t){function e(t,i,n,r){var o;return xt(this,e),(o=vt(this,gt(e).call(this,t))).shape=i,o.delta={x:n,y:r},o.beforeState=o.shape.clone(),o.afterState=o.shape.clone(),o.afterState.move(n,r),o}return mt(e,t),Et(e,[{key:"undo",value:function(){this.shape.copy(this.beforeState)}},{key:"redo",value:function(){this.shape.copy(this.afterState)}}]),e}(St),RemoveShape:function(t){function e(t,i){var n;return xt(this,e),(n=vt(this,gt(e).call(this,t))).shape=i,n}return mt(e,t),Et(e,[{key:"undo",value:function(){this.layer.addShape(this.shape)}},{key:"redo",value:function(){this.layer.removeShape(this.shape)}}]),e}(St),RemoveShapes:function(t){function e(t,i){var n;return xt(this,e),(n=vt(this,gt(e).call(this,t))).shapes=i,n}return mt(e,t),Et(e,[{key:"undo",value:function(){var t=this;this.shapes.forEach((function(e){return t.layer.addShape(e)}))}},{key:"redo",value:function(){var t=this;this.shapes.forEach((function(e){return t.layer.removeShape(e)}))}}]),e}(St),AddVertex:function(t){function e(t,i,n,r){var o;return xt(this,e),(o=vt(this,gt(e).call(this,t))).poly=i,o.vIndex=n,o.point=r.clone(),o}return mt(e,t),Et(e,[{key:"undo",value:function(){this.poly.removePoint(this.vIndex)}},{key:"redo",value:function(){this.poly.insertPoint(this.vIndex,this.point)}}]),e}(St),MoveVertex:function(t){function e(t,i,n,r){var o;return xt(this,e),(o=vt(this,gt(e).call(this,t))).poly=i,o.vIndex=n,o.posBefore=i.getPoint(n),o.posAfter=r.clone(),o}return mt(e,t),Et(e,[{key:"undo",value:function(){this.poly.updatePoint(this.vIndex,this.posBefore.x,this.posBefore.y)}},{key:"redo",value:function(){this.poly.updatePoint(this.vIndex,this.posAfter.x,this.posAfter.y)}}]),e}(St),RemoveVertex:function(t){function e(t,i,n){var r;return xt(this,e),(r=vt(this,gt(e).call(this,t))).poly=i,r.vIndex=n,r.point=i.getPoint(n),r}return mt(e,t),Et(e,[{key:"undo",value:function(){this.poly.insertPoint(this.vIndex,this.point)}},{key:"redo",value:function(){this.poly.removePoint(this.vIndex)}}]),e}(St),MoveEdge:function(t){function e(t,i,n,r,o,s,a){var l;xt(this,e),(l=vt(this,gt(e).call(this,t))).poly=i,l.edgeIndex=n,l.duplicateStartVertex=s,l.duplicateEndVertex=a;var h=n,u=i.nextIndex(h),p=i.getPoint(h),c=i.getPoint(u);return l.edgeBefore={a:p,b:c},l.edgeAfter={a:r.clone(),b:o.clone()},l}return mt(e,t),Et(e,[{key:"undo",value:function(){var t=e.getNewEdgeIndex(this.poly,this.edgeIndex,this.duplicateStartVertex,this.duplicateEndVertex),i=this.poly.nextIndex(t);this.poly.updatePoint(t,this.edgeBefore.a.x,this.edgeBefore.a.y),this.poly.updatePoint(i,this.edgeBefore.b.x,this.edgeBefore.b.y),e.revertDuplicateVertices(this.poly,this.edgeIndex,this.duplicateStartVertex,this.duplicateEndVertex)}},{key:"redo",value:function(){e.duplicateVertices(this.poly,this.edgeIndex,this.duplicateStartVertex,this.duplicateEndVertex);var t=e.getNewEdgeIndex(this.poly,this.edgeIndex,this.duplicateStartVertex,this.duplicateEndVertex),i=this.poly.nextIndex(t);this.poly.updatePoint(t,this.edgeAfter.a.x,this.edgeAfter.a.y),this.poly.updatePoint(i,this.edgeAfter.b.x,this.edgeAfter.b.y)}}],[{key:"duplicateVertices",value:function(t,e,i,n){var r=e;if(i&&(t.duplicateVertex(r),r++),n){var o=t.nextIndex(r);t.duplicateVertex(o)}}},{key:"revertDuplicateVertices",value:function(t,i,n,r){var o=e.getNewEdgeIndex(t,i,n,r);if(n){var s=o-1;t.removePoint(s),o--}if(r){var a=t.nextIndex(t.nextIndex(o));t.removePoint(a)}}},{key:"getNewEdgeIndex",value:function(t,e,i,n){var r=e;i&&r++;var o=t.vertexCount-(i?1:0)-(n?1:0);return n&&e===o-1&&r++,r}}]),e}(St)};function Tt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function It(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _t(t,e,i){return e&&It(t.prototype,e),i&&It(t,i),t}var Lt=function(){function t(e,i){Tt(this,t),this.a=e.clone(),this.b=i.clone(),this.dir=B.getEdgeDirection(e,i)}return _t(t,[{key:"intersect",value:function(t,e){return B.intersectLines(this.a,this.dir,t.a,t.dir,e)}},{key:"snapToLine",value:function(t){B.projectToLine(t,this.a,this.dir)}},{key:"isUsable",value:function(t,e){return B.pointLineDistance(t,this.a,this.dir)<e}},{key:"isEqual",value:function(t,e){return B.collinear(this.a,this.dir,t.a,t.dir,e)}}]),t}(),wt=function(t,e,i){(e||i)&&(i?e?e.intersect(i,t):i.snapToLine(t):e.snapToLine(t))},kt=function(t,e){return e=(e+t.vertexCount)%t.vertexCount,t.getPoint(e)},At=function(t,e,i,n,r){var o=new THREE.Vector2;return i.intersect(t,o)?o.distanceTo(n)>r?e:e?Math.abs(i.dir.dot(t.dir))>Math.abs(i.dir.dot(e.dir))?t:e:t:e},Ot=new THREE.Vector2(1,0),Nt=Autodesk.Viewing,Mt=function(){function t(e){Tt(this,t),this.poly=null,this.vIndex=-1,this.snapAngles=[0,45,90,135,180,225,270,315,360],this.snapAngleTolerance=2,this.snapRadius=10,this.gizmoLayer=e,this.setGlobalManager(e.globalManager),this.movedPoint=new THREE.Vector2,this.prevPoint=new THREE.Vector2,this.prevPoint2=new THREE.Vector2,this.edgeDir=new THREE.Vector2,this.alignAxis=new THREE.Vector2,this.edgeSnapLines=[],this.snapLine1=null,this.snapLine2=null,this.snapLineExt=null,this.snapLineStyle=new Q({lineColor:"rgb(255, 0, 0)",lineWidth:1,lineStyle:10}),this.snapLineGizmos=[],this.snapLineGizmosUsed=0}return _t(t,[{key:"onSetGlobalManager",value:function(t){this.globalManager=t,this.snapLineGizmos.forEach((function(e){return e.setGloblaManager(t)}))}},{key:"acquireSnapLineGizmo",value:function(){var t=this.snapLineGizmos[this.snapLineGizmosUsed];return t||((t=new ot([],this.snapLineStyle)).setGlobalManager(this.globalManager),this.snapLineGizmos[this.snapLineGizmosUsed]=t),this.snapLineGizmosUsed++,t}},{key:"clearSnappingGizmos",value:function(){var t=this;this.snapLineGizmos.forEach((function(e){return t.gizmoLayer.removeShape(e)})),this.snapLineGizmosUsed=0}},{key:"startSnapping",value:function(t,e){this.poly=t,this.vIndex=e,this.edgeSnapLines=function(t,e){var i=new THREE.Vector2,n=new THREE.Vector2,r=new THREE.Vector2,o=[];return t.enumEdges((function(t,s,a,l){a!=e&&l!=e&&(B.edgeIsDegenerated(t,s)||function(t,e){o.push(new Lt(t,e)),i=B.turnLeft(B.getEdgeDirection(t,e,i)),n=B.getEdgeCenter(t,e,n),r.copy(t).add(i),o.push(new Lt(t,r)),r.copy(n).add(i),o.push(new Lt(n,r)),r.copy(e).add(i),o.push(new Lt(e,r))}(t,s))})),o}(t,e)}},{key:"stopSnapping",value:function(){this.poly=null,this.vIndex=-1,this.snapLine1=null,this.snapLine2=null,this.clearSnappingGizmos()}},{key:"clearSnappingResult",value:function(){this.snapLine1=null,this.snapLine2=null}},{key:"getPrevSnapLine",value:function(t){var e=kt(this.poly,this.vIndex-1),i=kt(this.poly,this.vIndex-2),n=B.getEdgeDirection(i,e);return this.computeAngleSnapLine(t,e,n)}},{key:"getNextSnapLine",value:function(t){if(this.poly.isPolyline()&&this.vIndex>=this.poly.vertexCount-2)return null;var e=kt(this.poly,this.vIndex+1),i=kt(this.poly,this.vIndex+2),n=B.getEdgeDirection(e,i,n);return this.computeAngleSnapLine(t,e,n)}},{key:"snapToAngle",value:function(t,e){var i=this;if(this.snapLine1=null,this.snapLine2=null,this.snapLineExt=e&&new Lt(e.a,e.b),this.active&&!(this.poly.vertexCount<=1)){var n=kt(this.poly,this.vIndex-1);if(2==this.poly.vertexCount){var r=this.computeAngleSnapLine(t,n,Ot);return r&&this.snapLineExt?this.snapLine1=At(r,null,this.snapLineExt,t,a):this.snapLine1=r,void wt(t,this.snapLine1,this.snapLineExt)}var o=this.getPrevSnapLine(t),s=this.getNextSnapLine(t),a=this.snapRadius*this.gizmoLayer.getUnitsPerPixel(),l=function(e){return!!e&&(i.snapLineExt?Boolean(At(e,null,i.snapLineExt,t,a)):e.isUsable(t,a))},h=this.edgeSnapLines.filter(l);if(o=l(o)&&o,s=l(s)&&s,this.snapLine1=o||s||h[0],this.snapLine1){if(this.snapLineExt)return wt(t,this.snapLine1,this.snapLineExt);if(o&&s&&(this.snapLine2=At(s,null,this.snapLine1,t,a)),!this.snapLine2)for(var u=0;u<h.length;u++){var p=h[u];this.snapLine2=At(p,this.snapLine2,this.snapLine1,t,a)}return wt(t,this.snapLine1,this.snapLine2)}}}},{key:"isSnapped",value:function(){return Boolean(this.snapLine1||this.snapLine2)}},{key:"updateSnapLineGizmos",value:function(t){var e=this;if(this.clearSnappingGizmos(),this.poly){var i=[],n=1e-4,r=function(e){return e&&e.isUsable(t,n)};if(2==this.poly.vertexCount){var o=kt(this.poly,this.vIndex-1),s=this.computeAngleSnapLine(t,o,Ot);s&&r(s)&&i.push(s)}else{i=this.edgeSnapLines.filter(r);var a=this.getPrevSnapLine(t),l=this.getNextSnapLine(t);r(a)&&i.push(a),r(l)&&i.push(l)}i=i.filter((function(t,e){for(var r=!1,o=0;o<e;o++){var s=i[o];if(t.isEqual(s,n)){r=!0;break}}return!r}));for(var h=this.gizmoLayer.viewer.canvas,u=Math.sqrt(h.width*h.width+h.height*h.height),p=this.gizmoLayer.getUnitsPerPixel()*u,c=function(t,i){if(t){var n=t.a;i.makeLine(n.x-p*t.dir.x,n.y-p*t.dir.y,n.x+p*t.dir.x,n.y+p*t.dir.y),e.gizmoLayer.addShape(i)}},d=0;d<i.length;d++)c(i[d],this.acquireSnapLineGizmo())}}},{key:"dtor",value:function(){this.clearSnapping()}},{key:"computeAngleSnapLine",value:function(t,e,i){if(B.edgeIsDegenerated(e,t))return null;for(var n=t.clone().sub(e),r=THREE.Math.radToDeg(B.angleBetweenDirections(n,i)),o=-1,s=0;s<this.snapAngles.length;s++){var a=this.snapAngles[s];if(Math.abs(a-r)<this.snapAngleTolerance){o=s;break}}if(-1==o)return null;var l=THREE.Math.degToRad(this.snapAngles[o]),h=B.rotateAround(i.clone(),l),u=e.distanceTo(t),p=h.multiplyScalar(u).add(e);return new Lt(e,p)}},{key:"active",get:function(){return this.poly}}]),t}();function Dt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Bt(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Xt(t,e,i){return e&&Bt(t.prototype,e),i&&Bt(t,i),t}Nt.GlobalManagerMixin.call(Mt.prototype);var Yt={Line:1,CircularArc:2,EllipticalArc:3},Ft=function(t,e,i,n,r){return{type:Yt.Line,x1:t,y1:e,x2:i,y2:n,vpId:r}},zt=function(t,e,i,n,r,o){return{type:Yt.CirularArc,cx:t,cy:e,start:i,end:n,radius:r,vpId:o}},Rt=function(t,e,i,n,r,o,s,a){return{type:Yt.EllipticalArc,cx:t,cy:e,start:i,end:n,major:r,minor:o,tilt:s,vpId:a}},Vt=function(t,e){switch(t.type){case Yt.Line:e.onLineSegment(t.x1,t.y1,t.x2,t.y2,t.vpId);break;case Yt.CirularArc:e.onCircularArc(t.cx,t.cy,t.start,t.end,t.radius,t.vpId);break;case Yt.EllipticalArc:e.onEllipticalArc(t.cx,t.cy,t.tart,t.end,t.major,t.minor,t.tilt,t.vpId)}},Gt=function(){function t(){Dt(this,t),this.boundsCb=new Autodesk.Viewing.Private.BoundsCallback(new THREE.Box2),this.queryBox=new THREE.Box2,this.tmpPoint=new THREE.Vector2}return Xt(t,[{key:"getSegmentBox",value:function(t){return this.boundsCb.bounds.makeEmpty(),Vt(t,this.boundsCb),this.boundsCb.bounds}},{key:"getQueryBox",value:function(t,e,i,n){return this.queryBox.min.set(t,e),this.queryBox.max.set(i,n),this.queryBox}},{key:"intersectsBox",value:function(t,e,i,n,r){var o=this.getQueryBox(e,i,n,r),s=this.getSegmentBox(t);return o.isIntersectionBox(s)}},{key:"getPoint",value:function(t,e){var i=this.getSegmentBox(t).center(this.tmpPoint);e.x=i.x,e.y=i.y}}]),t}(),Ht=function(){function t(){Dt(this,t)}return Xt(t,[{key:"buildFromModel",value:function(t){var e=t.getBoundingBox();this.tree=new Autodesk.Extensions.CompGeom.QuadTree(e.min.x,e.min.y,e.max.x,e.max.y,0,new Gt);for(var i=t.getFragmentList(),n=i.getCount(),r=0;r<n;r++){var o=i.getGeometry(r);this.addGeometry(o)}}},{key:"addGeometry",value:function(t){var e=this,i={onLineSegment:function(){return e.tree.addItem(Ft.apply(void 0,arguments))},onCircularArc:function(){return e.tree.addItem(zt.apply(void 0,arguments))},onEllipticalArc:function(){return e.tree.addItem(Rt.apply(void 0,arguments))}};new Autodesk.Viewing.Private.VertexBufferReader(t).enumGeoms(null,i)}},{key:"enumSegments",value:function(t,e,i,n,r){this.tree.enumInBox(t,e,i,n,(function(t){return Vt(t,r)}))}}]),t}();function Wt(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var jt=Autodesk.Viewing.MeasureCommon.SnapType,Ut=Autodesk.Viewing,Zt=function(){function t(e,i,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.viewer=e,this.setGlobalManager(e.globalManager),this.layer=i,this.gizmoLayer=n,this.sheetSnapper=new Autodesk.Viewing.Extensions.Snapping.Snapper(e),this.layerSnapper=new Autodesk.Viewing.Extensions.Snapping.Snapper(e),this.angleSnapper=new Mt(n),this.snapBox=new THREE.Box2,this.sheetSnapper.activate(),this.layerSnapper.activate(),this.onCameraChangeCb=this.onCameraChange.bind(this),this.viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangeCb),this.initSegmentTrees(),this.tmpVec=new THREE.Vector3,this.geomSnapLine={a:new THREE.Vector3,b:new THREE.Vector3}}var e,i;return e=t,i=[{key:"dtor",value:function(){this.sheetSnapper.deactivate(),this.layerSnapper.deactivate(),this.viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangeCb)}},{key:"onCameraChange",value:function(){this.updateSnapperIndicators()}},{key:"initSegmentTrees",value:function(){this.viewer.getVisibleModels().forEach((function(t){var e=!(!t.myData||!t.myData.isLeaflet);t.is2d()&&!e&&!t.segmentTree&&t.isLoadDone()&&(t.segmentTree=new Ht,t.segmentTree.buildFromModel(t))}))}},{key:"updateSnapperIndicators",value:function(){this.sheetSnapper.isSnapped()?this.sheetSnapper.indicator.render():this.layerSnapper.indicator.render()}},{key:"getSnapPosition",value:function(t,e,i){var n=this._getSnapPosition(t,e,i);return this.angleSnapper.updateSnapLineGizmos(n),this.updateSnapperIndicators(),n}},{key:"clearSnappingGizmos",value:function(){this.angleSnapper.clearSnappingGizmos(),this.sheetSnapper.clearSnapped(),this.sheetSnapper.indicator&&this.sheetSnapper.indicator.clearOverlays(),this.layerSnapper.clearSnapped(),this.layerSnapper.indicator&&this.layerSnapper.indicator.clearOverlays()}},{key:"startAngleSnapping",value:function(t,e){this.angleSnapper.startSnapping(t,e)}},{key:"stopAngleSnapping",value:function(){this.angleSnapper.stopSnapping()}},{key:"_getSnapPosition",value:function(t,e,i){this.angleSnapper.clearSnappingResult(),this.sheetSnapper.clearSnapped(),this.layerSnapper.clearSnapped();var n=this.layer.canvasToLayer(t,e),r=this._getGeomSnapPosition(t,e,i),o=this._getGeomSnapLine();if(r&&!o)return r;if(this.angleSnapper.snapToAngle(n,o),o&&!this.angleSnapper.isSnapped())return r;if(o&&this.angleSnapper.isSnapped()){var s=this._getGeomSnapResult(),a=new THREE.Vector3(n.x,n.y,0).applyMatrix4(this.layer.layerToWorld);s.geomType=jt.SNAP_INTERSECTION,s.snapPoint=a,s.geomVertex=s.snapPoint}return n}},{key:"_getGeomSnapPosition",value:function(t,e,i){var n=this.layer.canvasToLayer(t,e),r=this._getSheetSnapPosition(t,e),o=this._getEditLayerSnapPosition(t,e,i);return r||o?o?r?THREE.Vector2.prototype.distanceToSquared.call(r,n)<THREE.Vector2.prototype.distanceToSquared.call(o,n)?(this.layerSnapper.clearSnapped(),r):(this.sheetSnapper.clearSnapped(),o):o:r:null}},{key:"_getGeomSnapResult",value:function(){var t=this.sheetSnapper.isSnapped(),e=this.layerSnapper.isSnapped();return t||e?(t?this.sheetSnapper:this.layerSnapper).getSnapResult():null}},{key:"_getGeomSnapLine",value:function(){var t=this._getGeomSnapResult();if(!t)return null;if(t.geomEdge){var e=t.geomEdge.vertices;return this.geomSnapLine.a.copy(e[0]),this.geomSnapLine.b.copy(e[1]),this.geomSnapLine.a.applyMatrix4(this.layer.worldToLayer),this.geomSnapLine.b.applyMatrix4(this.layer.worldToLayer),this.geomSnapLine}return null}},{key:"_getEditLayerSnapPosition",value:function(t,e,i){var n=this.layer.canvasToLayer(t,e,this.tmpVec),r=this.layerSnapper.detectRadiusInPixels*this.layer.getUnitsPerPixel();this.snapBox.min.set(n.x-r,n.y-r),this.snapBox.max.set(n.x+r,n.y+r);var o={};this.layer.enumShapes(this.snapBox,(function(t){i&&!i(t)||(o[t.id]=!0)}));var s=[];if(this.layer.enumMeshes(this.snapBox,(function(t){return s.push(t)})),this.layerSnapper.clearSnapped(),this.layerSnapper.snapping2DOverlay(n,s,(function(t){return Boolean(o[t])}),r),this.layerSnapper.isSnapped()){var a=this.layerSnapper.getSnapResult(),l=Autodesk.Viewing.MeasureCommon.getSnapResultPosition(a,this.viewer);return l=(new THREE.Vector2).copy(l),a.applyMatrix4(this.layer.layerToWorld),l}}},{key:"_getSheetSnapPosition",value:function(t,e){var i=this;this.initSegmentTrees();var n=this.viewer.impl.intersectGround(t,e);if(this.sheetSnapper.snapping2DWithSegmentEnum(n,(function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=i.viewer.getVisibleModels();r.forEach((function(t){var i;t.is2d()&&t.segmentTree&&(i=t.segmentTree).enumSegments.apply(i,e)}))})),this.sheetSnapper.isSnapped()){var r=this.sheetSnapper.getSnapResult(),o=Autodesk.Viewing.MeasureCommon.getSnapResultPosition(r,this.viewer);return o=this.tmpVec.copy(o).applyMatrix4(this.layer.worldToLayer),(new THREE.Vector2).copy(o)}}}],i&&Wt(e.prototype,i),t}();function qt(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}Ut.GlobalManagerMixin.call(Zt.prototype);var Jt=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.viewer=e,this.toolSet=i,this.callbackId="Edit2D_".concat(i.name),this.callback=this.onContextMenu.bind(this)}var e,i;return e=t,(i=[{key:"register",value:function(){this.viewer.registerContextMenuCallback(this.callbackId,this.callback)}},{key:"unregister",value:function(){this.viewer.unregisterContextMenuCallback(this.callbackId)}},{key:"vertexGizmoUnderMouse",value:function(t,e){var i=this.toolSet.tools.polygonEditTool.vertexGizmos,n=document.elementFromPoint(t,e);return i.findIndex((function(t){return t.container===n}))}},{key:"onContextMenu",value:function(t,e){var i=this.toolSet.tools.polygonEditTool,n=this.toolSet.context.layer,r=e.event;if(Boolean(i.poly)){var o=n.canvasToLayer(e.canvasX,e.canvasY),s=this.vertexGizmoUnderMouse(r.clientX,r.clientY),a=s>=0,l=i.findEdgeUnderMouse(o),h=i.getNewVertexPosition(o,l),u=Boolean(h);(n.hitTest(o.x,o.y)||a||u)&&(t.length=0,a?t.push({title:"Remove Vertex",target:function(){i.removePoint(s)}}):h&&t.push({title:"Insert Vertex",target:function(){var t=l+1;i.insertPoint(t,h)}}))}}}])&&qt(e.prototype,i),t}();function Kt(t){return Kt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Kt(t)}function $t(t){return $t=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},$t(t)}function Qt(t,e){return Qt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Qt(t,e)}function te(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ee(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ie(t,e,i){return e&&ee(t.prototype,e),i&&ee(t,i),t}var ne=function(){function t(){te(this,t)}return ie(t,[{key:"apply",value:function(t){}}]),t}(),re=function(t){function e(t){var i;return te(this,e),(i=function(t,e){return!e||"object"!==Kt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}(this,$t(e).call(this))).viewer=t,i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Qt(t,e)}(e,t),ie(e,[{key:"apply",value:function(t){var e=this.viewer.model;if(e){var i=function(t){var e=t.getData().viewports;if(!e)return-1;for(var i=-1,n=-1,r=0;r<e.length;r++){var o=e[r];if(o.transform){var s=o.geom_metrics.db_ids;s>n&&(i=r,n=s)}}return i}(e);e.pageToModel(t,null,i)}}}]),e}(ne);function oe(t){return oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},oe(t)}function se(t,e,i){return se="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=le(t)););return t}(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(i):r.value}},se(t,e,i||t)}function ae(t,e){return!e||"object"!==oe(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function le(t){return le=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},le(t)}function he(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ue(t,e)}function ue(t,e){return ue=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},ue(t,e)}function pe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ce(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function de(t,e,i){return e&&ce(t.prototype,e),i&&ce(t,i),t}var ye=Autodesk.Viewing.Private,fe=function(){function t(){pe(this,t),this.measureTransform=null}return de(t,[{key:"lengthToString",value:function(t){console.error("Not implemented")}},{key:"areaToString",value:function(t){console.error("Not implemented")}}]),t}(),ve="inch",ge=function(t){function e(t){var i;return pe(this,e),(i=ae(this,le(e).call(this,t))).measureTransform=new re(t),i}return he(e,t),de(e,[{key:"updateConfig",value:function(){var t=this.config,e=this.viewer.model;t.layerUnits=e?e.getUnitString():ve;var i=this.viewer.getExtension("Autodesk.Measure"),n=i&&i.sharedMeasureConfig;n?(t.displayUnits=n.units,t.precision=n.precision,t.scaleFactor=n.calibrationFactor):(t.displayUnits=this.config.layerUnits,t.precision=2,t.scaleFactor=1)}},{key:"lengthToString",value:function(t){return this.updateConfig(),se(le(e.prototype),"lengthToString",this).call(this,t)}},{key:"areaToString",value:function(t){return this.updateConfig(),se(le(e.prototype),"areaToString",this).call(this,t)}}]),e}(function(t){function e(t){var i;return pe(this,e),(i=ae(this,le(e).call(this))).viewer=t,i.config={layerUnits:ve,displayUnits:ve,precision:2,scaleFactor:1},i}return he(e,t),de(e,[{key:"lengthToString",value:function(t){var e=this.config;return t=ye.convertUnits(e.layerUnits,e.displayUnits,e.scaleFactor,t),ye.formatValueWithUnits(t,e.displayUnits,3,e.precision)}},{key:"areaToString",value:function(t){var e=this.config;t=ye.convertUnits(e.layerUnits,e.displayUnits,e.scaleFactor,t,"square");var i=e.displayUnits?"".concat(e.displayUnits,"^2"):null;return ye.formatValueWithUnits(t,i,3,e.precision)}}]),e}(fe));function me(t){return me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},me(t)}function Pe(t,e,i){return Pe="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ee(t)););return t}(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(i):r.value}},Pe(t,e,i||t)}function xe(t,e){return!e||"object"!==me(e)&&"function"!=typeof e?Ce(t):e}function Ce(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ee(t){return Ee=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Ee(t)}function Se(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&be(t,e)}function be(t,e){return be=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},be(t,e)}function Te(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ie(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _e(t,e,i){return e&&Ie(t.prototype,e),i&&Ie(t,i),t}var Le=function(t){return t.toString()+"px"},we={Left:1,Center:2,Right:3},ke={Top:1,Center:2,Bottom:3},Ae=Autodesk.Viewing,Oe=function(){function t(){Te(this,t)}return _e(t,[{key:"update",value:function(){}}]),t}();Ae.GlobalManagerMixin.call(Oe.prototype);var Ne=function(t){function e(t){var i,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Te(this,e),(i=xe(this,Ee(e).call(this))).layer=t,i.setGlobalManager(t.globalManager),i.layerPos=new THREE.Vector2,i.canvasPos=new THREE.Vector2;var r=i.getDocument();return i.container=r.createElement("div"),i.container.style.position="absolute",i.container.style.transformOrigin="50% 50%",i.visible=!1,i.alignX=we.Center,i.alignY=ke.Center,i.angle=0,n&&i.setVisible(!0,!1),i.isUnderMouse=!1,i.container.addEventListener("mouseenter",(function(){return i.isUnderMouse=!0})),i.container.addEventListener("mouseleave",(function(){return i.isUnderMouse=!1})),i.container.addEventListener("contextmenu",(function(t){i.isUnderMouse=!0,i.layer.viewer.triggerContextMenu(t)})),i.container.addEventListener("mousedown",(function(){return i.isUnderMouse=!0})),i}return Se(e,t),_e(e,[{key:"dtor",value:function(){this.setVisible(!1)}},{key:"setVisible",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t!=this.visible&&(t?(this.layer.viewer.canvasWrap.appendChild(this.container),this.layer.addCanvasGizmo(this),e&&this.update()):(this.layer.viewer.canvasWrap.removeChild(this.container),this.layer.removeCanvasGizmo(this)),this.visible=t)}},{key:"setAlignX",value:function(t){this.alignX=t,this.update()}},{key:"setAlignY",value:function(t){this.alignY=t,this.update()}},{key:"setRotation",value:function(t){this.angle=t,this.update()}},{key:"update",value:function(){this.canvasPos.copy(this.layer.layerToCanvas(this.layerPos.x,this.layerPos.y));var t,e,i=this.canvasPos,n=this.container.style;switch(n.left=Le(i.x),n.top=Le(i.y),this.alignX){case we.Left:t="0%";break;case we.Center:t="-50%";break;case we.Right:t="-100%"}switch(this.alignY){case ke.Top:e="0%";break;case ke.Center:e="-50%";break;case ke.Bottom:e="-100%"}n.transform="translate(".concat(t,", ").concat(e,") rotate(").concat(this.angle,"deg)")}},{key:"setPosition",value:function(t,e){this.layerPos.set(t,e),this.update()}},{key:"setClassEnabled",value:function(t,e){e?this.container.classList.add(t):this.container.classList.remove(t)}},{key:"setSelected",value:function(t){this.setClassEnabled("selected",t)}},{key:"isSelected",value:function(){return this.container.classList.contains("selected")}},{key:"setHoverEnabled",value:function(t){this.setClassEnabled("enable-hover",t)}},{key:"setName",value:function(t){this.name=t,this.container.id=t||""}}]),e}(Oe),Me=function(t){t.container.classList.add("measure-length"),t.container.classList.add("visible");var e=t.getDocument();t.textDiv=e.createElement("div"),t.textDiv.classList.add("measure-length-text"),t.container.appendChild(t.textDiv),t.setText=function(t){this.textDiv.textContent=t}.bind(t)},De=function(t){function e(t,i){var n,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return Te(this,e),n=xe(this,Ee(e).call(this,i,r)),Me(Ce(n)),n.shape=t,n.valueValid=!0,n.update(),n}return Se(e,t),_e(e,[{key:"update",value:function(){if(this.shape&&this.valueValid){if(this.container.style.visibility="visible",this.shape.isPolyline()){var t=this.shape.getEdgeCount(),i=Math.floor(t/2);if(this.shape.edgeIndexValid(i)){var n=new THREE.Vector2,r=new THREE.Vector2;this.shape.getEdge(i,n,r),this.layerPos.set(.5*(n.x+r.x),.5*(n.y+r.y))}}else this.shape.computeBBox(),this.shape.bbox.center(this.layerPos);Pe(Ee(e.prototype),"update",this).call(this)}else this.container.style.visibility="hidden"}},{key:"setShape",value:function(t){this.shape=t,this.update()}}]),e}(Ne),Be=function(t){function e(t,i,n){var r,o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return Te(this,e),(r=xe(this,Ee(e).call(this,t,i,o))).unitHandler=n,r}return Se(e,t),_e(e,[{key:"update",value:function(){var t=this.shape&&this.shape.getLength&&this.shape.getLength(this.unitHandler.measureTransform);if(this.valueValid=Boolean(t),this.valueValid){var i=this.unitHandler.lengthToString(t);this.setText(i)}Pe(Ee(e.prototype),"update",this).call(this)}}]),e}(De),Xe=function(t){function e(t,i,n){var r,o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return Te(this,e),(r=xe(this,Ee(e).call(this,t,i,o))).unitHandler=n,r}return Se(e,t),_e(e,[{key:"update",value:function(){var t=this.shape&&this.shape.getArea&&this.shape.getArea(this.unitHandler.measureTransform);if(this.valueValid=Boolean(t),this.valueValid){var i=this.unitHandler.areaToString(t);this.setText(i)}Pe(Ee(e.prototype),"update",this).call(this)}}]),e}(De),Ye=function(t){function e(t){var i,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Te(this,e),(i=xe(this,Ee(e).call(this,t,n))).posA=new THREE.Vector2,i.posB=new THREE.Vector2,i.posValid=!1,i.edgeDir=new THREE.Vector2,i.poly=null,i.edgeIndex=0,i.container.classList.add("edge-gizmo"),i.maxRelativeLength=void 0,i}return Se(e,t),_e(e,[{key:"attachToEdge",value:function(t,e){this.poly=t,this.edgeIndex=e,this.update()}},{key:"detachFromEdge",value:function(){this.poly=null,this.edgeIndex=-1,this.posValid=!1,this.update()}},{key:"update",value:function(){this.poly&&this.poly.edgeIndexValid(this.edgeIndex)&&(this.poly.getEdge(this.edgeIndex,this.posA,this.posB),this.posValid=!0);var t=this._shouldBeShown();this.container.style.visibility=t?"visible":"hidden",t&&(this.layerPos.set(.5*(this.posA.x+this.posB.x),.5*(this.posA.y+this.posB.y)),this._updateRotation(),Pe(Ee(e.prototype),"update",this).call(this))}},{key:"_shouldBeShown",value:function(){if(!this.posValid)return!1;if(this.maxRelativeLength){var t=this.layer.layerToCanvas(this.posA.x,this.posA.y),e=this.layer.layerToCanvas(this.posB.x,this.posB.y),i=t.distanceTo(e)*this.maxRelativeLength,n=this.getWindow();return parseFloat(n.getComputedStyle(this.container).width)<i}return!0}},{key:"_updateRotation",value:function(){var t=B.getEdgeDirection(this.posA,this.posB,this.edgeDir),e=Math.atan2(t.y,t.x);t.x<0&&(e+=Math.PI),this.angle=-THREE.Math.radToDeg(e)}}]),e}(Ne),Fe=function(t){function e(t,i){var n,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return Te(this,e),(n=xe(this,Ee(e).call(this,t,r))).setName(i),n.container.classList.add("edge-move-gizmo"),n.maxRelativeLength=.3,n}return Se(e,t),e}(Ye),ze=function(t){function e(t){var i,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Te(this,e),i=xe(this,Ee(e).call(this,t,n)),Me(Ce(i)),i.maxRelativeLength=1,i}return Se(e,t),e}(Ye),Re=function(t){function e(t,i,n,r){var o;return Te(this,e),(o=xe(this,Ee(e).call(this,t,!0))).setPosition(i,n),o.setName(r),o.container.classList.add("vertex-gizmo"),o}return Se(e,t),e}(Ne),Ve=function(t,e){t.updateBBox();var i=t.bbox,n=i.max.x-i.min.x;return n*e.getPixelsPerUnit()*n},Ge=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;return Te(this,e),(t=xe(this,Ee(e).call(this))).minWidth=i,t}return Se(e,t),_e(e,[{key:"accepts",value:function(t,e,i){var n=Ve(t,i);return Boolean(e)&&n>=this.minWidth}}]),e}(function(){function t(){Te(this,t)}return _e(t,[{key:"accepts",value:function(t,e){return!0}}]),t}()),He=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:14;return Te(this,e),(t=xe(this,Ee(e).call(this))).rangeStart=i,t.rangeEnd=n,t}return Se(e,t),_e(e,[{key:"apply",value:function(t,e,i){var n=(Ve(e,i)-this.rangeStart)/(this.rangeEnd-this.rangeStart),r=THREE.Math.clamp(n,0,1);t.container.style.opacity=r}}]),e}(function(){function t(){Te(this,t)}return _e(t,[{key:"apply",value:function(t,e,i,n){}}]),t}()),We=function(){function t(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Ge,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new He;Te(this,t),this.layer=e,this.shapeToLabelText=i,this.labels=[],this.labelsUsed=0,this.layer.addCanvasGizmo(this),this.visible=!0,this.layer.update(),this.filter=n,this.styleRule=r}return _e(t,[{key:"setTextRule",value:function(t){this.shapeToLabelText=t,this.update()}},{key:"setVisible",value:function(t){t!==this.visible&&(t?(this.layer.addCanvasGizmo(this),this.update()):(this.clearLabels(),this.layer.removeCanvasGizmo(this)),this.visible=t)}},{key:"dtor",value:function(){this.setVisible(!1)}},{key:"clearLabels",value:function(){for(var t=0;t<this.labelsUsed;t++)this.labels[t].setShape(null),this.labels[t].setVisible(!1);this.labelsUsed=0}},{key:"acquireLabel",value:function(){return this.labelsUsed===this.labels.length&&this.labels.push(new De(null,this.layer)),this.labels[this.labelsUsed++]}},{key:"update",value:function(){this.clearLabels();for(var t=this.layer.shapes,e=0;e<t.length;e++){var i=t[e],n=this.shapeToLabelText(i);if(!this.filter||this.filter.accepts(i,n,this.layer)){var r=this.acquireLabel();r.setShape(i),r.setText(n),r.setVisible(!0),this.styleRule&&this.styleRule.apply(r,i,this.layer)}}}}]),t}(),je=function(t){function e(t){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return Te(this,e),(i=xe(this,Ee(e).call(this))).layer=t,i.textCb=n,i.viewer=i.layer.viewer,i.mousePos=null,i.distanceToBox=5,i.container=i.getDocument().createElement("div"),i.container.classList.add("adsk-control-tooltip"),i.viewer.canvasWrap.appendChild(i.container),i.layer.addCanvasGizmo(Ce(i)),i.onMouseMoved=i.onMouseMoved.bind(Ce(i)),i.viewer.canvasWrap.addEventListener("mousemove",i.onMouseMoved),i.layer.updateCanvasGizmos(),i}return Se(e,t),_e(e,[{key:"dtor",value:function(){this.layer.removeCanvasGizmo(),this.viewer.canvasWrap.removeEventListener("mousemove",this.onMouseMoved),this.viewer.canvasWrap.removeChild(this.container)}},{key:"setTextCallback",value:function(t){this.textCb=t,this.update()}},{key:"onMouseMoved",value:function(t){this.viewer.toolController.__clientToCanvasCoords(t),this.mousePos=this.layer.canvasToLayer(t.canvasX,t.canvasY),this.update()}},{key:"update",value:function(){var t=this.mousePos&&this.textCb&&this.layer.hitTest(this.mousePos.x,this.mousePos.y),e=t&&this.textCb(t);if(this.container.textContent=e||"",e){this.container.style.visibility="visible",t.updateBBox();var i=t.bbox.max,n=this.layer.layerToCanvas(i.x,i.y);n.y-=this.distanceToBox;var r=this.viewer.canvas.width,o=this.viewer.canvas.height;this.container.style.right=r-n.x+"px",this.container.style.bottom=o-n.y+"px",this.container.style.left="auto",this.container.style.top="auto"}else this.container.style.visibility="hidden"}}]),e}(Oe);function Ue(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Ze=function(){function t(e,i,n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.path=e,this.gizmoLayer=r,this.layer=n,this.index=i,this.line=new ot,this.lineVisible=!1,this.line.style.isScreenSpace=!0,this.line.style.lineColor="rgb(255, 0, 255)",this.line.style.lineWidth=1,this.line.style.lineStyle=10,this.line.style.lineAlpha=1,this.vertexGizmo1=new Re(this.gizmoLayer,0,0,"TangentGizmo-$vertexIndex-$sideIndex"),this.vertexGizmo2=new Re(this.gizmoLayer,0,0,"TangentGizmo-$vertexIndex-$sideIndex"),this.vertexGizmo1.setVisible(!1),this.vertexGizmo2.setVisible(!1),this.pStart=new THREE.Vector2,this.pEnd=new THREE.Vector2,this.layer.addCanvasGizmo(this),this.dragIndex=-1,this.lastDragPos=new THREE.Vector2,this.dragOffset=new THREE.Vector2(0,0),this.update()}var e,i;return e=t,(i=[{key:"dtor",value:function(){this.setVisible(!1),this.layer.removeCanvasGizmo(this)}},{key:"setVisible",value:function(t){this.vertexGizmo1.setVisible(t),this.vertexGizmo2.setVisible(t),t!==this.lineVisible&&(t?this.gizmoLayer.addShape(this.line):this.gizmoLayer.removeShape(this.line)),this.lineVisible=t}},{key:"update",value:function(){var t=this.path.prevIndex(this.index),e=this.path.isBezierArc(t),i=this.path.isBezierArc(this.index);if(e||i){var n=this.path.points[this.index];if(i)this.pEnd.set(n.cp1x,n.cp1y),B.mirrorPointOnPoint(this.pEnd,n,this.pStart);else{var r=this.path.points[t];this.pStart.set(r.cp2x,r.cp2y),B.mirrorPointOnPoint(this.pStart,n,this.pEnd)}this.vertexGizmo1.setPosition(this.pStart.x,this.pStart.y),this.vertexGizmo2.setPosition(this.pEnd.x,this.pEnd.y),this.line.makeLine(this.pStart.x,this.pStart.y,this.pEnd.x,this.pEnd.y),this.gizmoLayer.update(),this.setVisible(!0)}else this.setVisible(!1)}},{key:"setTangentEndPoints",value:function(t,e){var i=this.path.prevIndex(this.index);this.path.isBezierArc(i)&&this.path.updateControlPoint(i,2,t.x,t.y),this.path.isBezierArc(this.index)&&this.path.updateControlPoint(this.index,1,e.x,e.y),this.update()}},{key:"onStartVertexMoved",value:function(t){var e=this.path.getPoint(this.index),i=B.mirrorPointOnPoint(t,e);this.setTangentEndPoints(t,i)}},{key:"onEndVertexMoved",value:function(t){var e=this.path.getPoint(this.index),i=B.mirrorPointOnPoint(t,e);this.setTangentEndPoints(i,t)}},{key:"startDrag",value:function(t,e,i){this.dragIndex=i;var n=0===i?this.pStart:this.pEnd,r=this.layer.layerToCanvas(n.x,n.y);this.dragOffset.set(r.x-t,r.y-e),this.lastDragPos.copy(n)}},{key:"endDrag",value:function(t,e){this.moveDrag(t,e),this.dragIndex=-1}},{key:"moveDrag",value:function(t,e){var i=t+this.dragOffset.x,n=e+this.dragOffset.y,r=this.layer.canvasToLayer(i,n);0===this.dragIndex?this.onStartVertexMoved(r):1===this.dragIndex&&this.onEndVertexMoved(r),this.layer.update()}},{key:"onButtonDown",value:function(t,e){var i=this.vertexGizmo1.isUnderMouse,n=this.vertexGizmo2.isUnderMouse;if(!i&&!n)return!1;var r=i?0:1;return this.startDrag(t,e,r),!0}},{key:"isDragging",value:function(){return-1!==this.dragIndex}}])&&Ue(e.prototype,i),t}();function qe(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Je=Autodesk.Viewing,Ke=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.layer=e.layer,this.selection=e.selection,this.undoStack=e.undoStack,this.nameSuffix="_".concat(e.toolSetName),this.shape=null,this.dragStartPoint=new THREE.Vector2,this.backupShape=null,this.keyMap={CancelEdit:Je.KeyCode.ESCAPE},this.lastMousePos=new THREE.Vector2}var e,i;return e=t,(i=[{key:"getNames",value:function(){return[this.getName()]}},{key:"getName",value:function(){return"Edit2_MoveTool"+this.nameSuffix}},{key:"activate",value:function(){}},{key:"deactivate",value:function(){}},{key:"register",value:function(){}},{key:"handleButtonDown",value:function(t,e){if(0===e){var i=this.layer.canvasToLayer(t.canvasX,t.canvasY),n=this.layer.hitTest(i.x,i.y);return n&&this.startDrag(n,i),this.shape?this.selection.selectOnly(this.shape):this.selection.clear(),Boolean(this.shape)}}},{key:"startDrag",value:function(t,e){this.shape=t,this.dragStartPoint.copy(e),this.backupShape=t.clone()}},{key:"moveDrag",value:function(t){var e=t.x-this.dragStartPoint.x,i=t.y-this.dragStartPoint.y;this.shape.copy(this.backupShape),this.shape.move(e,i),this.layer.update()}},{key:"resetDragging",value:function(){this.shape=null,this.backupShape=null}},{key:"endDrag",value:function(t){if(this.shape){this.shape.copy(this.backupShape);var e=t.x-this.dragStartPoint.x,i=t.y-this.dragStartPoint.y;return this.undoStack.run(new bt.MoveShape(this.layer,this.shape,e,i)),!!this.shape&&(this.shape=null,!0)}}},{key:"cancelDrag",value:function(){this.isDragging()&&(this.shape.copy(this.backupShape),this.layer.update(),this.resetDragging())}},{key:"isDragging",value:function(){return Boolean(this.shape)}},{key:"handleMouseMove",value:function(t){var e=this.layer.canvasToLayer(t.canvasX,t.canvasY);return this.lastMousePos.copy(e),!!this.shape&&(this.moveDrag(e),!0)}},{key:"handleButtonUp",value:function(t,e){if(0===e){var i=this.layer.canvasToLayer(t.canvasX,t.canvasY);return this.endDrag(i)}}},{key:"handleKeyDown",value:function(t,e){e===this.keyMap.CancelEdit&&this.cancelDrag()}},{key:"getCursor",value:function(){return this.shape||this.layer.hitTest(this.lastMousePos.x,this.lastMousePos.y)?"move":void 0}}])&&qe(e.prototype,i),t}();function $e(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Qe=Autodesk.Viewing,ti=function(){function t(e){var i=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.viewer=e.viewer,this.setGlobalManager(this.viewer.globalManager),this.layer=e.layer,this.gizmoLayer=e.gizmoLayer,this.snapper=e.snapper,this.selection=e.selection,this.undoStack=e.undoStack,this.unitHandler=e.unitHandler,this.nameSuffix="_".concat(e.toolSetName),this.ignoreDragging=!1,this.ignoreActions=!1,this.onActionCb=function(t){i.ignoreActions||i.handleExternalAction(t)},this.suppressSnapping=!1,this.keyMap={SnapKey:Qe.KeyCode.SHIFT,PanKey:Qe.KeyCode.SPACE},this.selection&&(this.selectionCb=function(){i.active&&i.onSelectionChanged&&i.onSelectionChanged()},this.selection.addEventListener(yt.Events.SELECTION_CHANGED,this.selectionCb)),this.active=!1,this.canvasPos=new THREE.Vector2,this.keyState={ctrl:!1,shift:!1,alt:!1}}var e,i;return e=t,(i=[{key:"getSnapPosition",value:function(t,e){var i=this;return this.snapper&&!this.suppressSnapping?this.snapper.getSnapPosition(t,e,(function(t){return i.snappingFilter(t)})):(this.snapper.clearSnappingGizmos(),this.layer.canvasToLayer(t,e))}},{key:"dtor",value:function(){this.selectionCb&&this.selection.removeEventListener(yt.Events.SELECTION_CHANGED,this.selectionCb)}},{key:"getNames",value:function(){return[this.getName()]}},{key:"handleKeyDown",value:function(t,e){if(this.keyState[e]=!0,e!==this.keyMap.SnapKey||this.suppressSnapping||(this.suppressSnapping=!0,this.onSnappingToggled&&this.onSnappingToggled(this.canvasPos.x,this.canvasPos.y)),e===Qe.KeyCode.BACKSPACE)return!0;e===this.keyMap.PanKey&&(this.ignoreDragging=!0)}},{key:"handleKeyUp",value:function(t,e){this.keyState[e]=!1,e===this.keyMap.SnapKey&&this.suppressSnapping&&(this.suppressSnapping=!1,this.onSnappingToggled&&this.onSnappingToggled(this.canvasPos.x,this.canvasPos.y)),e===this.keyMap.PanKey&&(this.ignoreDragging=!1)}},{key:"handleExternalAction",value:function(t){}},{key:"runAction",value:function(t){this.ignoreActions=!0,this.undoStack.run(t),this.ignoreActions=!1}},{key:"activate",value:function(){this.active=!0,this.undoStack.addEventListener(pt.AFTER_ACTION,this.onActionCb)}},{key:"deactivate",value:function(){this.active=!1,this.undoStack.removeEventListener(pt.AFTER_ACTION,this.onActionCb),this.snapper&&this.snapper.clearSnappingGizmos()}},{key:"register",value:function(){}},{key:"mapKey",value:function(t,e){for(var i in e){var n=e[i];if(t.keyCode==n)return i;if(Array.isArray(n)&&n.includes(t.keyCode))return i}return null}},{key:"snappingFilter",value:function(){return!0}},{key:"trackMousePos",value:function(t){this.canvasPos.set(t.canvasX,t.canvasY)}},{key:"handleMouseMove",value:function(t){this.trackMousePos(t)}},{key:"handleSingleClick",value:function(t){this.trackMousePos(t)}},{key:"handleDoubleClick",value:function(t){this.trackMousePos(t)}},{key:"handleButtonUp",value:function(t){this.trackMousePos(t)}},{key:"handleButtonDown",value:function(t){this.trackMousePos(t)}}])&&$e(e.prototype,i),t}();function ei(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}Qe.GlobalManagerMixin.call(ti.prototype);var ii=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.checkedModifiers={}}var e,i;return e=t,(i=[{key:"addCondition",value:function(t,e){this.checkedModifiers[t]=e}},{key:"removeCondition",value:function(t){delete this.checkedModifiers[t]}},{key:"accepts",value:function(t){for(var e in this.checkedModifiers)if(t.getModifierState(e)!==this.checkedModifiers[e])return!1;return!0}}])&&ei(e.prototype,i),t}();function ni(t){return ni="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ni(t)}function ri(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function oi(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function si(t,e){return!e||"object"!==ni(e)&&"function"!=typeof e?li(t):e}function ai(t){return ai=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},ai(t)}function li(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function hi(t,e){return hi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},hi(t,e)}var ui=Autodesk.Viewing,pi=function(t){function e(t){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Q;return ri(this,e),i=si(this,ai(e).call(this,t)),Autodesk.Viewing.EventDispatcher.prototype.apply(li(i)),i.style=n,i.rect=null,i.startPoint=new THREE.Vector2,i.endPoint=new THREE.Vector2,i.dragCanceled=!1,i.areaLabel=new Xe(null,i.layer,t.unitHandler,!1),i.modifiers=new ii,i}var i,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&hi(t,e)}(e,t),i=e,(n=[{key:"setAreaLabelVisible",value:function(t){this.areaLabel.setVisible(t)}},{key:"getName",value:function(){return"Edit2_RectangleTool"+this.nameSuffix}},{key:"activate",value:function(){}},{key:"deactivate",value:function(){}},{key:"register",value:function(){}},{key:"handleButtonDown",value:function(t,e){if(!this.modifiers.accepts(t))return!1;if(0==e){var i=this.getSnapPosition(t.canvasX,t.canvasY);return this.startDrag(i),!0}}},{key:"handleButtonUp",value:function(t,e){return 0==e&&(this.dragCanceled?(this.dragCanceled=!1,!0):(this.handleMouseMove(t),this.endDrag()))}},{key:"handleMouseMove",value:function(t){var e=this.getSnapPosition(t.canvasX,t.canvasY);return!!this.rect&&(this.moveDrag(e,t.shiftKey),!0)}},{key:"startDrag",value:function(t){this.rect=new rt([t.clone(),t.clone(),t.clone(),t.clone()],this.style.clone()),this.startPoint.copy(t),this.endPoint.copy(t),this.gizmoLayer.addShape(this.rect)}},{key:"updateRect",value:function(t){if(this.isDragging()){var e=this.startPoint,i=this.endPoint;if(t){var n=i.x-e.x,r=i.y-e.y,o=Math.max(Math.abs(n),Math.abs(r)),s=Math.sign(n),a=Math.sign(r);this.rect.updatePoint(1,e.x+o*s,e.y),this.rect.updatePoint(2,e.x+o*s,e.y+o*a),this.rect.updatePoint(3,e.x,e.y+o*a)}else this.rect.updatePoint(1,i.x,e.y),this.rect.updatePoint(2,i.x,i.y),this.rect.updatePoint(3,e.x,i.y);this.gizmoLayer.update(),this.areaLabel.setShape(this.rect)}}},{key:"moveDrag",value:function(t,e){this.endPoint.copy(t),this.updateRect(e)}},{key:"endDrag",value:function(){if(!this.rect)return!1;var t=this.endPoint.x-this.startPoint.x,e=this.endPoint.y-this.startPoint.y,i=Math.abs(t)>1e-10&&Math.abs(e)>1e-10;return this.gizmoLayer.removeShape(this.rect),i&&this.undoStack.run(new bt.AddShape(this.layer,this.rect)),this.rect=null,this.areaLabel.setShape(null),!0}},{key:"cancelDrag",value:function(){this.rect&&(this.gizmoLayer.removeShape(this.rect),this.rect=null,this.dragCanceled=!0,this.areaLabel.setShape(null))}},{key:"isDragging",value:function(){return Boolean(this.rect)}},{key:"handleKeyDown",value:function(t,e){e==ui.KeyCode.SHIFT&&this.updateRect(!0)}},{key:"handleKeyUp",value:function(t,e){e==ui.KeyCode.SHIFT&&this.updateRect(!1)}}])&&oi(i.prototype,n),e}(ti);function ci(t){return ci="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ci(t)}function di(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function yi(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function fi(t,e){return!e||"object"!==ci(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function vi(t){return vi=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},vi(t)}function gi(t,e){return gi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},gi(t,e)}var mi=Autodesk.Viewing,Pi=function(t){function e(t){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Q;return di(this,e),(i=fi(this,vi(e).call(this,t))).style=n,i.line=null,i.startPoint=new THREE.Vector2,i.endPoint=new THREE.Vector2,i.dragCanceled=!1,i.lengthLabel=new Be(null,i.layer,t.unitHandler,!1),i}var i,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&gi(t,e)}(e,t),i=e,(n=[{key:"setLengthLabelVisible",value:function(t){this.lengthLabel.setVisible(t)}},{key:"getName",value:function(){return"Edit2_LineTool"+this.nameSuffix}},{key:"activate",value:function(){}},{key:"deactivate",value:function(){}},{key:"register",value:function(){}},{key:"handleButtonDown",value:function(t,e){if(0==e){var i=this.getSnapPosition(t.canvasX,t.canvasY);return this.startDrag(i),!0}}},{key:"handleButtonUp",value:function(t,e){if(0==e)return this.handleMouseMove(t),this.dragCanceled?(this.dragCanceled=!1,!0):this.endDrag()}},{key:"handleMouseMove",value:function(t){var e=this.getSnapPosition(t.canvasX,t.canvasY);return!!this.line&&(this.moveDrag(e,t.shiftKey),!0)}},{key:"startDrag",value:function(t){this.line=new ot([t.clone(),t.clone()],this.style.clone()),this.startPoint.copy(t),this.endPoint.copy(t),this.gizmoLayer.addShape(this.line)}},{key:"updateLine",value:function(){this.isDragging()&&(this.line.updatePoint(1,this.endPoint.x,this.endPoint.y),this.gizmoLayer.update(),this.lengthLabel.setShape(this.line))}},{key:"moveDrag",value:function(t,e){this.endPoint.copy(t),this.updateLine()}},{key:"endDrag",value:function(){return!!this.line&&(this.gizmoLayer.removeShape(this.line),!B.edgeIsDegenerated(this.startPoint,this.endPoint)&&this.undoStack.run(new bt.AddShape(this.layer,this.line)),this.line=null,this.lengthLabel.setShape(null),!0)}},{key:"cancelDrag",value:function(){this.line&&(this.gizmoLayer.removeShape(this.line),this.line=null,this.dragCanceled=!0,this.lengthLabel.setShape(null))}},{key:"isDragging",value:function(){return Boolean(this.line)}},{key:"handleKeyDown",value:function(t,e){e==mi.KeyCode.SHIFT&&this.updateLine(!0)}},{key:"handleKeyUp",value:function(t,e){e==mi.KeyCode.SHIFT&&this.updateLine(!1)}}])&&yi(i.prototype,n),e}(ti);function xi(t){return xi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xi(t)}function Ci(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ei(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Si(t,e){return!e||"object"!==xi(e)&&"function"!=typeof e?bi(t):e}function bi(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ti(t,e,i){return Ti="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ii(t)););return t}(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(i):r.value}},Ti(t,e,i||t)}function Ii(t){return Ii=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Ii(t)}function _i(t,e){return _i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},_i(t,e)}var Li={Polyline:1,Polygon:2},wi=Autodesk.Viewing,ki=new Q,Ai=function(t){function e(t){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Li.Polygon,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Q;return Ci(this,e),(i=Si(this,Ii(e).call(this,t))).lineRectTool=n===Li.Polygon?new pi(t,r):new Pi(t,r),Autodesk.Viewing.EventDispatcher.prototype.apply(bi(i)),i.vertexGizmos=[],i.poly=void 0,i.style=r,i.edgePreviewStyle=new Q({lineWidth:2,isScreenSpace:!0,lineStyle:11}),i.mode=n,i.lastClickX=void 0,i.lastClickY=void 0,i.keyMap.CANCEL_EDIT=wi.KeyCode.ESCAPE,i.keyMap.REMOVE_LAST_VERTEX=wi.KeyCode.BACKSPACE,i.keyMap.FINISH_EDIT=[wi.KeyCode.ENTER,wi.KeyCode.c],i.fillGizmo=null,i.outlineGizmo=null,i.edgePreviewGizmo=null,i.mousePos=new THREE.Vector2,i.areaLabel=new Xe(null,i.gizmoLayer,i.unitHandler,!1),i.lengthLabel=new ze(i.gizmoLayer,!1),i}var i,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_i(t,e)}(e,t),i=e,n=[{key:"setAreaLabelVisible",value:function(t){this.areaLabel.setVisible(t)}},{key:"setLengthLabelVisible",value:function(t){this.lengthLabel.setVisible(t)}},{key:"deactivate",value:function(){Ti(Ii(e.prototype),"deactivate",this).call(this),this.cancelEdit()}},{key:"isPolygon",value:function(){return this.poly instanceof rt}},{key:"setStyles",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t.lineColor===ki.lineColor&&e||(this.style.lineColor=t.lineColor),t.lineAlpha===ki.lineAlpha&&e||(this.style.lineAlpha=t.lineAlpha),t.lineWidth===ki.lineWidth&&e||(this.style.lineWidth=t.lineWidth,this.lineRectTool.style.lineWidth=t.lineWidth,this.edgePreviewStyle.lineWidth=2*t.lineWidth/3),t.lineStyle===ki.lineStyle&&e||(this.style.lineStyle=t.lineStyle,this.lineRectTool.style.lineStyle=t.lineStyle),t.fillColor===ki.fillColor&&e||(this.style.fillColor=t.fillColor),t.fillAlpha===ki.fillAlpha&&e||(this.style.fillAlpha=t.fillAlpha)}},{key:"initGizmos",value:function(){this.isPolygon()&&(this.fillGizmo=new rt([],this.style.clone()),this.fillGizmo.style.lineAlpha=0,this.gizmoLayer.addShape(this.fillGizmo)),this.outlineGizmo=new ot([],this.style.clone()),this.gizmoLayer.addShape(this.outlineGizmo),this.edgePreviewGizmo=new ot([],this.edgePreviewStyle),this.edgePreviewGizmo.style.lineColor=this.poly.style.lineColor,this.gizmoLayer.addShape(this.edgePreviewGizmo),this.areaLabel.setShape(this.fillGizmo),this.poly&&this.poly.isPolyline()&&this.lengthLabel.attachToEdge(this.edgePreviewGizmo,0)}},{key:"clearGizmos",value:function(){this.fillGizmo&&(this.gizmoLayer.removeShape(this.fillGizmo),this.fillGizmo=null),this.areaLabel.setShape(null),this.lengthLabel.detachFromEdge(),this.outlineGizmo&&(this.gizmoLayer.removeShape(this.outlineGizmo),this.outlineGizmo=null),this.edgePreviewGizmo&&(this.gizmoLayer.removeShape(this.edgePreviewGizmo),this.edgePreviewGizmo=null);for(var t=0;t<this.vertexGizmos.length;t++)this.vertexGizmos[t].dtor();this.vertexGizmos.length=0}},{key:"polyModified",value:function(){this.updateGizmos();var t=this.poly.clone();t.addPoint(this.mousePos.x,this.mousePos.y),this.snapper.startAngleSnapping(t,this.poly.vertexCount)}},{key:"updateGizmos",value:function(){if(this.fillGizmo){this.fillGizmo.clear();for(var t=0;t<this.poly.vertexCount;t++){var e=this.poly.getPoint(t);this.fillGizmo.addPoint(e.x,e.y)}this.fillGizmo.addPoint(this.mousePos.x,this.mousePos.y)}if(this.outlineGizmo.clear(),this.poly.vertexCount>=2)for(var i=0;i<this.poly.vertexCount;i++){var n=this.poly.getPoint(i);this.outlineGizmo.addPoint(n.x,n.y)}if(this.edgePreviewGizmo.clear(),this.poly.vertexCount>=1){var r=this.poly.getPoint(this.poly.vertexCount-1);this.edgePreviewGizmo.addPoint(r.x,r.y),this.edgePreviewGizmo.addPoint(this.mousePos.x,this.mousePos.y),this.updateLengthLabel()}this.gizmoLayer.update()}},{key:"updateLengthLabel",value:function(){if(this.poly&&this.poly.isPolyline()){var t=this.unitHandler.measureTransform,e=this.poly.getLength(t)+this.edgePreviewGizmo.getLength(t),i=this.unitHandler.lengthToString(e);this.lengthLabel.setText(i)}}},{key:"getName",value:function(){return(this.mode===Li.Polygon?"Edit2_PolygonTool":"Edit2_PolylineTool")+this.nameSuffix}},{key:"handleMouseMove",value:function(t){return Ti(Ii(e.prototype),"handleMouseMove",this).call(this,t),t.buttons?this.lineRectTool.handleMouseMove(t):(this.onHover(t.canvasX,t.canvasY),!1)}},{key:"onHover",value:function(t,e){if(this.poly){var i=this.layer.canvasToLayer(t,e),n=this.poly.vertexCount>=3&&this.vertexGizmos[0].isUnderMouse;this.setStartVertexHighlighted(n),n?(this.snapper.clearSnappingGizmos(),i.copy(this.vertexGizmos[0].layerPos)):i=this.getSnapPosition(t,e),this.mousePos.copy(i),this.edgePreviewGizmo.updatePoint(1,i.x,i.y),this.fillGizmo&&this.fillGizmo.updatePoint(this.fillGizmo.vertexCount-1,i.x,i.y),this.gizmoLayer.update(),this.updateLengthLabel()}else this.getSnapPosition(t,e)}},{key:"handleStartVertexClicked",value:function(t){if(this.poly||!(this.poly.vertexCount<3)){if(this.poly.isPolyline()){var e=this.poly.getPoint(0);this.addVertex(e.x,e.y)}this.finishPolygon(),t.stopPropagation()}}},{key:"handleSingleClick",value:function(t,i){return Ti(Ii(e.prototype),"handleSingleClick",this).call(this,t,i),0!=!i&&(this.vertexGizmos.length>0&&t.canvasX===this.lastClickX&&t.canvasY===this.lastClickY||(this.lastClickX=t.canvasX,this.lastClickY=t.canvasY,this.mousePos.copy(this.getSnapPosition(t.canvasX,t.canvasY)),this.poly||this.startPoly(this.mousePos.x,this.mousePos.y),this.addVertex(this.mousePos.x,this.mousePos.y)),!0)}},{key:"handleButtonDown",value:function(t,e){return!this.ignoreDragging&&!this.poly&&(this.selection.clear(),this.lineRectTool.handleButtonDown(t,e))}},{key:"handleButtonUp",value:function(t,e){return this.lineRectTool.handleButtonUp(t,e)}},{key:"handleDoubleClick",value:function(t,i){return Ti(Ii(e.prototype),"handleDoubleClick",this).call(this,t,i),0!=!i&&(this.finishPolygon(),!0)}},{key:"startPoly",value:function(t,e){this.mode===Li.Polygon?this.poly=new rt([],this.style.clone()):this.poly=new ot([],this.style.clone()),this.initGizmos()}},{key:"addVertex",value:function(t,e){var i=this;this.poly.addPoint(t,e);var n="PolygonTool_vertexGizmo_"+this.vertexGizmos.length,r=new Re(this.gizmoLayer,t,e,n);this.vertexGizmos.push(r),1===this.vertexGizmos.length&&r.container.addEventListener("click",(function(t){return i.handleStartVertexClicked(t)})),this.polyModified()}},{key:"removeLastVertex",value:function(){this.poly&&this.poly.vertexCount&&(this.poly.vertexCount<=1?this.cancelEdit():(this.poly.removePoint(this.poly.vertexCount-1),this.vertexGizmos[this.vertexGizmos.length-1].dtor(),this.vertexGizmos.pop(),this.polyModified()))}},{key:"finishPolygon",value:function(){this.clearGizmos(),this.snapper.stopAngleSnapping(),this.runAction(new bt.AddShape(this.layer,this.poly)),this.dispatchEvent({type:e.POLYGON_ADDED,polygon:this.poly}),this.poly=null}},{key:"cancelEdit",value:function(){this.lineRectTool.isDragging()&&this.lineRectTool.cancelDrag(),this.poly&&(this.gizmoLayer.removeShape(this.poly),this.poly=null),this.clearGizmos(),this.snapper.stopAngleSnapping()}},{key:"handleFinishKey",value:function(t){return!(!this.poly||this.isPolygon()&&this.poly.vertexCount<3||(this.finishPolygon(),0))}},{key:"handleKeyDown",value:function(t,i){var n=Ti(Ii(e.prototype),"handleKeyDown",this).call(this,t,i);switch(n=this.lineRectTool.handleKeyDown(t,i)||n,this.mapKey(t,this.keyMap)){case"CANCEL_EDIT":this.cancelEdit(),n=!0;break;case"REMOVE_LAST_VERTEX":this.removeLastVertex(),n=!0;break;case"FINISH_EDIT":n=this.handleFinishKey(t)}return n}},{key:"handleKeyUp",value:function(t,i){Ti(Ii(e.prototype),"handleKeyUp",this).call(this,t,i),this.lineRectTool.handleKeyUp(t,i)}},{key:"onSnappingToggled",value:function(t,e){this.onHover(t,e)}},{key:"mouseOnStartVertex",value:function(t){return!!this.vertexGizmos[0]&&(this.layer.canvasToLayer(t.canvasX,t.canvasY),this.vertexGizmos[0].isUnderMouse)}},{key:"setStartVertexHighlighted",value:function(t){this.vertexGizmos[0]&&this.vertexGizmos[0].setSelected(t)}},{key:"getCursor",value:function(){return"crosshair"}}],n&&Ei(i.prototype,n),e}(ti);function Oi(t){return Oi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Oi(t)}function Ni(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Mi(t,e,i){return Mi="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Di(t)););return t}(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(i):r.value}},Mi(t,e,i||t)}function Di(t){return Di=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Di(t)}function Bi(t,e){return Bi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Bi(t,e)}Ai.POLYGON_ADDED="polygonAdded",Ai.Mode=Li;var Xi=Autodesk.Viewing,Yi=function(t){return"PolygonEditTool_vertexGizmo_"+t.toString()},Fi=function(t){for(var e=0;e<t.length;e++){var i=t[e];i.setName(Yi(e)),i.update(!1)}},zi=function(t,e){var i=t.isPolyline(),n=t.vertexCount>=3&&!(i&&0===e),r=t.vertexCount>=3&&!(i&&e===t.vertexCount-1);if(!n||!r&&prevEdge===nextEdge)return!1;var o=t.prevIndex(e),s=t.nextIndex(e),a=t.getPoint(o),l=t.getPoint(e),h=t.getPoint(s);return B.isPointOnLine(l,a,h,1e-5)},Ri=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=function(t,e){return!e||"object"!==Oi(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}(this,Di(e).call(this,t))).moveTool=new Ke(t),i.poly=null,i.lastDragPoint=new THREE.Vector2,i.vertexGizmos=[],i.draggedVertex=-1,i.dragVertexStartPos=new THREE.Vector2,i.dragEdgeStartPos={a:new THREE.Vector2,b:new THREE.Vector2},i.draggedEdge=-1,i.draggedEdgeBefore=-1,i.draggedEdgeNormal=new THREE.Vector2,i.duplicateStartVertex=!1,i.duplicateEndVertex=!1,i.selectedVertex=-1,i.dragOffset=new THREE.Vector2(0,0),i.edgeGizmo=new ot,i.edgeGizmoShown=!1,i.keyMap.DeleteSelectedVertex=Xi.KeyCode.BACKSPACE,i.keyMap.CancelEdit=Xi.KeyCode.ESCAPE,i.mousePos=new THREE.Vector2,i.areaLabel=new Xe(null,i.layer,t.unitHandler,!1),i.lengthLabel=new Be(null,i.layer,t.unitHandler,!1),i.edgeGizmos=[],i.tangentGizmos=[],i.hoverEnabled=!0,i}var i,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Bi(t,e)}(e,t),i=e,(n=[{key:"setHoverEnabled",value:function(t){this.hoverEnabled&&!t&&this.selection.setHovered(null),this.hoverEnabled=t}},{key:"setAreaLabelVisible",value:function(t){this.areaLabel.setVisible(t)}},{key:"setLengthLabelVisible",value:function(t){this.lengthLabel.setVisible(t)}},{key:"getName",value:function(){return"Edit2_PolygonEditTool"+this.nameSuffix}},{key:"deactivate",value:function(){Mi(Di(e.prototype),"deactivate",this).call(this),this.reset()}},{key:"createVertexGizmos",value:function(){for(var t=0;t<this.poly.points.length;t++){var e=this.poly.points[t],i=new Re(this.gizmoLayer,e.x,e.y,Yi(t),this.poly.style);this.vertexGizmos.push(i),i.setHoverEnabled(!0)}}},{key:"updateVertexGizmos",value:function(){var t=this.poly?this.poly.vertexCount:0,e=new THREE.Vector2;if(t==this.vertexGizmos.length)for(var i=0;i<t;i++)this.poly.getPoint(i,e),this.vertexGizmos[i].setPosition(e.x,e.y);else this.clearVertexGizmos(),this.createVertexGizmos()}},{key:"clearVertexGizmos",value:function(){for(var t=0;t<this.vertexGizmos.length;t++)this.vertexGizmos[t].dtor();this.vertexGizmos.length=0}},{key:"clearEdgeGizmos",value:function(){for(var t=0;t<this.edgeGizmos.length;t++)this.edgeGizmos[t].dtor();this.edgeGizmos.length=0}},{key:"createEdgeGizmos",value:function(){this.clearEdgeGizmos();for(var t=this.poly?this.poly.getEdgeCount():0,e=0;e<t;e++){var i=new Fe(this.layer,"PolygonEditTool_edgeGizmo_"+e.toString());i.attachToEdge(this.poly,e),this.edgeGizmos.push(i)}}},{key:"updateVertexHighlighting",value:function(){for(var t=0;t<this.vertexGizmos.length;t++)this.vertexGizmos[t].setSelected(t===this.selectedVertex)}},{key:"updateAllGizmos",value:function(){this.updateVertexGizmos(),this.createEdgeGizmos(),this.createTangentGizmos()}},{key:"setSelectedVertex",value:function(t){this.selectedVertex=this.poly?t:-1,this.updateVertexHighlighting()}},{key:"getVertexIndex",value:function(t,e){for(var i=0;i<this.vertexGizmos.length;i++)if(this.vertexGizmos[i].isUnderMouse)return i;return-1}},{key:"getEdgeIndex",value:function(t,e){for(var i=0;i<this.edgeGizmos.length;i++)if(this.edgeGizmos[i].isUnderMouse)return i;return-1}},{key:"reset",value:function(){this.poly&&(this.clearVertexGizmos(),this.clearEdgeGizmos(),this.clearTangentGizmos(),this.areaLabel.setShape(null),this.lengthLabel.setShape(null),this.poly=null,this.draggedVertex=-1,this.draggedEdge=-1,this.selectedVertex=-1,this.snapper.stopAngleSnapping())}},{key:"setEditPoly",value:function(t){this.reset(),t&&(this.poly=t,this.updateAllGizmos());var e=t&&t.isPolygon()?t:null;this.areaLabel.setShape(e);var i=t&&t.isPolyline()?t:null;this.lengthLabel.setShape(i)}},{key:"insertPoint",value:function(t,e){this.runAction(new bt.AddVertex(this.layer,this.poly,t,e));var i=new Re(this.gizmoLayer,e.x,e.y,void 0,this.poly.style);i.setHoverEnabled(!0),this.vertexGizmos.splice(t,0,i),Fi(this.vertexGizmos),this.updateAllGizmos(),this.layer.update()}},{key:"removePoint",value:function(t){var e=this.poly.isPolygon()?3:2;if(this.poly.vertexCount<=e)return this.runAction(new bt.RemoveShape(this.layer,this.poly)),void this.reset();this.runAction(new bt.RemoveVertex(this.layer,this.poly,t));var i=this.vertexGizmos.splice(t,1)[0];Fi(this.vertexGizmos),this.updateAllGizmos(),i.dtor(),this.selectedVertex===t&&this.setSelectedVertex(-1),this.layer.update()}},{key:"startDragVertex",value:function(t,e){this.snapper.startAngleSnapping(this.poly.clone(),e),this.draggedVertex=e;var i=this.poly.points[this.draggedVertex],n=this.layer.layerToCanvas(i.x,i.y);this.dragOffset.set(n.x-t.canvasX,n.y-t.canvasY),this.setSelectedVertex(this.draggedVertex),this.lastDragPoint.copy(i),this.dragVertexStartPos.copy(i)}},{key:"moveDragVertex",value:function(t,e){var i=t+this.dragOffset.x,n=e+this.dragOffset.y,r=this.getSnapPosition(i,n),o=r.x-this.lastDragPoint.x,s=r.y-this.lastDragPoint.y,a=this.poly.points[this.draggedVertex];this.poly.updatePoint(this.draggedVertex,a.x+o,a.y+s),this.vertexGizmos[this.draggedVertex].setPosition(a.x,a.y),this.gizmoLayer.update(),this.layer.update(),this.lastDragPoint.copy(r)}},{key:"restoreDragVertex",value:function(){this.poly.updatePoint(this.draggedVertex,this.dragVertexStartPos.x,this.dragVertexStartPos.y)}},{key:"endDragVertex",value:function(){this.restoreDragVertex();var t=this.dragVertexStartPos,e=this.lastDragPoint,i=.5*this.layer.getUnitsPerPixel();t.distanceTo(e)>i&&this.runAction(new bt.MoveVertex(this.layer,this.poly,this.draggedVertex,e)),this.draggedVertex=-1,this.snapper.clearSnappingGizmos()}},{key:"startDragEdge",value:function(t,e){this.draggedEdgeNormal=function(t,e,i){var n=e,r=(e+1)%t.vertexCount,o=t.getPoint(n),s=t.getPoint(r);i.subVectors(s,o).normalize();var a=i.x;return i.x=-i.y,i.y=a,i}(this.poly,e,this.draggedEdgeNormal),this.lastDragPoint.copy(this.layer.canvasToLayer(t.canvasX,t.canvasY));var i=e,n=(e+1)%this.poly.vertexCount;this.dragEdgeStartPos.a.copy(this.poly.getPoint(i)),this.dragEdgeStartPos.b.copy(this.poly.getPoint(n)),this.duplicateStartVertex=zi(this.poly,i),this.duplicateEndVertex=zi(this.poly,n),bt.MoveEdge.duplicateVertices(this.poly,e,this.duplicateStartVertex,this.duplicateEndVertex),this.draggedEdgeBefore=e;var r=bt.MoveEdge.getNewEdgeIndex(this.poly,e,this.duplicateStartVertex,this.duplicateEndVertex);this.setSelectedEdge(r),(this.duplicateStartVertex||this.duplicateEndVertex)&&this.updateAllGizmos()}},{key:"moveDragEdge",value:function(t){var e=this.layer.canvasToLayer(t.canvasX,t.canvasY),i=e.clone().sub(this.lastDragPoint),n=this.poly.prevIndex(this.draggedEdge),r=this.poly.nextIndex(this.draggedEdge),o=new THREE.Vector2,s=new THREE.Vector2,a=new THREE.Vector2,l=new THREE.Vector2,h=new THREE.Vector2,u=new THREE.Vector2;this.poly.getEdge(n,o,s),this.poly.getEdge(this.draggedEdge,a,l),this.poly.getEdge(r,h,u),a.add(i),l.add(i);var p=B.getEdgeDirection(o,s),c=B.getEdgeDirection(a,l),d=B.getEdgeDirection(h,u);this.duplicateStartVertex&&p.copy(this.draggedEdgeNormal),this.duplicateEndVertex&&d.copy(this.draggedEdgeNormal);var y=new THREE.Vector2,f=new THREE.Vector2;if(B.intersectLines(o,p,a,c,y)&&B.intersectLines(h,d,a,c,f)){var v=this.draggedEdge,g=this.poly.nextIndex(v);this.poly.updatePoint(v,y.x,y.y),this.poly.updatePoint(g,f.x,f.y),this.vertexGizmos[v].setPosition(y.x,y.y),this.vertexGizmos[g].setPosition(f.x,f.y),this.gizmoLayer.update(),this.layer.update(),this.lastDragPoint.copy(e),this.updateEdgeGizmo()}}},{key:"restoreDragEdge",value:function(){var t=this.dragEdgeStartPos.a,e=this.dragEdgeStartPos.b,i=this.draggedEdge,n=this.poly.nextIndex(i);this.poly.updatePoint(i,t.x,t.y),this.poly.updatePoint(n,e.x,e.y),bt.MoveEdge.revertDuplicateVertices(this.poly,this.draggedEdgeBefore,this.duplicateStartVertex,this.duplicateEndVertex)}},{key:"endDragEdge",value:function(){var t=this.draggedEdge,e=this.poly.nextIndex(t),i=this.poly.getPoint(t),n=this.poly.getPoint(e);this.restoreDragEdge(),this.dragEdgeStartPos.a.distanceTo(i)*this.layer.getPixelsPerUnit()<3||(this.runAction(new bt.MoveEdge(this.layer,this.poly,this.draggedEdgeBefore,i,n,this.duplicateStartVertex,this.duplicateEndVertex)),this.setSelectedEdge(-1),this.updateAllGizmos())}},{key:"edgeMovePossible",value:function(){return this.poly&&this.poly.vertexCount>2}},{key:"findEdgeUnderMouse",value:function(t){var e=17*this.layer.getUnitsPerPixel();return this.poly?this.poly.findEdgeIndex(t,e):-1}},{key:"getNewVertexPosition",value:function(t,e){if(!this.poly||!this.poly.edgeIndexValid(e))return null;var i=new THREE.Vector2,n=new THREE.Vector2;this.poly.getEdge(e,i,n);var r=B.getEdgeDirection(i,n),o=t.clone();return B.projectToLine(o,i,r),B.isPointOnEdge(o,i,n,1e-4)?o:null}},{key:"handleButtonDown",value:function(t,i){if(this.ignoreDragging)return!1;if(Mi(Di(e.prototype),"handleButtonDown",this).call(this,t,i),0==!i)return!1;var n=this.layer.canvasToLayer(t.canvasX,t.canvasY);this.mousePos.copy(n);var r=this.getVertexIndex(n.x,n.y);if(-1!=r)return this.startDragVertex(t,r),!0;var o=-1;if(t.ctrlKey){var s=this.findEdgeUnderMouse(this.mousePos),a=this.getNewVertexPosition(this.mousePos,s);if(a)return o=s+1,this.insertPoint(o,a),this.startDragVertex(t,o),!0}this.setSelectedVertex(-1);for(var l=0;l<this.tangentGizmos.length;l++)if(this.tangentGizmos[l].onButtonDown(t.canvasX,t.canvasY))return!0;var h=this.getEdgeIndex(n.x,n.y);if(this.edgeMovePossible()&&-1!==h)return this.startDragEdge(t,h),!0;if(this.poly){var u=this.layer.getLineHitRadius(this.poly);if(this.poly.hitTest(n.x,n.y,u))return this.moveTool.startDrag(this.poly,n),!0}var p=this.layer.hitTest(n.x,n.y);return p instanceof rt||p instanceof ot||p instanceof st||(p=null),this.selection.selectOnly(p),Boolean(this.poly)}},{key:"handleSingleClick",value:function(t){return Mi(Di(e.prototype),"handleSingleClick",this).call(this,t),console.log("poly",this.poly),Boolean(this.poly)}},{key:"handleMouseMove",value:function(t){if(Mi(Di(e.prototype),"handleMouseMove",this).call(this,t),this.mousePos.copy(this.layer.canvasToLayer(t.canvasX,t.canvasY)),this.updateMouseOverHighlights(),!this.poly)return!1;if(-1!=this.draggedVertex)return this.moveDragVertex(t.canvasX,t.canvasY),!0;-1!=this.draggedEdge&&this.moveDragEdge(t),this.moveTool.isDragging()&&(this.moveTool.moveDrag(this.mousePos),this.updateVertexGizmos());var i=this.findDraggedTangentGizmo();return i&&i.moveDrag(t.canvasX,t.canvasY),!1}},{key:"handleButtonUp",value:function(t,i){if(Mi(Di(e.prototype),"handleButtonUp",this).call(this,t,i),-1!==this.draggedVertex)return this.endDragVertex(),!0;if(-1!==this.draggedEdge)return this.endDragEdge(),!0;if(this.moveTool.isDragging()){var n=this.layer.canvasToLayer(t.canvasX,t.canvasY);return this.ignoreActions=!0,this.moveTool.endDrag(n),this.ignoreActions=!1,this.updateVertexGizmos(),!0}var r=this.findDraggedTangentGizmo();return r&&r.endDrag(t.canvasX,t.canvasY),!this.ignoreDragging&&this.poly&&0==i}},{key:"snappingFilter",value:function(t){return t!==this.poly}},{key:"onSelectionChanged",value:function(){var t=this.selection.getSelectedShapes()[0];t instanceof nt?this.setEditPoly(t):this.setEditPoly(null)}},{key:"handleKeyDown",value:function(t,i){var n=Mi(Di(e.prototype),"handleKeyDown",this).call(this,t,i);return i===this.keyMap.DeleteSelectedVertex&&this.poly&&-1!==this.selectedVertex&&(this.removePoint(this.selectedVertex),n=!0),i===this.keyMap.CancelEdit?(this.cancelDrag(),!0):n}},{key:"onSnappingToggled",value:function(t,e){-1!==this.draggedVertex&&this.moveDragVertex(t,e)}},{key:"cancelDrag",value:function(){var t=!1;-1!==this.draggedVertex&&(this.restoreDragVertex(),this.draggedVertex=-1,t=!0),-1!==this.draggedEdge&&(this.restoreDragEdge(),this.draggedEdge=-1,t=!0),this.moveTool.isDragging()&&(this.moveTool.cancelDrag(),this.updateVertexGizmos()),t&&(this.layer.update(),this.updateAllGizmos()),this.snapper.clearSnappingGizmos()}},{key:"handleExternalAction",value:function(){this.poly&&(Boolean(this.layer.findShapeById(this.poly.id))||this.reset(),this.updateAllGizmos(),this.cancelDrag(),this.snapper.clearSnappingGizmos())}},{key:"updateEdgeGizmo",value:function(){var t=this.getEdgeIndex(this.mousePos.x,this.mousePos.y),e=-1!=this.getVertexIndex(this.mousePos.x,this.mousePos.y)||-1!=this.draggedVertex,i=this.edgeMovePossible(),n=this.poly&&-1!=this.draggedEdge,r=n||i&&-1!=t&&!e;if(r&&!this.edgeGizmoShown?(this.gizmoLayer.addShape(this.edgeGizmo),this.edgeGizmoShown=!0):!r&&this.edgeGizmoShown&&(this.gizmoLayer.removeShape(this.edgeGizmo),this.edgeGizmoShown=!1),r){var o=n?this.draggedEdge:t,s=new THREE.Vector2,a=new THREE.Vector2;this.poly.getEdge(o,s,a),this.edgeGizmo.makeLine(s.x,s.y,a.x,a.y),this.edgeGizmo.style.lineWidth=this.poly.style.lineWidth,this.edgeGizmo.style.isScreenSpace=this.poly.style.isScreenSpace,n?(this.edgeGizmo.style.lineColor="rgb(0, 255, 0)",this.edgeGizmo.style.lineAlpha=1):(this.edgeGizmo.style.lineColor="rgb(0, 255, 0)",this.edgeGizmo.style.lineAlpha=.5),this.gizmoLayer.update()}}},{key:"setSelectedEdge",value:function(t){this.draggedEdge=t,this.updateEdgeGizmo();for(var e=0;e<this.edgeGizmos.length;e++)this.edgeGizmos[e].setSelected(e==this.draggedEdge)}},{key:"updateMouseOverHighlights",value:function(){if(this.updateEdgeGizmo(),this.hoverEnabled){var t=this.layer.hitTest(this.mousePos.x,this.mousePos.y);this.selection.setHoveredId(t?t.id:0)}}},{key:"getCursor",value:function(){if(this.poly){var t=this.mousePos;if(this.moveTool.isDragging())return"move";if(-1!=this.draggedVertex||-1!=this.draggedEdge)return"move";if(this.keyState[Xi.KeyCode.CONTROL]){var e=17*this.layer.getUnitsPerPixel();if(-1!==(this.poly?this.poly.findEdgeIndex(this.mousePos,e):-1))return"copy"}var i=this.layer.getLineHitRadius(this.poly);return this.poly.hitTest(t.x,t.y,i)?"move":void 0}}},{key:"clearTangentGizmos",value:function(){this.tangentGizmos.forEach((function(t){return t.dtor()})),this.tangentGizmos.length=0}},{key:"createTangentGizmos",value:function(){if(this.clearTangentGizmos(),this.poly&&this.poly.isPath())for(var t=0;t<this.poly.points.length;t++)this.tangentGizmos.push(new Ze(this.poly,t,this.layer,this.gizmoLayer))}},{key:"findDraggedTangentGizmo",value:function(){return this.tangentGizmos.find((function(t){return t.isDragging()}))}}])&&Ni(i.prototype,n),e}(ti);function Vi(t){return Vi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Vi(t)}function Gi(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Hi(t){return Hi=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Hi(t)}function Wi(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ji(t,e){return ji=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},ji(t,e)}var Ui=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),i=function(t,e){return!e||"object"!==Vi(e)&&"function"!=typeof e?Wi(t):e}(this,Hi(e).call(this,t)),Autodesk.Viewing.EventDispatcher.prototype.apply(Wi(i)),i.symbol=new at(0,0,.2,new Q({fillAlpha:1,lineWidth:.01,fillColor:"rgb(255, 255, 0)"})),i}var i,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ji(t,e)}(e,t),i=e,(n=[{key:"getName",value:function(){return"Edit2_InsertSymbolTool"+this.nameSuffix}},{key:"activate",value:function(){}},{key:"deactivate",value:function(){}},{key:"register",value:function(){}},{key:"setSymbol",value:function(t){this.symbol=t}},{key:"handleMouseMove",value:function(t){}},{key:"handleSingleClick",value:function(t){var i=this.layer.canvasToLayer(t.canvasX,t.canvasY),n=this.symbol.clone();return n.move(i.x,i.y),this.undoStack.run(new bt.AddShape(this.layer,n)),this.dispatchEvent({type:e.SYMBOL_INSERTED,symbol:n}),!0}},{key:"handleAutoDraw",value:function(t){var i=this.symbol.clone();return i.move(t.x,t.y),this.undoStack.run(new bt.AddShape(this.layer,i)),this.dispatchEvent({type:e.SYMBOL_INSERTED,symbol:i}),!0}},{key:"moveDraw",value:function(t){return this.symbol.move(t.x,t.y),!0}},{key:"handleDoubleClick",value:function(){return!0}},{key:"getCursor",value:function(){return"crosshair"}}])&&Gi(i.prototype,n),e}(ti);function Zi(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}Ui.SYMBOL_INSERTED="symbolInserted";var qi=Autodesk.Viewing,Ji=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.undoStack=e}var e,i;return e=t,(i=[{key:"handleKeyDown",value:function(t,e){if(e!==qi.KeyCode.z||!t.ctrlKey)return!1;t.shiftKey?this.undoStack.redo():this.undoStack.undo()}},{key:"getName",value:function(){return"Edit2_UndoTool"}},{key:"getNames",value:function(){return[this.getName()]}},{key:"activate",value:function(){}},{key:"deactivate",value:function(){}},{key:"register",value:function(){}}])&&Zi(e.prototype,i),t}();function Ki(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var $i=Autodesk.Viewing,Qi=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Autodesk.Viewing.EventDispatcher.prototype.apply(this),this.viewer=e.viewer,this.layer=e.layer,this.selection=e.selection,this.undoStack=e.undoStack,this.nameSuffix="_".concat(e.toolSetName),this.clipBoard=[],this.pasteCounter=0}var e,i;return e=t,(i=[{key:"copy",value:function(){this.clipBoard.length=0;var t=this.selection.getSelectedShapes();this.originalShapes=t,this.clipBoard=t.slice(),this.pasteCounter=0}},{key:"paste",value:function(){this.pasteCounter++;var e=30*this.pasteCounter*this.layer.getUnitsPerPixel(),i=[],n={type:t.BEFORE_PASTE,originalShapes:this.originalShapes,veto:!1};if(this.dispatchEvent(n),!n.veto){for(var r=0;r<this.clipBoard.length;r++){var o=this.clipBoard[r].clone();o.move(e,e),i.push(o)}this.selection.setSelection(i),this.undoStack.run(new bt.AddShapes(this.layer,i)),this.dispatchEvent({type:t.AFTER_PASTE,originalShapes:this.originalShapes,shapes:i})}}},{key:"delete",value:function(){var t=this.selection.getSelectedShapes();this.undoStack.run(new bt.RemoveShapes(this.layer,t)),this.selection.clear()}},{key:"handleKeyDown",value:function(t,e){if(!this.selection.empty()){if(e===$i.KeyCode.DELETE)return this.delete(),!0;if(t.ctrlKey&&e===$i.KeyCode.c)return this.copy(),!0}if(0!==this.clipBoard.length&&t.ctrlKey&&e===$i.KeyCode.v)return this.paste(),!0}},{key:"getName",value:function(){return"Edit2_CopyTool"+this.nameSuffix}},{key:"getNames",value:function(){return[this.getName()]}},{key:"activate",value:function(){}},{key:"deactivate",value:function(){}},{key:"register",value:function(){}}])&&Ki(e.prototype,i),t}();Qi.BEFORE_PASTE="BEFORE_PASTE",Qi.AFTER_PASTE="AFTER_PASTE";var tn=i(379),en=i.n(tn),nn=i(795),rn=i.n(nn),on=i(569),sn=i.n(on),an=i(565),ln=i.n(an),hn=i(216),un=i.n(hn),pn=i(589),cn=i.n(pn),dn=i(490),yn={};function fn(t){return fn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fn(t)}function vn(t,e,i,n,r,o,s){try{var a=t[o](s),l=a.value}catch(t){return void i(t)}a.done?e(l):Promise.resolve(l).then(n,r)}function gn(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function mn(t,e,i){return e&&gn(t.prototype,e),i&&gn(t,i),t}function Pn(t){return Pn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Pn(t)}function xn(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Cn(t,e){return Cn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Cn(t,e)}function En(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}yn.styleTagTransform=cn(),yn.setAttributes=ln(),yn.insert=sn().bind(null,"head"),yn.domAPI=rn(),yn.insertStyleElement=un(),en()(dn.Z,yn),dn.Z&&dn.Z.locals&&dn.Z.locals;var Sn=AutodeskNamespace("Autodesk.Edit2D"),bn=Autodesk.Viewing,Tn=function t(e,i){En(this,t),this.name=e,this.autoReactivate=i,this.context=null,this.tools={}},In=function(t){function e(t,i){var n;return En(this,e),(n=function(t,e){return!e||"object"!==fn(e)&&"function"!=typeof e?xn(t):e}(this,Pn(e).call(this,t,i))).undoStack=new pt,n._registeredTools=new Map,n._boundOnModelAdded=n._onModelAdded.bind(xn(n)),n._boundOnModelRemoved=n._onModelRemoved.bind(xn(n)),n._boundOnSelectionChanged=n._onSelectionChanged.bind(xn(n)),n}var i,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Cn(t,e)}(e,t),mn(e,[{key:"load",value:(i=regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.viewer.impl.createOverlayScene("Edit2D"),t.next=3,this.viewer.loadExtension("Autodesk.Snapping");case 3:this.viewer.addEventListener(bn.MODEL_ADDED_EVENT,this._boundOnModelAdded),this.viewer.addEventListener(bn.MODEL_REMOVED_EVENT,this._boundOnModelRemoved),this.undoTool=new Ji(this.undoStack),this.viewer.toolController.registerTool(this.undoTool),this.viewer.toolController.activateTool(this.undoTool.getName());case 8:case"end":return t.stop()}}),t,this)})),n=function(){var t=this,e=arguments;return new Promise((function(n,r){var o=i.apply(t,e);function s(t){vn(o,n,r,s,a,"next",t)}function a(t){vn(o,n,r,s,a,"throw",t)}s(void 0)}))},function(){return n.apply(this,arguments)})},{key:"unload",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this._registeredTools.keys()[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var o=n.value;this.unregisterTools(o)}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}return this.viewer.toolController.deregisterTool(this.undoTool),this.undoTool=null,this.viewer.removeEventListener(bn.MODEL_ADDED_EVENT,this._boundOnModelAdded),this.viewer.removeEventListener(bn.MODEL_REMOVED_EVENT,this._boundOnModelRemoved),!0}},{key:"_onModelAdded",value:function(){var t=this;if(1===this.viewer.getVisibleModels().length){var e=!0,i=!1,n=void 0;try{for(var r,o=this._registeredTools.values()[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;s.autoReactivate&&s.toolsToReactivate.forEach((function(e){return t.viewer.toolController.activateTool(e)}))}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}}}},{key:"_onModelRemoved",value:function(){if(0===this.viewer.getVisibleModels().length){var t=this.viewer.toolController,e=!0,i=!1,n=void 0;try{for(var r,o=this._registeredTools.values()[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;s.autoReactivate&&(s.toolsToReactivate=Object.values(s.tools).map((function(t){return t.getNames()})).reduce((function(t,e){return t.concat(e)}),[]).filter((function(e){return t.isToolActivated(e)})),s.toolsToReactivate.forEach((function(e){return t.deactivateTool(e)})))}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}}}},{key:"_onSelectionChanged",value:function(t){var e=t.target,i=!0,n=!1,r=void 0;try{for(var o,s=this._registeredTools.values()[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;e===a.context.selection||e.empty()||a.context.selection.clear()}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}}},{key:"registerDefaultTools",value:function(){this.defaultContext=this.registerTools("default")}},{key:"registerTools",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this._registeredTools.get(t);if(i)return console.warn("Edit 2D tools are already registered for tool set '".concat(t,"'")),i.context;i=new Tn(t,e),this._registeredTools.set(t,i);var n=i.context=new _n(this,t);n.selection.addEventListener(yt.Events.SELECTION_CHANGED,this._boundOnSelectionChanged),i.tools.polygonTool=new Ai(n,Ai.Mode.Polygon),i.tools.polylineTool=new Ai(n,Ai.Mode.Polyline),i.tools.moveTool=new Ke(n),i.tools.polygonEditTool=new Ri(n),i.tools.insertSymbolTool=new Ui(n),i.tools.copyTool=new Qi(n);var r=this.viewer.toolController;return r.registerTool(i.tools.polygonTool),r.registerTool(i.tools.polylineTool),r.registerTool(i.tools.moveTool),r.registerTool(i.tools.polygonEditTool),r.registerTool(i.tools.insertSymbolTool),r.registerTool(i.tools.copyTool),r.activateTool(i.tools.copyTool.getName()),i.contextMenu=new Jt(this.viewer,i),i.contextMenu.register(),n}},{key:"unregisterDefaultTools",value:function(){this.unregisterTools("default"),this.defaultContext=null}},{key:"unregisterTools",value:function(t){var e=this._registeredTools.get(t);if(e){var i=this.viewer.toolController;i.deregisterTool(e.tools.polygonTool),i.deregisterTool(e.tools.polylineTool),i.deregisterTool(e.tools.moveTool),i.deregisterTool(e.tools.polygonEditTool),i.deregisterTool(e.tools.insertSymbolTool),i.deregisterTool(e.tools.copyTool),e.context.selection.removeEventListener(yt.Events.SELECTION_CHANGED,this._boundOnSelectionChanged),e.contextMenu.unregister(),e.contextMenu=null,this._registeredTools.delete(t)}}},{key:"createLayer",value:function(){this.viewer.model||console.error("A 2D model is needed to adjust viewport");var t=new k(this.viewer);return this.viewer.impl.overlayScenes.Edit2D.scene.add(t.scene),t}},{key:"defaultTools",get:function(){var t=this._registeredTools.get("default");return t&&t.tools}}]),e}(bn.Extension),_n=function(){function t(e,i){var n=this;En(this,t),this.toolSetName=i,this.viewer=e.viewer,this.layer=e.createLayer(),this.gizmoLayer=e.createLayer(),this.undoStack=e.undoStack,this.selection=new yt(this.layer,this.undoStack),this.snapper=new Zt(this.viewer,this.layer,this.gizmoLayer),this.unitHandler=new ge(this.viewer),this.viewer.addEventListener(Autodesk.Viewing.MeasureCommon.Events.DISPLAY_UNITS_CHANGED,(function(){n.layer.updateCanvasGizmos(),n.gizmoLayer.updateCanvasGizmos()}))}return mn(t,[{key:"setMatrix",value:function(t){this.layer.setMatrix(t),this.gizmoLayer.setMatrix(t),this.layer.update(),this.gizmoLayer.update()}}]),t}();Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Edit2D",In),Sn.Shape=it,Sn.Polygon=rt,Sn.Polyline=ot,Sn.PolyBase=nt,Sn.Path=st,Sn.Circle=at,Sn.Style=Q,Sn.PolygonTool=Ai,Sn.Selection=yt,Sn.MoveTool=Ke,Sn.PolygonEditTool=Ri,Sn.InsertSymbolTool=Ui,Sn.Math2D=B,Sn.VertexGizmo=Re,Sn.RectangleTool=pi,Sn.LineTool=Pi,Sn.CopyTool=Qi,Sn.Actions=bt,Sn.UndoStack=pt,Sn.UndoTool=Ji,Sn.Edit2DContext=_n,Sn.CanvasGizmo=Ne,Sn.CanvasGizmoBase=Oe,Sn.ShapeLabel=De,Sn.AlignX=we,Sn.AlignY=ke,Sn.AreaLabel=Xe,Sn.EdgeLabel=ze,Sn.UnitHandler=fe,Sn.DefaultUnitHandler=ge,Sn.ShapeLabelRule=We,Sn.ShapeWrapper=lt,Sn.SegmentTree=Ht,Sn.TangentGizmo=Ze,Sn.MeasureTransform=ne,Sn.DefaultMeasureTransform=re,Sn.ShapeToolTip=je})(),Autodesk.Extensions.Edit2D=n})();
//# sourceMappingURL=Edit2D.min.js.map