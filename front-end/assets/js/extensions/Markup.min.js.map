{"version":3,"file":"Markup/Markup.min.js","mappings":"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","sources":["webpack://Autodesk.Extensions/./Markup/core/Markups.css","webpack://Autodesk.Extensions/./Markup/gui/MarkupsGui.css","webpack://Autodesk.Extensions/./node_modules/css-loader/dist/runtime/api.js","webpack://Autodesk.Extensions/./node_modules/css-loader/dist/runtime/sourceMaps.js","webpack://Autodesk.Extensions/./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js","webpack://Autodesk.Extensions/./node_modules/style-loader/dist/runtime/insertBySelector.js","webpack://Autodesk.Extensions/./node_modules/style-loader/dist/runtime/insertStyleElement.js","webpack://Autodesk.Extensions/./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js","webpack://Autodesk.Extensions/./node_modules/style-loader/dist/runtime/styleDomAPI.js","webpack://Autodesk.Extensions/./node_modules/style-loader/dist/runtime/styleTagTransform.js","webpack://Autodesk.Extensions/./thirdparty/canvg/canvg.js","webpack://Autodesk.Extensions/./thirdparty/canvg/rgbcolor.js","webpack://Autodesk.Extensions/./thirdparty/resize-observer-polyfill/ResizeObserver.min.js","webpack://Autodesk.Extensions/webpack/bootstrap","webpack://Autodesk.Extensions/webpack/runtime/compat get default export","webpack://Autodesk.Extensions/webpack/runtime/define property getters","webpack://Autodesk.Extensions/webpack/runtime/hasOwnProperty shorthand","webpack://Autodesk.Extensions/webpack/runtime/make namespace object","webpack://Autodesk.Extensions/webpack/runtime/nonce","webpack://Autodesk.Extensions/./Markup/core/MarkupTypes.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/EditAction.js","webpack://Autodesk.Extensions/./Markup/core/StyleUtils.js","webpack://Autodesk.Extensions/./Markup/core/MarkupEvents.js","webpack://Autodesk.Extensions/./Markup/core/Markup.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/SetStyle.js","webpack://Autodesk.Extensions/./Markup/core/edit-modes/EditMode.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/DeleteArrow.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/SetArrow.js","webpack://Autodesk.Extensions/./Markup/core/edit-modes/EditModeArrow.js","webpack://Autodesk.Extensions/./Markup/core/MarkupArrow.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/CreateArrow.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/DeleteRectangle.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/SetRectangle.js","webpack://Autodesk.Extensions/./Markup/core/edit-modes/EditModeRectangle.js","webpack://Autodesk.Extensions/./Markup/core/MarkupRectangle.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/CreateRectangle.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/DeleteText.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/SetCallout.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/SetSize.js","webpack://Autodesk.Extensions/./Markup/core/edit-modes/EditorTextAutosize.js","webpack://Autodesk.Extensions/./Markup/core/DomElementStyle.js","webpack://Autodesk.Extensions/./Markup/core/edit-modes/EditorTextInput.js","webpack://Autodesk.Extensions/./Markup/core/edit-modes/EditModeCallout.js","webpack://Autodesk.Extensions/./Markup/core/MarkupCallout.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/CreateCallout.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/DeleteCallout.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/SetText.js","webpack://Autodesk.Extensions/./Markup/core/edit-modes/EditModeText.js","webpack://Autodesk.Extensions/./Markup/core/MarkupText.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/CreateText.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/DeleteCircle.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/SetCircle.js","webpack://Autodesk.Extensions/./Markup/core/edit-modes/EditModeCircle.js","webpack://Autodesk.Extensions/./Markup/core/MarkupCircle.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/CreateCircle.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/DeleteCloud.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/SetCloud.js","webpack://Autodesk.Extensions/./Markup/core/edit-modes/EditModeCloud.js","webpack://Autodesk.Extensions/./Markup/core/MarkupCloud.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/CreateCloud.js","webpack://Autodesk.Extensions/./Markup/core/MarkupPen.js","webpack://Autodesk.Extensions/./Markup/core/edit-modes/EditModePen.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/DeleteFreehand.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/SetFreehand.js","webpack://Autodesk.Extensions/./Markup/core/edit-modes/EditModeFreehand.js","webpack://Autodesk.Extensions/./Markup/core/MarkupFreehand.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/CreateFreehand.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/DeletePolyline.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/SetPolyline.js","webpack://Autodesk.Extensions/./Markup/core/edit-modes/EditModePolyline.js","webpack://Autodesk.Extensions/./Markup/core/MarkupPolyLine.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/CreatePolyline.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/DeletePolycloud.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/SetPolycloud.js","webpack://Autodesk.Extensions/./Markup/core/edit-modes/EditModePolycloud.js","webpack://Autodesk.Extensions/./Markup/core/MarkupPolycloud.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/CreatePolycloud.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/DeleteHighlight.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/SetHighlight.js","webpack://Autodesk.Extensions/./Markup/core/edit-modes/EditModeHighlight.js","webpack://Autodesk.Extensions/./Markup/core/MarkupHighlight.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/CreateHighlight.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/DeleteDimension.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/SetDimension.js","webpack://Autodesk.Extensions/./Markup/core/edit-modes/EditModeDimension.js","webpack://Autodesk.Extensions/./Markup/core/MarkupDimension.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/CreateDimension.js","webpack://Autodesk.Extensions/./Markup/core/MarkupsCoreUtils.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/EditActionGroup.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/EditActionManager.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/CloneMarkup.js","webpack://Autodesk.Extensions/./Markup/core/edit-clipboard/Clipboard.js","webpack://Autodesk.Extensions/./Markup/core/edit-input/InputHandler.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/SetPosition.js","webpack://Autodesk.Extensions/./Markup/core/edit-actions/SetRotation.js","webpack://Autodesk.Extensions/./Markup/core/EditFrame.js","webpack://Autodesk.Extensions/./Markup/core/MarkupTool.js","webpack://Autodesk.Extensions/./Markup/core/EditModeManager.js","webpack://Autodesk.Extensions/./Markup/core/edit-modes/BuiltinEditModes.js","webpack://Autodesk.Extensions/./Markup/core/Markups.css?ced7","webpack://Autodesk.Extensions/./Markup/core/MarkupsCore.js","webpack://Autodesk.Extensions/./Markup/gui/MarkupsGui.css?2da1","webpack://Autodesk.Extensions/./Markup/gui/MarkupsGui.js","webpack://Autodesk.Extensions/./Markup/Markup.js"],"sourcesContent":["// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \".adsk-viewing-viewer .autodesk-markups-extension-core-make-me-bigger:after {\\r\\n\\tcontent: \\\"\\\"; \\r\\n\\tposition: absolute; \\r\\n\\ttop: -15px; \\r\\n\\tbottom: -15px; \\r\\n\\tleft: -15px; \\r\\n\\tright: -15px;\\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .autodesk-markups-extension-core-make-me-bigger.rotation-bridge:after {\\r\\n\\ttop: 0; \\r\\n\\tbottom: 0px; \\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .selector-box {\\r\\n\\tposition: absolute;\\r\\n    border: 1px dashed #0696D7;\\r\\n    background: rgba(6, 150, 215, 0.05);\\r\\n    z-index: 1;\\r\\n    cursor: move;\\r\\n    box-sizing: border-box;\\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .selector-drag-point,\\r\\n.adsk-viewing-viewer .selector-rotate-point {\\r\\n\\tposition: absolute;\\r\\n\\theight: 8px;\\r\\n\\twidth: 8px;\\r\\n\\tborder-radius: 8px;\\t\\t\\t\\t\\t/*HANDLE_SIZE*/\\r\\n    background: #FFFFFF;\\t\\t\\t\\t/*HANDLE_BACKGROUND_COLOR*/\\r\\n    border-color: rgba(107,120,127,0.7); /* HANDLE_BORDER_COLOR; */\\r\\n    border-width: 1px; \\t\\t\\t\\t\\t/* BORDER_WIDTH */\\r\\n    border-style: solid;\\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .selector-rotate-point {\\r\\n\\ttop: calc(100% + 22px); /* 30 - 8 = 22 */\\r\\n\\tleft: calc(50% + 1px);\\r\\n\\ttransform: translate3d(-50%, 0px, 0px);\\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .selector-drag-point.selected,\\r\\n.adsk-viewing-viewer .selector-rotate-point.selected:not(.rotation-bridge) {\\r\\n\\tbackground: #0696D7;\\r\\n\\tborder-color: #0696D7;\\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .rotation-bridge {\\r\\n\\tposition: absolute;\\r\\n\\tbackground-color: rgba(0,0,0,0);\\r\\n\\theight: 30px;\\r\\n\\twidth: 0px;\\r\\n\\ttop: 100%;\\r\\n\\tleft: calc(50% + 1px);\\r\\n\\tborder: unset;\\r\\n    border-left: 1px dashed #0696D7;\\r\\n}\\r\\n/*var placementOffset = -6;*/\\r\\n.adsk-viewing-viewer .selector-drag-point.sdp-handle-n {\\r\\n\\ttop: -6px;\\r\\n\\tleft: calc(50% - 4px);\\r\\n\\tposition: relative;\\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .selector-drag-point.sdp-handle-s {\\r\\n\\ttop: calc(100% - 14px);\\r\\n    left: calc(50% - 4px);\\r\\n    position: relative;\\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .selector-drag-point.sdp-handle-w {\\r\\n\\tleft: -6px;\\r\\n\\ttop: 50%;\\r\\n\\ttransform: translate3d(0, -50%, 0);\\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .selector-drag-point.sdp-handle-e {\\r\\n\\tright: -6px;\\r\\n\\ttop: 50%;\\r\\n    transform: translate3d(0, -50%, 0);\\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .selector-drag-point.sdp-handle-nw {\\r\\n\\ttop: -6px;\\r\\n\\tleft: -6px;\\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .selector-drag-point.sdp-handle-ne {\\r\\n\\ttop: -6px;\\r\\n\\tright: -6px;\\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .selector-drag-point.sdp-handle-sw {\\r\\n\\tbottom: -6px;\\r\\n\\tleft: -6px;\\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .selector-drag-point.sdp-handle-se {\\r\\n\\tbottom: -6px;\\r\\n\\tright: -6px;\\r\\n}\", \"\",{\"version\":3,\"sources\":[\"webpack://./Markup/core/Markups.css\"],\"names\":[],\"mappings\":\"AAAA;CACC,WAAW;CACX,kBAAkB;CAClB,UAAU;CACV,aAAa;CACb,WAAW;CACX,YAAY;AACb;;AAEA;CACC,MAAM;CACN,WAAW;AACZ;;AAEA;CACC,kBAAkB;IACf,0BAA0B;IAC1B,mCAAmC;IACnC,UAAU;IACV,YAAY;IACZ,sBAAsB;AAC1B;;AAEA;;CAEC,kBAAkB;CAClB,WAAW;CACX,UAAU;CACV,kBAAkB,MAAM,cAAc;IACnC,mBAAmB,KAAK,0BAA0B;IAClD,mCAAmC,EAAE,yBAAyB;IAC9D,iBAAiB,OAAO,iBAAiB;IACzC,mBAAmB;AACvB;;AAEA;CACC,sBAAsB,EAAE,gBAAgB;CACxC,qBAAqB;CACrB,sCAAsC;AACvC;;AAEA;;CAEC,mBAAmB;CACnB,qBAAqB;AACtB;;AAEA;CACC,kBAAkB;CAClB,+BAA+B;CAC/B,YAAY;CACZ,UAAU;CACV,SAAS;CACT,qBAAqB;CACrB,aAAa;IACV,+BAA+B;AACnC;AACA,4BAA4B;AAC5B;CACC,SAAS;CACT,qBAAqB;CACrB,kBAAkB;AACnB;;AAEA;CACC,sBAAsB;IACnB,qBAAqB;IACrB,kBAAkB;AACtB;;AAEA;CACC,UAAU;CACV,QAAQ;CACR,kCAAkC;AACnC;;AAEA;CACC,WAAW;CACX,QAAQ;IACL,kCAAkC;AACtC;;AAEA;CACC,SAAS;CACT,UAAU;AACX;;AAEA;CACC,SAAS;CACT,WAAW;AACZ;;AAEA;CACC,YAAY;CACZ,UAAU;AACX;;AAEA;CACC,YAAY;CACZ,WAAW;AACZ\",\"sourcesContent\":[\".adsk-viewing-viewer .autodesk-markups-extension-core-make-me-bigger:after {\\r\\n\\tcontent: \\\"\\\"; \\r\\n\\tposition: absolute; \\r\\n\\ttop: -15px; \\r\\n\\tbottom: -15px; \\r\\n\\tleft: -15px; \\r\\n\\tright: -15px;\\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .autodesk-markups-extension-core-make-me-bigger.rotation-bridge:after {\\r\\n\\ttop: 0; \\r\\n\\tbottom: 0px; \\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .selector-box {\\r\\n\\tposition: absolute;\\r\\n    border: 1px dashed #0696D7;\\r\\n    background: rgba(6, 150, 215, 0.05);\\r\\n    z-index: 1;\\r\\n    cursor: move;\\r\\n    box-sizing: border-box;\\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .selector-drag-point,\\r\\n.adsk-viewing-viewer .selector-rotate-point {\\r\\n\\tposition: absolute;\\r\\n\\theight: 8px;\\r\\n\\twidth: 8px;\\r\\n\\tborder-radius: 8px;\\t\\t\\t\\t\\t/*HANDLE_SIZE*/\\r\\n    background: #FFFFFF;\\t\\t\\t\\t/*HANDLE_BACKGROUND_COLOR*/\\r\\n    border-color: rgba(107,120,127,0.7); /* HANDLE_BORDER_COLOR; */\\r\\n    border-width: 1px; \\t\\t\\t\\t\\t/* BORDER_WIDTH */\\r\\n    border-style: solid;\\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .selector-rotate-point {\\r\\n\\ttop: calc(100% + 22px); /* 30 - 8 = 22 */\\r\\n\\tleft: calc(50% + 1px);\\r\\n\\ttransform: translate3d(-50%, 0px, 0px);\\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .selector-drag-point.selected,\\r\\n.adsk-viewing-viewer .selector-rotate-point.selected:not(.rotation-bridge) {\\r\\n\\tbackground: #0696D7;\\r\\n\\tborder-color: #0696D7;\\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .rotation-bridge {\\r\\n\\tposition: absolute;\\r\\n\\tbackground-color: rgba(0,0,0,0);\\r\\n\\theight: 30px;\\r\\n\\twidth: 0px;\\r\\n\\ttop: 100%;\\r\\n\\tleft: calc(50% + 1px);\\r\\n\\tborder: unset;\\r\\n    border-left: 1px dashed #0696D7;\\r\\n}\\r\\n/*var placementOffset = -6;*/\\r\\n.adsk-viewing-viewer .selector-drag-point.sdp-handle-n {\\r\\n\\ttop: -6px;\\r\\n\\tleft: calc(50% - 4px);\\r\\n\\tposition: relative;\\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .selector-drag-point.sdp-handle-s {\\r\\n\\ttop: calc(100% - 14px);\\r\\n    left: calc(50% - 4px);\\r\\n    position: relative;\\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .selector-drag-point.sdp-handle-w {\\r\\n\\tleft: -6px;\\r\\n\\ttop: 50%;\\r\\n\\ttransform: translate3d(0, -50%, 0);\\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .selector-drag-point.sdp-handle-e {\\r\\n\\tright: -6px;\\r\\n\\ttop: 50%;\\r\\n    transform: translate3d(0, -50%, 0);\\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .selector-drag-point.sdp-handle-nw {\\r\\n\\ttop: -6px;\\r\\n\\tleft: -6px;\\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .selector-drag-point.sdp-handle-ne {\\r\\n\\ttop: -6px;\\r\\n\\tright: -6px;\\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .selector-drag-point.sdp-handle-sw {\\r\\n\\tbottom: -6px;\\r\\n\\tleft: -6px;\\r\\n}\\r\\n\\r\\n.adsk-viewing-viewer .selector-drag-point.sdp-handle-se {\\r\\n\\tbottom: -6px;\\r\\n\\tright: -6px;\\r\\n}\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \"\\r\\n.adsk-icon-markup:before {\\r\\n  content: \\\"a\\\";\\r\\n}\\r\\n\\r\\n.lmv-markup-gui-toolbar {\\r\\n  position: absolute;\\r\\n  top: 0;\\r\\n  margin: 5px 5px;\\r\\n  color: #000000;\\r\\n}\\r\\n\\r\\n.lmv-markup-gui-toolbar-content > * {\\r\\n  margin: 0 2px;\\r\\n}\\r\\n\\r\\n.lmv-markup-gui-style-options {\\r\\n  display: inline-block;\\r\\n}\", \"\",{\"version\":3,\"sources\":[\"webpack://./Markup/gui/MarkupsGui.css\"],\"names\":[],\"mappings\":\";AACA;EACE,YAAY;AACd;;AAEA;EACE,kBAAkB;EAClB,MAAM;EACN,eAAe;EACf,cAAc;AAChB;;AAEA;EACE,aAAa;AACf;;AAEA;EACE,qBAAqB;AACvB\",\"sourcesContent\":[\"\\r\\n.adsk-icon-markup:before {\\r\\n  content: \\\"a\\\";\\r\\n}\\r\\n\\r\\n.lmv-markup-gui-toolbar {\\r\\n  position: absolute;\\r\\n  top: 0;\\r\\n  margin: 5px 5px;\\r\\n  color: #000000;\\r\\n}\\r\\n\\r\\n.lmv-markup-gui-toolbar-content > * {\\r\\n  margin: 0 2px;\\r\\n}\\r\\n\\r\\n.lmv-markup-gui-style-options {\\r\\n  display: inline-block;\\r\\n}\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","\"use strict\";\n\n/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n*/\nmodule.exports = function (cssWithMappingToString) {\n  var list = []; // return the list of modules as css string\n\n  list.toString = function toString() {\n    return this.map(function (item) {\n      var content = \"\";\n      var needLayer = typeof item[5] !== \"undefined\";\n\n      if (item[4]) {\n        content += \"@supports (\".concat(item[4], \") {\");\n      }\n\n      if (item[2]) {\n        content += \"@media \".concat(item[2], \" {\");\n      }\n\n      if (needLayer) {\n        content += \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\");\n      }\n\n      content += cssWithMappingToString(item);\n\n      if (needLayer) {\n        content += \"}\";\n      }\n\n      if (item[2]) {\n        content += \"}\";\n      }\n\n      if (item[4]) {\n        content += \"}\";\n      }\n\n      return content;\n    }).join(\"\");\n  }; // import a list of modules into the list\n\n\n  list.i = function i(modules, media, dedupe, supports, layer) {\n    if (typeof modules === \"string\") {\n      modules = [[null, modules, undefined]];\n    }\n\n    var alreadyImportedModules = {};\n\n    if (dedupe) {\n      for (var k = 0; k < this.length; k++) {\n        var id = this[k][0];\n\n        if (id != null) {\n          alreadyImportedModules[id] = true;\n        }\n      }\n    }\n\n    for (var _k = 0; _k < modules.length; _k++) {\n      var item = [].concat(modules[_k]);\n\n      if (dedupe && alreadyImportedModules[item[0]]) {\n        continue;\n      }\n\n      if (typeof layer !== \"undefined\") {\n        if (typeof item[5] === \"undefined\") {\n          item[5] = layer;\n        } else {\n          item[1] = \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\").concat(item[1], \"}\");\n          item[5] = layer;\n        }\n      }\n\n      if (media) {\n        if (!item[2]) {\n          item[2] = media;\n        } else {\n          item[1] = \"@media \".concat(item[2], \" {\").concat(item[1], \"}\");\n          item[2] = media;\n        }\n      }\n\n      if (supports) {\n        if (!item[4]) {\n          item[4] = \"\".concat(supports);\n        } else {\n          item[1] = \"@supports (\".concat(item[4], \") {\").concat(item[1], \"}\");\n          item[4] = supports;\n        }\n      }\n\n      list.push(item);\n    }\n  };\n\n  return list;\n};","\"use strict\";\n\nmodule.exports = function (item) {\n  var content = item[1];\n  var cssMapping = item[3];\n\n  if (!cssMapping) {\n    return content;\n  }\n\n  if (typeof btoa === \"function\") {\n    var base64 = btoa(unescape(encodeURIComponent(JSON.stringify(cssMapping))));\n    var data = \"sourceMappingURL=data:application/json;charset=utf-8;base64,\".concat(base64);\n    var sourceMapping = \"/*# \".concat(data, \" */\");\n    var sourceURLs = cssMapping.sources.map(function (source) {\n      return \"/*# sourceURL=\".concat(cssMapping.sourceRoot || \"\").concat(source, \" */\");\n    });\n    return [content].concat(sourceURLs).concat([sourceMapping]).join(\"\\n\");\n  }\n\n  return [content].join(\"\\n\");\n};","\"use strict\";\n\nvar stylesInDOM = [];\n\nfunction getIndexByIdentifier(identifier) {\n  var result = -1;\n\n  for (var i = 0; i < stylesInDOM.length; i++) {\n    if (stylesInDOM[i].identifier === identifier) {\n      result = i;\n      break;\n    }\n  }\n\n  return result;\n}\n\nfunction modulesToDom(list, options) {\n  var idCountMap = {};\n  var identifiers = [];\n\n  for (var i = 0; i < list.length; i++) {\n    var item = list[i];\n    var id = options.base ? item[0] + options.base : item[0];\n    var count = idCountMap[id] || 0;\n    var identifier = \"\".concat(id, \" \").concat(count);\n    idCountMap[id] = count + 1;\n    var indexByIdentifier = getIndexByIdentifier(identifier);\n    var obj = {\n      css: item[1],\n      media: item[2],\n      sourceMap: item[3],\n      supports: item[4],\n      layer: item[5]\n    };\n\n    if (indexByIdentifier !== -1) {\n      stylesInDOM[indexByIdentifier].references++;\n      stylesInDOM[indexByIdentifier].updater(obj);\n    } else {\n      var updater = addElementStyle(obj, options);\n      options.byIndex = i;\n      stylesInDOM.splice(i, 0, {\n        identifier: identifier,\n        updater: updater,\n        references: 1\n      });\n    }\n\n    identifiers.push(identifier);\n  }\n\n  return identifiers;\n}\n\nfunction addElementStyle(obj, options) {\n  var api = options.domAPI(options);\n  api.update(obj);\n\n  var updater = function updater(newObj) {\n    if (newObj) {\n      if (newObj.css === obj.css && newObj.media === obj.media && newObj.sourceMap === obj.sourceMap && newObj.supports === obj.supports && newObj.layer === obj.layer) {\n        return;\n      }\n\n      api.update(obj = newObj);\n    } else {\n      api.remove();\n    }\n  };\n\n  return updater;\n}\n\nmodule.exports = function (list, options) {\n  options = options || {};\n  list = list || [];\n  var lastIdentifiers = modulesToDom(list, options);\n  return function update(newList) {\n    newList = newList || [];\n\n    for (var i = 0; i < lastIdentifiers.length; i++) {\n      var identifier = lastIdentifiers[i];\n      var index = getIndexByIdentifier(identifier);\n      stylesInDOM[index].references--;\n    }\n\n    var newLastIdentifiers = modulesToDom(newList, options);\n\n    for (var _i = 0; _i < lastIdentifiers.length; _i++) {\n      var _identifier = lastIdentifiers[_i];\n\n      var _index = getIndexByIdentifier(_identifier);\n\n      if (stylesInDOM[_index].references === 0) {\n        stylesInDOM[_index].updater();\n\n        stylesInDOM.splice(_index, 1);\n      }\n    }\n\n    lastIdentifiers = newLastIdentifiers;\n  };\n};","\"use strict\";\n\nvar memo = {};\n/* istanbul ignore next  */\n\nfunction getTarget(target) {\n  if (typeof memo[target] === \"undefined\") {\n    var styleTarget = document.querySelector(target); // Special case to return head of iframe instead of iframe itself\n\n    if (window.HTMLIFrameElement && styleTarget instanceof window.HTMLIFrameElement) {\n      try {\n        // This will throw an exception if access to iframe is blocked\n        // due to cross-origin restrictions\n        styleTarget = styleTarget.contentDocument.head;\n      } catch (e) {\n        // istanbul ignore next\n        styleTarget = null;\n      }\n    }\n\n    memo[target] = styleTarget;\n  }\n\n  return memo[target];\n}\n/* istanbul ignore next  */\n\n\nfunction insertBySelector(insert, style) {\n  var target = getTarget(insert);\n\n  if (!target) {\n    throw new Error(\"Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.\");\n  }\n\n  target.appendChild(style);\n}\n\nmodule.exports = insertBySelector;","\"use strict\";\n\n/* istanbul ignore next  */\nfunction insertStyleElement(options) {\n  var element = document.createElement(\"style\");\n  options.setAttributes(element, options.attributes);\n  options.insert(element, options.options);\n  return element;\n}\n\nmodule.exports = insertStyleElement;","\"use strict\";\n\n/* istanbul ignore next  */\nfunction setAttributesWithoutAttributes(styleElement) {\n  var nonce = typeof __webpack_nonce__ !== \"undefined\" ? __webpack_nonce__ : null;\n\n  if (nonce) {\n    styleElement.setAttribute(\"nonce\", nonce);\n  }\n}\n\nmodule.exports = setAttributesWithoutAttributes;","\"use strict\";\n\n/* istanbul ignore next  */\nfunction apply(styleElement, options, obj) {\n  var css = \"\";\n\n  if (obj.supports) {\n    css += \"@supports (\".concat(obj.supports, \") {\");\n  }\n\n  if (obj.media) {\n    css += \"@media \".concat(obj.media, \" {\");\n  }\n\n  var needLayer = typeof obj.layer !== \"undefined\";\n\n  if (needLayer) {\n    css += \"@layer\".concat(obj.layer.length > 0 ? \" \".concat(obj.layer) : \"\", \" {\");\n  }\n\n  css += obj.css;\n\n  if (needLayer) {\n    css += \"}\";\n  }\n\n  if (obj.media) {\n    css += \"}\";\n  }\n\n  if (obj.supports) {\n    css += \"}\";\n  }\n\n  var sourceMap = obj.sourceMap;\n\n  if (sourceMap && typeof btoa !== \"undefined\") {\n    css += \"\\n/*# sourceMappingURL=data:application/json;base64,\".concat(btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap)))), \" */\");\n  } // For old IE\n\n  /* istanbul ignore if  */\n\n\n  options.styleTagTransform(css, styleElement, options.options);\n}\n\nfunction removeStyleElement(styleElement) {\n  // istanbul ignore if\n  if (styleElement.parentNode === null) {\n    return false;\n  }\n\n  styleElement.parentNode.removeChild(styleElement);\n}\n/* istanbul ignore next  */\n\n\nfunction domAPI(options) {\n  var styleElement = options.insertStyleElement(options);\n  return {\n    update: function update(obj) {\n      apply(styleElement, options, obj);\n    },\n    remove: function remove() {\n      removeStyleElement(styleElement);\n    }\n  };\n}\n\nmodule.exports = domAPI;","\"use strict\";\n\n/* istanbul ignore next  */\nfunction styleTagTransform(css, styleElement) {\n  if (styleElement.styleSheet) {\n    styleElement.styleSheet.cssText = css;\n  } else {\n    while (styleElement.firstChild) {\n      styleElement.removeChild(styleElement.firstChild);\n    }\n\n    styleElement.appendChild(document.createTextNode(css));\n  }\n}\n\nmodule.exports = styleTagTransform;","/*\r\n * canvg.js - Javascript SVG parser and renderer on Canvas\r\n * version 2.0.0\r\n * MIT Licensed\r\n * Gabe Lerner (gabelerner@gmail.com)\r\n * https://github.com/canvg/canvg\r\n *\r\n */\r\n\r\n(function (global, factory) {\r\n    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory(require('./rgbcolor')) :\r\n        typeof define === 'function' && define.amd ? define(['./rgbcolor'], factory) :\r\n            (global.canvg = factory(global.RGBColor,global.StackBlur,global.Canvas));\r\n}(this, (function (rgbcolor,stackblurCanvas,canvas) { 'use strict';\r\n\r\n    rgbcolor = rgbcolor && rgbcolor.hasOwnProperty('default') ? rgbcolor['default'] : rgbcolor;\r\n    stackblurCanvas = stackblurCanvas && stackblurCanvas.hasOwnProperty('default') ? stackblurCanvas['default'] : stackblurCanvas;\r\n    canvas = canvas && canvas.hasOwnProperty('default') ? canvas['default'] : canvas;\r\n\r\n    function createCommonjsModule(fn, module) {\r\n        return module = { exports: {} }, fn(module, module.exports), module.exports;\r\n    }\r\n\r\n    var canvg_1 = createCommonjsModule(function (module) {\r\n        /* eslint-env browser, node */\r\n        /* globals $, Sizzle, Windows, ActiveXObject */\r\n        /* eslint-disable no-redeclare */\r\n\r\n\r\n        var isNode = (module.exports && typeof window === 'undefined'),\r\n            nodeEnv = false;\r\n        var windowEnv;\r\n\r\n        {\r\n            windowEnv = window;\r\n            windowEnv.DOMParser = window.DOMParser;\r\n        }\r\n\r\n        var doc = windowEnv.document,\r\n            defaultClientWidth = 800,\r\n            defaultClientHeight = 600;\r\n\r\n        function createCanvas(width, height) {\r\n            var c;\r\n            {\r\n                c = doc.createElement('canvas');\r\n                c.width = width;\r\n                c.height = height;\r\n            }\r\n            return c;\r\n        }\r\n\r\n        // canvg(target, s)\r\n        // empty parameters: replace all 'svg' elements on page with 'canvas' elements\r\n        // target: canvas element or the id of a canvas element\r\n        // s: svg string, url to svg file, or xml document\r\n        // opts: optional hash of options\r\n        //       ignoreMouse: true => ignore mouse events\r\n        //       ignoreAnimation: true => ignore animations\r\n        //       ignoreDimensions: true => does not try to resize canvas\r\n        //       ignoreClear: true => does not clear canvas\r\n        //       offsetX: int => draws at a x offset\r\n        //       offsetY: int => draws at a y offset\r\n        //       scaleWidth: int => scales horizontally to width\r\n        //       scaleHeight: int => scales vertically to height\r\n        //       renderCallback: function => will call the function after the first render is completed\r\n        //       enableRedraw: function => whether enable the redraw interval in node environment\r\n        //       forceRedraw: function => will call the function on every frame, if it returns true, will redraw\r\n        var canvg = function (target, s, opts) {\r\n            // no parameters\r\n            if (target == null && s == null && opts == null) {\r\n                var svgTags = doc.querySelectorAll('svg');\r\n                for (var i = 0; i < svgTags.length; i++) {\r\n                    var svgTag = svgTags[i];\r\n                    var c = doc.createElement('canvas');\r\n                    if (typeof(svgTag.clientWidth) !== 'undefined' && typeof(svgTag.clientHeight) !== 'undefined') {\r\n                        c.width = svgTag.clientWidth;\r\n                        c.height = svgTag.clientHeight;\r\n                    } else {\r\n                        var rect = svgTag.getBoundingClientRect();\r\n                        c.width = rect.width;\r\n                        c.height = rect.height;\r\n                    }\r\n                    svgTag.parentNode.insertBefore(c, svgTag);\r\n                    svgTag.parentNode.removeChild(svgTag);\r\n                    var div = doc.createElement('div');\r\n                    div.appendChild(svgTag);\r\n                    canvg(c, div.innerHTML);\r\n                }\r\n                return;\r\n            }\r\n\r\n            var svg = build(opts || {});\r\n\r\n            if (typeof target == 'string') {\r\n                target = doc.getElementById(target);\r\n            }\r\n\r\n            // store class on canvas\r\n            if (target.svg != null) target.svg.stop();\r\n\r\n            // on i.e. 8 for flash canvas, we can't assign the property so check for it\r\n            if (!(target.childNodes && target.childNodes.length == 1 && target.childNodes[0].nodeName == 'OBJECT')) target.svg = svg;\r\n\r\n            var ctx = target.getContext('2d');\r\n\r\n            if (typeof s.documentElement != 'undefined') {\r\n                // load from xml doc\r\n                svg.loadXmlDoc(ctx, s);\r\n            } else if (s.substr(0, 1) == '<') {\r\n                // load from xml string\r\n                svg.loadXml(ctx, s);\r\n            } else {\r\n                // load from url\r\n                svg.load(ctx, s);\r\n            }\r\n        };\r\n\r\n        var matchesSelector;\r\n        {\r\n            // see https://developer.mozilla.org/en-US/docs/Web/API/Element.matches\r\n            if (typeof Element == 'undefined') ; else if (typeof Element.prototype.matches != 'undefined') {\r\n                matchesSelector = function (node, selector) {\r\n                    return node.matches(selector);\r\n                };\r\n            } else if (typeof Element.prototype.webkitMatchesSelector != 'undefined') {\r\n                matchesSelector = function (node, selector) {\r\n                    return node.webkitMatchesSelector(selector);\r\n                };\r\n            } else if (typeof Element.prototype.mozMatchesSelector != 'undefined') {\r\n                matchesSelector = function (node, selector) {\r\n                    return node.mozMatchesSelector(selector);\r\n                };\r\n            } else if (typeof Element.prototype.msMatchesSelector != 'undefined') {\r\n                matchesSelector = function (node, selector) {\r\n                    return node.msMatchesSelector(selector);\r\n                };\r\n            } else if (typeof Element.prototype.oMatchesSelector != 'undefined') {\r\n                matchesSelector = function (node, selector) {\r\n                    return node.oMatchesSelector(selector);\r\n                };\r\n            } else {\r\n                // requires Sizzle: https://github.com/jquery/sizzle/wiki/Sizzle-Documentation\r\n                // or jQuery: http://jquery.com/download/\r\n                // or Zepto: http://zeptojs.com/#\r\n                // without it, this is a ReferenceError\r\n\r\n                if (typeof jQuery === 'function' || typeof Zepto === 'function') {\r\n                    matchesSelector = function (node, selector) {\r\n                        return $(node).is(selector);\r\n                    };\r\n                }\r\n\r\n                if (typeof matchesSelector === 'undefined' && typeof Sizzle !== 'undefined') {\r\n                    matchesSelector = Sizzle.matchesSelector;\r\n                }\r\n            }\r\n        }\r\n\r\n        // slightly modified version of https://github.com/keeganstreet/specificity/blob/master/specificity.js\r\n        var attributeRegex = /(\\[[^\\]]+\\])/g;\r\n        var idRegex = /(#[^\\s\\+>~\\.\\[:]+)/g;\r\n        var classRegex = /(\\.[^\\s\\+>~\\.\\[:]+)/g;\r\n        var pseudoElementRegex = /(::[^\\s\\+>~\\.\\[:]+|:first-line|:first-letter|:before|:after)/gi;\r\n        var pseudoClassWithBracketsRegex = /(:[\\w-]+\\([^\\)]*\\))/gi;\r\n        var pseudoClassRegex = /(:[^\\s\\+>~\\.\\[:]+)/g;\r\n        var elementRegex = /([^\\s\\+>~\\.\\[:]+)/g;\r\n\r\n        function getSelectorSpecificity(selector) {\r\n            var typeCount = [0, 0, 0];\r\n            var findMatch = function (regex, type) {\r\n                var matches = selector.match(regex);\r\n                if (matches == null) {\r\n                    return;\r\n                }\r\n                typeCount[type] += matches.length;\r\n                selector = selector.replace(regex, ' ');\r\n            };\r\n\r\n            selector = selector.replace(/:not\\(([^\\)]*)\\)/g, '     $1 ');\r\n            selector = selector.replace(/{[\\s\\S]*/gm, ' ');\r\n            findMatch(attributeRegex, 1);\r\n            findMatch(idRegex, 0);\r\n            findMatch(classRegex, 1);\r\n            findMatch(pseudoElementRegex, 2);\r\n            findMatch(pseudoClassWithBracketsRegex, 1);\r\n            findMatch(pseudoClassRegex, 1);\r\n            selector = selector.replace(/[\\*\\s\\+>~]/g, ' ');\r\n            selector = selector.replace(/[#\\.]/g, ' ');\r\n            findMatch(elementRegex, 2);\r\n            return typeCount.join('');\r\n        }\r\n\r\n        function build(opts) {\r\n            var svg = { opts: opts };\r\n\r\n            svg.FRAMERATE = 30;\r\n            svg.MAX_VIRTUAL_PIXELS = 30000;\r\n\r\n            svg.rootEmSize = 12;\r\n            svg.emSize = 12;\r\n\r\n            svg.log = function (/* msg */) { };\r\n            if (svg.opts['log'] == true && typeof console != 'undefined') {\r\n                svg.log = function (msg) { console.log(msg); }; // eslint-disable-line no-console\r\n            }\r\n\r\n            // globals\r\n            svg.init = function (ctx) {\r\n                var uniqueId = 0;\r\n                svg.UniqueId = function () { uniqueId++; return 'canvg' + uniqueId; };\r\n                svg.Definitions = {};\r\n                svg.Styles = {};\r\n                svg.StylesSpecificity = {};\r\n                svg.Animations = [];\r\n                svg.Images = [];\r\n                svg.ctx = ctx;\r\n                svg.ViewPort = new (function () {\r\n\r\n                    this.viewPorts = [];\r\n                    this.Clear = function () { this.viewPorts = []; };\r\n                    this.SetCurrent = function (width, height) { this.viewPorts.push({ width: width, height: height }); };\r\n                    this.RemoveCurrent = function () { this.viewPorts.pop(); };\r\n                    this.Current = function () { return this.viewPorts[this.viewPorts.length - 1]; };\r\n                    this.width = function () { return this.Current().width; };\r\n                    this.height = function () { return this.Current().height; };\r\n                    this.ComputeSize = function (d) {\r\n                        if (d != null && typeof d == 'number') return d;\r\n                        if (d == 'x') return this.width();\r\n                        if (d == 'y') return this.height();\r\n                        return Math.sqrt(Math.pow(this.width(), 2) + Math.pow(this.height(), 2)) / Math.sqrt(2);\r\n                    };\r\n                });\r\n            };\r\n            svg.init();\r\n\r\n            // images loaded\r\n            svg.ImagesLoaded = function () {\r\n                for (var i = 0; i < svg.Images.length; i++) {\r\n                    if (!svg.Images[i].loaded) return false;\r\n                }\r\n                return true;\r\n            };\r\n\r\n            // trim\r\n            svg.trim = function (s) { return s.replace(/^\\s+|\\s+$/g, ''); };\r\n\r\n            // compress non-ideographic spaces\r\n            svg.compressSpaces = function (s) { return s.replace(/(?!\\u3000)\\s+/gm, ' '); };\r\n\r\n            // ajax\r\n            svg.ajax = function (url) {\r\n                var AJAX;\r\n                if (windowEnv.XMLHttpRequest) { AJAX = new windowEnv.XMLHttpRequest(); } else { AJAX = new ActiveXObject('Microsoft.XMLHTTP'); }\r\n                if (AJAX) {\r\n                    AJAX.open('GET', url, false);\r\n                    AJAX.send(null);\r\n                    return AJAX.responseText;\r\n                }\r\n                return null;\r\n            };\r\n\r\n            // parse xml\r\n            svg.parseXml = function (xml) {\r\n                if (typeof Windows != 'undefined' && typeof Windows.Data != 'undefined' && typeof Windows.Data.Xml != 'undefined') {\r\n                    var xmlDoc = new Windows.Data.Xml.Dom.XmlDocument();\r\n                    var settings = new Windows.Data.Xml.Dom.XmlLoadSettings();\r\n                    settings.prohibitDtd = false;\r\n                    xmlDoc.loadXml(xml, settings);\r\n                    return xmlDoc;\r\n                } else if (windowEnv.DOMParser) {\r\n                    try {\r\n                        var parser = opts.xmldom ? new windowEnv.DOMParser(opts.xmldom) : new windowEnv.DOMParser();\r\n                        return parser.parseFromString(xml, 'image/svg+xml');\r\n                    } catch (e) {\r\n                        parser = opts.xmldom ? new windowEnv.DOMParser(opts.xmldom) : new windowEnv.DOMParser();\r\n                        return parser.parseFromString(xml, 'text/xml');\r\n                    }\r\n                } else {\r\n                    xml = xml.replace(/<!DOCTYPE svg[^>]*>/, '');\r\n                    var xmlDoc = new ActiveXObject('Microsoft.XMLDOM');\r\n                    xmlDoc.async = 'false';\r\n                    xmlDoc.loadXML(xml);\r\n                    return xmlDoc;\r\n                }\r\n            };\r\n\r\n            svg.Property = function (name, value) {\r\n                this.name = name;\r\n                this.value = value;\r\n            };\r\n            svg.Property.prototype.getValue = function () {\r\n                return this.value;\r\n            };\r\n\r\n            svg.Property.prototype.hasValue = function () {\r\n                return (this.value != null && this.value !== '');\r\n            };\r\n\r\n            // return the numerical value of the property\r\n            svg.Property.prototype.numValue = function () {\r\n                if (!this.hasValue()) return 0;\r\n\r\n                var n = parseFloat(this.value);\r\n                if ((this.value + '').match(/%$/)) {\r\n                    n = n / 100.0;\r\n                }\r\n                return n;\r\n            };\r\n\r\n            svg.Property.prototype.valueOrDefault = function (def) {\r\n                if (this.hasValue()) return this.value;\r\n                return def;\r\n            };\r\n\r\n            svg.Property.prototype.numValueOrDefault = function (def) {\r\n                if (this.hasValue()) return this.numValue();\r\n                return def;\r\n            };\r\n\r\n            // color extensions\r\n            // augment the current color value with the opacity\r\n            svg.Property.prototype.addOpacity = function (opacityProp) {\r\n                var newValue = this.value;\r\n                if (opacityProp.value != null && opacityProp.value != '' && typeof this.value == 'string') { // can only add opacity to colors, not patterns\r\n                    var color = new rgbcolor(this.value);\r\n                    if (color.ok) {\r\n                        newValue = 'rgba(' + color.r + ', ' + color.g + ', ' + color.b + ', ' + opacityProp.numValue() + ')';\r\n                    }\r\n                }\r\n                return new svg.Property(this.name, newValue);\r\n            };\r\n\r\n            // definition extensions\r\n            // get the definition from the definitions table\r\n            svg.Property.prototype.getDefinition = function () {\r\n                var name = this.value.match(/#([^\\)'\"]+)/);\r\n                if (name) { name = name[1]; }\r\n                if (!name) { name = this.value; }\r\n                return svg.Definitions[name];\r\n            };\r\n\r\n            svg.Property.prototype.isUrlDefinition = function () {\r\n                return this.value.indexOf('url(') == 0\r\n            };\r\n\r\n            svg.Property.prototype.getFillStyleDefinition = function (e, opacityProp) {\r\n                var def = this.getDefinition();\r\n\r\n                // gradient\r\n                if (def != null && def.createGradient) {\r\n                    return def.createGradient(svg.ctx, e, opacityProp);\r\n                }\r\n\r\n                // pattern\r\n                if (def != null && def.createPattern) {\r\n                    if (def.getHrefAttribute().hasValue()) {\r\n                        var pt = def.attribute('patternTransform');\r\n                        def = def.getHrefAttribute().getDefinition();\r\n                        if (pt.hasValue()) { def.attribute('patternTransform', true).value = pt.value; }\r\n                    }\r\n                    return def.createPattern(svg.ctx, e);\r\n                }\r\n\r\n                return null;\r\n            };\r\n\r\n            // length extensions\r\n            svg.Property.prototype.getDPI = function (/* viewPort */) {\r\n                return 96.0; // TODO: compute?\r\n            };\r\n\r\n            svg.Property.prototype.getREM = function (/* viewPort */) {\r\n                return svg.rootEmSize;\r\n            };\r\n\r\n            svg.Property.prototype.getEM = function (/* viewPort */) {\r\n                return svg.emSize;\r\n            };\r\n\r\n            svg.Property.prototype.getUnits = function () {\r\n                var s = this.value + '';\r\n                return s.replace(/[0-9\\.\\-]/g, '');\r\n            };\r\n\r\n            svg.Property.prototype.isPixels = function () {\r\n                if (!this.hasValue()) return false;\r\n                var s = this.value + '';\r\n                if (s.match(/px$/)) return true;\r\n                if (s.match(/^[0-9]+$/)) return true;\r\n                return false;\r\n            };\r\n\r\n            // get the length as pixels\r\n            svg.Property.prototype.toPixels = function (viewPort, processPercent) {\r\n                if (!this.hasValue()) return 0;\r\n                var s = this.value + '';\r\n                if (s.match(/rem$/)) return this.numValue() * this.getREM(viewPort);\r\n                if (s.match(/em$/)) return this.numValue() * this.getEM(viewPort);\r\n                if (s.match(/ex$/)) return this.numValue() * this.getEM(viewPort) / 2.0;\r\n                if (s.match(/px$/)) return this.numValue();\r\n                if (s.match(/pt$/)) return this.numValue() * this.getDPI(viewPort) * (1.0 / 72.0);\r\n                if (s.match(/pc$/)) return this.numValue() * 15;\r\n                if (s.match(/cm$/)) return this.numValue() * this.getDPI(viewPort) / 2.54;\r\n                if (s.match(/mm$/)) return this.numValue() * this.getDPI(viewPort) / 25.4;\r\n                if (s.match(/in$/)) return this.numValue() * this.getDPI(viewPort);\r\n                if (s.match(/%$/)) return this.numValue() * svg.ViewPort.ComputeSize(viewPort);\r\n                var n = this.numValue();\r\n                if (processPercent && n < 1.0) return n * svg.ViewPort.ComputeSize(viewPort);\r\n                return n;\r\n            };\r\n\r\n            // time extensions\r\n            // get the time as milliseconds\r\n            svg.Property.prototype.toMilliseconds = function () {\r\n                if (!this.hasValue()) return 0;\r\n                var s = this.value + '';\r\n                if (s.match(/s$/)) return this.numValue() * 1000;\r\n                if (s.match(/ms$/)) return this.numValue();\r\n                return this.numValue();\r\n            };\r\n\r\n            // angle extensions\r\n            // get the angle as radians\r\n            svg.Property.prototype.toRadians = function () {\r\n                if (!this.hasValue()) return 0;\r\n                var s = this.value + '';\r\n                if (s.match(/deg$/)) return this.numValue() * (Math.PI / 180.0);\r\n                if (s.match(/grad$/)) return this.numValue() * (Math.PI / 200.0);\r\n                if (s.match(/rad$/)) return this.numValue();\r\n                return this.numValue() * (Math.PI / 180.0);\r\n            };\r\n\r\n            // text extensions\r\n            // get the text baseline\r\n            var textBaselineMapping = {\r\n                'baseline': 'alphabetic',\r\n                'before-edge': 'top',\r\n                'text-before-edge': 'top',\r\n                'middle': 'middle',\r\n                'central': 'middle',\r\n                'after-edge': 'bottom',\r\n                'text-after-edge': 'bottom',\r\n                'ideographic': 'ideographic',\r\n                'alphabetic': 'alphabetic',\r\n                'hanging': 'hanging',\r\n                'mathematical': 'alphabetic'\r\n            };\r\n            svg.Property.prototype.toTextBaseline = function () {\r\n                if (!this.hasValue()) return null;\r\n                return textBaselineMapping[this.value];\r\n            };\r\n\r\n            // fonts\r\n            svg.Font = new (function () {\r\n                this.Styles = 'normal|italic|oblique|inherit';\r\n                this.Variants = 'normal|small-caps|inherit';\r\n                this.Weights = 'normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit';\r\n\r\n                this.CreateFont = function (fontStyle, fontVariant, fontWeight, fontSize, fontFamily, inherit) {\r\n                    var f = inherit != null ? this.Parse(inherit) : this.CreateFont('', '', '', '', '', svg.ctx.font);\r\n                    fontFamily = fontFamily || f.fontFamily;\r\n                    return {\r\n                        fontFamily: fontFamily,\r\n                        fontSize: fontSize || f.fontSize,\r\n                        fontStyle: fontStyle || f.fontStyle,\r\n                        fontWeight: fontWeight || f.fontWeight,\r\n                        fontVariant: fontVariant || f.fontVariant,\r\n                        toString: function () { return [this.fontStyle, this.fontVariant, this.fontWeight, this.fontSize, this.fontFamily].join(' ') }\r\n                    }\r\n                };\r\n\r\n                var that = this;\r\n                this.Parse = function (s) {\r\n                    var f = {};\r\n                    var d = svg.trim(svg.compressSpaces(s || '')).split(' ');\r\n                    var set = { fontSize: false, fontStyle: false, fontWeight: false, fontVariant: false };\r\n                    var ff = '';\r\n                    for (var i = 0; i < d.length; i++) {\r\n                        if (!set.fontStyle && that.Styles.indexOf(d[i]) != -1) {\r\n                            if (d[i] != 'inherit') f.fontStyle = d[i];\r\n                            set.fontStyle = true;\r\n                        } else if (!set.fontVariant && that.Variants.indexOf(d[i]) != -1) {\r\n                            if (d[i] != 'inherit') f.fontVariant = d[i];\r\n                            set.fontStyle = set.fontVariant = true;\r\n                        } else if (!set.fontWeight && that.Weights.indexOf(d[i]) != -1) {\r\n                            if (d[i] != 'inherit') f.fontWeight = d[i];\r\n                            set.fontStyle = set.fontVariant = set.fontWeight = true;\r\n                        } else if (!set.fontSize) {\r\n                            if (d[i] != 'inherit') f.fontSize = d[i].split('/')[0];\r\n                            set.fontStyle = set.fontVariant = set.fontWeight = set.fontSize = true;\r\n                        } else { if (d[i] != 'inherit') ff += d[i]; }\r\n                    }\r\n                    if (ff != '') f.fontFamily = ff;\r\n                    return f;\r\n                };\r\n            });\r\n\r\n            // points and paths\r\n            svg.ToNumberArray = function (s) {\r\n                var a = svg.trim(svg.compressSpaces((s || '').replace(/,/g, ' '))).split(' ');\r\n                for (var i = 0; i < a.length; i++) {\r\n                    a[i] = parseFloat(a[i]);\r\n                }\r\n                return a;\r\n            };\r\n            svg.Point = function (x, y) {\r\n                this.x = x;\r\n                this.y = y;\r\n            };\r\n            svg.Point.prototype.angleTo = function (p) {\r\n                return Math.atan2(p.y - this.y, p.x - this.x);\r\n            };\r\n\r\n            svg.Point.prototype.applyTransform = function (v) {\r\n                var xp = this.x * v[0] + this.y * v[2] + v[4];\r\n                var yp = this.x * v[1] + this.y * v[3] + v[5];\r\n                this.x = xp;\r\n                this.y = yp;\r\n            };\r\n\r\n            svg.CreatePoint = function (s) {\r\n                var a = svg.ToNumberArray(s);\r\n                return new svg.Point(a[0], a[1]);\r\n            };\r\n            svg.CreatePath = function (s) {\r\n                var a = svg.ToNumberArray(s);\r\n                var path = [];\r\n                for (var i = 0; i < a.length; i += 2) {\r\n                    path.push(new svg.Point(a[i], a[i + 1]));\r\n                }\r\n                return path;\r\n            };\r\n\r\n            // bounding box\r\n            svg.BoundingBox = function (x1, y1, x2, y2) { // pass in initial points if you want\r\n                this.x1 = Number.NaN;\r\n                this.y1 = Number.NaN;\r\n                this.x2 = Number.NaN;\r\n                this.y2 = Number.NaN;\r\n\r\n                this.x = function () { return this.x1; };\r\n                this.y = function () { return this.y1; };\r\n                this.width = function () { return this.x2 - this.x1; };\r\n                this.height = function () { return this.y2 - this.y1; };\r\n\r\n                this.addPoint = function (x, y) {\r\n                    if (x != null) {\r\n                        if (isNaN(this.x1) || isNaN(this.x2)) {\r\n                            this.x1 = x;\r\n                            this.x2 = x;\r\n                        }\r\n                        if (x < this.x1) this.x1 = x;\r\n                        if (x > this.x2) this.x2 = x;\r\n                    }\r\n\r\n                    if (y != null) {\r\n                        if (isNaN(this.y1) || isNaN(this.y2)) {\r\n                            this.y1 = y;\r\n                            this.y2 = y;\r\n                        }\r\n                        if (y < this.y1) this.y1 = y;\r\n                        if (y > this.y2) this.y2 = y;\r\n                    }\r\n                };\r\n                this.addX = function (x) { this.addPoint(x, null); };\r\n                this.addY = function (y) { this.addPoint(null, y); };\r\n\r\n                this.addBoundingBox = function (bb) {\r\n                    this.addPoint(bb.x1, bb.y1);\r\n                    this.addPoint(bb.x2, bb.y2);\r\n                };\r\n\r\n                this.addQuadraticCurve = function (p0x, p0y, p1x, p1y, p2x, p2y) {\r\n                    var cp1x = p0x + 2 / 3 * (p1x - p0x); // CP1 = QP0 + 2/3 *(QP1-QP0)\r\n                    var cp1y = p0y + 2 / 3 * (p1y - p0y); // CP1 = QP0 + 2/3 *(QP1-QP0)\r\n                    var cp2x = cp1x + 1 / 3 * (p2x - p0x); // CP2 = CP1 + 1/3 *(QP2-QP0)\r\n                    var cp2y = cp1y + 1 / 3 * (p2y - p0y); // CP2 = CP1 + 1/3 *(QP2-QP0)\r\n                    this.addBezierCurve(p0x, p0y, cp1x, cp2x, cp1y, cp2y, p2x, p2y);\r\n                };\r\n\r\n                this.addBezierCurve = function (p0x, p0y, p1x, p1y, p2x, p2y, p3x, p3y) {\r\n                    // from http://blog.hackers-cafe.net/2009/06/how-to-calculate-bezier-curves-bounding.html\r\n                    var p0 = [p0x, p0y],\r\n                        p1 = [p1x, p1y],\r\n                        p2 = [p2x, p2y],\r\n                        p3 = [p3x, p3y];\r\n                    this.addPoint(p0[0], p0[1]);\r\n                    this.addPoint(p3[0], p3[1]);\r\n\r\n                    for (var i = 0; i <= 1; i++) {\r\n                        var f = function (t) {\r\n                            return Math.pow(1 - t, 3) * p0[i] +\r\n                                3 * Math.pow(1 - t, 2) * t * p1[i] +\r\n                                3 * (1 - t) * Math.pow(t, 2) * p2[i] +\r\n                                Math.pow(t, 3) * p3[i];\r\n                        };\r\n\r\n                        var b = 6 * p0[i] - 12 * p1[i] + 6 * p2[i];\r\n                        var a = -3 * p0[i] + 9 * p1[i] - 9 * p2[i] + 3 * p3[i];\r\n                        var c = 3 * p1[i] - 3 * p0[i];\r\n\r\n                        if (a == 0) {\r\n                            if (b == 0) continue;\r\n                            var t = -c / b;\r\n                            if (0 < t && t < 1) {\r\n                                if (i == 0) this.addX(f(t));\r\n                                if (i == 1) this.addY(f(t));\r\n                            }\r\n                            continue;\r\n                        }\r\n\r\n                        var b2ac = Math.pow(b, 2) - 4 * c * a;\r\n                        if (b2ac < 0) continue;\r\n                        var t1 = (-b + Math.sqrt(b2ac)) / (2 * a);\r\n                        if (0 < t1 && t1 < 1) {\r\n                            if (i == 0) this.addX(f(t1));\r\n                            if (i == 1) this.addY(f(t1));\r\n                        }\r\n                        var t2 = (-b - Math.sqrt(b2ac)) / (2 * a);\r\n                        if (0 < t2 && t2 < 1) {\r\n                            if (i == 0) this.addX(f(t2));\r\n                            if (i == 1) this.addY(f(t2));\r\n                        }\r\n                    }\r\n                };\r\n\r\n                this.isPointInBox = function (x, y) {\r\n                    return (this.x1 <= x && x <= this.x2 && this.y1 <= y && y <= this.y2);\r\n                };\r\n\r\n                this.addPoint(x1, y1);\r\n                this.addPoint(x2, y2);\r\n            };\r\n\r\n            // transforms\r\n            svg.Transform = function (v) {\r\n                var that = this;\r\n                this.Type = {};\r\n\r\n                // translate\r\n                this.Type.translate = function (s) {\r\n                    this.p = svg.CreatePoint(s);\r\n                    this.apply = function (ctx) {\r\n                        ctx.translate(this.p.x || 0.0, this.p.y || 0.0);\r\n                    };\r\n                    this.unapply = function (ctx) {\r\n                        ctx.translate(-1.0 * this.p.x || 0.0, -1.0 * this.p.y || 0.0);\r\n                    };\r\n                    this.applyToPoint = function (p) {\r\n                        p.applyTransform([1, 0, 0, 1, this.p.x || 0.0, this.p.y || 0.0]);\r\n                    };\r\n                };\r\n\r\n                // rotate\r\n                this.Type.rotate = function (s) {\r\n                    var a = svg.ToNumberArray(s);\r\n                    this.angle = new svg.Property('angle', a[0]);\r\n                    this.cx = a[1] || 0;\r\n                    this.cy = a[2] || 0;\r\n                    this.apply = function (ctx) {\r\n                        ctx.translate(this.cx, this.cy);\r\n                        ctx.rotate(this.angle.toRadians());\r\n                        ctx.translate(-this.cx, -this.cy);\r\n                    };\r\n                    this.unapply = function (ctx) {\r\n                        ctx.translate(this.cx, this.cy);\r\n                        ctx.rotate(-1.0 * this.angle.toRadians());\r\n                        ctx.translate(-this.cx, -this.cy);\r\n                    };\r\n                    this.applyToPoint = function (p) {\r\n                        var a = this.angle.toRadians();\r\n                        p.applyTransform([1, 0, 0, 1, this.p.x || 0.0, this.p.y || 0.0]);\r\n                        p.applyTransform([Math.cos(a), Math.sin(a), -Math.sin(a), Math.cos(a), 0, 0]);\r\n                        p.applyTransform([1, 0, 0, 1, -this.p.x || 0.0, -this.p.y || 0.0]);\r\n                    };\r\n                };\r\n\r\n                this.Type.scale = function (s) {\r\n                    this.p = svg.CreatePoint(s);\r\n                    this.apply = function (ctx) {\r\n                        ctx.scale(this.p.x || 1.0, this.p.y || this.p.x || 1.0);\r\n                    };\r\n                    this.unapply = function (ctx) {\r\n                        ctx.scale(1.0 / this.p.x || 1.0, 1.0 / this.p.y || this.p.x || 1.0);\r\n                    };\r\n                    this.applyToPoint = function (p) {\r\n                        p.applyTransform([this.p.x || 0.0, 0, 0, this.p.y || 0.0, 0, 0]);\r\n                    };\r\n                };\r\n\r\n                this.Type.matrix = function (s) {\r\n                    this.m = svg.ToNumberArray(s);\r\n                    this.apply = function (ctx) {\r\n                        ctx.transform(this.m[0], this.m[1], this.m[2], this.m[3], this.m[4], this.m[5]);\r\n                    };\r\n                    this.unapply = function (ctx) {\r\n                        var a = this.m[0];\r\n                        var b = this.m[2];\r\n                        var c = this.m[4];\r\n                        var d = this.m[1];\r\n                        var e = this.m[3];\r\n                        var f = this.m[5];\r\n                        var g = 0.0;\r\n                        var h = 0.0;\r\n                        var i = 1.0;\r\n                        var det = 1 / (a * (e * i - f * h) - b * (d * i - f * g) + c * (d * h - e * g));\r\n                        ctx.transform(\r\n                            det * (e * i - f * h),\r\n                            det * (f * g - d * i),\r\n                            det * (c * h - b * i),\r\n                            det * (a * i - c * g),\r\n                            det * (b * f - c * e),\r\n                            det * (c * d - a * f)\r\n                        );\r\n                    };\r\n                    this.applyToPoint = function (p) {\r\n                        p.applyTransform(this.m);\r\n                    };\r\n                };\r\n\r\n                this.Type.SkewBase = function (s) {\r\n                    this.base = that.Type.matrix;\r\n                    this.base(s);\r\n                    this.angle = new svg.Property('angle', s);\r\n                };\r\n                this.Type.SkewBase.prototype = new this.Type.matrix;\r\n\r\n                this.Type.skewX = function (s) {\r\n                    this.base = that.Type.SkewBase;\r\n                    this.base(s);\r\n                    this.m = [1, 0, Math.tan(this.angle.toRadians()), 1, 0, 0];\r\n                };\r\n                this.Type.skewX.prototype = new this.Type.SkewBase;\r\n\r\n                this.Type.skewY = function (s) {\r\n                    this.base = that.Type.SkewBase;\r\n                    this.base(s);\r\n                    this.m = [1, Math.tan(this.angle.toRadians()), 0, 1, 0, 0];\r\n                };\r\n                this.Type.skewY.prototype = new this.Type.SkewBase;\r\n\r\n                this.transforms = [];\r\n\r\n                this.apply = function (ctx) {\r\n                    for (var i = 0; i < this.transforms.length; i++) {\r\n                        this.transforms[i].apply(ctx);\r\n                    }\r\n                };\r\n\r\n                this.unapply = function (ctx) {\r\n                    for (var i = this.transforms.length - 1; i >= 0; i--) {\r\n                        this.transforms[i].unapply(ctx);\r\n                    }\r\n                };\r\n\r\n                this.applyToPoint = function (p) {\r\n                    for (var i = 0; i < this.transforms.length; i++) {\r\n                        this.transforms[i].applyToPoint(p);\r\n                    }\r\n                };\r\n\r\n                var data = svg.trim(svg.compressSpaces(v)).replace(/\\)([a-zA-Z])/g, ') $1').replace(/\\)(\\s?,\\s?)/g, ') ').split(/\\s(?=[a-z])/);\r\n                for (var i = 0; i < data.length; i++) {\r\n                    if (data[i] === 'none') {\r\n                        continue;\r\n                    }\r\n\r\n                    var type = svg.trim(data[i].split('(')[0]);\r\n                    var s = data[i].split('(')[1].replace(')', '');\r\n                    var transformType = this.Type[type];\r\n                    if (typeof transformType != 'undefined') {\r\n                        var transform = new transformType(s);\r\n                        transform.type = type;\r\n                        this.transforms.push(transform);\r\n                    }\r\n                }\r\n            };\r\n\r\n            // aspect ratio\r\n            svg.AspectRatio = function (ctx, aspectRatio, width, desiredWidth, height, desiredHeight, minX, minY, refX, refY) {\r\n                // aspect ratio - http://www.w3.org/TR/SVG/coords.html#PreserveAspectRatioAttribute\r\n                aspectRatio = svg.compressSpaces(aspectRatio);\r\n                aspectRatio = aspectRatio.replace(/^defer\\s/, ''); // ignore defer\r\n                var align = aspectRatio.split(' ')[0] || 'xMidYMid';\r\n                var meetOrSlice = aspectRatio.split(' ')[1] || 'meet';\r\n\r\n                // calculate scale\r\n                var scaleX = width / desiredWidth;\r\n                var scaleY = height / desiredHeight;\r\n                var scaleMin = Math.min(scaleX, scaleY);\r\n                var scaleMax = Math.max(scaleX, scaleY);\r\n                if (meetOrSlice == 'meet') {\r\n                    desiredWidth *= scaleMin;\r\n                    desiredHeight *= scaleMin;\r\n                }\r\n                if (meetOrSlice == 'slice') {\r\n                    desiredWidth *= scaleMax;\r\n                    desiredHeight *= scaleMax;\r\n                }\r\n\r\n                refX = new svg.Property('refX', refX);\r\n                refY = new svg.Property('refY', refY);\r\n                if (refX.hasValue() && refY.hasValue()) {\r\n                    ctx.translate(-scaleMin * refX.toPixels('x'), -scaleMin * refY.toPixels('y'));\r\n                } else {\r\n                    // align\r\n                    if (align.match(/^xMid/) && ((meetOrSlice == 'meet' && scaleMin == scaleY) || (meetOrSlice == 'slice' && scaleMax == scaleY))) ctx.translate(width / 2.0 - desiredWidth / 2.0, 0);\r\n                    if (align.match(/YMid$/) && ((meetOrSlice == 'meet' && scaleMin == scaleX) || (meetOrSlice == 'slice' && scaleMax == scaleX))) ctx.translate(0, height / 2.0 - desiredHeight / 2.0);\r\n                    if (align.match(/^xMax/) && ((meetOrSlice == 'meet' && scaleMin == scaleY) || (meetOrSlice == 'slice' && scaleMax == scaleY))) ctx.translate(width - desiredWidth, 0);\r\n                    if (align.match(/YMax$/) && ((meetOrSlice == 'meet' && scaleMin == scaleX) || (meetOrSlice == 'slice' && scaleMax == scaleX))) ctx.translate(0, height - desiredHeight);\r\n                }\r\n\r\n                // scale\r\n                if (align == 'none') ctx.scale(scaleX, scaleY);\r\n                else if (meetOrSlice == 'meet') ctx.scale(scaleMin, scaleMin);\r\n                else if (meetOrSlice == 'slice') ctx.scale(scaleMax, scaleMax);\r\n\r\n                // translate\r\n                ctx.translate(minX == null ? 0 : -minX, minY == null ? 0 : -minY);\r\n            };\r\n\r\n            // elements\r\n            svg.Element = {};\r\n\r\n            svg.EmptyProperty = new svg.Property('EMPTY', '');\r\n\r\n            svg.Element.ElementBase = function (node) {\r\n                this.attributes = {};\r\n                this.styles = {};\r\n                this.stylesSpecificity = {};\r\n                this.children = [];\r\n\r\n                // get or create attribute\r\n                this.attribute = function (name, createIfNotExists) {\r\n                    var a = this.attributes[name];\r\n                    if (a != null) return a;\r\n\r\n                    if (createIfNotExists == true) {\r\n                        a = new svg.Property(name, '');\r\n                        this.attributes[name] = a;\r\n                    }\r\n                    return a || svg.EmptyProperty;\r\n                };\r\n\r\n                this.getHrefAttribute = function () {\r\n                    for (var a in this.attributes) {\r\n                        if (a == 'href' || a.match(/:href$/)) {\r\n                            return this.attributes[a];\r\n                        }\r\n                    }\r\n                    return svg.EmptyProperty;\r\n                };\r\n\r\n                // get or create style, crawls up node tree\r\n                this.style = function (name, createIfNotExists, skipAncestors) {\r\n                    var s = this.styles[name];\r\n                    if (s != null) return s;\r\n\r\n                    var a = this.attribute(name);\r\n                    if (a != null && a.hasValue()) {\r\n                        this.styles[name] = a; // move up to me to cache\r\n                        return a;\r\n                    }\r\n\r\n                    if (skipAncestors != true) {\r\n                        var p = this.parent;\r\n                        if (p != null) {\r\n                            var ps = p.style(name);\r\n                            if (ps != null && ps.hasValue()) {\r\n                                return ps;\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    if (createIfNotExists == true) {\r\n                        s = new svg.Property(name, '');\r\n                        this.styles[name] = s;\r\n                    }\r\n                    return s || svg.EmptyProperty;\r\n                };\r\n\r\n                // base render\r\n                this.render = function (ctx) {\r\n                    // don't render display=none\r\n                    if (this.style('display').value == 'none') return;\r\n\r\n                    // don't render visibility=hidden\r\n                    if (this.style('visibility').value == 'hidden') return;\r\n\r\n                    ctx.save();\r\n                    if (this.style('mask').hasValue()) { // mask\r\n                        var mask = this.style('mask').getDefinition();\r\n                        if (mask != null) mask.apply(ctx, this);\r\n                    } else if (this.style('filter').hasValue()) { // filter\r\n                        var filter = this.style('filter').getDefinition();\r\n                        if (filter != null) filter.apply(ctx, this);\r\n                    } else {\r\n                        this.setContext(ctx);\r\n                        this.renderChildren(ctx);\r\n                        this.clearContext(ctx);\r\n                    }\r\n                    ctx.restore();\r\n                };\r\n\r\n                // base set context\r\n                this.setContext = function (/* ctx */) {\r\n                    // OVERRIDE ME!\r\n                };\r\n\r\n                // base clear context\r\n                this.clearContext = function (/* ctx */) {\r\n                    // OVERRIDE ME!\r\n                };\r\n\r\n                // base render children\r\n                this.renderChildren = function (ctx) {\r\n                    for (var i = 0; i < this.children.length; i++) {\r\n                        this.children[i].render(ctx);\r\n                    }\r\n                };\r\n\r\n                this.addChild = function (childNode, create) {\r\n                    var child = childNode;\r\n                    if (create) child = svg.CreateElement(childNode);\r\n                    child.parent = this;\r\n                    if (child.type != 'title') { this.children.push(child); }\r\n                };\r\n\r\n                this.addStylesFromStyleDefinition = function () {\r\n                    // add styles\r\n                    for (var selector in svg.Styles) {\r\n                        if (selector[0] != '@' && matchesSelector(node, selector)) {\r\n                            var styles = svg.Styles[selector];\r\n                            var specificity = svg.StylesSpecificity[selector];\r\n                            if (styles != null) {\r\n                                for (var name in styles) {\r\n                                    var existingSpecificity = this.stylesSpecificity[name];\r\n                                    if (typeof existingSpecificity == 'undefined') {\r\n                                        existingSpecificity = '000';\r\n                                    }\r\n                                    if (specificity >= existingSpecificity) {\r\n                                        this.styles[name] = styles[name];\r\n                                        this.stylesSpecificity[name] = specificity;\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                };\r\n\r\n                // Microsoft Edge fix\r\n                var allUppercase = new RegExp('^[A-Z\\-]+$');\r\n                var normalizeAttributeName = function (name) {\r\n                    if (allUppercase.test(name)) {\r\n                        return name.toLowerCase();\r\n                    }\r\n                    return name;\r\n                };\r\n\r\n                if (node != null && node.nodeType == 1) { //ELEMENT_NODE\r\n                    // add attributes\r\n                    for (var i = 0; i < node.attributes.length; i++) {\r\n                        var attribute = node.attributes[i];\r\n                        var nodeName = normalizeAttributeName(attribute.nodeName);\r\n                        this.attributes[nodeName] = new svg.Property(nodeName, attribute.value);\r\n                    }\r\n\r\n                    this.addStylesFromStyleDefinition();\r\n\r\n                    // add inline styles\r\n                    if (this.attribute('style').hasValue()) {\r\n                        var styles = this.attribute('style').value.split(';');\r\n                        for (var i = 0; i < styles.length; i++) {\r\n                            if (svg.trim(styles[i]) != '') {\r\n                                var style = styles[i].split(':');\r\n                                var name = svg.trim(style[0]);\r\n                                var value = svg.trim(style[1]);\r\n                                this.styles[name] = new svg.Property(name, value);\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    // add id\r\n                    if (this.attribute('id').hasValue()) {\r\n                        if (svg.Definitions[this.attribute('id').value] == null) {\r\n                            svg.Definitions[this.attribute('id').value] = this;\r\n                        }\r\n                    }\r\n\r\n                    // add children\r\n                    for (var i = 0; i < node.childNodes.length; i++) {\r\n                        var childNode = node.childNodes[i];\r\n                        if (childNode.nodeType == 1) this.addChild(childNode, true); //ELEMENT_NODE\r\n                        if (this.captureTextNodes && (childNode.nodeType == 3 || childNode.nodeType == 4)) {\r\n                            var text = childNode.value || childNode.text || childNode.textContent || '';\r\n                            if (svg.compressSpaces(text) != '') {\r\n                                this.addChild(new svg.Element.tspan(childNode), false); // TEXT_NODE\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            };\r\n\r\n            svg.Element.RenderedElementBase = function (node) {\r\n                this.base = svg.Element.ElementBase;\r\n                this.base(node);\r\n\r\n                this.calculateOpacity = function() {\r\n                    var opacity = 1.0;\r\n\r\n                    var el = this;\r\n                    while (el != null) {\r\n                        var opacityStyle = el.style('opacity', false, true); // no ancestors on style call\r\n                        if (opacityStyle.hasValue()) {\r\n                            opacity = opacity * opacityStyle.numValue();\r\n                        }\r\n                        el = el.parent;\r\n                    }\r\n\r\n                    return opacity;\r\n                };\r\n\r\n                this.setContext = function (ctx, fromMeasure) {\r\n                    if (!fromMeasure) { // causes stack overflow when measuring text with gradients\r\n                        // fill\r\n                        if (this.style('fill').isUrlDefinition()) {\r\n                            var fs = this.style('fill').getFillStyleDefinition(this, this.style('fill-opacity'));\r\n                            if (fs != null) ctx.fillStyle = fs;\r\n                        } else if (this.style('fill').hasValue()) {\r\n                            var fillStyle = this.style('fill');\r\n                            if (fillStyle.value == 'currentColor') fillStyle.value = this.style('color').value;\r\n                            if (fillStyle.value != 'inherit') ctx.fillStyle = (fillStyle.value == 'none' ? 'rgba(0,0,0,0)' : fillStyle.value);\r\n                        }\r\n                        if (this.style('fill-opacity').hasValue()) {\r\n                            var fillStyle = new svg.Property('fill', ctx.fillStyle);\r\n                            fillStyle = fillStyle.addOpacity(this.style('fill-opacity'));\r\n                            ctx.fillStyle = fillStyle.value;\r\n                        }\r\n\r\n                        // stroke\r\n                        if (this.style('stroke').isUrlDefinition()) {\r\n                            var fs = this.style('stroke').getFillStyleDefinition(this, this.style('stroke-opacity'));\r\n                            if (fs != null) ctx.strokeStyle = fs;\r\n                        } else if (this.style('stroke').hasValue()) {\r\n                            var strokeStyle = this.style('stroke');\r\n                            if (strokeStyle.value == 'currentColor') strokeStyle.value = this.style('color').value;\r\n                            if (strokeStyle.value != 'inherit') ctx.strokeStyle = (strokeStyle.value == 'none' ? 'rgba(0,0,0,0)' : strokeStyle.value);\r\n                        }\r\n                        if (this.style('stroke-opacity').hasValue()) {\r\n                            var strokeStyle = new svg.Property('stroke', ctx.strokeStyle);\r\n                            strokeStyle = strokeStyle.addOpacity(this.style('stroke-opacity'));\r\n                            ctx.strokeStyle = strokeStyle.value;\r\n                        }\r\n                        if (this.style('stroke-width').hasValue()) {\r\n                            var newLineWidth = this.style('stroke-width').toPixels();\r\n                            ctx.lineWidth = newLineWidth == 0 ? 0.001 : newLineWidth; // browsers don't respect 0\r\n                        }\r\n                        if (this.style('stroke-linecap').hasValue()) ctx.lineCap = this.style('stroke-linecap').value;\r\n                        if (this.style('stroke-linejoin').hasValue()) ctx.lineJoin = this.style('stroke-linejoin').value;\r\n                        if (this.style('stroke-miterlimit').hasValue()) ctx.miterLimit = this.style('stroke-miterlimit').value;\r\n                        if (this.style('paint-order').hasValue()) ctx.paintOrder = this.style('paint-order').value;\r\n                        if (this.style('stroke-dasharray').hasValue() && this.style('stroke-dasharray').value != 'none') {\r\n                            var gaps = svg.ToNumberArray(this.style('stroke-dasharray').value);\r\n                            if (typeof ctx.setLineDash != 'undefined') { ctx.setLineDash(gaps); } else if (typeof ctx.webkitLineDash != 'undefined') { ctx.webkitLineDash = gaps; } else if (typeof ctx.mozDash != 'undefined' && !(gaps.length == 1 && gaps[0] == 0)) { ctx.mozDash = gaps; }\r\n\r\n                            var offset = this.style('stroke-dashoffset').toPixels();\r\n                            if (typeof ctx.lineDashOffset != 'undefined') { ctx.lineDashOffset = offset; } else if (typeof ctx.webkitLineDashOffset != 'undefined') { ctx.webkitLineDashOffset = offset; } else if (typeof ctx.mozDashOffset != 'undefined') { ctx.mozDashOffset = offset; }\r\n                        }\r\n                    }\r\n\r\n                    // font\r\n                    if (typeof ctx.font != 'undefined') {\r\n                        ctx.font = svg.Font.CreateFont(\r\n                            this.style('font-style').value,\r\n                            this.style('font-variant').value,\r\n                            this.style('font-weight').value,\r\n                            this.style('font-size').hasValue() ? this.style('font-size').toPixels() + 'px' : '',\r\n                            this.style('font-family').value).toString();\r\n\r\n                        // update em size if needed\r\n                        var currentFontSize = this.style('font-size', false, false);\r\n                        if (currentFontSize.isPixels()) {\r\n                            svg.emSize = currentFontSize.toPixels();\r\n                        }\r\n                    }\r\n\r\n                    // transform\r\n                    if (this.style('transform', false, true).hasValue()) {\r\n                        var transform = new svg.Transform(this.style('transform', false, true).value);\r\n                        transform.apply(ctx);\r\n                    }\r\n\r\n                    // clip\r\n                    if (this.style('clip-path', false, true).hasValue()) {\r\n                        var clip = this.style('clip-path', false, true).getDefinition();\r\n                        if (clip != null) clip.apply(ctx);\r\n                    }\r\n\r\n                    // opacity\r\n                    ctx.globalAlpha = this.calculateOpacity();\r\n                };\r\n            };\r\n            svg.Element.RenderedElementBase.prototype = new svg.Element.ElementBase;\r\n\r\n            svg.Element.PathElementBase = function (node) {\r\n                this.base = svg.Element.RenderedElementBase;\r\n                this.base(node);\r\n\r\n                this.path = function (ctx) {\r\n                    if (ctx != null) ctx.beginPath();\r\n                    return new svg.BoundingBox();\r\n                };\r\n\r\n                this.renderChildren = function (ctx) {\r\n                    this.path(ctx);\r\n                    svg.Mouse.checkPath(this, ctx);\r\n                    if (ctx.fillStyle != '') {\r\n                        if (this.style('fill-rule').valueOrDefault('inherit') != 'inherit') { ctx.fill(this.style('fill-rule').value); } else { ctx.fill(); }\r\n                    }\r\n                    if (ctx.strokeStyle != '') ctx.stroke();\r\n\r\n                    var markers = this.getMarkers();\r\n                    if (markers != null) {\r\n                        if (this.style('marker-start').isUrlDefinition()) {\r\n                            var marker = this.style('marker-start').getDefinition();\r\n                            marker.render(ctx, markers[0][0], markers[0][1]);\r\n                        }\r\n                        if (this.style('marker-mid').isUrlDefinition()) {\r\n                            var marker = this.style('marker-mid').getDefinition();\r\n                            for (var i = 1; i < markers.length - 1; i++) {\r\n                                marker.render(ctx, markers[i][0], markers[i][1]);\r\n                            }\r\n                        }\r\n                        if (this.style('marker-end').isUrlDefinition()) {\r\n                            var marker = this.style('marker-end').getDefinition();\r\n                            marker.render(ctx, markers[markers.length - 1][0], markers[markers.length - 1][1]);\r\n                        }\r\n                    }\r\n                };\r\n\r\n                this.getBoundingBox = function () {\r\n                    return this.path();\r\n                };\r\n\r\n                this.getMarkers = function () {\r\n                    return null;\r\n                };\r\n            };\r\n            svg.Element.PathElementBase.prototype = new svg.Element.RenderedElementBase;\r\n\r\n            // svg element\r\n            svg.Element.svg = function (node) {\r\n                this.base = svg.Element.RenderedElementBase;\r\n                this.base(node);\r\n\r\n                this.baseClearContext = this.clearContext;\r\n                this.clearContext = function (ctx) {\r\n                    this.baseClearContext(ctx);\r\n                    svg.ViewPort.RemoveCurrent();\r\n                };\r\n\r\n                this.baseSetContext = this.setContext;\r\n                this.setContext = function (ctx) {\r\n                    // initial values and defaults\r\n                    ctx.strokeStyle = 'rgba(0,0,0,0)';\r\n                    ctx.lineCap = 'butt';\r\n                    ctx.lineJoin = 'miter';\r\n                    ctx.miterLimit = 4;\r\n                    if (ctx.canvas.style && typeof ctx.font != 'undefined' && typeof windowEnv.getComputedStyle != 'undefined') {\r\n                        ctx.font = windowEnv.getComputedStyle(ctx.canvas).getPropertyValue('font');\r\n\r\n                        var fontSize = new svg.Property('fontSize', svg.Font.Parse(ctx.font).fontSize);\r\n                        if (fontSize.hasValue()) svg.rootEmSize = svg.emSize = fontSize.toPixels('y');\r\n                    }\r\n\r\n                    this.baseSetContext(ctx);\r\n\r\n                    // create new view port\r\n                    if (!this.attribute('x').hasValue()) this.attribute('x', true).value = 0;\r\n                    if (!this.attribute('y').hasValue()) this.attribute('y', true).value = 0;\r\n                    ctx.translate(this.attribute('x').toPixels('x'), this.attribute('y').toPixels('y'));\r\n\r\n                    var width = svg.ViewPort.width();\r\n                    var height = svg.ViewPort.height();\r\n\r\n                    if (!this.attribute('width').hasValue()) this.attribute('width', true).value = '100%';\r\n                    if (!this.attribute('height').hasValue()) this.attribute('height', true).value = '100%';\r\n                    if (typeof this.root == 'undefined') {\r\n                        width = this.attribute('width').toPixels('x');\r\n                        height = this.attribute('height').toPixels('y');\r\n\r\n                        var x = 0;\r\n                        var y = 0;\r\n                        if (this.attribute('refX').hasValue() && this.attribute('refY').hasValue()) {\r\n                            x = -this.attribute('refX').toPixels('x');\r\n                            y = -this.attribute('refY').toPixels('y');\r\n                        }\r\n\r\n                        if (this.attribute('overflow').valueOrDefault('hidden') != 'visible') {\r\n                            ctx.beginPath();\r\n                            ctx.moveTo(x, y);\r\n                            ctx.lineTo(width, y);\r\n                            ctx.lineTo(width, height);\r\n                            ctx.lineTo(x, height);\r\n                            ctx.closePath();\r\n                            ctx.clip();\r\n                        }\r\n                    }\r\n                    svg.ViewPort.SetCurrent(width, height);\r\n\r\n                    // viewbox\r\n                    if (this.attribute('viewBox').hasValue()) {\r\n                        var viewBox = svg.ToNumberArray(this.attribute('viewBox').value);\r\n                        var minX = viewBox[0];\r\n                        var minY = viewBox[1];\r\n                        width = viewBox[2];\r\n                        height = viewBox[3];\r\n\r\n                        svg.AspectRatio(ctx,\r\n                            this.attribute('preserveAspectRatio').value,\r\n                            svg.ViewPort.width(),\r\n                            width,\r\n                            svg.ViewPort.height(),\r\n                            height,\r\n                            minX,\r\n                            minY,\r\n                            this.attribute('refX').value,\r\n                            this.attribute('refY').value);\r\n\r\n                        svg.ViewPort.RemoveCurrent();\r\n                        svg.ViewPort.SetCurrent(viewBox[2], viewBox[3]);\r\n                    }\r\n                };\r\n            };\r\n            svg.Element.svg.prototype = new svg.Element.RenderedElementBase;\r\n\r\n            // rect element\r\n            svg.Element.rect = function (node) {\r\n                this.base = svg.Element.PathElementBase;\r\n                this.base(node);\r\n\r\n                this.path = function (ctx) {\r\n                    var x = this.attribute('x').toPixels('x');\r\n                    var y = this.attribute('y').toPixels('y');\r\n                    var width = this.attribute('width').toPixels('x');\r\n                    var height = this.attribute('height').toPixels('y');\r\n                    var rx = this.attribute('rx').toPixels('x');\r\n                    var ry = this.attribute('ry').toPixels('y');\r\n                    if (this.attribute('rx').hasValue() && !this.attribute('ry').hasValue()) ry = rx;\r\n                    if (this.attribute('ry').hasValue() && !this.attribute('rx').hasValue()) rx = ry;\r\n                    rx = Math.min(rx, width / 2.0);\r\n                    ry = Math.min(ry, height / 2.0);\r\n                    if (ctx != null) {\r\n                        var KAPPA = 4 * ((Math.sqrt(2) - 1) / 3);\r\n                        ctx.beginPath();\r\n                        ctx.moveTo(x + rx, y);\r\n                        ctx.lineTo(x + width - rx, y);\r\n                        ctx.bezierCurveTo(x + width - rx + (KAPPA * rx), y, x + width, y + ry - (KAPPA * ry), x + width, y + ry);\r\n                        ctx.lineTo(x + width, y + height - ry);\r\n                        ctx.bezierCurveTo(x + width, y + height - ry + (KAPPA * ry), x + width - rx + (KAPPA * rx), y + height, x + width - rx, y + height);\r\n                        ctx.lineTo(x + rx, y + height);\r\n                        ctx.bezierCurveTo(x + rx - (KAPPA * rx), y + height, x, y + height - ry + (KAPPA * ry), x, y + height - ry);\r\n                        ctx.lineTo(x, y + ry);\r\n                        ctx.bezierCurveTo(x, y + ry - (KAPPA * ry), x + rx - (KAPPA * rx), y, x + rx, y);\r\n                        ctx.closePath();\r\n                    }\r\n\r\n                    return new svg.BoundingBox(x, y, x + width, y + height);\r\n                };\r\n            };\r\n            svg.Element.rect.prototype = new svg.Element.PathElementBase;\r\n\r\n            // circle element\r\n            svg.Element.circle = function (node) {\r\n                this.base = svg.Element.PathElementBase;\r\n                this.base(node);\r\n\r\n                this.path = function (ctx) {\r\n                    var cx = this.attribute('cx').toPixels('x');\r\n                    var cy = this.attribute('cy').toPixels('y');\r\n                    var r = this.attribute('r').toPixels();\r\n\r\n                    if (ctx != null) {\r\n                        ctx.beginPath();\r\n                        ctx.arc(cx, cy, r, 0, Math.PI * 2, false);\r\n                        ctx.closePath();\r\n                    }\r\n\r\n                    return new svg.BoundingBox(cx - r, cy - r, cx + r, cy + r);\r\n                };\r\n            };\r\n            svg.Element.circle.prototype = new svg.Element.PathElementBase;\r\n\r\n            // ellipse element\r\n            svg.Element.ellipse = function (node) {\r\n                this.base = svg.Element.PathElementBase;\r\n                this.base(node);\r\n\r\n                this.path = function (ctx) {\r\n                    var KAPPA = 4 * ((Math.sqrt(2) - 1) / 3);\r\n                    var rx = this.attribute('rx').toPixels('x');\r\n                    var ry = this.attribute('ry').toPixels('y');\r\n                    var cx = this.attribute('cx').toPixels('x');\r\n                    var cy = this.attribute('cy').toPixels('y');\r\n\r\n                    if (ctx != null) {\r\n                        ctx.beginPath();\r\n                        ctx.moveTo(cx + rx, cy);\r\n                        ctx.bezierCurveTo(cx + rx, cy + (KAPPA * ry), cx + (KAPPA * rx), cy + ry, cx, cy + ry);\r\n                        ctx.bezierCurveTo(cx - (KAPPA * rx), cy + ry, cx - rx, cy + (KAPPA * ry), cx - rx, cy);\r\n                        ctx.bezierCurveTo(cx - rx, cy - (KAPPA * ry), cx - (KAPPA * rx), cy - ry, cx, cy - ry);\r\n                        ctx.bezierCurveTo(cx + (KAPPA * rx), cy - ry, cx + rx, cy - (KAPPA * ry), cx + rx, cy);\r\n                        ctx.closePath();\r\n                    }\r\n\r\n                    return new svg.BoundingBox(cx - rx, cy - ry, cx + rx, cy + ry);\r\n                };\r\n            };\r\n            svg.Element.ellipse.prototype = new svg.Element.PathElementBase;\r\n\r\n            // line element\r\n            svg.Element.line = function (node) {\r\n                this.base = svg.Element.PathElementBase;\r\n                this.base(node);\r\n\r\n                this.getPoints = function () {\r\n                    return [\r\n                        new svg.Point(this.attribute('x1').toPixels('x'), this.attribute('y1').toPixels('y')),\r\n                        new svg.Point(this.attribute('x2').toPixels('x'), this.attribute('y2').toPixels('y'))\r\n                    ];\r\n                };\r\n\r\n                this.path = function (ctx) {\r\n                    var points = this.getPoints();\r\n\r\n                    if (ctx != null) {\r\n                        ctx.beginPath();\r\n                        ctx.moveTo(points[0].x, points[0].y);\r\n                        ctx.lineTo(points[1].x, points[1].y);\r\n                    }\r\n\r\n                    return new svg.BoundingBox(points[0].x, points[0].y, points[1].x, points[1].y);\r\n                };\r\n\r\n                this.getMarkers = function () {\r\n                    var points = this.getPoints();\r\n                    var a = points[0].angleTo(points[1]);\r\n                    return [\r\n                        [points[0], a],\r\n                        [points[1], a]\r\n                    ];\r\n                };\r\n            };\r\n            svg.Element.line.prototype = new svg.Element.PathElementBase;\r\n\r\n            // polyline element\r\n            svg.Element.polyline = function (node) {\r\n                this.base = svg.Element.PathElementBase;\r\n                this.base(node);\r\n\r\n                this.points = svg.CreatePath(this.attribute('points').value);\r\n                this.path = function (ctx) {\r\n                    var bb = new svg.BoundingBox(this.points[0].x, this.points[0].y);\r\n                    if (ctx != null) {\r\n                        ctx.beginPath();\r\n                        ctx.moveTo(this.points[0].x, this.points[0].y);\r\n                    }\r\n                    for (var i = 1; i < this.points.length; i++) {\r\n                        bb.addPoint(this.points[i].x, this.points[i].y);\r\n                        if (ctx != null) ctx.lineTo(this.points[i].x, this.points[i].y);\r\n                    }\r\n                    return bb;\r\n                };\r\n\r\n                this.getMarkers = function () {\r\n                    var markers = [];\r\n                    for (var i = 0; i < this.points.length - 1; i++) {\r\n                        markers.push([this.points[i], this.points[i].angleTo(this.points[i + 1])]);\r\n                    }\r\n                    if (markers.length > 0) {\r\n                        markers.push([this.points[this.points.length - 1], markers[markers.length - 1][1]]);\r\n                    }\r\n                    return markers;\r\n                };\r\n            };\r\n            svg.Element.polyline.prototype = new svg.Element.PathElementBase;\r\n\r\n            // polygon element\r\n            svg.Element.polygon = function (node) {\r\n                this.base = svg.Element.polyline;\r\n                this.base(node);\r\n\r\n                this.basePath = this.path;\r\n                this.path = function (ctx) {\r\n                    var bb = this.basePath(ctx);\r\n                    if (ctx != null) {\r\n                        ctx.lineTo(this.points[0].x, this.points[0].y);\r\n                        ctx.closePath();\r\n                    }\r\n                    return bb;\r\n                };\r\n            };\r\n            svg.Element.polygon.prototype = new svg.Element.polyline;\r\n\r\n            // path element\r\n            svg.Element.path = function (node) {\r\n                this.base = svg.Element.PathElementBase;\r\n                this.base(node);\r\n\r\n                var d = this.attribute('d').value;\r\n                // TODO: convert to real lexer based on http://www.w3.org/TR/SVG11/paths.html#PathDataBNF\r\n                d = d.replace(/,/gm, ' '); // get rid of all commas\r\n                // As the end of a match can also be the start of the next match, we need to run this replace twice.\r\n                for (var i = 0; i < 2; i++)\r\n                    d = d.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\\s])/gm, '$1 $2'); // suffix commands with spaces\r\n                d = d.replace(/([^\\s])([MmZzLlHhVvCcSsQqTtAa])/gm, '$1 $2'); // prefix commands with spaces\r\n                d = d.replace(/([0-9])([+\\-])/gm, '$1 $2'); // separate digits on +- signs\r\n                // Again, we need to run this twice to find all occurances\r\n                for (var i = 0; i < 2; i++)\r\n                    d = d.replace(/(\\.[0-9]*)(\\.)/gm, '$1 $2'); // separate digits when they start with a comma\r\n                d = d.replace(/([Aa](\\s+[0-9]+){3})\\s+([01])\\s*([01])/gm, '$1 $3 $4 '); // shorthand elliptical arc path syntax\r\n                d = svg.compressSpaces(d); // compress multiple spaces\r\n                d = svg.trim(d);\r\n                this.PathParser = new (function (d) {\r\n                    this.tokens = d.split(' ');\r\n\r\n                    this.reset = function () {\r\n                        this.i = -1;\r\n                        this.command = '';\r\n                        this.previousCommand = '';\r\n                        this.start = new svg.Point(0, 0);\r\n                        this.control = new svg.Point(0, 0);\r\n                        this.current = new svg.Point(0, 0);\r\n                        this.points = [];\r\n                        this.angles = [];\r\n                    };\r\n\r\n                    this.isEnd = function () {\r\n                        return this.i >= this.tokens.length - 1;\r\n                    };\r\n\r\n                    this.isCommandOrEnd = function () {\r\n                        if (this.isEnd()) return true;\r\n                        return this.tokens[this.i + 1].match(/^[A-Za-z]$/) != null;\r\n                    };\r\n\r\n                    this.isRelativeCommand = function () {\r\n                        switch (this.command) {\r\n                            case 'm':\r\n                            case 'l':\r\n                            case 'h':\r\n                            case 'v':\r\n                            case 'c':\r\n                            case 's':\r\n                            case 'q':\r\n                            case 't':\r\n                            case 'a':\r\n                            case 'z':\r\n                                return true;\r\n                        }\r\n                        return false;\r\n                    };\r\n\r\n                    this.getToken = function () {\r\n                        this.i++;\r\n                        return this.tokens[this.i];\r\n                    };\r\n\r\n                    this.getScalar = function () {\r\n                        return parseFloat(this.getToken());\r\n                    };\r\n\r\n                    this.nextCommand = function () {\r\n                        this.previousCommand = this.command;\r\n                        this.command = this.getToken();\r\n                    };\r\n\r\n                    this.getPoint = function () {\r\n                        var p = new svg.Point(this.getScalar(), this.getScalar());\r\n                        return this.makeAbsolute(p);\r\n                    };\r\n\r\n                    this.getAsControlPoint = function () {\r\n                        var p = this.getPoint();\r\n                        this.control = p;\r\n                        return p;\r\n                    };\r\n\r\n                    this.getAsCurrentPoint = function () {\r\n                        var p = this.getPoint();\r\n                        this.current = p;\r\n                        return p;\r\n                    };\r\n\r\n                    this.getReflectedControlPoint = function () {\r\n                        if (this.previousCommand.toLowerCase() != 'c' &&\r\n                            this.previousCommand.toLowerCase() != 's' &&\r\n                            this.previousCommand.toLowerCase() != 'q' &&\r\n                            this.previousCommand.toLowerCase() != 't') {\r\n                            return this.current;\r\n                        }\r\n\r\n                        // reflect point\r\n                        var p = new svg.Point(2 * this.current.x - this.control.x, 2 * this.current.y - this.control.y);\r\n                        return p;\r\n                    };\r\n\r\n                    this.makeAbsolute = function (p) {\r\n                        if (this.isRelativeCommand()) {\r\n                            p.x += this.current.x;\r\n                            p.y += this.current.y;\r\n                        }\r\n                        return p;\r\n                    };\r\n\r\n                    this.addMarker = function (p, from, priorTo) {\r\n                        // if the last angle isn't filled in because we didn't have this point yet ...\r\n                        if (priorTo != null && this.angles.length > 0 && this.angles[this.angles.length - 1] == null) {\r\n                            this.angles[this.angles.length - 1] = this.points[this.points.length - 1].angleTo(priorTo);\r\n                        }\r\n                        this.addMarkerAngle(p, from == null ? null : from.angleTo(p));\r\n                    };\r\n\r\n                    this.addMarkerAngle = function (p, a) {\r\n                        this.points.push(p);\r\n                        this.angles.push(a);\r\n                    };\r\n\r\n                    this.getMarkerPoints = function () { return this.points; };\r\n                    this.getMarkerAngles = function () {\r\n                        for (var i = 0; i < this.angles.length; i++) {\r\n                            if (this.angles[i] == null) {\r\n                                for (var j = i + 1; j < this.angles.length; j++) {\r\n                                    if (this.angles[j] != null) {\r\n                                        this.angles[i] = this.angles[j];\r\n                                        break;\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                        return this.angles;\r\n                    };\r\n                })(d);\r\n\r\n                this.path = function (ctx) {\r\n                    var pp = this.PathParser;\r\n                    pp.reset();\r\n\r\n                    var bb = new svg.BoundingBox();\r\n                    if (ctx != null) ctx.beginPath();\r\n                    while (!pp.isEnd()) {\r\n                        pp.nextCommand();\r\n                        switch (pp.command) {\r\n                            case 'M':\r\n                            case 'm':\r\n                                var p = pp.getAsCurrentPoint();\r\n                                pp.addMarker(p);\r\n                                bb.addPoint(p.x, p.y);\r\n                                if (ctx != null) ctx.moveTo(p.x, p.y);\r\n                                pp.start = pp.current;\r\n                                while (!pp.isCommandOrEnd()) {\r\n                                    var p = pp.getAsCurrentPoint();\r\n                                    pp.addMarker(p, pp.start);\r\n                                    bb.addPoint(p.x, p.y);\r\n                                    if (ctx != null) ctx.lineTo(p.x, p.y);\r\n                                }\r\n                                break;\r\n                            case 'L':\r\n                            case 'l':\r\n                                while (!pp.isCommandOrEnd()) {\r\n                                    var c = pp.current;\r\n                                    var p = pp.getAsCurrentPoint();\r\n                                    pp.addMarker(p, c);\r\n                                    bb.addPoint(p.x, p.y);\r\n                                    if (ctx != null) ctx.lineTo(p.x, p.y);\r\n                                }\r\n                                break;\r\n                            case 'H':\r\n                            case 'h':\r\n                                while (!pp.isCommandOrEnd()) {\r\n                                    var newP = new svg.Point((pp.isRelativeCommand() ? pp.current.x : 0) + pp.getScalar(), pp.current.y);\r\n                                    pp.addMarker(newP, pp.current);\r\n                                    pp.current = newP;\r\n                                    bb.addPoint(pp.current.x, pp.current.y);\r\n                                    if (ctx != null) ctx.lineTo(pp.current.x, pp.current.y);\r\n                                }\r\n                                break;\r\n                            case 'V':\r\n                            case 'v':\r\n                                while (!pp.isCommandOrEnd()) {\r\n                                    var newP = new svg.Point(pp.current.x, (pp.isRelativeCommand() ? pp.current.y : 0) + pp.getScalar());\r\n                                    pp.addMarker(newP, pp.current);\r\n                                    pp.current = newP;\r\n                                    bb.addPoint(pp.current.x, pp.current.y);\r\n                                    if (ctx != null) ctx.lineTo(pp.current.x, pp.current.y);\r\n                                }\r\n                                break;\r\n                            case 'C':\r\n                            case 'c':\r\n                                while (!pp.isCommandOrEnd()) {\r\n                                    var curr = pp.current;\r\n                                    var p1 = pp.getPoint();\r\n                                    var cntrl = pp.getAsControlPoint();\r\n                                    var cp = pp.getAsCurrentPoint();\r\n                                    pp.addMarker(cp, cntrl, p1);\r\n                                    bb.addBezierCurve(curr.x, curr.y, p1.x, p1.y, cntrl.x, cntrl.y, cp.x, cp.y);\r\n                                    if (ctx != null) ctx.bezierCurveTo(p1.x, p1.y, cntrl.x, cntrl.y, cp.x, cp.y);\r\n                                }\r\n                                break;\r\n                            case 'S':\r\n                            case 's':\r\n                                while (!pp.isCommandOrEnd()) {\r\n                                    var curr = pp.current;\r\n                                    var p1 = pp.getReflectedControlPoint();\r\n                                    var cntrl = pp.getAsControlPoint();\r\n                                    var cp = pp.getAsCurrentPoint();\r\n                                    pp.addMarker(cp, cntrl, p1);\r\n                                    bb.addBezierCurve(curr.x, curr.y, p1.x, p1.y, cntrl.x, cntrl.y, cp.x, cp.y);\r\n                                    if (ctx != null) ctx.bezierCurveTo(p1.x, p1.y, cntrl.x, cntrl.y, cp.x, cp.y);\r\n                                }\r\n                                break;\r\n                            case 'Q':\r\n                            case 'q':\r\n                                while (!pp.isCommandOrEnd()) {\r\n                                    var curr = pp.current;\r\n                                    var cntrl = pp.getAsControlPoint();\r\n                                    var cp = pp.getAsCurrentPoint();\r\n                                    pp.addMarker(cp, cntrl, cntrl);\r\n                                    bb.addQuadraticCurve(curr.x, curr.y, cntrl.x, cntrl.y, cp.x, cp.y);\r\n                                    if (ctx != null) ctx.quadraticCurveTo(cntrl.x, cntrl.y, cp.x, cp.y);\r\n                                }\r\n                                break;\r\n                            case 'T':\r\n                            case 't':\r\n                                while (!pp.isCommandOrEnd()) {\r\n                                    var curr = pp.current;\r\n                                    var cntrl = pp.getReflectedControlPoint();\r\n                                    pp.control = cntrl;\r\n                                    var cp = pp.getAsCurrentPoint();\r\n                                    pp.addMarker(cp, cntrl, cntrl);\r\n                                    bb.addQuadraticCurve(curr.x, curr.y, cntrl.x, cntrl.y, cp.x, cp.y);\r\n                                    if (ctx != null) ctx.quadraticCurveTo(cntrl.x, cntrl.y, cp.x, cp.y);\r\n                                }\r\n                                break;\r\n                            case 'A':\r\n                            case 'a':\r\n                                while (!pp.isCommandOrEnd()) {\r\n                                    var curr = pp.current;\r\n                                    var rx = pp.getScalar();\r\n                                    var ry = pp.getScalar();\r\n                                    var xAxisRotation = pp.getScalar() * (Math.PI / 180.0);\r\n                                    var largeArcFlag = pp.getScalar();\r\n                                    var sweepFlag = pp.getScalar();\r\n                                    var cp = pp.getAsCurrentPoint();\r\n\r\n                                    // Conversion from endpoint to center parameterization\r\n                                    // http://www.w3.org/TR/SVG11/implnote.html#ArcImplementationNotes\r\n                                    // x1', y1'\r\n                                    var currp = new svg.Point(\r\n                                        Math.cos(xAxisRotation) * (curr.x - cp.x) / 2.0 + Math.sin(xAxisRotation) * (curr.y - cp.y) / 2.0, -Math.sin(xAxisRotation) * (curr.x - cp.x) / 2.0 + Math.cos(xAxisRotation) * (curr.y - cp.y) / 2.0\r\n                                    );\r\n                                    // adjust radii\r\n                                    var l = Math.pow(currp.x, 2) / Math.pow(rx, 2) + Math.pow(currp.y, 2) / Math.pow(ry, 2);\r\n                                    if (l > 1) {\r\n                                        rx *= Math.sqrt(l);\r\n                                        ry *= Math.sqrt(l);\r\n                                    }\r\n                                    // cx', cy'\r\n                                    var s = (largeArcFlag == sweepFlag ? -1 : 1) * Math.sqrt(\r\n                                        ((Math.pow(rx, 2) * Math.pow(ry, 2)) - (Math.pow(rx, 2) * Math.pow(currp.y, 2)) - (Math.pow(ry, 2) * Math.pow(currp.x, 2))) /\r\n                                        (Math.pow(rx, 2) * Math.pow(currp.y, 2) + Math.pow(ry, 2) * Math.pow(currp.x, 2))\r\n                                    );\r\n                                    if (isNaN(s)) s = 0;\r\n                                    var cpp = new svg.Point(s * rx * currp.y / ry, s * -ry * currp.x / rx);\r\n                                    // cx, cy\r\n                                    var centp = new svg.Point(\r\n                                        (curr.x + cp.x) / 2.0 + Math.cos(xAxisRotation) * cpp.x - Math.sin(xAxisRotation) * cpp.y,\r\n                                        (curr.y + cp.y) / 2.0 + Math.sin(xAxisRotation) * cpp.x + Math.cos(xAxisRotation) * cpp.y\r\n                                    );\r\n                                    // vector magnitude\r\n                                    var m = function (v) { return Math.sqrt(Math.pow(v[0], 2) + Math.pow(v[1], 2)); };\r\n                                    // ratio between two vectors\r\n                                    var r = function (u, v) { return (u[0] * v[0] + u[1] * v[1]) / (m(u) * m(v)) };\r\n                                    // angle between two vectors\r\n                                    var a = function (u, v) { return (u[0] * v[1] < u[1] * v[0] ? -1 : 1) * Math.acos(r(u, v)); };\r\n                                    // initial angle\r\n                                    var a1 = a([1, 0], [(currp.x - cpp.x) / rx, (currp.y - cpp.y) / ry]);\r\n                                    // angle delta\r\n                                    var u = [(currp.x - cpp.x) / rx, (currp.y - cpp.y) / ry];\r\n                                    var v = [(-currp.x - cpp.x) / rx, (-currp.y - cpp.y) / ry];\r\n                                    var ad = a(u, v);\r\n                                    if (r(u, v) <= -1) ad = Math.PI;\r\n                                    if (r(u, v) >= 1) ad = 0;\r\n\r\n                                    // for markers\r\n                                    var dir = 1 - sweepFlag ? 1.0 : -1.0;\r\n                                    var ah = a1 + dir * (ad / 2.0);\r\n                                    var halfWay = new svg.Point(\r\n                                        centp.x + rx * Math.cos(ah),\r\n                                        centp.y + ry * Math.sin(ah)\r\n                                    );\r\n                                    pp.addMarkerAngle(halfWay, ah - dir * Math.PI / 2);\r\n                                    pp.addMarkerAngle(cp, ah - dir * Math.PI);\r\n\r\n                                    bb.addPoint(cp.x, cp.y); // TODO: this is too naive, make it better\r\n                                    if (ctx != null && !isNaN(a1) && !isNaN(ad)) {\r\n                                        var r = rx > ry ? rx : ry;\r\n                                        var sx = rx > ry ? 1 : rx / ry;\r\n                                        var sy = rx > ry ? ry / rx : 1;\r\n\r\n                                        ctx.translate(centp.x, centp.y);\r\n                                        ctx.rotate(xAxisRotation);\r\n                                        ctx.scale(sx, sy);\r\n                                        ctx.arc(0, 0, r, a1, a1 + ad, 1 - sweepFlag);\r\n                                        ctx.scale(1 / sx, 1 / sy);\r\n                                        ctx.rotate(-xAxisRotation);\r\n                                        ctx.translate(-centp.x, -centp.y);\r\n                                    }\r\n                                }\r\n                                break;\r\n                            case 'Z':\r\n                            case 'z':\r\n                                if (ctx != null) {\r\n                                    // only close path if it is not a straight line\r\n                                    if (bb.x1 !== bb.x2 && bb.y1 !== bb.y2) {\r\n                                        ctx.closePath();\r\n                                    }\r\n                                }\r\n                                pp.current = pp.start;\r\n                        }\r\n                    }\r\n\r\n                    return bb;\r\n                };\r\n\r\n                this.getMarkers = function () {\r\n                    var points = this.PathParser.getMarkerPoints();\r\n                    var angles = this.PathParser.getMarkerAngles();\r\n\r\n                    var markers = [];\r\n                    for (var i = 0; i < points.length; i++) {\r\n                        markers.push([points[i], angles[i]]);\r\n                    }\r\n                    return markers;\r\n                };\r\n            };\r\n            svg.Element.path.prototype = new svg.Element.PathElementBase;\r\n\r\n            // pattern element\r\n            svg.Element.pattern = function (node) {\r\n                this.base = svg.Element.ElementBase;\r\n                this.base(node);\r\n\r\n                this.createPattern = function (ctx /* , element */) {\r\n                    var width = this.attribute('width').toPixels('x', true);\r\n                    var height = this.attribute('height').toPixels('y', true);\r\n\r\n                    // render me using a temporary svg element\r\n                    var tempSvg = new svg.Element.svg();\r\n                    tempSvg.attributes['viewBox'] = new svg.Property('viewBox', this.attribute('viewBox').value);\r\n                    tempSvg.attributes['width'] = new svg.Property('width', width + 'px');\r\n                    tempSvg.attributes['height'] = new svg.Property('height', height + 'px');\r\n                    tempSvg.attributes['transform'] = new svg.Property('transform', this.attribute('patternTransform').value);\r\n                    tempSvg.children = this.children;\r\n\r\n                    var c = createCanvas(width, height);\r\n                    var cctx = c.getContext('2d');\r\n                    if (this.attribute('x').hasValue() && this.attribute('y').hasValue()) {\r\n                        cctx.translate(this.attribute('x').toPixels('x', true), this.attribute('y').toPixels('y', true));\r\n                    }\r\n                    // render 3x3 grid so when we transform there's no white space on edges\r\n                    for (var x = -1; x <= 1; x++) {\r\n                        for (var y = -1; y <= 1; y++) {\r\n                            cctx.save();\r\n                            tempSvg.attributes['x'] = new svg.Property('x', x * c.width);\r\n                            tempSvg.attributes['y'] = new svg.Property('y', y * c.height);\r\n                            tempSvg.render(cctx);\r\n                            cctx.restore();\r\n                        }\r\n                    }\r\n                    var pattern = ctx.createPattern(c, 'repeat');\r\n                    return pattern;\r\n                };\r\n            };\r\n            svg.Element.pattern.prototype = new svg.Element.ElementBase;\r\n\r\n            // marker element\r\n            svg.Element.marker = function (node) {\r\n                this.base = svg.Element.ElementBase;\r\n                this.base(node);\r\n\r\n                this.baseRender = this.render;\r\n                this.render = function (ctx, point, angle) {\r\n                    if (!point) { return; }\r\n                    ctx.translate(point.x, point.y);\r\n                    if (this.attribute('orient').valueOrDefault('auto') == 'auto') ctx.rotate(angle);\r\n                    if (this.attribute('markerUnits').valueOrDefault('strokeWidth') == 'strokeWidth') ctx.scale(ctx.lineWidth, ctx.lineWidth);\r\n                    ctx.save();\r\n\r\n                    // render me using a temporary svg element\r\n                    var tempSvg = new svg.Element.svg();\r\n                    tempSvg.attributes['viewBox'] = new svg.Property('viewBox', this.attribute('viewBox').value);\r\n                    tempSvg.attributes['refX'] = new svg.Property('refX', this.attribute('refX').value);\r\n                    tempSvg.attributes['refY'] = new svg.Property('refY', this.attribute('refY').value);\r\n                    tempSvg.attributes['width'] = new svg.Property('width', this.attribute('markerWidth').value);\r\n                    tempSvg.attributes['height'] = new svg.Property('height', this.attribute('markerHeight').value);\r\n                    tempSvg.attributes['fill'] = new svg.Property('fill', this.attribute('fill').valueOrDefault('black'));\r\n                    tempSvg.attributes['stroke'] = new svg.Property('stroke', this.attribute('stroke').valueOrDefault('none'));\r\n                    tempSvg.children = this.children;\r\n                    tempSvg.render(ctx);\r\n\r\n                    ctx.restore();\r\n                    if (this.attribute('markerUnits').valueOrDefault('strokeWidth') == 'strokeWidth') ctx.scale(1 / ctx.lineWidth, 1 / ctx.lineWidth);\r\n                    if (this.attribute('orient').valueOrDefault('auto') == 'auto') ctx.rotate(-angle);\r\n                    ctx.translate(-point.x, -point.y);\r\n                };\r\n            };\r\n            svg.Element.marker.prototype = new svg.Element.ElementBase;\r\n\r\n            // definitions element\r\n            svg.Element.defs = function (node) {\r\n                this.base = svg.Element.ElementBase;\r\n                this.base(node);\r\n\r\n                this.render = function (/* ctx */) {\r\n                    // NOOP\r\n                };\r\n            };\r\n            svg.Element.defs.prototype = new svg.Element.ElementBase;\r\n\r\n            // base for gradients\r\n            svg.Element.GradientBase = function (node) {\r\n                this.base = svg.Element.ElementBase;\r\n                this.base(node);\r\n\r\n                this.stops = [];\r\n                for (var i = 0; i < this.children.length; i++) {\r\n                    var child = this.children[i];\r\n                    if (child.type == 'stop') this.stops.push(child);\r\n                }\r\n\r\n                this.getGradient = function () {\r\n                    // OVERRIDE ME!\r\n                };\r\n\r\n                this.gradientUnits = function () {\r\n                    return this.attribute('gradientUnits').valueOrDefault('objectBoundingBox');\r\n                };\r\n\r\n                this.attributesToInherit = ['gradientUnits'];\r\n\r\n                this.inheritStopContainer = function (stopsContainer) {\r\n                    for (var i = 0; i < this.attributesToInherit.length; i++) {\r\n                        var attributeToInherit = this.attributesToInherit[i];\r\n                        if (!this.attribute(attributeToInherit).hasValue() && stopsContainer.attribute(attributeToInherit).hasValue()) {\r\n                            this.attribute(attributeToInherit, true).value = stopsContainer.attribute(attributeToInherit).value;\r\n                        }\r\n                    }\r\n                };\r\n\r\n                this.createGradient = function (ctx, element, parentOpacityProp) {\r\n                    var stopsContainer = this;\r\n                    if (this.getHrefAttribute().hasValue()) {\r\n                        stopsContainer = this.getHrefAttribute().getDefinition();\r\n                        this.inheritStopContainer(stopsContainer);\r\n                    }\r\n\r\n                    var addParentOpacity = function (color) {\r\n                        if (parentOpacityProp.hasValue()) {\r\n                            var p = new svg.Property('color', color);\r\n                            return p.addOpacity(parentOpacityProp).value;\r\n                        }\r\n                        return color;\r\n                    };\r\n\r\n                    var g = this.getGradient(ctx, element);\r\n                    if (g == null) return addParentOpacity(stopsContainer.stops[stopsContainer.stops.length - 1].color);\r\n                    for (var i = 0; i < stopsContainer.stops.length; i++) {\r\n                        g.addColorStop(stopsContainer.stops[i].offset, addParentOpacity(stopsContainer.stops[i].color));\r\n                    }\r\n\r\n                    if (this.attribute('gradientTransform').hasValue()) {\r\n                        // render as transformed pattern on temporary canvas\r\n                        var rootView = svg.ViewPort.viewPorts[0];\r\n\r\n                        var rect = new svg.Element.rect();\r\n                        rect.attributes['x'] = new svg.Property('x', -svg.MAX_VIRTUAL_PIXELS / 3.0);\r\n                        rect.attributes['y'] = new svg.Property('y', -svg.MAX_VIRTUAL_PIXELS / 3.0);\r\n                        rect.attributes['width'] = new svg.Property('width', svg.MAX_VIRTUAL_PIXELS);\r\n                        rect.attributes['height'] = new svg.Property('height', svg.MAX_VIRTUAL_PIXELS);\r\n\r\n                        var group = new svg.Element.g();\r\n                        group.attributes['transform'] = new svg.Property('transform', this.attribute('gradientTransform').value);\r\n                        group.children = [rect];\r\n\r\n                        var tempSvg = new svg.Element.svg();\r\n                        tempSvg.attributes['x'] = new svg.Property('x', 0);\r\n                        tempSvg.attributes['y'] = new svg.Property('y', 0);\r\n                        tempSvg.attributes['width'] = new svg.Property('width', rootView.width);\r\n                        tempSvg.attributes['height'] = new svg.Property('height', rootView.height);\r\n                        tempSvg.children = [group];\r\n                        var c = createCanvas(rootView.width, rootView.height);\r\n                        var tempCtx = c.getContext('2d');\r\n                        tempCtx.fillStyle = g;\r\n                        tempSvg.render(tempCtx);\r\n                        return tempCtx.createPattern(c, 'no-repeat');\r\n                    }\r\n\r\n                    return g;\r\n                };\r\n            };\r\n            svg.Element.GradientBase.prototype = new svg.Element.ElementBase;\r\n\r\n            // linear gradient element\r\n            svg.Element.linearGradient = function (node) {\r\n                this.base = svg.Element.GradientBase;\r\n                this.base(node);\r\n\r\n                this.attributesToInherit.push('x1');\r\n                this.attributesToInherit.push('y1');\r\n                this.attributesToInherit.push('x2');\r\n                this.attributesToInherit.push('y2');\r\n\r\n                this.getGradient = function (ctx, element) {\r\n                    var bb = this.gradientUnits() == 'objectBoundingBox' ? element.getBoundingBox(ctx) : null;\r\n\r\n                    if (!this.attribute('x1').hasValue() &&\r\n                        !this.attribute('y1').hasValue() &&\r\n                        !this.attribute('x2').hasValue() &&\r\n                        !this.attribute('y2').hasValue()) {\r\n                        this.attribute('x1', true).value = 0;\r\n                        this.attribute('y1', true).value = 0;\r\n                        this.attribute('x2', true).value = 1;\r\n                        this.attribute('y2', true).value = 0;\r\n                    }\r\n\r\n                    var x1 = (this.gradientUnits() == 'objectBoundingBox' ?\r\n                        bb.x() + bb.width() * this.attribute('x1').numValue() :\r\n                        this.attribute('x1').toPixels('x'));\r\n                    var y1 = (this.gradientUnits() == 'objectBoundingBox' ?\r\n                        bb.y() + bb.height() * this.attribute('y1').numValue() :\r\n                        this.attribute('y1').toPixels('y'));\r\n                    var x2 = (this.gradientUnits() == 'objectBoundingBox' ?\r\n                        bb.x() + bb.width() * this.attribute('x2').numValue() :\r\n                        this.attribute('x2').toPixels('x'));\r\n                    var y2 = (this.gradientUnits() == 'objectBoundingBox' ?\r\n                        bb.y() + bb.height() * this.attribute('y2').numValue() :\r\n                        this.attribute('y2').toPixels('y'));\r\n\r\n                    if (x1 == x2 && y1 == y2) return null;\r\n                    return ctx.createLinearGradient(x1, y1, x2, y2);\r\n                };\r\n            };\r\n            svg.Element.linearGradient.prototype = new svg.Element.GradientBase;\r\n\r\n            // radial gradient element\r\n            svg.Element.radialGradient = function (node) {\r\n                this.base = svg.Element.GradientBase;\r\n                this.base(node);\r\n\r\n                this.attributesToInherit.push('cx');\r\n                this.attributesToInherit.push('cy');\r\n                this.attributesToInherit.push('r');\r\n                this.attributesToInherit.push('fx');\r\n                this.attributesToInherit.push('fy');\r\n\r\n                this.getGradient = function (ctx, element) {\r\n                    var bb = element.getBoundingBox(ctx);\r\n\r\n                    if (!this.attribute('cx').hasValue()) this.attribute('cx', true).value = '50%';\r\n                    if (!this.attribute('cy').hasValue()) this.attribute('cy', true).value = '50%';\r\n                    if (!this.attribute('r').hasValue()) this.attribute('r', true).value = '50%';\r\n\r\n                    var cx = (this.gradientUnits() == 'objectBoundingBox' ?\r\n                        bb.x() + bb.width() * this.attribute('cx').numValue() :\r\n                        this.attribute('cx').toPixels('x'));\r\n                    var cy = (this.gradientUnits() == 'objectBoundingBox' ?\r\n                        bb.y() + bb.height() * this.attribute('cy').numValue() :\r\n                        this.attribute('cy').toPixels('y'));\r\n\r\n                    var fx = cx;\r\n                    var fy = cy;\r\n                    if (this.attribute('fx').hasValue()) {\r\n                        fx = (this.gradientUnits() == 'objectBoundingBox' ?\r\n                            bb.x() + bb.width() * this.attribute('fx').numValue() :\r\n                            this.attribute('fx').toPixels('x'));\r\n                    }\r\n                    if (this.attribute('fy').hasValue()) {\r\n                        fy = (this.gradientUnits() == 'objectBoundingBox' ?\r\n                            bb.y() + bb.height() * this.attribute('fy').numValue() :\r\n                            this.attribute('fy').toPixels('y'));\r\n                    }\r\n\r\n                    var r = (this.gradientUnits() == 'objectBoundingBox' ?\r\n                        (bb.width() + bb.height()) / 2.0 * this.attribute('r').numValue() :\r\n                        this.attribute('r').toPixels());\r\n\r\n                    return ctx.createRadialGradient(fx, fy, 0, cx, cy, r);\r\n                };\r\n            };\r\n            svg.Element.radialGradient.prototype = new svg.Element.GradientBase;\r\n\r\n            // gradient stop element\r\n            svg.Element.stop = function (node) {\r\n                this.base = svg.Element.ElementBase;\r\n                this.base(node);\r\n\r\n                this.offset = this.attribute('offset').numValue();\r\n                if (this.offset < 0) this.offset = 0;\r\n                if (this.offset > 1) this.offset = 1;\r\n\r\n                var stopColor = this.style('stop-color', true);\r\n                if (stopColor.value === '') stopColor.value = '#000';\r\n                if (this.style('stop-opacity').hasValue()) stopColor = stopColor.addOpacity(this.style('stop-opacity'));\r\n                this.color = stopColor.value;\r\n            };\r\n            svg.Element.stop.prototype = new svg.Element.ElementBase;\r\n\r\n            // animation base element\r\n            svg.Element.AnimateBase = function (node) {\r\n                this.base = svg.Element.ElementBase;\r\n                this.base(node);\r\n\r\n                svg.Animations.push(this);\r\n\r\n                this.duration = 0.0;\r\n                this.begin = this.attribute('begin').toMilliseconds();\r\n                this.maxDuration = this.begin + this.attribute('dur').toMilliseconds();\r\n\r\n                this.getProperty = function () {\r\n                    var attributeType = this.attribute('attributeType').value;\r\n                    var attributeName = this.attribute('attributeName').value;\r\n\r\n                    if (attributeType == 'CSS') {\r\n                        return this.parent.style(attributeName, true);\r\n                    }\r\n                    return this.parent.attribute(attributeName, true);\r\n                };\r\n\r\n                this.initialValue = null;\r\n                this.initialUnits = '';\r\n                this.removed = false;\r\n\r\n                this.calcValue = function () {\r\n                    // OVERRIDE ME!\r\n                    return '';\r\n                };\r\n\r\n                this.update = function (delta) {\r\n                    // set initial value\r\n                    if (this.initialValue == null) {\r\n                        this.initialValue = this.getProperty().value;\r\n                        this.initialUnits = this.getProperty().getUnits();\r\n                    }\r\n\r\n                    // if we're past the end time\r\n                    if (this.duration > this.maxDuration) {\r\n                        // loop for indefinitely repeating animations\r\n                        if (this.attribute('repeatCount').value == 'indefinite' ||\r\n                            this.attribute('repeatDur').value == 'indefinite') {\r\n                            this.duration = 0.0;\r\n                        } else if (this.attribute('fill').valueOrDefault('remove') == 'freeze' && !this.frozen) {\r\n                            this.frozen = true;\r\n                            this.parent.animationFrozen = true;\r\n                            this.parent.animationFrozenValue = this.getProperty().value;\r\n                        } else if (this.attribute('fill').valueOrDefault('remove') == 'remove' && !this.removed) {\r\n                            this.removed = true;\r\n                            this.getProperty().value = this.parent.animationFrozen ? this.parent.animationFrozenValue : this.initialValue;\r\n                            return true;\r\n                        }\r\n                        return false;\r\n                    }\r\n                    this.duration = this.duration + delta;\r\n\r\n                    // if we're past the begin time\r\n                    var updated = false;\r\n                    if (this.begin < this.duration) {\r\n                        var newValue = this.calcValue(); // tween\r\n\r\n                        if (this.attribute('type').hasValue()) {\r\n                            // for transform, etc.\r\n                            var type = this.attribute('type').value;\r\n                            newValue = type + '(' + newValue + ')';\r\n                        }\r\n\r\n                        this.getProperty().value = newValue;\r\n                        updated = true;\r\n                    }\r\n\r\n                    return updated;\r\n                };\r\n\r\n                this.from = this.attribute('from');\r\n                this.to = this.attribute('to');\r\n                this.values = this.attribute('values');\r\n                if (this.values.hasValue()) this.values.value = this.values.value.split(';');\r\n\r\n                // fraction of duration we've covered\r\n                this.progress = function () {\r\n                    var ret = { progress: (this.duration - this.begin) / (this.maxDuration - this.begin) };\r\n                    if (this.values.hasValue()) {\r\n                        var p = ret.progress * (this.values.value.length - 1);\r\n                        var lb = Math.floor(p),\r\n                            ub = Math.ceil(p);\r\n                        ret.from = new svg.Property('from', parseFloat(this.values.value[lb]));\r\n                        ret.to = new svg.Property('to', parseFloat(this.values.value[ub]));\r\n                        ret.progress = (p - lb) / (ub - lb);\r\n                    } else {\r\n                        ret.from = this.from;\r\n                        ret.to = this.to;\r\n                    }\r\n                    return ret;\r\n                };\r\n            };\r\n            svg.Element.AnimateBase.prototype = new svg.Element.ElementBase;\r\n\r\n            // animate element\r\n            svg.Element.animate = function (node) {\r\n                this.base = svg.Element.AnimateBase;\r\n                this.base(node);\r\n\r\n                this.calcValue = function () {\r\n                    var p = this.progress();\r\n\r\n                    // tween value linearly\r\n                    var newValue = p.from.numValue() + (p.to.numValue() - p.from.numValue()) * p.progress;\r\n                    return newValue + this.initialUnits;\r\n                };\r\n            };\r\n            svg.Element.animate.prototype = new svg.Element.AnimateBase;\r\n\r\n            // animate color element\r\n            svg.Element.animateColor = function (node) {\r\n                this.base = svg.Element.AnimateBase;\r\n                this.base(node);\r\n\r\n                this.calcValue = function () {\r\n                    var p = this.progress();\r\n                    var from = new rgbcolor(p.from.value);\r\n                    var to = new rgbcolor(p.to.value);\r\n\r\n                    if (from.ok && to.ok) {\r\n                        // tween color linearly\r\n                        var r = from.r + (to.r - from.r) * p.progress;\r\n                        var g = from.g + (to.g - from.g) * p.progress;\r\n                        var b = from.b + (to.b - from.b) * p.progress;\r\n                        return 'rgb(' + parseInt(r, 10) + ',' + parseInt(g, 10) + ',' + parseInt(b, 10) + ')';\r\n                    }\r\n                    return this.attribute('from').value;\r\n                };\r\n            };\r\n            svg.Element.animateColor.prototype = new svg.Element.AnimateBase;\r\n\r\n            // animate transform element\r\n            svg.Element.animateTransform = function (node) {\r\n                this.base = svg.Element.AnimateBase;\r\n                this.base(node);\r\n\r\n                this.calcValue = function () {\r\n                    var p = this.progress();\r\n\r\n                    // tween value linearly\r\n                    var from = svg.ToNumberArray(p.from.value);\r\n                    var to = svg.ToNumberArray(p.to.value);\r\n                    var newValue = '';\r\n                    for (var i = 0; i < from.length; i++) {\r\n                        newValue += from[i] + (to[i] - from[i]) * p.progress + ' ';\r\n                    }\r\n                    return newValue;\r\n                };\r\n            };\r\n            svg.Element.animateTransform.prototype = new svg.Element.animate;\r\n\r\n            // font element\r\n            svg.Element.font = function (node) {\r\n                this.base = svg.Element.ElementBase;\r\n                this.base(node);\r\n\r\n                this.horizAdvX = this.attribute('horiz-adv-x').numValue();\r\n\r\n                this.isRTL = false;\r\n                this.isArabic = false;\r\n                this.fontFace = null;\r\n                this.missingGlyph = null;\r\n                this.glyphs = [];\r\n                for (var i = 0; i < this.children.length; i++) {\r\n                    var child = this.children[i];\r\n                    if (child.type == 'font-face') {\r\n                        this.fontFace = child;\r\n                        if (child.style('font-family').hasValue()) {\r\n                            svg.Definitions[child.style('font-family').value] = this;\r\n                        }\r\n                    } else if (child.type == 'missing-glyph') this.missingGlyph = child;\r\n                    else if (child.type == 'glyph') {\r\n                        if (child.arabicForm != '') {\r\n                            this.isRTL = true;\r\n                            this.isArabic = true;\r\n                            if (typeof this.glyphs[child.unicode] == 'undefined') this.glyphs[child.unicode] = [];\r\n                            this.glyphs[child.unicode][child.arabicForm] = child;\r\n                        } else {\r\n                            this.glyphs[child.unicode] = child;\r\n                        }\r\n                    }\r\n                }\r\n\r\n                this.render = function(/* ctx */) {\r\n                    // NO RENDER\r\n                };\r\n            };\r\n            svg.Element.font.prototype = new svg.Element.ElementBase;\r\n\r\n            // font-face element\r\n            svg.Element.fontface = function (node) {\r\n                this.base = svg.Element.ElementBase;\r\n                this.base(node);\r\n\r\n                this.ascent = this.attribute('ascent').value;\r\n                this.descent = this.attribute('descent').value;\r\n                this.unitsPerEm = this.attribute('units-per-em').numValue();\r\n            };\r\n            svg.Element.fontface.prototype = new svg.Element.ElementBase;\r\n\r\n            // missing-glyph element\r\n            svg.Element.missingglyph = function (node) {\r\n                this.base = svg.Element.path;\r\n                this.base(node);\r\n\r\n                this.horizAdvX = 0;\r\n            };\r\n            svg.Element.missingglyph.prototype = new svg.Element.path;\r\n\r\n            // glyph element\r\n            svg.Element.glyph = function (node) {\r\n                this.base = svg.Element.path;\r\n                this.base(node);\r\n\r\n                this.horizAdvX = this.attribute('horiz-adv-x').numValue();\r\n                this.unicode = this.attribute('unicode').value;\r\n                this.arabicForm = this.attribute('arabic-form').value;\r\n            };\r\n            svg.Element.glyph.prototype = new svg.Element.path;\r\n\r\n            // text element\r\n            svg.Element.text = function (node) {\r\n                this.captureTextNodes = true;\r\n                this.base = svg.Element.RenderedElementBase;\r\n                this.base(node);\r\n\r\n                this.baseSetContext = this.setContext;\r\n                this.setContext = function (ctx) {\r\n                    this.baseSetContext(ctx);\r\n\r\n                    var textBaseline = this.style('dominant-baseline').toTextBaseline();\r\n                    if (textBaseline == null) textBaseline = this.style('alignment-baseline').toTextBaseline();\r\n                    if (textBaseline != null) ctx.textBaseline = textBaseline;\r\n                };\r\n\r\n                this.initializeCoordinates = function (ctx) {\r\n                    this.x = this.attribute('x').toPixels('x');\r\n                    this.y = this.attribute('y').toPixels('y');\r\n                    if (this.attribute('dx').hasValue()) this.x += this.attribute('dx').toPixels('x');\r\n                    if (this.attribute('dy').hasValue()) this.y += this.attribute('dy').toPixels('y');\r\n                    this.x += this.getAnchorDelta(ctx, this, 0);\r\n                };\r\n\r\n                this.getBoundingBox = function (ctx) {\r\n                    this.initializeCoordinates(ctx);\r\n                    var bb = null;\r\n                    for (var i = 0; i < this.children.length; i++) {\r\n                        var childBB = this.getChildBoundingBox(ctx, this, this, i);\r\n                        if (bb == null) bb = childBB;\r\n                        else bb.addBoundingBox(childBB);\r\n                    }\r\n                    return bb;\r\n                };\r\n\r\n                this.renderChildren = function (ctx) {\r\n                    this.initializeCoordinates(ctx);\r\n                    for (var i = 0; i < this.children.length; i++) {\r\n                        this.renderChild(ctx, this, this, i);\r\n                    }\r\n                };\r\n\r\n                this.getAnchorDelta = function (ctx, parent, startI) {\r\n                    var textAnchor = this.style('text-anchor').valueOrDefault('start');\r\n                    if (textAnchor != 'start') {\r\n                        var width = 0;\r\n                        for (var i = startI; i < parent.children.length; i++) {\r\n                            var child = parent.children[i];\r\n                            if (i > startI && child.attribute('x').hasValue()) break; // new group\r\n                            width += child.measureTextRecursive(ctx);\r\n                        }\r\n                        return -1 * (textAnchor == 'end' ? width : width / 2.0);\r\n                    }\r\n                    return 0;\r\n                };\r\n\r\n                this.adjustChildCoordinates = function(ctx, textParent, parent, i) {\r\n                    var child = parent.children[i];\r\n\r\n                    if (child.attribute('x').hasValue()) {\r\n                        child.x = child.attribute('x').toPixels('x') + textParent.getAnchorDelta(ctx, parent, i);\r\n                        if (child.attribute('dx').hasValue()) child.x += child.attribute('dx').toPixels('x');\r\n                    } else {\r\n                        if (child.attribute('dx').hasValue()) textParent.x += child.attribute('dx').toPixels('x');\r\n                        child.x = textParent.x;\r\n                    }\r\n                    textParent.x = child.x + child.measureText(ctx);\r\n\r\n                    if (child.attribute('y').hasValue()) {\r\n                        child.y = child.attribute('y').toPixels('y');\r\n                        if (child.attribute('dy').hasValue()) child.y += child.attribute('dy').toPixels('y');\r\n                    } else {\r\n                        if (child.attribute('dy').hasValue()) textParent.y += child.attribute('dy').toPixels('y');\r\n                        child.y = textParent.y;\r\n                    }\r\n                    textParent.y = child.y;\r\n\r\n                    return child;\r\n                };\r\n\r\n                this.getChildBoundingBox = function (ctx, textParent, parent, i) {\r\n                    var child = this.adjustChildCoordinates(ctx, textParent, parent, i);\r\n                    var bb = child.getBoundingBox(ctx);\r\n\r\n                    for (var i = 0; i < child.children.length; i++) {\r\n                        var childBB = textParent.getChildBoundingBox(ctx, textParent, child, i);\r\n                        bb.addBoundingBox(childBB);\r\n                    }\r\n\r\n                    return bb;\r\n                };\r\n\r\n                this.renderChild = function (ctx, textParent, parent, i) {\r\n                    var child = this.adjustChildCoordinates(ctx, textParent, parent, i);\r\n                    child.render(ctx);\r\n\r\n                    for (var i = 0; i < child.children.length; i++) {\r\n                        textParent.renderChild(ctx, textParent, child, i);\r\n                    }\r\n                };\r\n            };\r\n            svg.Element.text.prototype = new svg.Element.RenderedElementBase;\r\n\r\n            // text base\r\n            svg.Element.TextElementBase = function (node) {\r\n                this.base = svg.Element.RenderedElementBase;\r\n                this.base(node);\r\n\r\n                this.getGlyph = function (font, text, i) {\r\n                    var c = text[i];\r\n                    var glyph = null;\r\n                    if (font.isArabic) {\r\n                        var arabicForm = 'isolated';\r\n                        if ((i == 0 || text[i - 1] == ' ') && i < text.length - 2 && text[i + 1] != ' ') arabicForm = 'terminal';\r\n                        if (i > 0 && text[i - 1] != ' ' && i < text.length - 2 && text[i + 1] != ' ') arabicForm = 'medial';\r\n                        if (i > 0 && text[i - 1] != ' ' && (i == text.length - 1 || text[i + 1] == ' ')) arabicForm = 'initial';\r\n                        if (typeof font.glyphs[c] != 'undefined') {\r\n                            glyph = font.glyphs[c][arabicForm];\r\n                            if (glyph == null && font.glyphs[c].type == 'glyph') glyph = font.glyphs[c];\r\n                        }\r\n                    } else {\r\n                        glyph = font.glyphs[c];\r\n                    }\r\n                    if (glyph == null) glyph = font.missingGlyph;\r\n                    return glyph;\r\n                };\r\n\r\n                this.renderChildren = function (ctx) {\r\n                    var customFont = this.parent.style('font-family').getDefinition();\r\n                    if (customFont != null) {\r\n                        var fontSize = this.parent.style('font-size').numValueOrDefault(svg.Font.Parse(svg.ctx.font).fontSize);\r\n                        var fontStyle = this.parent.style('font-style').valueOrDefault(svg.Font.Parse(svg.ctx.font).fontStyle);\r\n                        var text = this.getText();\r\n                        if (customFont.isRTL) text = text.split('').reverse().join('');\r\n\r\n                        var dx = svg.ToNumberArray(this.parent.attribute('dx').value);\r\n                        for (var i = 0; i < text.length; i++) {\r\n                            var glyph = this.getGlyph(customFont, text, i);\r\n                            var scale = fontSize / customFont.fontFace.unitsPerEm;\r\n                            ctx.translate(this.x, this.y);\r\n                            ctx.scale(scale, -scale);\r\n                            var lw = ctx.lineWidth;\r\n                            ctx.lineWidth = ctx.lineWidth * customFont.fontFace.unitsPerEm / fontSize;\r\n                            if (fontStyle == 'italic') ctx.transform(1, 0, .4, 1, 0, 0);\r\n                            glyph.render(ctx);\r\n                            if (fontStyle == 'italic') ctx.transform(1, 0, -.4, 1, 0, 0);\r\n                            ctx.lineWidth = lw;\r\n                            ctx.scale(1 / scale, -1 / scale);\r\n                            ctx.translate(-this.x, -this.y);\r\n\r\n                            this.x += fontSize * (glyph.horizAdvX || customFont.horizAdvX) / customFont.fontFace.unitsPerEm;\r\n                            if (typeof dx[i] != 'undefined' && !isNaN(dx[i])) {\r\n                                this.x += dx[i];\r\n                            }\r\n                        }\r\n                        return;\r\n                    }\r\n                    if (ctx.paintOrder == 'stroke') {\r\n                        if (ctx.strokeStyle != '') ctx.strokeText(svg.compressSpaces(this.getText()), this.x, this.y);\r\n                        if (ctx.fillStyle != '') ctx.fillText(svg.compressSpaces(this.getText()), this.x, this.y);\r\n                    } else {\r\n                        if (ctx.fillStyle != '') ctx.fillText(svg.compressSpaces(this.getText()), this.x, this.y);\r\n                        if (ctx.strokeStyle != '') ctx.strokeText(svg.compressSpaces(this.getText()), this.x, this.y);\r\n                    }\r\n                };\r\n\r\n                this.getText = function () {\r\n                    // OVERRIDE ME\r\n                };\r\n\r\n                this.measureTextRecursive = function (ctx) {\r\n                    var width = this.measureText(ctx);\r\n                    for (var i = 0; i < this.children.length; i++) {\r\n                        width += this.children[i].measureTextRecursive(ctx);\r\n                    }\r\n                    return width;\r\n                };\r\n\r\n                this.measureText = function (ctx) {\r\n                    var customFont = this.parent.style('font-family').getDefinition();\r\n                    if (customFont != null) {\r\n                        var fontSize = this.parent.style('font-size').numValueOrDefault(svg.Font.Parse(svg.ctx.font).fontSize);\r\n                        var measure = 0;\r\n                        var text = this.getText();\r\n                        if (customFont.isRTL) text = text.split('').reverse().join('');\r\n                        var dx = svg.ToNumberArray(this.parent.attribute('dx').value);\r\n                        for (var i = 0; i < text.length; i++) {\r\n                            var glyph = this.getGlyph(customFont, text, i);\r\n                            measure += (glyph.horizAdvX || customFont.horizAdvX) * fontSize / customFont.fontFace.unitsPerEm;\r\n                            if (typeof dx[i] != 'undefined' && !isNaN(dx[i])) {\r\n                                measure += dx[i];\r\n                            }\r\n                        }\r\n                        return measure;\r\n                    }\r\n\r\n                    var textToMeasure = svg.compressSpaces(this.getText());\r\n                    if (!ctx.measureText) return textToMeasure.length * 10;\r\n\r\n                    ctx.save();\r\n                    this.setContext(ctx, true);\r\n                    var width = ctx.measureText(textToMeasure).width;\r\n                    ctx.restore();\r\n                    return width;\r\n                };\r\n\r\n                this.getBoundingBox = function (ctx) {\r\n                    var fontSize = this.parent.style('font-size').numValueOrDefault(svg.Font.Parse(svg.ctx.font).fontSize);\r\n                    return new svg.BoundingBox(this.x, this.y - fontSize, this.x + this.measureText(ctx), this.y);\r\n                };\r\n            };\r\n            svg.Element.TextElementBase.prototype = new svg.Element.RenderedElementBase;\r\n\r\n            // tspan\r\n            svg.Element.tspan = function (node) {\r\n                this.captureTextNodes = true;\r\n                this.base = svg.Element.TextElementBase;\r\n                this.base(node);\r\n\r\n                this.text = svg.compressSpaces(node.value || node.text || node.textContent || '');\r\n                this.getText = function () {\r\n                    // if this node has children, then they own the text\r\n                    if (this.children.length > 0) { return ''; }\r\n                    return this.text;\r\n                };\r\n            };\r\n            svg.Element.tspan.prototype = new svg.Element.TextElementBase;\r\n\r\n            // tref\r\n            svg.Element.tref = function (node) {\r\n                this.base = svg.Element.TextElementBase;\r\n                this.base(node);\r\n\r\n                this.getText = function () {\r\n                    var element = this.getHrefAttribute().getDefinition();\r\n                    if (element != null) return element.children[0].getText();\r\n                };\r\n            };\r\n            svg.Element.tref.prototype = new svg.Element.TextElementBase;\r\n\r\n            // a element\r\n            svg.Element.a = function (node) {\r\n                this.base = svg.Element.TextElementBase;\r\n                this.base(node);\r\n\r\n                this.hasText = node.childNodes.length > 0;\r\n                for (var i = 0; i < node.childNodes.length; i++) {\r\n                    if (node.childNodes[i].nodeType != 3) this.hasText = false;\r\n                }\r\n\r\n                // this might contain text\r\n                this.text = this.hasText ? node.childNodes[0].value || node.childNodes[0].data : '';\r\n                this.getText = function () {\r\n                    return this.text;\r\n                };\r\n\r\n                this.baseRenderChildren = this.renderChildren;\r\n                this.renderChildren = function (ctx) {\r\n                    if (this.hasText) {\r\n                        // render as text element\r\n                        this.baseRenderChildren(ctx);\r\n                        var fontSize = new svg.Property('fontSize', svg.Font.Parse(svg.ctx.font).fontSize);\r\n                        svg.Mouse.checkBoundingBox(this, new svg.BoundingBox(this.x, this.y - fontSize.toPixels('y'), this.x + this.measureText(ctx), this.y));\r\n                    } else if (this.children.length > 0) {\r\n                        // render as temporary group\r\n                        var g = new svg.Element.g();\r\n                        g.children = this.children;\r\n                        g.parent = this;\r\n                        g.render(ctx);\r\n                    }\r\n                };\r\n\r\n                this.onclick = function () {\r\n                    windowEnv.open(this.getHrefAttribute().value);\r\n                };\r\n\r\n                this.onmousemove = function () {\r\n                    svg.ctx.canvas.style.cursor = 'pointer';\r\n                };\r\n            };\r\n            svg.Element.a.prototype = new svg.Element.TextElementBase;\r\n\r\n            // image element\r\n            svg.Element.image = function (node) {\r\n                this.base = svg.Element.RenderedElementBase;\r\n                this.base(node);\r\n\r\n                var href = this.getHrefAttribute().value;\r\n                if (href == '') { return; }\r\n                var isSvg = href.match(/\\.svg$/);\r\n\r\n                svg.Images.push(this);\r\n                this.loaded = false;\r\n                if (!isSvg) {\r\n                    this.img = doc.createElement('img');\r\n                    if (svg.opts['useCORS'] == true) { this.img.crossOrigin = 'Anonymous'; }\r\n                    var self = this;\r\n                    this.img.onload = function () { self.loaded = true; };\r\n                    this.img.onerror = function () {\r\n                        svg.log('ERROR: image \"' + href + '\" not found');\r\n                        self.loaded = true;\r\n                    };\r\n                    this.img.src = href;\r\n                } else {\r\n                    this.img = svg.ajax(href);\r\n                    this.loaded = true;\r\n                }\r\n\r\n                this.renderChildren = function (ctx) {\r\n                    var x = this.attribute('x').toPixels('x');\r\n                    var y = this.attribute('y').toPixels('y');\r\n\r\n                    var width = this.attribute('width').toPixels('x');\r\n                    var height = this.attribute('height').toPixels('y');\r\n                    if (width == 0 || height == 0) return;\r\n\r\n                    ctx.save();\r\n                    if (isSvg) {\r\n                        ctx.drawSvg(this.img, x, y, width, height);\r\n                    } else {\r\n                        ctx.translate(x, y);\r\n                        svg.AspectRatio(ctx,\r\n                            this.attribute('preserveAspectRatio').value,\r\n                            width,\r\n                            this.img.width,\r\n                            height,\r\n                            this.img.height,\r\n                            0,\r\n                            0);\r\n                        if (self.loaded) {\r\n                            if (this.img.complete === undefined || this.img.complete) {\r\n                                ctx.drawImage(this.img, 0, 0);\r\n                            }\r\n                        }\r\n                    }\r\n                    ctx.restore();\r\n                };\r\n\r\n                this.getBoundingBox = function () {\r\n                    var x = this.attribute('x').toPixels('x');\r\n                    var y = this.attribute('y').toPixels('y');\r\n                    var width = this.attribute('width').toPixels('x');\r\n                    var height = this.attribute('height').toPixels('y');\r\n                    return new svg.BoundingBox(x, y, x + width, y + height);\r\n                };\r\n            };\r\n            svg.Element.image.prototype = new svg.Element.RenderedElementBase;\r\n\r\n            // group element\r\n            svg.Element.g = function (node) {\r\n                this.base = svg.Element.RenderedElementBase;\r\n                this.base(node);\r\n\r\n                this.getBoundingBox = function (ctx) {\r\n                    var bb = new svg.BoundingBox();\r\n                    for (var i = 0; i < this.children.length; i++) {\r\n                        bb.addBoundingBox(this.children[i].getBoundingBox(ctx));\r\n                    }\r\n                    return bb;\r\n                };\r\n            };\r\n            svg.Element.g.prototype = new svg.Element.RenderedElementBase;\r\n\r\n            // symbol element\r\n            svg.Element.symbol = function (node) {\r\n                this.base = svg.Element.RenderedElementBase;\r\n                this.base(node);\r\n\r\n                this.render = function (/* ctx */) {\r\n                    // NO RENDER\r\n                };\r\n            };\r\n            svg.Element.symbol.prototype = new svg.Element.RenderedElementBase;\r\n\r\n            // style element\r\n            svg.Element.style = function (node) {\r\n                this.base = svg.Element.ElementBase;\r\n                this.base(node);\r\n\r\n                // text, or spaces then CDATA\r\n                var css = '';\r\n                for (var i = 0; i < node.childNodes.length; i++) {\r\n                    css += node.childNodes[i].data;\r\n                }\r\n                css = css.replace(/(\\/\\*([^*]|[\\r\\n]|(\\*+([^*\\/]|[\\r\\n])))*\\*+\\/)|(^[\\s]*\\/\\/.*)/gm, ''); // remove comments\r\n                css = svg.compressSpaces(css); // replace whitespace\r\n                var cssDefs = css.split('}');\r\n                for (var i = 0; i < cssDefs.length; i++) {\r\n                    if (svg.trim(cssDefs[i]) != '') {\r\n                        var cssDef = cssDefs[i].split('{');\r\n                        var cssClasses = cssDef[0].split(',');\r\n                        var cssProps = cssDef[1].split(';');\r\n                        for (var j = 0; j < cssClasses.length; j++) {\r\n                            var cssClass = svg.trim(cssClasses[j]);\r\n                            if (cssClass != '') {\r\n                                var props = svg.Styles[cssClass] || {};\r\n                                for (var k = 0; k < cssProps.length; k++) {\r\n                                    var prop = cssProps[k].indexOf(':');\r\n                                    var name = cssProps[k].substr(0, prop);\r\n                                    var value = cssProps[k].substr(prop + 1, cssProps[k].length - prop);\r\n                                    if (name != null && value != null) {\r\n                                        props[svg.trim(name)] = new svg.Property(svg.trim(name), svg.trim(value));\r\n                                    }\r\n                                }\r\n                                svg.Styles[cssClass] = props;\r\n                                svg.StylesSpecificity[cssClass] = getSelectorSpecificity(cssClass);\r\n                                if (cssClass == '@font-face' && !nodeEnv) {\r\n                                    var fontFamily = props['font-family'].value.replace(/\"/g, '');\r\n                                    var srcs = props['src'].value.split(',');\r\n                                    for (var s = 0; s < srcs.length; s++) {\r\n                                        if (srcs[s].indexOf('format(\"svg\")') > 0) {\r\n                                            var urlStart = srcs[s].indexOf('url');\r\n                                            var urlEnd = srcs[s].indexOf(')', urlStart);\r\n                                            var url = srcs[s].substr(urlStart + 5, urlEnd - urlStart - 6);\r\n                                            var doc = svg.parseXml(svg.ajax(url));\r\n                                            var fonts = doc.getElementsByTagName('font');\r\n                                            for (var f = 0; f < fonts.length; f++) {\r\n                                                var font = svg.CreateElement(fonts[f]);\r\n                                                svg.Definitions[fontFamily] = font;\r\n                                            }\r\n                                        }\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            };\r\n            svg.Element.style.prototype = new svg.Element.ElementBase;\r\n\r\n            // use element\r\n            svg.Element.use = function (node) {\r\n                this.base = svg.Element.RenderedElementBase;\r\n                this.base(node);\r\n\r\n                this.baseSetContext = this.setContext;\r\n                this.setContext = function (ctx) {\r\n                    this.baseSetContext(ctx);\r\n                    if (this.attribute('x').hasValue()) ctx.translate(this.attribute('x').toPixels('x'), 0);\r\n                    if (this.attribute('y').hasValue()) ctx.translate(0, this.attribute('y').toPixels('y'));\r\n                };\r\n\r\n                var element = this.getHrefAttribute().getDefinition();\r\n\r\n                this.path = function (ctx) {\r\n                    if (element != null) element.path(ctx);\r\n                };\r\n\r\n                this.elementTransform = function () {\r\n                    if (element != null && element.style('transform', false, true).hasValue()) {\r\n                        return new svg.Transform(element.style('transform', false, true).value);\r\n                    }\r\n                };\r\n\r\n                this.getBoundingBox = function (ctx) {\r\n                    if (element != null) return element.getBoundingBox(ctx);\r\n                };\r\n\r\n                this.renderChildren = function (ctx) {\r\n                    if (element != null) {\r\n                        var tempSvg = element;\r\n                        if (element.type == 'symbol') {\r\n                            // render me using a temporary svg element in symbol cases (http://www.w3.org/TR/SVG/struct.html#UseElement)\r\n                            tempSvg = new svg.Element.svg();\r\n                            tempSvg.type = 'svg';\r\n                            tempSvg.attributes['viewBox'] = new svg.Property('viewBox', element.attribute('viewBox').value);\r\n                            tempSvg.attributes['preserveAspectRatio'] = new svg.Property('preserveAspectRatio', element.attribute('preserveAspectRatio').value);\r\n                            tempSvg.attributes['overflow'] = new svg.Property('overflow', element.attribute('overflow').value);\r\n                            tempSvg.children = element.children;\r\n                        }\r\n                        if (tempSvg.type == 'svg') {\r\n                            // if symbol or svg, inherit width/height from me\r\n                            if (this.attribute('width').hasValue()) tempSvg.attributes['width'] = new svg.Property('width', this.attribute('width').value);\r\n                            if (this.attribute('height').hasValue()) tempSvg.attributes['height'] = new svg.Property('height', this.attribute('height').value);\r\n                        }\r\n                        var oldParent = tempSvg.parent;\r\n                        tempSvg.parent = null;\r\n                        tempSvg.render(ctx);\r\n                        tempSvg.parent = oldParent;\r\n                    }\r\n                };\r\n            };\r\n            svg.Element.use.prototype = new svg.Element.RenderedElementBase;\r\n\r\n            // mask element\r\n            svg.Element.mask = function (node) {\r\n                this.base = svg.Element.ElementBase;\r\n                this.base(node);\r\n\r\n                this.apply = function (ctx, element) {\r\n                    // render as temp svg\r\n                    var x = this.attribute('x').toPixels('x');\r\n                    var y = this.attribute('y').toPixels('y');\r\n                    var width = this.attribute('width').toPixels('x');\r\n                    var height = this.attribute('height').toPixels('y');\r\n\r\n                    if (width == 0 && height == 0) {\r\n                        var bb = new svg.BoundingBox();\r\n                        for (var i = 0; i < this.children.length; i++) {\r\n                            bb.addBoundingBox(this.children[i].getBoundingBox(ctx));\r\n                        }\r\n                        var x = Math.floor(bb.x1);\r\n                        var y = Math.floor(bb.y1);\r\n                        var width = Math.floor(bb.width());\r\n                        var height = Math.floor(bb.height());\r\n                    }\r\n\r\n                    // temporarily remove mask to avoid recursion\r\n                    var mask = element.style('mask').value;\r\n                    element.style('mask').value = '';\r\n\r\n                    var cMask = createCanvas(x + width, y + height);\r\n                    var maskCtx = cMask.getContext('2d');\r\n                    this.renderChildren(maskCtx);\r\n\r\n                    var c = createCanvas(x + width, y + height);\r\n                    var tempCtx = c.getContext('2d');\r\n                    element.render(tempCtx);\r\n                    tempCtx.globalCompositeOperation = 'destination-in';\r\n                    tempCtx.fillStyle = maskCtx.createPattern(cMask, 'no-repeat');\r\n                    tempCtx.fillRect(0, 0, x + width, y + height);\r\n\r\n                    ctx.fillStyle = tempCtx.createPattern(c, 'no-repeat');\r\n                    ctx.fillRect(0, 0, x + width, y + height);\r\n\r\n                    // reassign mask\r\n                    element.style('mask').value = mask;\r\n                };\r\n\r\n                this.render = function (/* ctx */) {\r\n                    // NO RENDER\r\n                };\r\n            };\r\n            svg.Element.mask.prototype = new svg.Element.ElementBase;\r\n\r\n            // clip element\r\n            svg.Element.clipPath = function (node) {\r\n                this.base = svg.Element.ElementBase;\r\n                this.base(node);\r\n\r\n                this.apply = function (ctx) {\r\n                    var hasContext2D = (typeof CanvasRenderingContext2D !== 'undefined');\r\n                    var oldBeginPath = ctx.beginPath;\r\n                    var oldClosePath = ctx.closePath;\r\n                    if (hasContext2D) {\r\n                        CanvasRenderingContext2D.prototype.beginPath = function () { };\r\n                        CanvasRenderingContext2D.prototype.closePath = function () { };\r\n                    }\r\n\r\n                    oldBeginPath.call(ctx);\r\n                    for (var i = 0; i < this.children.length; i++) {\r\n                        var child = this.children[i];\r\n                        if (typeof child.path != 'undefined') {\r\n                            var transform = typeof child.elementTransform != 'undefined' && child.elementTransform(); // handle <use />\r\n                            if (!transform && child.style('transform', false, true).hasValue()) {\r\n                                transform = new svg.Transform(child.style('transform', false, true).value);\r\n                            }\r\n                            if (transform) {\r\n                                transform.apply(ctx);\r\n                            }\r\n                            child.path(ctx);\r\n                            if (hasContext2D) {\r\n                                CanvasRenderingContext2D.prototype.closePath = oldClosePath;\r\n                            }\r\n                            if (transform) { transform.unapply(ctx); }\r\n                        }\r\n                    }\r\n                    oldClosePath.call(ctx);\r\n                    ctx.clip();\r\n                    if (hasContext2D) {\r\n                        CanvasRenderingContext2D.prototype.beginPath = oldBeginPath;\r\n                        CanvasRenderingContext2D.prototype.closePath = oldClosePath;\r\n                    }\r\n                };\r\n\r\n                this.render = function (/* ctx */) {\r\n                    // NO RENDER\r\n                };\r\n            };\r\n            svg.Element.clipPath.prototype = new svg.Element.ElementBase;\r\n\r\n            // filters\r\n            svg.Element.filter = function (node) {\r\n                this.base = svg.Element.ElementBase;\r\n                this.base(node);\r\n\r\n                this.apply = function (ctx, element) {\r\n                    // render as temp svg\r\n                    var bb = element.getBoundingBox(ctx);\r\n                    var x = Math.floor(bb.x1);\r\n                    var y = Math.floor(bb.y1);\r\n                    var width = Math.floor(bb.width());\r\n                    var height = Math.floor(bb.height());\r\n\r\n                    // temporarily remove filter to avoid recursion\r\n                    var filter = element.style('filter').value;\r\n                    element.style('filter').value = '';\r\n\r\n                    var px = 0,\r\n                        py = 0;\r\n                    for (var i = 0; i < this.children.length; i++) {\r\n                        var efd = this.children[i].extraFilterDistance || 0;\r\n                        px = Math.max(px, efd);\r\n                        py = Math.max(py, efd);\r\n                    }\r\n\r\n                    var c = createCanvas(width + 2 * px, height + 2 * py);\r\n                    var tempCtx = c.getContext('2d');\r\n                    tempCtx.translate(-x + px, -y + py);\r\n                    element.render(tempCtx);\r\n\r\n                    // apply filters\r\n                    for (var i = 0; i < this.children.length; i++) {\r\n                        if (typeof this.children[i].apply == 'function') {\r\n                            this.children[i].apply(tempCtx, 0, 0, width + 2 * px, height + 2 * py);\r\n                        }\r\n                    }\r\n\r\n                    // render on me\r\n                    ctx.drawImage(c, 0, 0, width + 2 * px, height + 2 * py, x - px, y - py, width + 2 * px, height + 2 * py);\r\n\r\n                    // reassign filter\r\n                    element.style('filter', true).value = filter;\r\n                };\r\n\r\n                this.render = function (/* ctx */) {\r\n                    // NO RENDER\r\n                };\r\n            };\r\n            svg.Element.filter.prototype = new svg.Element.ElementBase;\r\n\r\n            svg.Element.feDropShadow = function (node) {\r\n                this.base = svg.Element.ElementBase;\r\n                this.base(node);\r\n                this.addStylesFromStyleDefinition();\r\n\r\n                this.apply = function (/* ctx, x, y, width, height */) {\r\n                    // TODO: implement\r\n                };\r\n            };\r\n            svg.Element.feDropShadow.prototype = new svg.Element.ElementBase;\r\n\r\n            svg.Element.feMorphology = function (node) {\r\n                this.base = svg.Element.ElementBase;\r\n                this.base(node);\r\n\r\n                this.apply = function (/* ctx, x, y, width, height */) {\r\n                    // TODO: implement\r\n                };\r\n            };\r\n            svg.Element.feMorphology.prototype = new svg.Element.ElementBase;\r\n\r\n            svg.Element.feComposite = function (node) {\r\n                this.base = svg.Element.ElementBase;\r\n                this.base(node);\r\n\r\n                this.apply = function (/* ctx, x, y, width, height */) {\r\n                    // TODO: implement\r\n                };\r\n            };\r\n            svg.Element.feComposite.prototype = new svg.Element.ElementBase;\r\n\r\n            svg.Element.feColorMatrix = function (node) {\r\n                this.base = svg.Element.ElementBase;\r\n                this.base(node);\r\n\r\n                var matrix = svg.ToNumberArray(this.attribute('values').value);\r\n                switch (this.attribute('type').valueOrDefault('matrix')) { // http://www.w3.org/TR/SVG/filters.html#feColorMatrixElement\r\n                    case 'saturate':\r\n                        var s = matrix[0];\r\n                        matrix = [0.213 + 0.787 * s, 0.715 - 0.715 * s, 0.072 - 0.072 * s, 0, 0,\r\n                            0.213 - 0.213 * s, 0.715 + 0.285 * s, 0.072 - 0.072 * s, 0, 0,\r\n                            0.213 - 0.213 * s, 0.715 - 0.715 * s, 0.072 + 0.928 * s, 0, 0,\r\n                            0, 0, 0, 1, 0,\r\n                            0, 0, 0, 0, 1\r\n                        ];\r\n                        break;\r\n                    case 'hueRotate':\r\n                        var a = matrix[0] * Math.PI / 180.0;\r\n                        var c = function (m1, m2, m3) { return m1 + Math.cos(a) * m2 + Math.sin(a) * m3; };\r\n                        matrix = [c(0.213, 0.787, -0.213), c(0.715, -0.715, -0.715), c(0.072, -0.072, 0.928), 0, 0,\r\n                            c(0.213, -0.213, 0.143), c(0.715, 0.285, 0.140), c(0.072, -0.072, -0.283), 0, 0,\r\n                            c(0.213, -0.213, -0.787), c(0.715, -0.715, 0.715), c(0.072, 0.928, 0.072), 0, 0,\r\n                            0, 0, 0, 1, 0,\r\n                            0, 0, 0, 0, 1\r\n                        ];\r\n                        break;\r\n                    case 'luminanceToAlpha':\r\n                        matrix = [0, 0, 0, 0, 0,\r\n                            0, 0, 0, 0, 0,\r\n                            0, 0, 0, 0, 0,\r\n                            0.2125, 0.7154, 0.0721, 0, 0,\r\n                            0, 0, 0, 0, 1\r\n                        ];\r\n                        break;\r\n                }\r\n\r\n                function imGet(img, x, y, width, height, rgba) {\r\n                    return img[y * width * 4 + x * 4 + rgba];\r\n                }\r\n\r\n                function imSet(img, x, y, width, height, rgba, val) {\r\n                    img[y * width * 4 + x * 4 + rgba] = val;\r\n                }\r\n\r\n                function m(i, v) {\r\n                    var mi = matrix[i];\r\n                    return mi * (mi < 0 ? v - 255 : v);\r\n                }\r\n\r\n                this.apply = function (ctx, x, y, width, height) {\r\n                    // assuming x==0 && y==0 for now\r\n                    var srcData = ctx.getImageData(0, 0, width, height);\r\n                    for (var y = 0; y < height; y++) {\r\n                        for (var x = 0; x < width; x++) {\r\n                            var r = imGet(srcData.data, x, y, width, height, 0);\r\n                            var g = imGet(srcData.data, x, y, width, height, 1);\r\n                            var b = imGet(srcData.data, x, y, width, height, 2);\r\n                            var a = imGet(srcData.data, x, y, width, height, 3);\r\n                            imSet(srcData.data, x, y, width, height, 0, m(0, r) + m(1, g) + m(2, b) + m(3, a) + m(4, 1));\r\n                            imSet(srcData.data, x, y, width, height, 1, m(5, r) + m(6, g) + m(7, b) + m(8, a) + m(9, 1));\r\n                            imSet(srcData.data, x, y, width, height, 2, m(10, r) + m(11, g) + m(12, b) + m(13, a) + m(14, 1));\r\n                            imSet(srcData.data, x, y, width, height, 3, m(15, r) + m(16, g) + m(17, b) + m(18, a) + m(19, 1));\r\n                        }\r\n                    }\r\n                    ctx.clearRect(0, 0, width, height);\r\n                    ctx.putImageData(srcData, 0, 0);\r\n                };\r\n            };\r\n            svg.Element.feColorMatrix.prototype = new svg.Element.ElementBase;\r\n\r\n            svg.Element.feGaussianBlur = function (node) {\r\n                this.base = svg.Element.ElementBase;\r\n                this.base(node);\r\n\r\n                this.blurRadius = Math.floor(this.attribute('stdDeviation').numValue());\r\n                this.extraFilterDistance = this.blurRadius;\r\n\r\n                this.apply = function (ctx, x, y, width, height) {\r\n                    if (!stackblurCanvas || typeof stackblurCanvas.canvasRGBA === 'undefined') {\r\n                        svg.log('ERROR: StackBlur.js must be included for blur to work');\r\n                        return;\r\n                    }\r\n\r\n                    // StackBlur requires canvas be on document\r\n                    ctx.canvas.id = svg.UniqueId();\r\n                    {\r\n                        ctx.canvas.style.display = 'none';\r\n                        doc.body.appendChild(ctx.canvas);\r\n                    }\r\n                    stackblurCanvas.canvasRGBA(ctx.canvas, x, y, width, height, this.blurRadius);\r\n                    {\r\n                        doc.body.removeChild(ctx.canvas);\r\n                    }\r\n                };\r\n            };\r\n            svg.Element.feGaussianBlur.prototype = new svg.Element.ElementBase;\r\n\r\n            // title element, do nothing\r\n            svg.Element.title = function (/* node */) { };\r\n            svg.Element.title.prototype = new svg.Element.ElementBase;\r\n\r\n            // desc element, do nothing\r\n            svg.Element.desc = function (/* node */) { };\r\n            svg.Element.desc.prototype = new svg.Element.ElementBase;\r\n\r\n            svg.Element.MISSING = function (node) {\r\n                svg.log('ERROR: Element \\'' + node.nodeName + '\\' not yet implemented.');\r\n            };\r\n            svg.Element.MISSING.prototype = new svg.Element.ElementBase;\r\n\r\n            // element factory\r\n            svg.CreateElement = function (node) {\r\n                var className = node.nodeName.replace(/^[^:]+:/, ''); // remove namespace\r\n                className = className.replace(/\\-/g, ''); // remove dashes\r\n                var e = null;\r\n                if (typeof svg.Element[className] != 'undefined') {\r\n                    e = new svg.Element[className](node);\r\n                } else {\r\n                    e = new svg.Element.MISSING(node);\r\n                }\r\n\r\n                e.type = node.nodeName;\r\n                return e;\r\n            };\r\n\r\n            // load from url\r\n            svg.load = function (ctx, url) {\r\n                svg.loadXml(ctx, svg.ajax(url));\r\n            };\r\n\r\n            // load from xml\r\n            svg.loadXml = function (ctx, xml) {\r\n                svg.loadXmlDoc(ctx, svg.parseXml(xml));\r\n            };\r\n\r\n            svg.loadXmlDoc = function (ctx, dom) {\r\n                svg.init(ctx);\r\n\r\n                var mapXY = function (p) {\r\n                    var e = ctx.canvas;\r\n                    while (e) {\r\n                        p.x -= e.offsetLeft;\r\n                        p.y -= e.offsetTop;\r\n                        e = e.offsetParent;\r\n                    }\r\n                    if (windowEnv.scrollX) p.x += windowEnv.scrollX;\r\n                    if (windowEnv.scrollY) p.y += windowEnv.scrollY;\r\n                    return p;\r\n                };\r\n\r\n                // bind mouse\r\n                if (svg.opts['ignoreMouse'] != true) {\r\n                    ctx.canvas.onclick = function (e) {\r\n                        var p = mapXY(new svg.Point(e != null ? e.clientX : event.clientX, e != null ? e.clientY : event.clientY));\r\n                        svg.Mouse.onclick(p.x, p.y);\r\n                    };\r\n                    ctx.canvas.onmousemove = function (e) {\r\n                        var p = mapXY(new svg.Point(e != null ? e.clientX : event.clientX, e != null ? e.clientY : event.clientY));\r\n                        svg.Mouse.onmousemove(p.x, p.y);\r\n                    };\r\n                }\r\n\r\n                var e = svg.CreateElement(dom.documentElement);\r\n                e.root = true;\r\n                e.addStylesFromStyleDefinition();\r\n\r\n                // render loop\r\n                var isFirstRender = true;\r\n                var draw = function () {\r\n                    svg.ViewPort.Clear();\r\n                    if (ctx.canvas.parentNode) {\r\n                        svg.ViewPort.SetCurrent(ctx.canvas.parentNode.clientWidth, ctx.canvas.parentNode.clientHeight);\r\n                    } else {\r\n                        svg.ViewPort.SetCurrent(defaultClientWidth, defaultClientHeight);\r\n                    }\r\n\r\n                    if (svg.opts['ignoreDimensions'] != true) {\r\n                        // set canvas size\r\n                        if (e.style('width').hasValue()) {\r\n                            ctx.canvas.width = e.style('width').toPixels('x');\r\n                            if (ctx.canvas.style) { ctx.canvas.style.width = ctx.canvas.width + 'px'; }\r\n                        }\r\n                        if (e.style('height').hasValue()) {\r\n                            ctx.canvas.height = e.style('height').toPixels('y');\r\n                            if (ctx.canvas.style) { ctx.canvas.style.height = ctx.canvas.height + 'px'; }\r\n                        }\r\n                    }\r\n                    var cWidth = ctx.canvas.clientWidth || ctx.canvas.width;\r\n                    var cHeight = ctx.canvas.clientHeight || ctx.canvas.height;\r\n                    if (svg.opts['ignoreDimensions'] == true && e.style('width').hasValue() && e.style('height').hasValue()) {\r\n                        cWidth = e.style('width').toPixels('x');\r\n                        cHeight = e.style('height').toPixels('y');\r\n                    }\r\n                    svg.ViewPort.SetCurrent(cWidth, cHeight);\r\n\r\n                    if (svg.opts['offsetX'] != null) e.attribute('x', true).value = svg.opts['offsetX'];\r\n                    if (svg.opts['offsetY'] != null) e.attribute('y', true).value = svg.opts['offsetY'];\r\n                    if (svg.opts['scaleWidth'] != null || svg.opts['scaleHeight'] != null) {\r\n                        var xRatio = null,\r\n                            yRatio = null,\r\n                            viewBox = svg.ToNumberArray(e.attribute('viewBox').value);\r\n\r\n                        if (svg.opts['scaleWidth'] != null) {\r\n                            if (e.attribute('width').hasValue()) xRatio = e.attribute('width').toPixels('x') / svg.opts['scaleWidth'];\r\n                            else if (!isNaN(viewBox[2])) xRatio = viewBox[2] / svg.opts['scaleWidth'];\r\n                        }\r\n\r\n                        if (svg.opts['scaleHeight'] != null) {\r\n                            if (e.attribute('height').hasValue()) yRatio = e.attribute('height').toPixels('y') / svg.opts['scaleHeight'];\r\n                            else if (!isNaN(viewBox[3])) yRatio = viewBox[3] / svg.opts['scaleHeight'];\r\n                        }\r\n\r\n                        if (xRatio == null) { xRatio = yRatio; }\r\n                        if (yRatio == null) { yRatio = xRatio; }\r\n\r\n                        e.attribute('width', true).value = svg.opts['scaleWidth'];\r\n                        e.attribute('height', true).value = svg.opts['scaleHeight'];\r\n                        e.style('transform', true, true).value += ' scale(' + (1.0 / xRatio) + ',' + (1.0 / yRatio) + ')';\r\n                    }\r\n\r\n                    // clear and render\r\n                    if (svg.opts['ignoreClear'] != true) {\r\n                        ctx.clearRect(0, 0, cWidth, cHeight);\r\n                    }\r\n                    e.render(ctx);\r\n                    if (isFirstRender) {\r\n                        isFirstRender = false;\r\n                        if (typeof svg.opts['renderCallback'] == 'function') svg.opts['renderCallback'](dom);\r\n                    }\r\n                };\r\n\r\n                var waitingForImages = true;\r\n                if (svg.ImagesLoaded()) {\r\n                    waitingForImages = false;\r\n                    draw();\r\n                }\r\n                {\r\n                    //In node, in the most cases, we don't need the animation listener.\r\n                    svg.intervalID = setInterval(function () {\r\n                        var needUpdate = false;\r\n\r\n                        if (waitingForImages && svg.ImagesLoaded()) {\r\n                            waitingForImages = false;\r\n                            needUpdate = true;\r\n                        }\r\n\r\n                        // need update from mouse events?\r\n                        if (svg.opts['ignoreMouse'] != true) {\r\n                            needUpdate = needUpdate || svg.Mouse.hasEvents();\r\n                        }\r\n\r\n                        // need update from animations?\r\n                        if (svg.opts['ignoreAnimation'] != true) {\r\n                            for (var i = 0; i < svg.Animations.length; i++) {\r\n                                var needAnimationUpdate = svg.Animations[i].update(1000 / svg.FRAMERATE);\r\n                                needUpdate = needUpdate || needAnimationUpdate;\r\n                            }\r\n                        }\r\n\r\n                        // need update from redraw?\r\n                        if (typeof svg.opts['forceRedraw'] == 'function') {\r\n                            if (svg.opts['forceRedraw']() == true) needUpdate = true;\r\n                        }\r\n\r\n                        // render if needed\r\n                        if (needUpdate) {\r\n                            draw();\r\n                            svg.Mouse.runEvents(); // run and clear our events\r\n                        }\r\n                    }, 1000 / svg.FRAMERATE);\r\n                }\r\n            };\r\n\r\n            svg.stop = function () {\r\n                if (svg.intervalID) {\r\n                    clearInterval(svg.intervalID);\r\n                }\r\n            };\r\n\r\n            svg.Mouse = new (function () {\r\n                this.events = [];\r\n                this.hasEvents = function () { return this.events.length != 0; };\r\n\r\n                this.onclick = function (x, y) {\r\n                    this.events.push({\r\n                        type: 'onclick',\r\n                        x: x,\r\n                        y: y,\r\n                        run: function (e) { if (e.onclick) e.onclick(); }\r\n                    });\r\n                };\r\n\r\n                this.onmousemove = function (x, y) {\r\n                    this.events.push({\r\n                        type: 'onmousemove',\r\n                        x: x,\r\n                        y: y,\r\n                        run: function (e) { if (e.onmousemove) e.onmousemove(); }\r\n                    });\r\n                };\r\n\r\n                this.eventElements = [];\r\n\r\n                this.checkPath = function (element, ctx) {\r\n                    for (var i = 0; i < this.events.length; i++) {\r\n                        var e = this.events[i];\r\n                        if (ctx.isPointInPath && ctx.isPointInPath(e.x, e.y)) this.eventElements[i] = element;\r\n                    }\r\n                };\r\n\r\n                this.checkBoundingBox = function (element, bb) {\r\n                    for (var i = 0; i < this.events.length; i++) {\r\n                        var e = this.events[i];\r\n                        if (bb.isPointInBox(e.x, e.y)) this.eventElements[i] = element;\r\n                    }\r\n                };\r\n\r\n                this.runEvents = function () {\r\n                    svg.ctx.canvas.style.cursor = '';\r\n\r\n                    for (var i = 0; i < this.events.length; i++) {\r\n                        var e = this.events[i];\r\n                        var element = this.eventElements[i];\r\n                        while (element) {\r\n                            e.run(element);\r\n                            element = element.parent;\r\n                        }\r\n                    }\r\n\r\n                    // done running, clear\r\n                    this.events = [];\r\n                    this.eventElements = [];\r\n                };\r\n            });\r\n\r\n            return svg;\r\n        }\r\n\r\n        if (typeof CanvasRenderingContext2D != 'undefined') {\r\n            CanvasRenderingContext2D.prototype.drawSvg = function (s, dx, dy, dw, dh, opts) {\r\n                var cOpts = {\r\n                    ignoreMouse: true,\r\n                    ignoreAnimation: true,\r\n                    ignoreDimensions: true,\r\n                    ignoreClear: true,\r\n                    offsetX: dx,\r\n                    offsetY: dy,\r\n                    scaleWidth: dw,\r\n                    scaleHeight: dh\r\n                };\r\n\r\n                for (var prop in opts) {\r\n                    if (opts.hasOwnProperty(prop)) {\r\n                        cOpts[prop] = opts[prop];\r\n                    }\r\n                }\r\n                canvg(this.canvas, s, cOpts);\r\n            };\r\n        }\r\n\r\n        module.exports = canvg;\r\n    });\r\n\r\n    return canvg_1;\r\n\r\n})));","/**\r\n * A class to parse color values\r\n * @author Stoyan Stefanov <sstoo@gmail.com>\r\n * @link   http://www.phpied.com/rgb-color-parser-in-javascript/\r\n * @license Use it if you like it\r\n */\r\n\r\n(function ( global ) {\r\n\r\n    function RGBColor(color_string)\r\n    {\r\n        this.ok = false;\r\n\r\n        // strip any leading #\r\n        if (color_string.charAt(0) == '#') { // remove # if any\r\n            color_string = color_string.substr(1,6);\r\n        }\r\n\r\n        color_string = color_string.replace(/ /g,'');\r\n        color_string = color_string.toLowerCase();\r\n\r\n        // before getting into regexps, try simple matches\r\n        // and overwrite the input\r\n        var simple_colors = {\r\n            aliceblue: 'f0f8ff',\r\n            antiquewhite: 'faebd7',\r\n            aqua: '00ffff',\r\n            aquamarine: '7fffd4',\r\n            azure: 'f0ffff',\r\n            beige: 'f5f5dc',\r\n            bisque: 'ffe4c4',\r\n            black: '000000',\r\n            blanchedalmond: 'ffebcd',\r\n            blue: '0000ff',\r\n            blueviolet: '8a2be2',\r\n            brown: 'a52a2a',\r\n            burlywood: 'deb887',\r\n            cadetblue: '5f9ea0',\r\n            chartreuse: '7fff00',\r\n            chocolate: 'd2691e',\r\n            coral: 'ff7f50',\r\n            cornflowerblue: '6495ed',\r\n            cornsilk: 'fff8dc',\r\n            crimson: 'dc143c',\r\n            cyan: '00ffff',\r\n            darkblue: '00008b',\r\n            darkcyan: '008b8b',\r\n            darkgoldenrod: 'b8860b',\r\n            darkgray: 'a9a9a9',\r\n            darkgreen: '006400',\r\n            darkkhaki: 'bdb76b',\r\n            darkmagenta: '8b008b',\r\n            darkolivegreen: '556b2f',\r\n            darkorange: 'ff8c00',\r\n            darkorchid: '9932cc',\r\n            darkred: '8b0000',\r\n            darksalmon: 'e9967a',\r\n            darkseagreen: '8fbc8f',\r\n            darkslateblue: '483d8b',\r\n            darkslategray: '2f4f4f',\r\n            darkturquoise: '00ced1',\r\n            darkviolet: '9400d3',\r\n            deeppink: 'ff1493',\r\n            deepskyblue: '00bfff',\r\n            dimgray: '696969',\r\n            dodgerblue: '1e90ff',\r\n            feldspar: 'd19275',\r\n            firebrick: 'b22222',\r\n            floralwhite: 'fffaf0',\r\n            forestgreen: '228b22',\r\n            fuchsia: 'ff00ff',\r\n            gainsboro: 'dcdcdc',\r\n            ghostwhite: 'f8f8ff',\r\n            gold: 'ffd700',\r\n            goldenrod: 'daa520',\r\n            gray: '808080',\r\n            green: '008000',\r\n            greenyellow: 'adff2f',\r\n            honeydew: 'f0fff0',\r\n            hotpink: 'ff69b4',\r\n            indianred : 'cd5c5c',\r\n            indigo : '4b0082',\r\n            ivory: 'fffff0',\r\n            khaki: 'f0e68c',\r\n            lavender: 'e6e6fa',\r\n            lavenderblush: 'fff0f5',\r\n            lawngreen: '7cfc00',\r\n            lemonchiffon: 'fffacd',\r\n            lightblue: 'add8e6',\r\n            lightcoral: 'f08080',\r\n            lightcyan: 'e0ffff',\r\n            lightgoldenrodyellow: 'fafad2',\r\n            lightgrey: 'd3d3d3',\r\n            lightgreen: '90ee90',\r\n            lightpink: 'ffb6c1',\r\n            lightsalmon: 'ffa07a',\r\n            lightseagreen: '20b2aa',\r\n            lightskyblue: '87cefa',\r\n            lightslateblue: '8470ff',\r\n            lightslategray: '778899',\r\n            lightsteelblue: 'b0c4de',\r\n            lightyellow: 'ffffe0',\r\n            lime: '00ff00',\r\n            limegreen: '32cd32',\r\n            linen: 'faf0e6',\r\n            magenta: 'ff00ff',\r\n            maroon: '800000',\r\n            mediumaquamarine: '66cdaa',\r\n            mediumblue: '0000cd',\r\n            mediumorchid: 'ba55d3',\r\n            mediumpurple: '9370d8',\r\n            mediumseagreen: '3cb371',\r\n            mediumslateblue: '7b68ee',\r\n            mediumspringgreen: '00fa9a',\r\n            mediumturquoise: '48d1cc',\r\n            mediumvioletred: 'c71585',\r\n            midnightblue: '191970',\r\n            mintcream: 'f5fffa',\r\n            mistyrose: 'ffe4e1',\r\n            moccasin: 'ffe4b5',\r\n            navajowhite: 'ffdead',\r\n            navy: '000080',\r\n            oldlace: 'fdf5e6',\r\n            olive: '808000',\r\n            olivedrab: '6b8e23',\r\n            orange: 'ffa500',\r\n            orangered: 'ff4500',\r\n            orchid: 'da70d6',\r\n            palegoldenrod: 'eee8aa',\r\n            palegreen: '98fb98',\r\n            paleturquoise: 'afeeee',\r\n            palevioletred: 'd87093',\r\n            papayawhip: 'ffefd5',\r\n            peachpuff: 'ffdab9',\r\n            peru: 'cd853f',\r\n            pink: 'ffc0cb',\r\n            plum: 'dda0dd',\r\n            powderblue: 'b0e0e6',\r\n            purple: '800080',\r\n            red: 'ff0000',\r\n            rosybrown: 'bc8f8f',\r\n            royalblue: '4169e1',\r\n            saddlebrown: '8b4513',\r\n            salmon: 'fa8072',\r\n            sandybrown: 'f4a460',\r\n            seagreen: '2e8b57',\r\n            seashell: 'fff5ee',\r\n            sienna: 'a0522d',\r\n            silver: 'c0c0c0',\r\n            skyblue: '87ceeb',\r\n            slateblue: '6a5acd',\r\n            slategray: '708090',\r\n            snow: 'fffafa',\r\n            springgreen: '00ff7f',\r\n            steelblue: '4682b4',\r\n            tan: 'd2b48c',\r\n            teal: '008080',\r\n            thistle: 'd8bfd8',\r\n            tomato: 'ff6347',\r\n            turquoise: '40e0d0',\r\n            violet: 'ee82ee',\r\n            violetred: 'd02090',\r\n            wheat: 'f5deb3',\r\n            white: 'ffffff',\r\n            whitesmoke: 'f5f5f5',\r\n            yellow: 'ffff00',\r\n            yellowgreen: '9acd32'\r\n        };\r\n        for (var key in simple_colors) {\r\n            if (color_string == key) {\r\n                color_string = simple_colors[key];\r\n            }\r\n        }\r\n        // emd of simple type-in colors\r\n\r\n        // array of color definition objects\r\n        var color_defs = [\r\n            {\r\n                re: /^rgb\\((\\d{1,3}),\\s*(\\d{1,3}),\\s*(\\d{1,3})\\)$/,\r\n                example: ['rgb(123, 234, 45)', 'rgb(255,234,245)'],\r\n                process: function (bits){\r\n                    return [\r\n                        parseInt(bits[1]),\r\n                        parseInt(bits[2]),\r\n                        parseInt(bits[3])\r\n                    ];\r\n                }\r\n            },\r\n            {\r\n                re: /^(\\w{2})(\\w{2})(\\w{2})$/,\r\n                example: ['#00ff00', '336699'],\r\n                process: function (bits){\r\n                    return [\r\n                        parseInt(bits[1], 16),\r\n                        parseInt(bits[2], 16),\r\n                        parseInt(bits[3], 16)\r\n                    ];\r\n                }\r\n            },\r\n            {\r\n                re: /^(\\w{1})(\\w{1})(\\w{1})$/,\r\n                example: ['#fb0', 'f0f'],\r\n                process: function (bits){\r\n                    return [\r\n                        parseInt(bits[1] + bits[1], 16),\r\n                        parseInt(bits[2] + bits[2], 16),\r\n                        parseInt(bits[3] + bits[3], 16)\r\n                    ];\r\n                }\r\n            }\r\n        ];\r\n\r\n        // search through the definitions to find a match\r\n        for (var i = 0; i < color_defs.length; i++) {\r\n            var re = color_defs[i].re;\r\n            var processor = color_defs[i].process;\r\n            var bits = re.exec(color_string);\r\n            if (bits) {\r\n                channels = processor(bits);\r\n                this.r = channels[0];\r\n                this.g = channels[1];\r\n                this.b = channels[2];\r\n                this.ok = true;\r\n            }\r\n\r\n        }\r\n\r\n        // validate/cleanup values\r\n        this.r = (this.r < 0 || isNaN(this.r)) ? 0 : ((this.r > 255) ? 255 : this.r);\r\n        this.g = (this.g < 0 || isNaN(this.g)) ? 0 : ((this.g > 255) ? 255 : this.g);\r\n        this.b = (this.b < 0 || isNaN(this.b)) ? 0 : ((this.b > 255) ? 255 : this.b);\r\n\r\n        // some getters\r\n        this.toRGB = function () {\r\n            return 'rgb(' + this.r + ', ' + this.g + ', ' + this.b + ')';\r\n        }\r\n        this.toHex = function () {\r\n            var r = this.r.toString(16);\r\n            var g = this.g.toString(16);\r\n            var b = this.b.toString(16);\r\n            if (r.length == 1) r = '0' + r;\r\n            if (g.length == 1) g = '0' + g;\r\n            if (b.length == 1) b = '0' + b;\r\n            return '#' + r + g + b;\r\n        }\r\n\r\n        // help\r\n        this.getHelpXML = function () {\r\n\r\n            var examples = new Array();\r\n            // add regexps\r\n            for (var i = 0; i < color_defs.length; i++) {\r\n                var example = color_defs[i].example;\r\n                for (var j = 0; j < example.length; j++) {\r\n                    examples[examples.length] = example[j];\r\n                }\r\n            }\r\n            // add type-in colors\r\n            for (var sc in simple_colors) {\r\n                examples[examples.length] = sc;\r\n            }\r\n\r\n            var xml = document.createElement('ul');\r\n            xml.setAttribute('id', 'rgbcolor-examples');\r\n            for (var i = 0; i < examples.length; i++) {\r\n                try {\r\n                    var list_item = document.createElement('li');\r\n                    var list_color = new RGBColor(examples[i]);\r\n                    var example_div = document.createElement('div');\r\n                    example_div.style.cssText =\r\n                        'margin: 3px; '\r\n                        + 'border: 1px solid black; '\r\n                        + 'background:' + list_color.toHex() + '; '\r\n                        + 'color:' + list_color.toHex()\r\n                    ;\r\n                    example_div.appendChild(document.createTextNode('test'));\r\n                    var list_item_value = document.createTextNode(\r\n                        ' ' + examples[i] + ' -> ' + list_color.toRGB() + ' -> ' + list_color.toHex()\r\n                    );\r\n                    list_item.appendChild(example_div);\r\n                    list_item.appendChild(list_item_value);\r\n                    xml.appendChild(list_item);\r\n\r\n                } catch(e){}\r\n            }\r\n            return xml;\r\n\r\n        }\r\n\r\n    }\r\n\r\n    // export as AMD...\r\n    if ( typeof define !== 'undefined' && define.amd ) {\r\n        define( function () { return RGBColor; });\r\n    }\r\n\r\n    // ...or as browserify\r\n    else if ( typeof module !== 'undefined' && module.exports ) {\r\n        module.exports = RGBColor;\r\n    }\r\n\r\n    global.RGBColor = RGBColor;\r\n\r\n}( typeof window !== 'undefined' ? window : this ));","!function(t,e){\"object\"==typeof exports&&\"undefined\"!=typeof module?module.exports=e():\"function\"==typeof define&&define.amd?define(e):t.ResizeObserver=e()}(this,function(){\"use strict\";var t=function(){if(\"undefined\"!=typeof Map)return Map;function t(t,e){var n=-1;return t.some(function(t,i){return t[0]===e&&(n=i,!0)}),n}return function(){function e(){this.__entries__=[]}var n={size:{configurable:!0}};return n.size.get=function(){return this.__entries__.length},e.prototype.get=function(e){var n=t(this.__entries__,e),i=this.__entries__[n];return i&&i[1]},e.prototype.set=function(e,n){var i=t(this.__entries__,e);~i?this.__entries__[i][1]=n:this.__entries__.push([e,n])},e.prototype.delete=function(e){var n=this.__entries__,i=t(n,e);~i&&n.splice(i,1)},e.prototype.has=function(e){return!!~t(this.__entries__,e)},e.prototype.clear=function(){this.__entries__.splice(0)},e.prototype.forEach=function(t,e){void 0===e&&(e=null);for(var n=0,i=this.__entries__;n<i.length;n+=1){var r=i[n];t.call(e,r[1],r[0])}},Object.defineProperties(e.prototype,n),e}()}(),e=\"undefined\"!=typeof window&&\"undefined\"!=typeof document&&window.document===document,n=\"undefined\"!=typeof global&&global.Math===Math?global:\"undefined\"!=typeof self&&self.Math===Math?self:\"undefined\"!=typeof window&&window.Math===Math?window:Function(\"return this\")(),i=\"function\"==typeof requestAnimationFrame?requestAnimationFrame.bind(n):function(t){return setTimeout(function(){return t(Date.now())},1e3/60)},r=2,o=[\"top\",\"right\",\"bottom\",\"left\",\"width\",\"height\",\"size\",\"weight\"],s=\"undefined\"!=typeof MutationObserver,a=function(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(t,e){var n=!1,o=!1,s=0;function a(){n&&(n=!1,t()),o&&h()}function c(){i(a)}function h(){var t=Date.now();if(n){if(t-s<r)return;o=!0}else n=!0,o=!1,setTimeout(c,e);s=t}return h}(this.refresh.bind(this),20)};a.prototype.addObserver=function(t){~this.observers_.indexOf(t)||this.observers_.push(t),this.connected_||this.connect_()},a.prototype.removeObserver=function(t){var e=this.observers_,n=e.indexOf(t);~n&&e.splice(n,1),!e.length&&this.connected_&&this.disconnect_()},a.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},a.prototype.updateObservers_=function(){var t=this.observers_.filter(function(t){return t.gatherActive(),t.hasActive()});return t.forEach(function(t){return t.broadcastActive()}),t.length>0},a.prototype.connect_=function(){e&&!this.connected_&&(document.addEventListener(\"transitionend\",this.onTransitionEnd_),window.addEventListener(\"resize\",this.refresh),s?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener(\"DOMSubtreeModified\",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},a.prototype.disconnect_=function(){e&&this.connected_&&(document.removeEventListener(\"transitionend\",this.onTransitionEnd_),window.removeEventListener(\"resize\",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener(\"DOMSubtreeModified\",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},a.prototype.onTransitionEnd_=function(t){var e=t.propertyName;void 0===e&&(e=\"\"),o.some(function(t){return!!~e.indexOf(t)})&&this.refresh()},a.getInstance=function(){return this.instance_||(this.instance_=new a),this.instance_},a.instance_=null;var c=function(t,e){for(var n=0,i=Object.keys(e);n<i.length;n+=1){var r=i[n];Object.defineProperty(t,r,{value:e[r],enumerable:!1,writable:!1,configurable:!0})}return t},h=function(t){return t&&t.ownerDocument&&t.ownerDocument.defaultView||n},u=_(0,0,0,0);function f(t){return parseFloat(t)||0}function d(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];return e.reduce(function(e,n){return e+f(t[\"border-\"+n+\"-width\"])},0)}function p(t){var e=t.clientWidth,n=t.clientHeight;if(!e&&!n)return u;var i,r=h(t).getComputedStyle(t),o=function(t){for(var e={},n=0,i=[\"top\",\"right\",\"bottom\",\"left\"];n<i.length;n+=1){var r=i[n],o=t[\"padding-\"+r];e[r]=f(o)}return e}(r),s=o.left+o.right,a=o.top+o.bottom,c=f(r.width),p=f(r.height);if(\"border-box\"===r.boxSizing&&(Math.round(c+s)!==e&&(c-=d(r,\"left\",\"right\")+s),Math.round(p+a)!==n&&(p-=d(r,\"top\",\"bottom\")+a)),(i=t)!==h(i).document.documentElement){var v=Math.round(c+s)-e,l=Math.round(p+a)-n;1!==Math.abs(v)&&(c-=v),1!==Math.abs(l)&&(p-=l)}return _(o.left,o.top,c,p)}var v=\"undefined\"!=typeof SVGGraphicsElement?function(t){return t instanceof h(t).SVGGraphicsElement}:function(t){return t instanceof h(t).SVGElement&&\"function\"==typeof t.getBBox};function l(t){return e?v(t)?_(0,0,(n=t.getBBox()).width,n.height):p(t):u;var n}function _(t,e,n,i){return{x:t,y:e,width:n,height:i}}var b=function(t){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=_(0,0,0,0),this.target=t};b.prototype.isActive=function(){var t=l(this.target);return this.contentRect_=t,t.width!==this.broadcastWidth||t.height!==this.broadcastHeight},b.prototype.broadcastRect=function(){var t=this.contentRect_;return this.broadcastWidth=t.width,this.broadcastHeight=t.height,t};var m=function(t,e){var n,i,r,o,s,a,h,u=(i=(n=e).x,r=n.y,o=n.width,s=n.height,a=\"undefined\"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,h=Object.create(a.prototype),c(h,{x:i,y:r,width:o,height:s,top:r,right:i+o,bottom:s+r,left:i}),h);c(this,{target:t,contentRect:u})},y=function(e,n,i){if(this.activeObservations_=[],this.observations_=new t,\"function\"!=typeof e)throw new TypeError(\"The callback provided as parameter 1 is not a function.\");this.callback_=e,this.controller_=n,this.callbackCtx_=i};y.prototype.observe=function(t){if(!arguments.length)throw new TypeError(\"1 argument required, but only 0 present.\");if(\"undefined\"!=typeof Element&&Element instanceof Object){if(!(t instanceof h(t).Element))throw new TypeError('parameter 1 is not of type \"Element\".');var e=this.observations_;e.has(t)||(e.set(t,new b(t)),this.controller_.addObserver(this),this.controller_.refresh())}},y.prototype.unobserve=function(t){if(!arguments.length)throw new TypeError(\"1 argument required, but only 0 present.\");if(\"undefined\"!=typeof Element&&Element instanceof Object){if(!(t instanceof h(t).Element))throw new TypeError('parameter 1 is not of type \"Element\".');var e=this.observations_;e.has(t)&&(e.delete(t),e.size||this.controller_.removeObserver(this))}},y.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},y.prototype.gatherActive=function(){var t=this;this.clearActive(),this.observations_.forEach(function(e){e.isActive()&&t.activeObservations_.push(e)})},y.prototype.broadcastActive=function(){if(this.hasActive()){var t=this.callbackCtx_,e=this.activeObservations_.map(function(t){return new m(t.target,t.broadcastRect())});this.callback_.call(t,e,t),this.clearActive()}},y.prototype.clearActive=function(){this.activeObservations_.splice(0)},y.prototype.hasActive=function(){return this.activeObservations_.length>0};var g=\"undefined\"!=typeof WeakMap?new WeakMap:new t,w=function(t){if(!(this instanceof w))throw new TypeError(\"Cannot call a class as a function.\");if(!arguments.length)throw new TypeError(\"1 argument required, but only 0 present.\");var e=a.getInstance(),n=new y(t,e,this);g.set(this,n)};return[\"observe\",\"unobserve\",\"disconnect\"].forEach(function(t){w.prototype[t]=function(){return(e=g.get(this))[t].apply(e,arguments);var e}}),void 0!==n.ResizeObserver?n.ResizeObserver:w});","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","__webpack_require__.nc = undefined;","\r\n// These are all the supported markup types.\r\n\r\n    export const MARKUP_TYPE_ARROW = \"arrow\";\r\n    export const MARKUP_TYPE_TEXT = \"label\";\r\n    export const MARKUP_TYPE_RECTANGLE = \"rectangle\";\r\n    export const MARKUP_TYPE_CIRCLE = \"ellipse\";\r\n    export const MARKUP_TYPE_CLOUD = \"cloud\";\r\n    export const MARKUP_TYPE_FREEHAND = \"freehand\";\r\n    export const MARKUP_TYPE_HIGHLIGHT = \"highlight\";\r\n    export const MARKUP_TYPE_POLYLINE = \"polyline\";\r\n    export const MARKUP_TYPE_POLYCLOUD = \"polycloud\";\r\n    export const MARKUP_TYPE_CALLOUT = \"callout\";\r\n    export const MARKUP_TYPE_DIMENSION = \"dimension\";","'use strict';\r\n\r\n    /**\r\n     * Base class for all markup edit actions.\r\n     *\r\n     * EditActions encapsulate {@link Autodesk.Viewing.Extensions.Markups.Core.Markup|Markup}\r\n     * operations (such as creation, edition and deletion) that hook into the undo/redo system.\r\n     *\r\n     * The minimum set of methods to implement on an EditAction extension are:\r\n     * - execute()\r\n     * - undo()\r\n     * - redo()\r\n     *\r\n     * A good set of classes to check their implementation are:\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.CreateCircle|CreateCircle}.\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.DeleteCircle|DeleteCircle}.\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.SetCircle|SetCircle}.\r\n     *\r\n     * @tutorial feature_markup\r\n     * @constructor\r\n     * @memberof Autodesk.Viewing.Extensions.Markups.Core\r\n     *\r\n     * @param {Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore} editor\r\n     * @param {String} type - An identifier for the EditAction.\r\n     * @param {number} targetId - The id of the markup being affected.\r\n     */\r\n    export function EditAction(editor, type, targetId) {\r\n\r\n        this.type =  type;\r\n        this.editor = editor;\r\n        this.targetId = targetId;\r\n        this.addToHistory = true;\r\n        this.selectOnExecution = true;\r\n    }\r\n\r\n    /**\r\n     * Performs the action.\r\n     */\r\n    EditAction.prototype.execute = function() {\r\n\r\n        this.editor.actionManager.execute(this);\r\n    };\r\n\r\n    /**\r\n     * @abstract\r\n     */\r\n    EditAction.prototype.redo = function() {\r\n\r\n    };\r\n\r\n    /**\r\n     * @abstract\r\n     */\r\n    EditAction.prototype.undo = function() {\r\n\r\n    };\r\n\r\n    /**\r\n     * Provides a mechanism to merge consecutive actions of the same type.\r\n     * @param {Autodesk.Viewing.Extensions.Markups.Core.EditAction} action - Action to check if it can be merged with 'this'.\r\n     * @returns {boolean} Returns true if merge has been applied. Parameter will be discarded.\r\n     */\r\n    EditAction.prototype.merge = function(action) {\r\n\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * Provides a mechanism to check whether the action yields no results.\r\n     * @returns {boolean} Returns true if no changes happen with this action.\r\n     */\r\n    EditAction.prototype.isIdentity = function() {\r\n\r\n        return false;\r\n    };\r\n\r\n","\r\n/**\r\n * \r\n * @param {*} attributes \r\n * @param {*} editor \r\n */\r\nexport var createStyle = function(attributes, editor) {\r\n\r\n    var style = {};\r\n\r\n    for(var i = 0; i < attributes.length; ++i) {\r\n\r\n        style[attributes[i]] = null;\r\n    }\r\n\r\n    var defaults = getStyleDefaultValues(style, editor);\r\n\r\n    for(var i = 0; i < attributes.length; ++i) {\r\n\r\n        var attribute = attributes[i];\r\n        style[attribute] = defaults[attribute].values[defaults[attribute].default].value;\r\n    }\r\n\r\n    return style;\r\n};\r\n\r\n/**\r\n *\r\n * @param source\r\n * @param destination\r\n * @returns {*}\r\n */\r\nexport var copyStyle = function(source, destination) {\r\n\r\n    for(var attribute in destination) {\r\n        if (source.hasOwnProperty(attribute)) {\r\n            destination[attribute] = source[attribute];\r\n        }\r\n    }\r\n\r\n    return destination;\r\n};\r\n\r\n/**\r\n *\r\n * @param source\r\n * @param destination\r\n * @returns {*}\r\n */\r\nexport var isStyleEqual = function(source, destination) {\r\n\r\n    for(var attribute in destination) {\r\n        if (source.hasOwnProperty(attribute) && source[attribute] !== destination[attribute]) {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    return true;\r\n};\r\n\r\n/**\r\n *\r\n * @param source\r\n * @returns {{}}\r\n */\r\nexport var cloneStyle = function(source) {\r\n\r\n    var clone = {};\r\n\r\n    for(var attribute in source) {\r\n        clone[attribute] = source[attribute];\r\n    }\r\n\r\n    return clone;\r\n};\r\n\r\n/**\r\n *\r\n * @param style\r\n * @param editor\r\n * @returns {{}}\r\n */\r\nexport var getStyleDefaultValues = function(style, editor) {\r\n\r\n    function getWidths(normalWidth) {\r\n\r\n        return {\r\n            values: [\r\n                {name:'Thin', value: normalWidth / 3},\r\n                {name:'Normal', value: normalWidth},\r\n                {name:'Thick', value: normalWidth * 3},\r\n                {name:'Very Thick', value: normalWidth * 9}],\r\n            default: 1\r\n        };\r\n    }\r\n\r\n    function getLineJoins() {\r\n\r\n        return {\r\n            values: [\r\n                {name:'Miter', value: 'miter'},\r\n                {name:'Round', value: 'round'},\r\n                {name:'Bevel', value: 'bevel'}],\r\n            default: 0\r\n        };\r\n    }\r\n\r\n    function getFontSizes(normalWidth) {\r\n\r\n        return {\r\n            values: [\r\n                {name:'Thin', value: normalWidth / 2},\r\n                {name:'Normal', value: normalWidth},\r\n                {name:'Thick', value: normalWidth * 4}],\r\n            default: 1\r\n        };\r\n    }\r\n\r\n    function getColors() {\r\n\r\n        return {\r\n            values: [\r\n                {name:'red', value: '#ff0000'},\r\n                {name:'green', value: '#00ff00'},\r\n                {name:'blue', value: '#0000ff'},\r\n                {name:'white', value: '#ffffff'},\r\n                {name:'black', value: '#000000'},\r\n                {name:'yellow', value: '#ffff00'}],\r\n            default: 0\r\n        };\r\n    }\r\n\r\n    function getOpacities(defaultTransparent) {\r\n\r\n        return {\r\n            values: [\r\n                {name:'100%', value: 1.00},\r\n                {name:'75%', value:  0.75},\r\n                {name:'50%', value: 0.50},\r\n                {name:'25%', value: 0.25},\r\n                {name:'0%', value: 0.00}],\r\n            default: (defaultTransparent ? 4 : 0)\r\n        };\r\n    }\r\n\r\n    function getFontFamilies() {\r\n\r\n        // TODO: Localize?\r\n        // TODO: Validate fonts with design\r\n        // Source: http://www.webdesigndev.com/web-development/16-gorgeous-web-safe-fonts-to-use-with-css\r\n        return {\r\n            values:[\r\n                {name:'Arial', value: 'Arial'},\r\n                {name:'Arial Black', value: 'Arial Black'},\r\n                {name:'Arial Narrow', value: 'Arial Narrow'},\r\n                {name:'Century Gothic', value: 'Century Gothic'},\r\n                {name:'Courier New', value: 'Courier New'},\r\n                {name:'Georgia', value: 'Georgia'},\r\n                {name:'Impact', value: 'Impact'},\r\n                {name:'Lucida Console', value: 'Lucida Console'},\r\n                {name:'Tahoma', value: 'Tahoma'},\r\n                {name:'Verdana', value: 'Verdana'}\r\n            ],\r\n            default: 0\r\n        };\r\n    }\r\n\r\n    function getFontStyles() {\r\n        return {\r\n            values:[\r\n                {name:'Normal', value: 'normal'},\r\n                {name:'Italic', value: 'italic'}],\r\n            default: 0\r\n        };\r\n    }\r\n\r\n    function getFontWeights() {\r\n        return {\r\n            values:[\r\n                {name:'Normal', value: 'normal'},\r\n                {name:'Bold', value: 'bold'}],\r\n            default: 0};\r\n    }\r\n\r\n    var values = cloneStyle(style);\r\n    var normaStrokeWidth = editor.getStrokeWidth();\r\n    var normaFontWidth = editor.getFontWidth();\r\n\r\n    for(var attribute in values) {\r\n\r\n        switch(attribute) {\r\n            case 'stroke-width':\r\n                values[attribute] = getWidths(normaStrokeWidth);\r\n                break;\r\n\r\n            case 'stroke-linejoin':\r\n                values[attribute] = getLineJoins();\r\n                break;\r\n\r\n            case 'font-size':\r\n                values[attribute] = getFontSizes(normaFontWidth);\r\n                break;\r\n\r\n            case 'font-family':\r\n                values[attribute] = getFontFamilies();\r\n                break;\r\n\r\n            case 'font-style':\r\n                values[attribute] = getFontStyles();\r\n                break;\r\n\r\n            case 'font-weight':\r\n                values[attribute] = getFontWeights();\r\n                break;\r\n\r\n            case 'stroke-color':\r\n            case 'fill-color':\r\n                values[attribute] = getColors();\r\n                break;\r\n\r\n            case 'stroke-opacity':\r\n                var defaultTransparent = false;\r\n                values[attribute] = getOpacities(defaultTransparent);\r\n                break;\r\n\r\n            case 'fill-opacity':\r\n                var defaultTransparent = true;\r\n                values[attribute] = getOpacities(defaultTransparent);\r\n                break;\r\n\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n\r\n    return values;\r\n};\r\n","'use strict';\r\n\r\n    /**\r\n     * Fired whenever the drawing tool changes. For example, when the Arrow drawing\r\n     * tool changes into the Rectangle drawing tool.\r\n     * See {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#changeEditMode|MarkupsCore.changeEditMode()}\r\n     * for a list of all supported drawing tools (EditModes).\r\n     * \r\n     * @event Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore#EVENT_EDITMODE_CHANGED\r\n     * @type {string}\r\n     */\r\n    export const EVENT_EDITMODE_CHANGED = \"EVENT_EDITMODE_CHANGED\";\r\n\r\n    /**\r\n     * Fired when Edit mode has been enabled, which allows the end user to start\r\n     * drawing markups over the Viewer canvas.\r\n     * See also {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#enterEditMode|MarkupsCore.enterEditMode()}.\r\n     * \r\n     * @event Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore#EVENT_EDITMODE_ENTER\r\n     * @type {string}\r\n     */\r\n    export const EVENT_EDITMODE_ENTER = \"EVENT_EDITMODE_ENTER\";\r\n\r\n    /**\r\n     * Fired when Edit mode has been disabled, preventing the end user from\r\n     * drawing markups over the Viewer canvas.\r\n     * See also {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#leaveEditMode|MarkupsCore.leaveEditMode()}.\r\n     * \r\n     * @event Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore#EVENT_EDITMODE_LEAVE\r\n     * @type {string}\r\n     */\r\n    export const EVENT_EDITMODE_LEAVE = \"EVENT_EDITMODE_LEAVE\";\r\n\r\n    /**\r\n     * Fired when a drawn markup has been selected by the end user with a click command.\r\n     * \r\n     * @event Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore#EVENT_MARKUP_SELECTED\r\n     * @type {string}\r\n     */\r\n    export const EVENT_MARKUP_SELECTED = \"EVENT_MARKUP_SELECTED\";\r\n\r\n    /**\r\n     * Fired when a drawn markup is being dragged over the Viewer canvas.\r\n     * \r\n     * @event Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore#EVENT_MARKUP_DRAGGING\r\n     * @type {string}\r\n     */\r\n    export const EVENT_MARKUP_DRAGGING = \"EVENT_MARKUP_DRAGGING\";\r\n\r\n    /**\r\n     * Internal usage only.\r\n     * \r\n     * @event Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore#EVENT_MARKUP_ENTER_EDITION\r\n     * @type {string}\r\n     * @private\r\n     */\r\n    export const EVENT_MARKUP_ENTER_EDITION = \"EVENT_MARKUP_ENTER_EDITION\";\r\n\r\n    /**\r\n     * Internal usage only.\r\n     * \r\n     * @event Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore#EVENT_MARKUP_CANCEL_EDITION\r\n     * @type {string}\r\n     * @private\r\n     */\r\n    export const EVENT_MARKUP_CANCEL_EDITION = \"EVENT_MARKUP_CANCEL_EDITION\";\r\n\r\n    /**\r\n     * Internal usage only.\r\n     * \r\n     * @event Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore#EVENT_MARKUP_DELETE_EDITION\r\n     * @type {string}\r\n     * @private\r\n     */\r\n    export const EVENT_MARKUP_DELETE_EDITION = \"EVENT_MARKUP_DELETE_EDITION\";\r\n\r\n\r\n    /**\r\n     * Fired whenever a new undo or redo action is available.\r\n     */\r\n    export const EVENT_HISTORY_CHANGED = \"EVENT_HISTORY_CHANGED\";\r\n\r\n    /**\r\n     * Fired when a markup creation begins. \r\n     * For example, as soon as the user starts dragging with the mouse\r\n     * to draw an arrow on the screen.\r\n     */\r\n    export const EVENT_EDITMODE_CREATION_BEGIN = \"EVENT_EDITMODE_CREATION_BEGIN\";\r\n\r\n    /**\r\n     * Fired when a markup has been created.\r\n     * For example, as soon as the user stops dragging and releases the\r\n     * mouse button to finish drawing an arrow on the screen\r\n     */\r\n    export const EVENT_EDITMODE_CREATION_END = \"EVENT_EDITMODE_CREATION_END\";\r\n\r\n    /**\r\n     * Fired when a markup is no longer selected.\r\n     */\r\n    export const EVENT_MARKUP_DESELECT = \"EVENT_MARKUP_DESELECT\";\r\n\r\n    /**\r\n     * The selected markup is being modified\r\n     */\r\n    export const EVENT_EDITFRAME_EDITION_START = \"EVENT_EDITFRAME_EDITION_START\";\r\n\r\n    /**\r\n     * The selected markup is no longer being modified\r\n     */\r\n    export const EVENT_EDITFRAME_EDITION_END = \"EVENT_EDITFRAME_EDITION_END\";","'use strict';\r\n\r\nimport { addTraitEventDispatcher, renderToCanvas, radiansToDegrees, \r\n         checkPolygon, checkLineSegment, isTouchDevice } from './MarkupsCoreUtils'\r\nimport { createStyle, copyStyle, cloneStyle } from './StyleUtils'\r\nimport * as MarkupEvents from './MarkupEvents'\r\n\r\n    var av = Autodesk.Viewing;\r\n\r\n    /**\r\n     * Base class for all markups.\r\n     *\r\n     * A Markup is a class that is capable of rendering itself as an Svg node.<br>\r\n     * It can also render itself into a canvas-2d context.\r\n     * Component within {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore MarkupsCore} extension.\r\n     *\r\n     * Any class extending Markup should contain at least the following methods:\r\n     * - getEditMode()\r\n     * - set()\r\n     * - updateStyle()\r\n     * - setParent()\r\n     * - setRotation()\r\n     * - setSize()\r\n     * - setPosition()\r\n     * - renderToCanvas()\r\n     * - setMetadata()\r\n     *\r\n     * A good reference is the rectangle markup implementation available in\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupRectangle|MarkupRectangle}.\r\n     *\r\n     * @tutorial feature_markup\r\n     * @constructor\r\n     * @memberof Autodesk.Viewing.Extensions.Markups.Core\r\n     *\r\n     * @param {number} id - Identifier, populated with return value of {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore#getId getId()}.\r\n     * @param {Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore} editor - Markups extension\r\n     * @param {Array} styleAttributes - Attributes for customization. Related to {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore#setStyle setStyle()}.\r\n     * @constructor\r\n     */\r\n    export function Markup(id, editor, styleAttributes) {\r\n\r\n        this.id = id;\r\n        this.type = \"\";\r\n        this.editor = editor;\r\n        this.viewer = editor.viewer;\r\n        this.setGlobalManager(this.viewer.globalManager);\r\n        this.position = {x: 0, y: 0};\r\n        this.size = {x:0, y:0};\r\n        this.rotation = 0;\r\n        this.style = createStyle(styleAttributes, this.editor);\r\n        this.style = copyStyle(editor.getDefaultStyle(), this.style);\r\n        this.highlightColor = '#0696D7';\r\n        this.constraintWidth = false;\r\n        this.constraintHeight = false;\r\n        this.constraintRotation = false;\r\n        this.minWidth = -10000;\r\n        this.minHeight = -10000;\r\n        this.highlighted = false;\r\n        this.selected = false;\r\n\r\n        // bind to this to pass this.globalManager\r\n        this.checkLineSegment = checkLineSegment.bind(this);\r\n        this.checkPolygon = checkPolygon.bind(this);\r\n        this.renderToCanvasX = renderToCanvas.bind(this);\r\n\r\n        addTraitEventDispatcher(this);\r\n    }\r\n\r\n    av.GlobalManagerMixin.call(Markup.prototype);\r\n    var proto = Markup.prototype;\r\n\r\n    proto.destroy = function () {\r\n\r\n        this.unselect();\r\n        this.setParent(null);\r\n    };\r\n\r\n    /**\r\n     * Specifies the parent layer which will contain the markup.\r\n     * @param {HTMLElement} parent\r\n     */\r\n    proto.setParent = function(parent) {\r\n\r\n        var div = this.shape;\r\n        div.parentNode && div.parentNode.removeChild(div);\r\n        parent && parent.appendChild(div);\r\n    };\r\n\r\n    /**\r\n     * Clones (deep-copy) the markup. Used internally by the copy/cut/paste mechanism in\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore MarkupsCore}.\r\n     *\r\n     * @returns {Autodesk.Viewing.Extensions.Markups.Core.Markup} clone of the current markup\r\n     */\r\n    proto.clone = function() {\r\n\r\n        var clone = Object.create(this.__proto__);\r\n        var overrides = this.getCloneOverrides();\r\n\r\n        for (var name in this) {\r\n\r\n            if(!this.hasOwnProperty(name)) {\r\n                continue;\r\n            }\r\n\r\n            var member = this[name];\r\n\r\n            // Is there an override for this member?\r\n            if (overrides.hasOwnProperty(name)) {\r\n                clone[name] = overrides[name];\r\n                continue;\r\n            }\r\n\r\n            // Member is null or undefined?\r\n            if (member === null || member === undefined) {\r\n                clone[name] = member;\r\n                continue;\r\n            }\r\n\r\n            // Member has a clone function?\r\n            if (member['clone'] instanceof Function) {\r\n                clone[name] = member.clone();\r\n                continue;\r\n            }\r\n\r\n            // Is it a function?\r\n            if (member instanceof Function) {\r\n                clone[name] = member.bind(clone);\r\n                continue;\r\n            }\r\n\r\n            // Is it an html node?\r\n            if (member.nodeType) {\r\n                clone[name] = member.cloneNode(true);\r\n                continue;\r\n            }\r\n\r\n            // Is it the globalManager?\r\n            if (member instanceof av.GlobalManager) {\r\n                av.GlobalManagerMixin.call(clone);\r\n                clone.setGlobalManager(member);\r\n                continue;\r\n            }\r\n\r\n            // Just a plain object?\r\n            if (member instanceof Object) {\r\n                clone[name] = JSON.parse(JSON.stringify(member));\r\n                continue;\r\n            }\r\n\r\n            // Ok, it seems it's just a primitive type.\r\n            clone[name] = member;\r\n        }\r\n\r\n        this.cloneShape(clone);\r\n        return clone;\r\n    };\r\n\r\n    proto.cloneShape = function(clone) {\r\n\r\n        clone.shape.markup = clone.shape.childNodes.item(0);\r\n        clone.shape.hitarea = clone.shape.childNodes.item(1);\r\n        clone.bindDomEvents();\r\n    };\r\n\r\n    /**\r\n     * Used internally by\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.Markup#clone clone()},\r\n     * provides a mechanism to avoid cloning specific attributes.<br>\r\n     * Developers only need to override this method when creating new Markup types.\r\n     * When overriding, first call the super() implementation and then include additional attribute/value pairs to it.\r\n     * @returns {Object} containing attributes that need not to be cloned.\r\n     */\r\n    proto.getCloneOverrides = function() {\r\n\r\n        return {\r\n            viewer: this.viewer,\r\n            editor: this.editor,\r\n            hammer: null,\r\n            listeners: {}\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Used internally to select a markup.<br>\r\n     * Fires event Autodesk.Viewing.Extensions.Markups.Core.EVENT_MARKUP_SELECTED.\r\n     */\r\n    proto.select = function () {\r\n\r\n        if (this.selected) {\r\n            return;\r\n        }\r\n\r\n        this.selected = true;\r\n        this.highlighted = false;\r\n        this.updateStyle();\r\n        this.dispatchEvent({type: MarkupEvents.EVENT_MARKUP_SELECTED, markup: this});\r\n    };\r\n\r\n    /**\r\n     * Used internally to signal that the current markup has been unselected.<br>\r\n     * No event is fired.\r\n     */\r\n    proto.unselect = function() {\r\n\r\n        this.selected = false;\r\n    };\r\n\r\n    proto.highlight = function(highlight) {\r\n\r\n        if (this.interactionsDisabled) {\r\n            return;\r\n        }\r\n\r\n        this.highlighted = highlight;\r\n        this.updateStyle();\r\n    };\r\n\r\n    /**\r\n     * Returns a copy of the markup's style.\r\n     * @returns {Object}\r\n     */\r\n    proto.getStyle = function() {\r\n\r\n        return cloneStyle(this.style);\r\n    };\r\n\r\n    /**\r\n     * Used internally to set the style object. Triggers a re-render of the markup (Svg)\r\n     * @param {Object} style - Dictionary with key/value pairs\r\n     */\r\n    proto.setStyle = function(style) {\r\n\r\n        copyStyle(style, this.style);\r\n        this.updateStyle();\r\n    };\r\n\r\n    /**\r\n     * Used internally and implemented by specific Markup types to render themselves as Svg.\r\n     */\r\n    proto.updateStyle = function () {\r\n\r\n    };\r\n\r\n    /**\r\n     * Used internally to notify the markup that it is now being edited.<br>\r\n     * Fires event Autodesk.Viewing.Extensions.Markups.Core.EVENT_MARKUP_ENTER_EDITION.\r\n     */\r\n    proto.edit = function() {\r\n\r\n        this.dispatchEvent({type: MarkupEvents.EVENT_MARKUP_ENTER_EDITION, markup: this});\r\n    };\r\n\r\n    /**\r\n     * Used internally to signal that it is no longer being edited.<br>\r\n     * Fires event Autodesk.Viewing.Extensions.Markups.Core.EVENT_MARKUP_CANCEL_EDITION.\r\n     */\r\n    proto.cancel = function() {\r\n\r\n        this.dispatchEvent({type: MarkupEvents.EVENT_MARKUP_CANCEL_EDITION, markup: this});\r\n    };\r\n\r\n    /**\r\n     * Used internally to signal that the markup is being deleted.<br>\r\n     * Fires event Autodesk.Viewing.Extensions.Markups.Core.EVENT_MARKUP_DELETE_EDITION.\r\n     */\r\n    proto.deleteMarkup = function() {\r\n\r\n        this.dispatchEvent({type: MarkupEvents.EVENT_MARKUP_DELETE_EDITION, markup: this});\r\n    };\r\n\r\n    /**\r\n     * Used internally to get the {@link Autodesk.Viewing.Extensions.Markups.Core.EditMode EditMode}\r\n     * associated with the current Markup.<br>\r\n     * Implemented by classes extending this one.\r\n     * @returns {Autodesk.Viewing.Extensions.Markups.Core.EditMode}\r\n     */\r\n    proto.getEditMode = function() {\r\n\r\n        console.warn('EditMode of markup type' + this.type + ' not defined.' );\r\n        return null;\r\n    };\r\n\r\n    /**\r\n     * Used internally to get the markup's position in browser pixel space.<br>\r\n     * Notice that (0,0) is top left.<br>\r\n     * See also\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.Markup#getClientSize|getClientSize()}.\r\n     * @returns {*}\r\n     */\r\n    proto.getClientPosition = function() {\r\n\r\n        var position = this.position;\r\n        return this.editor.positionFromMarkupsToClient(position.x, position.y);\r\n    };\r\n\r\n    /**\r\n     * Used internally to get the markup's bounding rect in browser pixel space.<br>\r\n     * See also\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.Markup#getClientPosition|getClientPosition()}.\r\n     * @returns {*}\r\n     */\r\n    proto.getClientSize = function () {\r\n\r\n        var size = this.size;\r\n        return this.editor.sizeFromMarkupsToClient(size.x, size.y);\r\n    };\r\n\r\n    /**\r\n     * Used internally to get the markup's bounding rect in browser pixel space, including the stroke width.<br>\r\n     * @returns {Object} a rectangle with right, top, left, bottom attributes\r\n     */\r\n    proto.getBoundingRect = function () {\r\n\r\n        var rotation = this.rotation;\r\n\r\n        if (rotation !== 0) { // Undo rotation to find a tight bounding rect\r\n            this.setRotation(0);\r\n        }\r\n\r\n        var parentRect = this.viewer.impl.getCanvasBoundingClientRect();\r\n\r\n        var boundRect = this.shape.markup.getBoundingClientRect();\r\n        var top = boundRect.top - parentRect.top;\r\n\r\n        var strokeWidth = this.style['stroke-width'] || 0;\r\n        var offset = this.editor.sizeFromMarkupsToClient(strokeWidth, 0).x;\r\n\r\n        if (rotation !== 0) {\r\n            this.setRotation(rotation);\r\n        }\r\n\r\n        return {\r\n            x: boundRect.left - parentRect.left - offset,\r\n            y: top - offset,\r\n            width: boundRect.width + 2*offset,\r\n            height: boundRect.height + 2*offset\r\n        };\r\n    };\r\n\r\n    /**\r\n     * Changes the rotation of the markup to the given angle.\r\n     * This gets called by the Autodesk.Viewing.Extensions.Markups.Core.SetRotation edit action\r\n     *\r\n     * @param {Number} angle\r\n     */\r\n    proto.setRotation = function(angle) {\r\n\r\n        this.rotation = angle;\r\n        this.updateStyle();\r\n    };\r\n\r\n    proto.getRotation = function () {\r\n\r\n        return this.rotation;\r\n    };\r\n\r\n    /**\r\n     * Used by the EditFrame to move the markup in Client Space coordinates\r\n     * @param {Number} x - New X location for the markup. Notice that markups are centered on this value.\r\n     * @param {Number} y - New Y location for the markup. Notice that markups are centered on this value.\r\n     */\r\n    proto.setPosition = function(x,y) {\r\n\r\n        this.position.x = x;\r\n        this.position.y = y;\r\n\r\n        this.updateStyle();\r\n    };\r\n\r\n    /**\r\n     * Changes the position and size of the markup.\r\n     * This gets called by the Autodesk.Viewing.Extensions.Markups.Core.SetSize edit action\r\n     * @param {{x: Number, y: Number}} position\r\n     * @param {Number} width\r\n     * @param {Number} height\r\n     */\r\n    proto.setSize = function (position, width, height) {\r\n\r\n        this.position.x = position.x;\r\n        this.position.y = position.y;\r\n        this.size.x = width;\r\n        this.size.y = height;\r\n\r\n        this.updateStyle();\r\n    };\r\n\r\n    proto.isWidthConstrained = function() {\r\n\r\n        return this.constraintWidth;\r\n    };\r\n\r\n    proto.isHeightConstrained = function() {\r\n\r\n        return this.constraintHeight;\r\n    };\r\n\r\n    proto.isRotationConstrained = function() {\r\n\r\n        return this.constraintRotation;\r\n    };\r\n\r\n    proto.setMinWidth = function(minWidth) {\r\n        this.minWidth = minWidth;\r\n    };\r\n\r\n    proto.setMinHeight = function(minHeight) {\r\n        this.minHeight = minHeight;\r\n    };\r\n\r\n    proto.getMinWidth = function() {\r\n        return this.minWidth;\r\n    };\r\n\r\n    proto.getMinHeight = function() {\r\n        return this.minHeight;\r\n    };\r\n\r\n    /**\r\n     * Used to disable highlight on annotations while a new annotation is being created.\r\n     * @param {Boolean} disable - Whether (mouse) interactions are enable.\r\n     */\r\n    proto.disableInteractions = function(disable) {\r\n\r\n        this.interactionsDisabled = disable;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param width\r\n     */\r\n    proto.setStrokeWidth = function(width) {\r\n\r\n    };\r\n\r\n    proto.constrainsToBounds = function(bounds) {\r\n\r\n    };\r\n\r\n    proto.onMouseDown = function(event) {\r\n\r\n        if (this.interactionsDisabled) {\r\n            return;\r\n        }\r\n\r\n        this.select();\r\n        this.editor.editFrame.startDrag(event);\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param idTarget\r\n     * @returns *\r\n     */\r\n    proto.generatePoint3d = function(idTarget) {\r\n\r\n        var viewer = this.viewer;\r\n        var polygon = this.generateBoundingPolygon();\r\n        var self = this;\r\n\r\n        function checkLineSegmentAux(a, b) {\r\n\r\n            var point2d = self.checkLineSegment(a.x, a.y, b.x, b.y, idTarget);\r\n            var point3d = point2d && viewer.clientToWorld(point2d.x, point2d.y);\r\n            return point3d && point3d.point;\r\n        }\r\n\r\n        function checkPolygonAux(polygon) {\r\n\r\n            var point2d = self.checkPolygon(polygon, idTarget);\r\n            var point3d = point2d && viewer.clientToWorld(point2d.x, point2d.y);\r\n            return point3d && point3d.point;\r\n        }\r\n\r\n        // Try to avoid expensive calculations by checking some lines segments first.\r\n        // If line check cannot find a point the costly one by area is used.\r\n        // A ----midAB---- B\r\n        // |               |\r\n        // |     center    |\r\n        // |               |\r\n        // C --------------D\r\n\r\n        var xVertices = polygon.xVertices;\r\n        var yVertices = polygon.yVertices;\r\n\r\n        var midAB = new THREE.Vector2(xVertices[0] + xVertices[1], yVertices[0] + yVertices[1]).multiplyScalar(0.5);\r\n        var midAC = new THREE.Vector2(xVertices[0] + xVertices[3], yVertices[0] + yVertices[3]).multiplyScalar(0.5);\r\n        var midDB = new THREE.Vector2(xVertices[2] + xVertices[1], yVertices[2] + yVertices[1]).multiplyScalar(0.5);\r\n        var midDC = new THREE.Vector2(xVertices[2] + xVertices[3], yVertices[2] + yVertices[3]).multiplyScalar(0.5);\r\n        var center = midAC.clone().add(midDB).multiplyScalar(0.5);\r\n\r\n        var point3d =\r\n            checkLineSegmentAux(center, midDB) ||\r\n            checkLineSegmentAux(center, midAC) ||\r\n            checkLineSegmentAux(center, midAB) ||\r\n            checkLineSegmentAux(center, midDC);\r\n\r\n        return point3d || checkPolygonAux(polygon);\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @returns {{min: {x: number, y: number}, max: {x: number, y: number}}}\r\n     */\r\n    proto.generateBoundingBox = function() {\r\n\r\n        var boundingBox = {min: {x: 0,y: 0}, max: {x: 0, y: 0}};\r\n\r\n        // Get bounding box from markup bounding polygon.\r\n        var polygon = this.generateBoundingPolygon();\r\n\r\n        var vertexCount = polygon.vertexCount;\r\n        var xVertices = polygon.xVertices;\r\n        var yVertices = polygon.yVertices;\r\n\r\n        var bbX0 = Number.POSITIVE_INFINITY;\r\n        var bbY0 = Number.POSITIVE_INFINITY;\r\n        var bbX1 = Number.NEGATIVE_INFINITY;\r\n        var bbY1 = Number.NEGATIVE_INFINITY;\r\n\r\n        for(var i = 0; i < vertexCount; ++i) {\r\n\r\n            var bbX = xVertices[i];\r\n            var bbY = yVertices[i];\r\n\r\n            bbX0 = Math.min(bbX0, bbX);\r\n            bbY0 = Math.min(bbY0, bbY);\r\n            bbX1 = Math.max(bbX1, bbX);\r\n            bbY1 = Math.max(bbY1, bbY);\r\n        }\r\n\r\n        boundingBox.min.x = bbX0;\r\n        boundingBox.min.y = bbY0;\r\n        boundingBox.max.x = bbX1;\r\n        boundingBox.max.y = bbY1;\r\n\r\n        return boundingBox;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @returns {{vertexCount: number, xVertices: Float32Array, yVertices: Float32Array}}\r\n     */\r\n    proto.generateBoundingPolygon = function() {\r\n\r\n        var position = this.getClientPosition();\r\n        var halfSize = this.getClientSize();\r\n\r\n        halfSize.x *= 0.5;\r\n        halfSize.y *= 0.5;\r\n\r\n        var lt = new THREE.Vector3(-halfSize.x,-halfSize.y).add(position);\r\n        var rt = new THREE.Vector3( halfSize.x,-halfSize.y).add(position);\r\n        var rb = new THREE.Vector3( halfSize.x, halfSize.y).add(position);\r\n        var lb = new THREE.Vector3(-halfSize.x, halfSize.y).add(position);\r\n\r\n        if (this.rotation !== 0) {\r\n\r\n            var m1 = new THREE.Matrix4().makeTranslation(-position.x, -position.y, 0);\r\n            var m2 = new THREE.Matrix4().makeRotationZ(this.rotation);\r\n            var m3 = new THREE.Matrix4().makeTranslation(position.x, position.y, 0);\r\n            var transform = m3.multiply(m2).multiply(m1);\r\n\r\n            lt.applyMatrix4(transform);\r\n            rt.applyMatrix4(transform);\r\n            rb.applyMatrix4(transform);\r\n            lb.applyMatrix4(transform);\r\n        }\r\n\r\n        return { // packed for fast access in test algorithm.\r\n            vertexCount: 4,\r\n            xVertices : new Float32Array([lt.x, rt.x, rb.x, lb.x]),\r\n            yVertices : new Float32Array([lt.y, rt.y, rb.y, lb.y])\r\n        };\r\n    };\r\n\r\n    /**\r\n     * Implemented by extending classes.<br>\r\n     * Gets called automatically when\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore#generateData|generateData()}\r\n     * @returns {null|Element} - Either null (default) or the metadata Svg node\r\n     */\r\n    proto.setMetadata = function() {\r\n\r\n        return null; // No metadata is injected by default.\r\n    };\r\n\r\n    proto.setMouseDisabledWhenTouching = function(event) {\r\n\r\n        if (event.isFirst) {\r\n            this.shape.removeEventListener('mousedown', this.onMouseDownBinded);\r\n        } else if (event.isFinal) {\r\n            var _this = this;\r\n            setTimeout(function() {\r\n                _this.shape.addEventListener('mousedown', _this.onMouseDownBinded);\r\n            }, 10);\r\n        }\r\n    };\r\n\r\n    proto.bindDomEvents = function() {\r\n\r\n        if (isTouchDevice()) {\r\n\r\n            this.hammer = new av.Hammer.Manager(this.shape, {\r\n                recognizers: [\r\n                    av.GestureRecognizers.singletap\r\n                ],\r\n                handlePointerEventMouse: false,\r\n                inputClass: av.isIE11 ? av.Hammer.PointerEventInput : av.Hammer.TouchInput\r\n            });\r\n\r\n            this.onSingleTapBinded = function(event) {\r\n\r\n                this.onMouseDown(event);\r\n            }.bind(this);\r\n\r\n            this.onHammerInputBinded = function(event) {\r\n\r\n                this.setMouseDisabledWhenTouching(event);\r\n            }.bind(this);\r\n\r\n            this.hammer.on('singletap', this.onSingleTapBinded);\r\n            this.hammer.on('hammer.input', this.onHammerInputBinded);\r\n        }\r\n\r\n        this.onMouseDownBinded = this.onMouseDown.bind(this);\r\n        this.onMouseOutBinded = function() {\r\n\r\n            this.highlight(false);\r\n        }.bind(this);\r\n\r\n        this.onMouseOverBinded = function() {\r\n\r\n            this.highlight(true);\r\n        }.bind(this);\r\n\r\n        this.shape.addEventListener('mousedown', this.onMouseDownBinded);\r\n        this.shape.addEventListener('mouseout', this.onMouseOutBinded);\r\n        this.shape.addEventListener('mouseover', this.onMouseOverBinded);\r\n    };\r\n\r\n    proto.renderToCanvas = function(ctx, viewBox, width, height, callback) {\r\n\r\n        this.renderToCanvasX(this.shape, viewBox, width, height, ctx, callback);\r\n    };\r\n\r\n    proto.getPath = function() {\r\n\r\n    };\r\n\r\n    proto.getTransform = function() {\r\n\r\n        return [\r\n            'translate(', this.position.x, ',', this.position.y, ')',\r\n            'rotate(', radiansToDegrees(-this.rotation), ')'\r\n        ].join(' ');\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\nimport { cloneStyle } from '../StyleUtils'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param markup\r\n     * @param style\r\n     * @constructor\r\n     */\r\n    export function SetStyle(editor, markup, style) {\r\n\r\n        EditAction.call(this, editor, 'SET-STYLE', markup.id);\r\n\r\n        this.newStyle = cloneStyle(style);\r\n        this.oldStyle = markup.getStyle();\r\n    }\r\n\r\n    SetStyle.prototype = Object.create(EditAction.prototype);\r\n    SetStyle.prototype.constructor = SetStyle;\r\n\r\n    var proto = SetStyle.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        var markup = this.editor.getMarkup(this.targetId);\r\n        markup && markup.setStyle(this.newStyle);\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        var markup = this.editor.getMarkup(this.targetId);\r\n        markup && markup.setStyle(this.oldStyle);\r\n    };\r\n","'use strict';\r\n\r\nimport * as MarkupEvents from '../MarkupEvents'\r\nimport { createStyle, copyStyle } from '../StyleUtils'\r\nimport { addTraitEventDispatcher, removeTraitEventDispatcher, sign } from '../MarkupsCoreUtils'\r\nimport { SetStyle } from '../edit-actions/SetStyle'\r\n\r\nconst av = Autodesk.Viewing;\r\n\r\n    /**\r\n     * Base class for all markup edit modes.\r\n     *\r\n     * An EditMode is responsible for handling user input to create and edit a\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.Markup|Markup}.\r\n     *\r\n     * Any class extending Markup should contain at least the following methods:\r\n     * - deleteMarkup()\r\n     * - onMouseDown()\r\n     * - onMouseMove()\r\n     *\r\n     * A good reference is the Circle EditMode implementation available in\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.EditModeCircle|EditModeCircle}.\r\n     *\r\n     * @tutorial feature_markup\r\n     * @constructor\r\n     * @memberof Autodesk.Viewing.Extensions.Markups.Core\r\n     *\r\n     * @param {Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore} editor - Markups extension.\r\n     * @param {String} type - An identifier for the EditMode type. Not to be confused by the Markup's id.\r\n     * @param {Array} styleAttributes - Attributes for customization.\r\n     * @constructor\r\n     */\r\n    export function EditMode(editor, type, styleAttributes) {\r\n\r\n        this.editor = editor;\r\n        this.viewer = editor.viewer;\r\n        this.setGlobalManager(this.viewer.globalManager);\r\n        this.type = type;\r\n        this.selectedMarkup = null;\r\n        this.dragging = false;\r\n        this.draggingAnnotationIniPosition = null;\r\n        this.draggingMouseIniPosition = new THREE.Vector2();\r\n        this.initialX = 0;\r\n        this.initialY = 0;\r\n        this.minSize = 9; // In pixels\r\n        this.creating = false;\r\n        this.size = {x: 0, y: 0};\r\n        this.style = createStyle(styleAttributes, this.editor);\r\n        this.style = copyStyle(editor.getDefaultStyle(), this.style);\r\n\r\n        this.CREATION_METHOD_DRAG = 'CREATION_METHOD_DRAG';\r\n        this.CREATION_METHOD_CLICK = 'CREATION_METHOD_CLICK';\r\n        this.CREATION_METHOD_CLICKS = 'CREATION_METHOD_CLICKS';\r\n        this.creationMethod = this.CREATION_METHOD_DRAG;\r\n\r\n        addTraitEventDispatcher(this);\r\n    }\r\n\r\n    av.GlobalManagerMixin.call(EditMode.prototype);\r\n    var proto = EditMode.prototype;\r\n\r\n    proto.destroy = function() {\r\n\r\n        this.unselect();\r\n        removeTraitEventDispatcher(this);\r\n    };\r\n\r\n    proto.unselect = function() {\r\n\r\n        var fireEv = false;\r\n        var selectedMarkup = this.selectedMarkup;\r\n        var selectedId = null;\r\n\r\n        if (selectedMarkup) {\r\n            selectedId = selectedMarkup.id;\r\n            selectedMarkup.unselect();\r\n            this.selectedMarkup = null;\r\n            fireEv = true;\r\n        }\r\n\r\n        this.editor.editFrame.setMarkup(null);\r\n\r\n        if (fireEv) {\r\n            this.dispatchEvent({ type: MarkupEvents.EVENT_MARKUP_DESELECT, markupId: selectedId });\r\n        }\r\n    };\r\n\r\n    proto.creationBegin = function() {\r\n\r\n        if (this.creating) {\r\n            return;\r\n        }\r\n\r\n        this.creating = true;\r\n        this.dispatchEvent({ type: MarkupEvents.EVENT_EDITMODE_CREATION_BEGIN });\r\n    };\r\n\r\n    proto.creationEnd = function(isCancelling) {\r\n\r\n        if (!this.creating) {\r\n            return;\r\n        }\r\n\r\n        if (this.creationMethod !== this.CREATION_METHOD_CLICK) {\r\n\r\n            if (this.selectedMarkup && !this.isMinSizeValid()) {\r\n\r\n                this.creationCancel();\r\n                isCancelling = true;\r\n            } else {\r\n\r\n                if (this.creationMethod === this.CREATION_METHOD_DRAG) {\r\n                    this.finishDragging();\r\n                }\r\n\r\n                if (this.selectedMarkup) {\r\n\r\n                    // Opened on mouse down.\r\n                    this.editor.closeActionGroup();\r\n                    this.selectedMarkup = null;\r\n                }\r\n            }\r\n        }\r\n\r\n        this.creating = false;\r\n        this.dispatchEvent({ type: MarkupEvents.EVENT_EDITMODE_CREATION_END, creationCancelled: !!isCancelling });\r\n    };\r\n\r\n    proto.creationCancel = function() {\r\n\r\n        this.editor.cancelActionGroup();\r\n        this.creationEnd(true);\r\n        this.selectedMarkup = null; // No need to call unselect\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param style\r\n     */\r\n    proto.setStyle = function(style) {\r\n\r\n        this.style = style;\r\n\r\n        var selectedMarkup = this.selectedMarkup;\r\n        if(!selectedMarkup) {\r\n            return;\r\n        }\r\n\r\n        var setStyle = new SetStyle(this.editor, selectedMarkup, style);\r\n        setStyle.execute();\r\n    };\r\n\r\n    proto.getStyle = function() {\r\n\r\n        return this.style;\r\n    };\r\n\r\n    proto.setSelection = function(markup) {\r\n\r\n        if (this.selectedMarkup !== markup) {\r\n            this.unselect();\r\n            markup && markup.select();\r\n        }\r\n\r\n        this.selectedMarkup = markup;\r\n\r\n        var editor = this.editor;\r\n        markup && editor.bringToFront(markup);\r\n\r\n        if (this.isTextInputHelperActive() && editor.editFrame.markup) {\r\n            this.textInputHelper.setEditFrame();\r\n        } else if (!this.creating) {\r\n            editor.editFrame.setMarkup(markup);\r\n        }\r\n    };\r\n\r\n    proto.getSelection = function() {\r\n\r\n        return this.selectedMarkup;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param [markup] If provided deletes markup (has to have same type that the edit mode), otherwise deletes selected one.\r\n     * @param [cantUndo] If true to not add deletion to undo history.\r\n     * @returns {boolean}\r\n     */\r\n    proto.deleteMarkup = function (markup, cantUndo) {\r\n\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * Used by classes extending EditMode to validate the minimum size (in screen coordinates) of the markup.\r\n     * See minSize attribute\r\n     * @return {Boolean} Whether current size is valid for creating the markup\r\n     * @private\r\n     */\r\n    proto.isMinSizeValid = function() {\r\n\r\n        if (this.minSize !== 0) {\r\n\r\n            var tmp = this.editor.sizeFromMarkupsToClient(this.size.x, this.size.y);\r\n            return (tmp.x*tmp.x + tmp.y*tmp.y) >= (this.minSize * this.minSize);\r\n\r\n        }\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    proto.startDragging = function() {\r\n\r\n        var selectedMarkup = this.selectedMarkup;\r\n        var mousePosition = this.editor.getMousePosition();\r\n\r\n        if (selectedMarkup) {\r\n\r\n            this.dragging = true;\r\n            this.draggingAnnotationIniPosition = selectedMarkup.getClientPosition();\r\n            this.draggingMouseIniPosition.set(mousePosition.x, mousePosition.y);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    proto.finishDragging = function() {\r\n\r\n        var dragging = this.dragging;\r\n        var selectedMarkup = this.selectedMarkup;\r\n\r\n        this.dragging = false;\r\n\r\n        if (selectedMarkup && dragging) {\r\n\r\n            selectedMarkup.finishDragging();\r\n        }\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @returns {{x: number, y: number}}\r\n     */\r\n    proto.getFinalMouseDraggingPosition = function() {\r\n\r\n        var editor = this.editor;\r\n        var bounds = editor.getBounds();\r\n        var mousePosition = editor.getMousePosition();\r\n\r\n        var initialX = this.initialX;\r\n        var initialY = this.initialY;\r\n\r\n        var finalX = Math.min(Math.max(bounds.x, mousePosition.x), bounds.x + bounds.width);\r\n        var finalY = Math.min(Math.max(bounds.y, mousePosition.y), bounds.y + bounds.height);\r\n\r\n        if (finalX == initialX &&\r\n            finalY == initialY) {\r\n            finalX++;\r\n            finalY++;\r\n        }\r\n\r\n        // Make equal x/y when shift is down\r\n        if (editor.input.makeSameXY) {\r\n            var dx = Math.abs(finalX - initialX);\r\n            var dy = Math.abs(finalY - initialY);\r\n\r\n            var maxDelta = Math.max(dx, dy);\r\n\r\n            // These calculations have the opportunity to go beyond 'bounds'.\r\n            finalX = initialX + maxDelta * sign(finalX - initialX);\r\n            finalY = initialY + maxDelta * sign(finalY - initialY);\r\n        }\r\n\r\n        return { x:finalX, y:finalY };\r\n    };\r\n\r\n    proto.notifyAllowNavigation = function(allows) {\r\n\r\n    };\r\n\r\n    proto.onMouseMove = function (event) {\r\n\r\n    };\r\n\r\n    proto.onMouseDown = function () {\r\n\r\n    };\r\n\r\n    /**\r\n     * Handler to mouse up events, used to start annotations creation.\r\n     * It will cancel the creation of a markup if its minSize conditions are not met.\r\n     *\r\n     * @param {MouseEvent} event Mouse event.\r\n     * @private\r\n     */\r\n    proto.onMouseUp = function(event) {\r\n\r\n        if (this.creationMethod !== this.CREATION_METHOD_DRAG) {\r\n            return;\r\n        }\r\n\r\n        this.creationEnd();\r\n    };\r\n\r\n    proto.onMouseDoubleClick = function(event) {\r\n\r\n        if (this.creationMethod !== this.CREATION_METHOD_CLICKS) {\r\n            return;\r\n        }\r\n\r\n        this.creationEnd();\r\n    };\r\n\r\n    /**\r\n     * Notify the markup that the displayed markups are being saved so edit mode can finish current editions.\r\n     */\r\n    proto.onSave = function() {\r\n\r\n        if (this.creating) {\r\n            this.creationCancel();\r\n        }\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @returns {{x: *, y: *}}\r\n     */\r\n    proto.getDraggingPosition = function () {\r\n\r\n        var mousePosition = this.editor.getMousePosition();\r\n\r\n        var dx = mousePosition.x - this.draggingMouseIniPosition.x;\r\n        var dy = mousePosition.y - this.draggingMouseIniPosition.y;\r\n\r\n        return {\r\n            x: this.draggingAnnotationIniPosition.x + dx,\r\n            y: this.draggingAnnotationIniPosition.y + dy\r\n        };\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param x\r\n     * @param y\r\n     * @param bounds\r\n     * @returns {boolean}\r\n     * @orivate\r\n     */\r\n    proto.isInsideBounds = function (x, y, bounds) {\r\n\r\n        return x >= bounds.x && x <= bounds.x + bounds.width &&\r\n               y >= bounds.y && y <= bounds.y + bounds.height;\r\n    };\r\n\r\n    /*\r\n     * Decides whether to use the snapper in the current edit mode or not.\r\n     * \r\n     * @returns {boolean}\r\n     */\r\n    proto.useWithSnapping = function () {\r\n        return this.viewer.model.is2d();\r\n    };\r\n\r\n    \r\n    proto.isTextInputHelperActive = function() {\r\n        return this.textInputHelper && this.textInputHelper.isActive();\r\n    };\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\nimport { CreateArrow } from './CreateArrow'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param arrow\r\n     * @constructor\r\n     */\r\n    export function DeleteArrow(editor, arrow) {\r\n\r\n        // Confusing naming here. Arrow.tail is the starting point of the arrow,\r\n        // and arrow.head is the final point. In CreateArrow the head argument\r\n        // is the first point of the arrow and the tail argument is the second\r\n        // point of the argument. So construct CreateArrow with the tail before\r\n        // the head. \r\n        EditAction.call(this, editor, 'DELETE-ARROW', arrow.id);\r\n        this.createArrow = new CreateArrow(\r\n            editor,\r\n            arrow.id,\r\n            arrow.tail,\r\n            arrow.head,\r\n            arrow.getStyle());\r\n    }\r\n\r\n    DeleteArrow.prototype = Object.create(EditAction.prototype);\r\n    DeleteArrow.prototype.constructor = DeleteArrow;\r\n\r\n    var proto = DeleteArrow.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        this.createArrow.undo();\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        this.createArrow.redo();\r\n    };\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param arrow\r\n     * @param head\r\n     * @param tail\r\n     * @constructor\r\n     */\r\n    export function SetArrow(editor, arrow, head, tail) {\r\n\r\n        EditAction.call(this, editor, 'SET-ARROW', arrow.id);\r\n\r\n        this.newHead = {x: head.x, y: head.y};\r\n        this.newTail = {x: tail.x, y: tail.y};\r\n        this.oldHead = {x: arrow.head.x, y: arrow.head.y};\r\n        this.oldTail = {x: arrow.tail.x, y: arrow.tail.y};\r\n    }\r\n\r\n    SetArrow.prototype = Object.create(EditAction.prototype);\r\n    SetArrow.prototype.constructor = SetArrow;\r\n\r\n    var proto = SetArrow.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        this.applyState(this.targetId, this.newHead, this.newTail);\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        this.applyState(this.targetId, this.oldHead, this.oldTail);\r\n    };\r\n\r\n    proto.merge = function(action) {\r\n\r\n        if (this.targetId === action.targetId &&\r\n            this.type === action.type) {\r\n\r\n            this.newHead = action.newHead;\r\n            this.newTail = action.newTail;\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @private\r\n     */\r\n    proto.applyState = function(targetId, head, tail) {\r\n\r\n        var arrow = this.editor.getMarkup(targetId);\r\n        if(!arrow) {\r\n            return;\r\n        }\r\n\r\n        // Different stroke widths make positions differ at sub-pixel level.\r\n        var epsilon = 0.0001;\r\n\r\n        if (Math.abs(arrow.head.x - head.x) >= epsilon || Math.abs(arrow.head.y - head.y) >= epsilon ||\r\n            Math.abs(arrow.tail.x - tail.x) >= epsilon || Math.abs(arrow.tail.y - tail.y) >= epsilon) {\r\n\r\n            // Confusing naming here. in arrow.set the first two numbers are\r\n            // the point you drag from and the second two are the point you\r\n            // drag to. So the head point is actually where the tail of the\r\n            // arrow is positioned and the tail point is the head is positioned.\r\n            arrow.set(head.x, head.y, tail.x, tail.y);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * @returns {boolean}\r\n     */\r\n    proto.isIdentity = function() {\r\n\r\n        return (\r\n            this.newHead.x === this.oldHead.x &&\r\n            this.newHead.y === this.oldHead.y &&\r\n            this.newTail.x === this.oldTail.x &&\r\n            this.newTail.y === this.oldTail.y);\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { EditMode } from './EditMode'\r\nimport { DeleteArrow } from '../edit-actions/DeleteArrow'\r\nimport { CreateArrow } from '../edit-actions/CreateArrow'\r\nimport { SetArrow } from '../edit-actions/SetArrow'\r\nimport * as MarkupTypes from '../MarkupTypes'\r\n\r\n\r\n    var MeasureCommon = Autodesk.Viewing.MeasureCommon;\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @constructor\r\n     */\r\n    export function EditModeArrow(editor) {\r\n\r\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity'];\r\n        EditMode.call(this, editor, MarkupTypes.MARKUP_TYPE_ARROW, styleAttributes);\r\n    }\r\n\r\n    EditModeArrow.prototype = Object.create(EditMode.prototype);\r\n    EditModeArrow.prototype.constructor = EditModeArrow;\r\n\r\n\r\n    var proto = EditModeArrow.prototype;\r\n\r\n    proto.deleteMarkup = function(markup, cantUndo) {\r\n\r\n        markup = markup || this.selectedMarkup;\r\n        if (markup && markup.type == this.type) {\r\n            var deleteArrow = new DeleteArrow(this.editor, markup);\r\n            deleteArrow.addToHistory = !cantUndo;\r\n            deleteArrow.execute();\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * Handler to mouse down events, used to start markups creation.\r\n     * @private\r\n     */\r\n    proto.onMouseDown = function() {\r\n\r\n        EditMode.prototype.onMouseDown.call(this);\r\n\r\n        if (this.selectedMarkup) {\r\n            return;\r\n        }\r\n\r\n        var editor = this.editor;\r\n        var mousePosition = editor.getMousePosition();\r\n\r\n        this.initialX = mousePosition.x;\r\n        this.initialY = mousePosition.y;\r\n\r\n        this.size.x = 0;\r\n        this.size.y = 0;\r\n\r\n        // Snap to parallel/perpendicular of underlying vectors\r\n        this.lineSnapped = null;\r\n        if (editor.snapper) {\r\n            var geomType = editor.snapper.getGeometryType();\r\n            if (geomType === MeasureCommon.SnapType.SNAP_VERTEX || \r\n                geomType === MeasureCommon.SnapType.SNAP_EDGE || \r\n                geomType === MeasureCommon.SnapType.SNAP_MIDPOINT || \r\n                geomType === MeasureCommon.SnapType.SNAP_CIRCLE_CENTER) \r\n            {\r\n                this.lineSnapped = editor.snapper.getEdge();\r\n            }\r\n        }\r\n\r\n        // Calculate head and tail.\r\n        var arrowMinSize = this.style['stroke-width'] * 3.5;\r\n\r\n        var head = this.head = editor.positionFromClientToMarkups(this.initialX, this.initialY);\r\n        var tail = {\r\n            x: head.x + Math.cos( Math.PI * 0.25) * arrowMinSize,\r\n            y: head.y + Math.sin(-Math.PI * 0.25) * arrowMinSize\r\n        };\r\n        // Constrain head and tail inside working area.\r\n        var constrain = function(head, tail, size, bounds) {\r\n\r\n            if (this.isInsideBounds(tail.x, tail.y, bounds)) {\r\n                return;\r\n            }\r\n\r\n            tail.y = head.y + Math.sin( Math.PI * 0.25) * size;\r\n            if (this.isInsideBounds( tail.x, tail.y, bounds)) {\r\n                return;\r\n            }\r\n\r\n            tail.x = head.x + Math.cos(-Math.PI * 0.25) * size;\r\n            if (this.isInsideBounds( tail.x, tail.y, bounds)) {\r\n                return;\r\n            }\r\n\r\n            tail.y = head.y + Math.sin(-Math.PI * 0.25) * size;\r\n\r\n        }.bind(this);\r\n\r\n        constrain( head, tail, arrowMinSize, editor.getBounds());\r\n\r\n        // Create arrow.\r\n        editor.beginActionGroup();\r\n\r\n        var arrowVector = new THREE.Vector2(tail.x - head.x, tail.y - head.y);\r\n        if (arrowVector.lengthSq() < arrowMinSize * arrowMinSize) {\r\n\r\n            arrowVector = arrowVector.normalize().multiplyScalar(arrowMinSize);\r\n            tail.x = head.x + arrowVector.x;\r\n            tail.y = head.y + arrowVector.y;\r\n        }\r\n\r\n        var arrowId = editor.getId();\r\n        var create = new CreateArrow(editor, arrowId, head, tail, this.style);\r\n        create.execute();\r\n\r\n        this.selectedMarkup = editor.getMarkup(arrowId);\r\n        this.creationBegin();\r\n    };\r\n\r\n    /**\r\n     * Handler to mouse move events, used to create markups.\r\n     * @param {MouseEvent} event Mouse event.\r\n     * @private\r\n     */\r\n    proto.onMouseMove = function(event) {\r\n\r\n        EditMode.prototype.onMouseMove.call( this, event );\r\n\r\n        var selectedMarkup = this.selectedMarkup;\r\n        if(!selectedMarkup || !this.creating) {\r\n            return;\r\n        }\r\n\r\n        var editor = this.editor;\r\n        var final = this.getFinalMouseDraggingPosition();\r\n        var initialX = this.initialX;\r\n        var initialY = this.initialY;\r\n\r\n        // Snap to parallel/perpendicular of underlying vectors\r\n        if (editor.snapper && !editor.snapper.isSnapped() && this.lineSnapped) {\r\n            var start = editor.project(this.lineSnapped.vertices[0]);\r\n            var end = editor.project(this.lineSnapped.vertices[1]);\r\n            var p = new THREE.Vector3(final.x, final.y, start.z);\r\n\r\n            var parallel = MeasureCommon.nearestPointInPointToLine(p, start, end);\r\n\r\n            // select an arbitrary point on the perpendicular line\r\n            var k = -(start.x - end.x) / (start.y - end.y);\r\n            var b = initialY - k * initialX;\r\n            var x = initialX + 1;\r\n            var y = k * x + b;\r\n            var pEnd = new THREE.Vector3(x, y, start.z);\r\n\r\n            var pStart = new THREE.Vector3(initialX, initialY, start.z);\r\n            var perpendicular = MeasureCommon.nearestPointInPointToLine(p, pStart, pEnd);\r\n\r\n            // Snap to parallel of underlying vectors\r\n            if (parallel.distanceTo(p) <= 20) {\r\n                final.x = parallel.x;\r\n                final.y = parallel.y;\r\n            }\r\n            // Snap to perpendicular of underlying vectors\r\n            else if (perpendicular.distanceTo(p) <= 20) {\r\n                final.x = perpendicular.x;\r\n                final.y = perpendicular.y;\r\n            }\r\n        }\r\n\r\n        var head = this.head;\r\n        var tail = editor.positionFromClientToMarkups(final.x, final.y);\r\n\r\n        var arrowVector = new THREE.Vector2(tail.x - head.x, tail.y - head.y);\r\n        var arrowMinSize = selectedMarkup.style['stroke-width'] * 3.5;\r\n\r\n        if (arrowVector.lengthSq() < arrowMinSize * arrowMinSize) {\r\n\r\n            arrowVector = arrowVector.normalize().multiplyScalar(arrowMinSize);\r\n            tail.x = head.x + arrowVector.x;\r\n            tail.y = head.y + arrowVector.y;\r\n        }\r\n\r\n        this.size = editor.sizeFromClientToMarkups((final.x - initialX), (final.y - initialY));\r\n\r\n        var setArrow = new SetArrow(editor, selectedMarkup, head, tail);\r\n        setArrow.execute();\r\n    };","'use strict';\r\n\r\nimport { Markup } from './Markup'\r\nimport * as MarkupTypes from './MarkupTypes'\r\nimport { createMarkupPathSvg, composeRGBAString, setAttributeToMarkupSvg,\r\n    updateMarkupPathSvgHitarea, checkLineSegment, addMarkupMetadata } from './MarkupsCoreUtils'\r\nimport { cloneStyle } from './StyleUtils'\r\nimport { EditModeArrow } from './edit-modes/EditModeArrow'\r\n\r\n    /**\r\n     *\r\n     * @param id\r\n     * @param editor\r\n     * @constructor\r\n     */\r\n    export function MarkupArrow(id, editor) {\r\n\r\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity'];\r\n        Markup.call(this, id, editor, styleAttributes);\r\n\r\n        // bind to this to pass this.globalManager\r\n        this.addMarkupMetadata = addMarkupMetadata.bind(this);\r\n        this.checkLineSegment = checkLineSegment.bind(this);\r\n\r\n        this.type = MarkupTypes.MARKUP_TYPE_ARROW;\r\n        this.constraintHeight = true;\r\n\r\n        // Create head and tail.\r\n        this.head = new THREE.Vector3();\r\n        this.tail = new THREE.Vector3();\r\n        this.size.y = this.style['stroke-width'] * 3;\r\n        this.shape = createMarkupPathSvg();\r\n\r\n        this.bindDomEvents();\r\n    }\r\n\r\n    MarkupArrow.prototype = Object.create(Markup.prototype);\r\n    MarkupArrow.prototype.constructor = MarkupArrow;\r\n\r\n    var proto = MarkupArrow.prototype;\r\n\r\n    proto.getEditMode = function() {\r\n\r\n        return new EditModeArrow(this.editor);\r\n    };\r\n\r\n    /**\r\n     * Sets top-left and bottom-right values in client space coordinates (2d).\r\n     * Notice that for the arrow, the top left is the \"tail\" of the arrow and\r\n     * the bottom right is the \"head\" of it.\r\n     *\r\n     * @param {Number} xO - tail\r\n     * @param {Number} yO - tail\r\n     * @param {Number} xF - head\r\n     * @param {Number} yF - head\r\n     */\r\n    proto.set = function(xO, yO, xF, yF) {\r\n\r\n        var vO = new THREE.Vector2(xO, yO);\r\n        var vF = new THREE.Vector2(xF, yF);\r\n        var vDir = vF.clone().sub(vO).normalize();\r\n\r\n        this.size.x = vO.distanceTo(vF); // TODO: Clamp min length\r\n        this.rotation = Math.acos(vDir.dot(new THREE.Vector2(1,0)));\r\n        this.rotation = yF > yO ? (Math.PI*2)-this.rotation : this.rotation;\r\n\r\n        var head = this.head;\r\n        var tail = this.tail;\r\n\r\n        head.set(xF, yF, 0);\r\n        tail.set(xO, yO, 0);\r\n\r\n        this.position.x = tail.x + (head.x - tail.x) * 0.5;\r\n        this.position.y = tail.y + (head.y - tail.y) * 0.5;\r\n\r\n        this.updateStyle();\r\n    };\r\n\r\n    /**\r\n     * Changes the rotation of the markup to the given angle.\r\n     * This gets called by the Autodesk.Viewing.Extensions.Markups.Core.SetRotation edit action\r\n     *\r\n     * @param {Number} angle\r\n     */\r\n    proto.setRotation = function(angle) {\r\n\r\n        this.rotation = angle;\r\n\r\n        var xF = Math.cos(-angle);\r\n        var yF = Math.sin(-angle);\r\n        var vFDir = new THREE.Vector2(xF, yF); // already normalized\r\n        vFDir.multiplyScalar(this.size.x*0.5);\r\n\r\n        var vCenter = new THREE.Vector2(this.position.x, this.position.y);\r\n        var vO = vCenter.clone().sub(vFDir);\r\n        var vF = vCenter.clone().add(vFDir);\r\n\r\n        this.head.set(vF.x, vF.y, 0);\r\n        this.tail.set(vO.x, vO.y, 0);\r\n\r\n        this.updateStyle();\r\n    };\r\n\r\n    /**\r\n     * Changes the position and size of the markup.\r\n     * This gets called by the namespace.SetSize edit action\r\n     * @param {{x: Number, y: Number}} position - arrow's center\r\n     * @param {Number} width - Arrow's length\r\n     * @param {Number} height - We ignore this one because we use the arrow's stroke width instead\r\n     */\r\n    proto.setSize = function(position, width, height) {\r\n\r\n        var xF = Math.cos(-this.rotation);\r\n        var yF = Math.sin(-this.rotation);\r\n        var vFDir = new THREE.Vector2(xF, yF); // already normalized\r\n        vFDir.multiplyScalar(width*0.5);\r\n\r\n        var vCenter = new THREE.Vector2(position.x, position.y);\r\n        var vO = vCenter.clone().sub(vFDir);\r\n        var vF = vCenter.clone().add(vFDir);\r\n\r\n        this.head.set(vF.x, vF.y, 0);\r\n        this.tail.set(vO.x, vO.y, 0);\r\n\r\n        this.position.x = position.x;\r\n        this.position.y = position.y;\r\n        this.size.x = width;\r\n\r\n        this.updateStyle();\r\n    };\r\n\r\n    proto.updateStyle = function() {\r\n\r\n        var style = this.style;\r\n        var shape = this.shape;\r\n        var strokeWidth = style['stroke-width'];\r\n        var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\r\n        var transform = this.getTransform();\r\n\r\n        this.size.y = strokeWidth * 3;\r\n        this.style['fill-color'] = style['stroke-color'];\r\n        this.style['fill-opacity'] = style['stroke-opacity'];\r\n\r\n        setAttributeToMarkupSvg(shape, 'd', this.getPath().join(' '));\r\n        setAttributeToMarkupSvg(shape, 'stroke-width', strokeWidth);\r\n        setAttributeToMarkupSvg(shape, 'stroke', strokeColor);\r\n        setAttributeToMarkupSvg(shape, 'fill', strokeColor);\r\n        setAttributeToMarkupSvg(shape, 'transform', transform);\r\n        updateMarkupPathSvgHitarea(shape, this.editor);\r\n    };\r\n\r\n    /**\r\n     * Used by the EditFrame to move the markup in Client Space coordinates\r\n     * @param {Number} x - New X location for the markup. Notice that markups are centered on this value.\r\n     * @param {Number} y - New Y location for the markup. Notice that markups are centered on this value.\r\n     */\r\n    proto.setPosition = function (x, y) {\r\n\r\n        var head = this.head;\r\n        var tail = this.tail;\r\n\r\n        var dx = head.x - tail.x;\r\n        var dy = head.y - tail.y;\r\n\r\n        var xo = x + dx * 0.5;\r\n        var yo = y + dy * 0.5;\r\n\r\n        head.x = xo;\r\n        head.y = yo;\r\n\r\n        tail.x = xo - dx;\r\n        tail.y = yo - dy;\r\n\r\n        this.position.x = tail.x + (head.x - tail.x) * 0.5;\r\n        this.position.y = tail.y + (head.y - tail.y) * 0.5;\r\n\r\n        this.updateStyle();\r\n    };\r\n\r\n    proto.generatePoint3d = function(idTarget) {\r\n\r\n        var head = this.editor.positionFromMarkupsToClient(this.head.x, this.head.y);\r\n        var tail = this.editor.positionFromMarkupsToClient(this.tail.x, this.tail.y);\r\n\r\n        var direction = head.clone().sub(tail).normalize();\r\n\r\n        var point2d = this.checkLineSegment(head.x, head.y, head.x + direction.x * 200, head.y + direction.y * 200, idTarget);\r\n        var point3d = point2d && this.viewer.clientToWorld(point2d.x, point2d.y);\r\n\r\n        return point3d && point3d.point;\r\n    };\r\n\r\n    proto.setMetadata = function() {\r\n\r\n        var metadata = cloneStyle(this.style);\r\n\r\n        metadata.type = this.type;\r\n        metadata.head = [this.head.x, this.head.y].join(\" \");\r\n        metadata.tail = [this.tail.x, this.tail.y].join(\" \");\r\n        metadata.rotation = String(this.rotation);\r\n\r\n        return this.addMarkupMetadata(this.shape, metadata);\r\n    };\r\n\r\n    proto.getPath = function() {\r\n\r\n        // To build the arrow we need 7 points in total\r\n        // The 'default' arrow built here has the following characteristics:\r\n        //\r\n        // 1. It is built horizontally facing right\r\n        // 2. It's bounding rectangle has length: this.size.x\r\n        // 3. It's bounding rectangle has height: 2 * this.strokeWidth\r\n        // 4. The arrow tail's thickness is: this.strokeWidth\r\n        // 5. The arrow head's length is: 2/3 of (point 3)\r\n        // 6. The arrow head's thickness is: (point 3)\r\n        // 7. The arrow generated is centered in its local (0,0), meaning that\r\n        //    two points are placed with negative x values, and all other have\r\n        //    positive x values:\r\n        //\r\n        //                            (3)\\\r\n        //                              \\  \\\r\n        //             (1)-------------(2)   \\\r\n        //              |         (0)        (4)\r\n        //             (7)-------------(6)   /\r\n        //                              /  /\r\n        //                            (5)/\r\n        //\r\n\r\n        var sizeX = this.size.x;\r\n        var sizeY = this.size.y;\r\n        var sizeYOver3 = sizeY/3;\r\n        var strokeWidth = this.style['stroke-width'];\r\n        var tailW = sizeX - strokeWidth * 3;\r\n        var headW = sizeX - tailW;\r\n        var spikeOffset = strokeWidth * 0.3;\r\n\r\n        return [\r\n            'M', -sizeX * 0.5        , -sizeY * 0.5 + sizeYOver3,    // (1)\r\n            'l',  tailW              ,  0,                           // (2)\r\n            'l', -spikeOffset        , -sizeYOver3,                  // (3)\r\n            'l',  headW + spikeOffset,  sizeYOver3 * 1.5,            // (4)\r\n            'l', -headW - spikeOffset,  sizeYOver3 * 1.5,            // (5)\r\n            'l',  spikeOffset        , -sizeYOver3,                  // (6)\r\n            'l', -tailW              ,  0,                           // (7)\r\n            'z'\r\n        ];\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\nimport { MarkupArrow } from '../MarkupArrow'\r\nimport { cloneStyle } from '../StyleUtils'\r\n\r\n    /**\r\n     * @constructor\r\n     */\r\n    export function CreateArrow(editor, id, head, tail, style) {\r\n\r\n        EditAction.call(this, editor, 'CREATE-ARROW', id);\r\n\r\n        this.selectOnExecution = false;\r\n        this.tail = tail;\r\n        this.head = head;\r\n        this.style = cloneStyle(style);\r\n    }\r\n\r\n    CreateArrow.prototype = Object.create(EditAction.prototype);\r\n    CreateArrow.prototype.constructor = CreateArrow;\r\n\r\n    var proto = CreateArrow.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        var editor = this.editor;\r\n        var arrow = new MarkupArrow(this.targetId, editor);\r\n\r\n        editor.addMarkup(arrow);\r\n\r\n        // Confusing naming here. in arrow.set the first two numbers are\r\n        // the point you drag from and the second two are the point you\r\n        // drag to. So the head point is actually where the tail of the\r\n        // arrow is positioned and the tail point is the head is positioned.\r\n\r\n        //TODO: In MarkupArrow \"set\" function has tail x, tail y, head x, head y but used here in the opposite way\r\n        arrow.set(this.head.x, this.head.y, this.tail.x, this.tail.y);\r\n        arrow.setStyle(this.style);\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        var markup = this.editor.getMarkup(this.targetId);\r\n        markup && this.editor.removeMarkup(markup);\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\nimport { CreateRectangle } from './CreateRectangle'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param rectangle\r\n     * @constructor\r\n     */\r\n    export var DeleteRectangle = function(editor, rectangle) {\r\n\r\n        EditAction.call(this, editor, 'DELETE-RECTANGLE', rectangle.id);\r\n        this.createRectangle = new CreateRectangle(\r\n            editor,\r\n            rectangle.id,\r\n            rectangle.position,\r\n            rectangle.size,\r\n            rectangle.rotation,\r\n            rectangle.getStyle());\r\n    };\r\n\r\n    DeleteRectangle.prototype = Object.create(EditAction.prototype);\r\n    DeleteRectangle.prototype.constructor = DeleteRectangle;\r\n\r\n    var proto = DeleteRectangle.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        this.createRectangle.undo();\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        this.createRectangle.redo();\r\n    };\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param rectangle\r\n     * @param position\r\n     * @param size\r\n     * @constructor\r\n     */\r\n    export function SetRectangle(editor, rectangle, position, size) {\r\n\r\n        EditAction.call(this, editor, 'SET-RECTANGLE', rectangle.id);\r\n\r\n        this.newPosition = {x: position.x, y: position.y};\r\n        this.newSize = {x: size.x, y: size.y};\r\n        this.oldPosition = {x: rectangle.position.x, y: rectangle.position.y};\r\n        this.oldSize = {x: rectangle.size.x, y: rectangle.size.y};\r\n    }\r\n\r\n    SetRectangle.prototype = Object.create(EditAction.prototype);\r\n    SetRectangle.prototype.constructor = SetRectangle;\r\n\r\n    var proto = SetRectangle.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        this.applyState(this.targetId, this.newPosition, this.newSize);\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        this.applyState(this.targetId, this.oldPosition, this.oldSize);\r\n    };\r\n\r\n    proto.merge = function(action) {\r\n\r\n        if (this.targetId === action.targetId &&\r\n            this.type === action.type) {\r\n\r\n            this.newPosition = action.newPosition;\r\n            this.newSize = action.newSize;\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @private\r\n     */\r\n    proto.applyState = function(targetId, position, size) {\r\n\r\n        var rectangle = this.editor.getMarkup(targetId);\r\n        if(!rectangle) {\r\n            return;\r\n        }\r\n\r\n        // Different stroke widths make positions differ at sub-pixel level.\r\n        var epsilon = 0.0001;\r\n\r\n        if (Math.abs(rectangle.position.x - position.x) > epsilon || Math.abs(rectangle.size.y - size.y) > epsilon ||\r\n            Math.abs(rectangle.position.y - position.y) > epsilon || Math.abs(rectangle.size.y - size.y) > epsilon) {\r\n\r\n            rectangle.set(position, size);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * @returns {boolean}\r\n     */\r\n    proto.isIdentity = function() {\r\n\r\n        return(\r\n            this.newPosition.x === this.oldPosition.x &&\r\n            this.newPosition.y === this.oldPosition.y &&\r\n            this.newSize.x === this.oldSize.x &&\r\n            this.newSize.y === this.oldSize.y);\r\n    };\r\n","'use strict';\r\n\r\nimport { EditMode } from './EditMode'\r\nimport { DeleteRectangle } from '../edit-actions/DeleteRectangle'\r\nimport { CreateRectangle } from '../edit-actions/CreateRectangle'\r\nimport { SetRectangle } from '../edit-actions/SetRectangle'\r\nimport * as MarkupTypes from '../MarkupTypes'\r\n\r\n    var MeasureCommon = Autodesk.Viewing.MeasureCommon;\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @constructor\r\n     */\r\n    export function EditModeRectangle(editor) {\r\n\r\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity', 'fill-color', 'fill-opacity'];\r\n        EditMode.call(this, editor, MarkupTypes.MARKUP_TYPE_RECTANGLE, styleAttributes);\r\n    }\r\n\r\n    EditModeRectangle.prototype = Object.create(EditMode.prototype);\r\n    EditModeRectangle.prototype.constructor = EditModeRectangle;\r\n\r\n    var proto = EditModeRectangle.prototype;\r\n\r\n    proto.deleteMarkup = function(markup, cantUndo) {\r\n\r\n        markup = markup || this.selectedMarkup;\r\n        if (markup && markup.type == this.type) {\r\n            var deleteRectangle = new DeleteRectangle(this.editor, markup);\r\n            deleteRectangle.addToHistory = !cantUndo;\r\n            deleteRectangle.execute();\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * Handler to mouse move events, used to create markups.\r\n     * @param {MouseEvent} event Mouse event.\r\n     * @private\r\n     */\r\n    proto.onMouseMove = function(event) {\r\n\r\n        EditMode.prototype.onMouseMove.call( this, event );\r\n\r\n        var selectedMarkup = this.selectedMarkup;\r\n        if(!selectedMarkup || !this.creating) {\r\n            return;\r\n        }\r\n\r\n        var editor = this.editor;\r\n\r\n        var pos = this.getFinalMouseDraggingPosition();\r\n        var final = editor.clientToMarkups(pos.x, pos.y);\r\n        var position = {x: (this.firstCorner.x + final.x) / 2, y: (this.firstCorner.y + final.y) / 2};\r\n\r\n        var width, height;\r\n        // Snap to parallel/perpendicular of underlying vectors\r\n        if (editor.snapper && this.lineSnapped) {\r\n            var start = editor.project(this.lineSnapped.vertices[0]);\r\n            var end = editor.project(this.lineSnapped.vertices[1]);\r\n\r\n            var startZ = start.z;\r\n\r\n            start = editor.clientToMarkups(start.x, start.y);\r\n            end = editor.clientToMarkups(end.x, end.y);\r\n\r\n            start = new THREE.Vector3(start.x, start.y, startZ);\r\n            end = new THREE.Vector3(end.x, end.y, startZ);\r\n\r\n            var p = new THREE.Vector3(final.x, final.y, startZ);\r\n\r\n            var parallel = MeasureCommon.nearestPointInPointToLine(p, start, end);\r\n            height = p.distanceTo(parallel);\r\n\r\n            // select an arbitrary point on the perpendicular line\r\n            var k = -(start.x - end.x) / (start.y - end.y);\r\n            var b = this.firstCorner.y - k * this.firstCorner.x;\r\n            var x = this.firstCorner.x + 1;\r\n            var y = k * x + b;\r\n            var pEnd = new THREE.Vector3(x, y, startZ);\r\n\r\n            var pStart = new THREE.Vector3(this.firstCorner.x, this.firstCorner.y, startZ);\r\n            var perpendicular = MeasureCommon.nearestPointInPointToLine(p, pStart, pEnd);\r\n            width = p.distanceTo(perpendicular);\r\n        }\r\n        else {\r\n            width = final.x - this.firstCorner.x;\r\n            height = final.y - this.firstCorner.y;\r\n        }\r\n\r\n        var size = this.size = {x: Math.abs(width), y: Math.abs(height)};\r\n\r\n        var setRectangle = new SetRectangle(\r\n            editor,\r\n            selectedMarkup,\r\n            position,\r\n            size);\r\n\r\n        setRectangle.execute();\r\n    };\r\n\r\n    /**\r\n     * Handler to mouse down events, used to start markups creation.\r\n     * @private\r\n     */\r\n    proto.onMouseDown = function() {\r\n\r\n        EditMode.prototype.onMouseDown.call(this);\r\n\r\n        if (this.selectedMarkup) {\r\n            return;\r\n        }\r\n\r\n        var editor = this.editor;\r\n        var mousePosition = editor.getMousePosition();\r\n\r\n        this.initialX = mousePosition.x;\r\n        this.initialY = mousePosition.y;\r\n\r\n        // Calculate center and size.\r\n        var position = this.firstCorner = editor.clientToMarkups(this.initialX, this.initialY);\r\n        var size = this.size = editor.sizeFromClientToMarkups(1, 1);\r\n\r\n        // Calculate rotation\r\n        var rotation = 0;\r\n        this.lineSnapped = null;\r\n        if (editor.snapper) {\r\n            // Snap to parallel/perpendicular of underlying vectors\r\n            var geomType = editor.snapper.getGeometryType();\r\n            if (geomType === MeasureCommon.SnapType.SNAP_EDGE) {\r\n                this.lineSnapped = editor.snapper.getEdge();\r\n                var start = editor.project(this.lineSnapped.vertices[0]);\r\n                var end = editor.project(this.lineSnapped.vertices[1]);\r\n                var dx = end.x - start.x;\r\n                var dy = end.y - start.y;\r\n                rotation = this.rotation = Math.atan2(dy, dx);\r\n            }\r\n        }\r\n\r\n        // Create rectangle.\r\n        editor.beginActionGroup();\r\n\r\n        var markupId = editor.getId();\r\n        var create = new CreateRectangle(\r\n            editor,\r\n            markupId,\r\n            position,\r\n            size,\r\n            rotation,\r\n            this.style);\r\n\r\n        create.execute();\r\n\r\n        this.selectedMarkup = editor.getMarkup(markupId);\r\n        this.creationBegin();\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { Markup } from './Markup'\r\nimport * as MarkupTypes from './MarkupTypes'\r\nimport { createMarkupPathSvg, composeRGBAString, createRectanglePath,\r\n    setAttributeToMarkupSvg, updateMarkupPathSvgHitarea, addMarkupMetadata } from './MarkupsCoreUtils'\r\nimport { cloneStyle } from './StyleUtils'\r\nimport { EditModeRectangle } from './edit-modes/EditModeRectangle'\r\n\r\n    /**\r\n     * Rectangle markup.\r\n     *\r\n     * Implements a Rectangle {@link Autodesk.Viewing.Extensions.Markups.Core.Markup|Markup}.\r\n     * Included in documentation as an example of how to create\r\n     * a specific markup type. Developers are encourage to look into this class's source code and copy\r\n     * as much code as they need. Find link to source code below.\r\n     *\r\n     * @tutorial feature_markup\r\n     * @constructor\r\n     * @memberof Autodesk.Viewing.Extensions.Markups.Core\r\n     * @extends Autodesk.Viewing.Extensions.Markups.Core.Markup\r\n     *\r\n     * @param {number} id\r\n     * @param {Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore} editor\r\n     * @constructor\r\n     */\r\n    export function MarkupRectangle(id, editor) {\r\n\r\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity', 'fill-color', 'fill-opacity'];\r\n        Markup.call(this, id, editor, styleAttributes);\r\n\r\n        // Bind to this to pass this.globalManager\r\n        this.addMarkupMetadata = addMarkupMetadata.bind(this);\r\n\r\n        this.type = MarkupTypes.MARKUP_TYPE_RECTANGLE;\r\n        this.shape = createMarkupPathSvg();\r\n\r\n        this.bindDomEvents();\r\n    }\r\n\r\n    MarkupRectangle.prototype = Object.create(Markup.prototype);\r\n    MarkupRectangle.prototype.constructor = MarkupRectangle;\r\n\r\n    var proto = MarkupRectangle.prototype;\r\n\r\n    proto.getEditMode = function() {\r\n\r\n        return new EditModeRectangle(this.editor);\r\n    };\r\n\r\n    /**\r\n     * Sets position and size in markup space coordinates\r\n     * @param {Object} position\r\n     * @param {Object} size\r\n     */\r\n    proto.set = function(position, size) {\r\n\r\n        this.position.x = position.x;\r\n        this.position.y = position.y;\r\n        this.size.x = size.x;\r\n        this.size.y = size.y;\r\n\r\n        this.updateStyle();\r\n    };\r\n\r\n    /**\r\n     * Applies data values into DOM element style/attribute(s)\r\n     *\r\n     */\r\n    proto.updateStyle = function() {\r\n\r\n        var style = this.style;\r\n        var shape = this.shape;\r\n        var path = this.getPath().join(' ');\r\n\r\n        var strokeWidth = this.style['stroke-width'];\r\n        var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\r\n        var fillColor = composeRGBAString(style['fill-color'], style['fill-opacity']);\r\n        var transform = this.getTransform();\r\n\r\n        setAttributeToMarkupSvg(shape, 'd', path);\r\n        setAttributeToMarkupSvg(shape, 'stroke-width', strokeWidth);\r\n        setAttributeToMarkupSvg(shape, 'stroke', strokeColor);\r\n        setAttributeToMarkupSvg(shape, 'fill', fillColor);\r\n        setAttributeToMarkupSvg(shape, 'transform', transform);\r\n        updateMarkupPathSvgHitarea(shape, this.editor);\r\n    };\r\n\r\n    proto.setMetadata = function() {\r\n\r\n        var metadata = cloneStyle(this.style);\r\n\r\n        metadata.type = this.type;\r\n        metadata.position = [this.position.x, this.position.y].join(\" \");\r\n        metadata.size = [this.size.x, this.size.y].join(\" \");\r\n        metadata.rotation = String(this.rotation);\r\n\r\n        return this.addMarkupMetadata(this.shape, metadata);\r\n    };\r\n\r\n    proto.getPath = function() {\r\n\r\n        var strokeWidth = this.style['stroke-width'];\r\n\r\n        var w = this.size.x - strokeWidth;\r\n        var h = this.size.y - strokeWidth;\r\n        var x =-w * 0.5;\r\n        var y =-h * 0.5;\r\n\r\n        var path = [];\r\n        createRectanglePath(x, y, w, h, false, path);\r\n\r\n        return path;\r\n    };\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\nimport { MarkupRectangle } from '../MarkupRectangle'\r\nimport { cloneStyle } from '../StyleUtils'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param id\r\n     * @param position\r\n     * @param size\r\n     * @param rotation\r\n     * @param style\r\n     * @constructor\r\n     */\r\n    export function CreateRectangle(editor, id, position, size, rotation, style) {\r\n\r\n        EditAction.call(this, editor, 'CREATE-RECTANGLE', id);\r\n\r\n        this.selectOnExecution = false;\r\n        this.position = {x: position.x, y: position.y};\r\n        this.size = {x: size.x, y: size.y};\r\n        this.rotation = rotation;\r\n        this.style = cloneStyle(style);\r\n    }\r\n\r\n    CreateRectangle.prototype = Object.create(EditAction.prototype);\r\n    CreateRectangle.prototype.constructor = CreateRectangle;\r\n\r\n    var proto = CreateRectangle.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        var editor = this.editor;\r\n        var rectangle = new MarkupRectangle(this.targetId, editor);\r\n\r\n        editor.addMarkup(rectangle);\r\n\r\n        rectangle.set(this.position, this.size);\r\n        rectangle.setRotation(this.rotation);\r\n        rectangle.setStyle(this.style);\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        var markup = this.editor.getMarkup(this.targetId);\r\n        markup && this.editor.removeMarkup(markup);\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\nimport { CreateText } from './CreateText'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param text\r\n     * @constructor\r\n     */\r\n    export function DeleteText(editor, text) {\r\n\r\n        EditAction.call(this, editor, 'DELETE-TEXT', text.id);\r\n\r\n        var position = {x: text.position.x, y: text.position.y};\r\n        var size = {x: text.size.x, y: text.size.y};\r\n\r\n        this.createText = new CreateText(\r\n            editor,\r\n            text.id,\r\n            position,\r\n            size,\r\n            text.getText(),\r\n            text.getStyle());\r\n    }\r\n\r\n    DeleteText.prototype = Object.create(EditAction.prototype);\r\n    DeleteText.prototype.constructor = DeleteText;\r\n\r\n    var proto = DeleteText.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        this.createText.undo();\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        this.createText.redo();\r\n    };\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param markup\r\n     * @param position\r\n     * @param size\r\n     * @param text\r\n     * @constructor\r\n     */\r\n    export function SetCallout(editor, markup, position, size, text, isFrameUsed) {\r\n\r\n        EditAction.call(this, editor, 'SET-CALLOUT', markup.id);\r\n\r\n        this.newPosition = {x: position.x, y: position.y};\r\n        this.oldPosition = {x: markup.position.x, y: markup.position.y};\r\n        this.newSize = {x: size.x, y: size.y};\r\n        this.oldSize = {x: markup.size.x, y: markup.size.y};\r\n        this.newText = text;\r\n        this.oldText = markup.getText();\r\n        this.newIsFrameUsed = isFrameUsed;\r\n        this.oldIsFrameUsed = markup.isFrameUsed;\r\n    }\r\n\r\n    SetCallout.prototype = Object.create(EditAction.prototype);\r\n    SetCallout.prototype.constructor = SetCallout;\r\n\r\n    var proto = SetCallout.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        var callout = this.editor.getMarkup(this.targetId);\r\n        callout && callout.set(this.newPosition, this.newSize, this.newText, this.newIsFrameUsed);\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        var callout = this.editor.getMarkup(this.targetId);\r\n        callout && callout.set(this.oldPosition, this.oldSize, this.oldText, this.oldIsFrameUsed);\r\n    };\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param markup\r\n     * @param position\r\n     * @param width\r\n     * @param height\r\n     * @constructor\r\n     */\r\n    export function SetSize(editor, markup, position, width, height) {\r\n\r\n        EditAction.call(this, editor, 'SET-SIZE', markup.id);\r\n\r\n        this.newPosition = {x: position.x, y: position.y};\r\n        this.oldPosition = {x: markup.position.x, y: markup.position.y};\r\n        this.newWidth = width;\r\n        this.oldWidth = markup.size.x;\r\n        this.newHeight = height;\r\n        this.oldHeight = markup.size.y;\r\n    }\r\n\r\n    SetSize.prototype = Object.create(EditAction.prototype);\r\n    SetSize.prototype.constructor = SetSize;\r\n\r\n    var proto = SetSize.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        var markup = this.editor.getMarkup(this.targetId);\r\n        markup && markup.setSize(this.newPosition, this.newWidth, this.newHeight);\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        var markup = this.editor.getMarkup(this.targetId);\r\n        markup && markup.setSize(this.oldPosition, this.oldWidth, this.oldHeight);\r\n    };\r\n\r\n    proto.merge = function(action) {\r\n\r\n        if (this.targetId === action.targetId &&\r\n            this.type === action.type) {\r\n\r\n            this.newPosition = action.newPosition;\r\n            this.newWidth = action.newWidth;\r\n            this.newHeight = action.newHeight;\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * @returns {boolean}\r\n     */\r\n    proto.isIdentity = function() {\r\n\r\n        var identity =\r\n            this.newPosition.x === this.oldPosition.x &&\r\n            this.newPosition.y === this.oldPosition.y &&\r\n            this.newWidth === this.oldWidth &&\r\n            this.newHeight === this.oldHeight;\r\n\r\n        return identity;\r\n    };\r\n","\r\n'use strict';\r\n\r\n/*!\r\n    Based on Autosize 4.0.0\r\n    license: MIT\r\n    http://www.jacklmoore.com/autosize\r\n*/\r\nvar map = typeof Map === \"function\" ? new Map() : (function () {\r\n    var keys = [];\r\n    var values = [];\r\n\r\n    return {\r\n        has: function has(key) {\r\n            return keys.indexOf(key) > -1;\r\n        },\r\n        get: function get(key) {\r\n            return values[keys.indexOf(key)];\r\n        },\r\n        set: function set(key, value) {\r\n            if (keys.indexOf(key) === -1) {\r\n                keys.push(key);\r\n                values.push(value);\r\n            }\r\n        },\r\n        'delete': function _delete(key) {\r\n            var index = keys.indexOf(key);\r\n            if (index > -1) {\r\n                keys.splice(index, 1);\r\n                values.splice(index, 1);\r\n            }\r\n        }\r\n    };\r\n})();\r\n\r\nvar createEvent = function createEvent(name) {\r\n    return new Event(name, { bubbles: true });\r\n};\r\ntry {\r\n    new Event('test');\r\n} catch (e) {\r\n    // IE does not support `new Event()`\r\n    createEvent = function (name) {\r\n        const _document = Autodesk.Viewing.getGlobal().document;\r\n        var evt = _document.createEvent('Event');\r\n        evt.initEvent(name, true, false);\r\n        return evt;\r\n    };\r\n}\r\n\r\nfunction assign(ta) {\r\n    if (!ta || !ta.nodeName || ta.nodeName !== 'TEXTAREA' || map.has(ta)) return;\r\n\r\n    var heightOffset = null;\r\n    var clientWidth = ta.clientWidth;\r\n    var cachedHeight = null;\r\n\r\n    const self = this;\r\n    function init() {\r\n        const _window = self.getWindow();\r\n        var style = _window.getComputedStyle(ta, null);\r\n\r\n        if (style.resize === 'vertical') {\r\n            ta.style.resize = 'none';\r\n        } else if (style.resize === 'both') {\r\n            ta.style.resize = 'horizontal';\r\n        }\r\n\r\n        if (style.boxSizing === 'content-box') {\r\n            heightOffset = -(parseFloat(style.paddingTop) + parseFloat(style.paddingBottom));\r\n        } else {\r\n            heightOffset = parseFloat(style.borderTopWidth) + parseFloat(style.borderBottomWidth);\r\n        }\r\n        // Fix when a textarea is not on document body and heightOffset is Not a Number\r\n        if (isNaN(heightOffset)) {\r\n            heightOffset = 0;\r\n        }\r\n\r\n        update();\r\n    }\r\n\r\n    function changeOverflow(value) {\r\n        {\r\n            // Chrome/Safari-specific fix:\r\n            // When the textarea y-overflow is hidden, Chrome/Safari do not reflow the text to account for the space\r\n            // made available by removing the scrollbar. The following forces the necessary text reflow.\r\n            var width = ta.style.width;\r\n            ta.style.width = '0px';\r\n            // Force reflow:\r\n            /* jshint ignore:start */\r\n            ta.offsetWidth;\r\n            /* jshint ignore:end */\r\n            ta.style.width = width;\r\n        }\r\n\r\n        ta.style.overflow = value;\r\n    }\r\n\r\n    function getParentOverflows(el) {\r\n        var arr = [];\r\n\r\n        while (el && el.parentNode && el.parentNode instanceof Element) {\r\n            if (el.parentNode.scrollTop) {\r\n                arr.push({\r\n                    node: el.parentNode,\r\n                    scrollTop: el.parentNode.scrollTop\r\n                });\r\n            }\r\n            el = el.parentNode;\r\n        }\r\n\r\n        return arr;\r\n    }\r\n\r\n    function resize() {\r\n        var originalHeight = ta.style.height;\r\n        var overflows = getParentOverflows(ta);\r\n        const _document = self.getDocument();\r\n        var docTop = _document.documentElement && _document.documentElement.scrollTop; // Needed for Mobile IE (ticket #240)\r\n\r\n        ta.style.height = '';\r\n\r\n        var endHeight = ta.scrollHeight + heightOffset;\r\n\r\n        if (ta.scrollHeight === 0) {\r\n            // If the scrollHeight is 0, then the element probably has display:none or is detached from the DOM.\r\n            ta.style.height = originalHeight;\r\n            return;\r\n        }\r\n\r\n        ta.style.height = endHeight + 'px';\r\n\r\n        // used to check if an update is actually necessary on window.resize\r\n        clientWidth = ta.clientWidth;\r\n\r\n        // prevents scroll-position jumping\r\n        overflows.forEach(function (el) {\r\n            // This condition is necessary for iOS 11, where you can't assign value to body.scrollTop\r\n            if (el.node.scrollTop !== el.scrollTop) {\r\n                el.node.scrollTop = el.scrollTop;\r\n            }\r\n        });\r\n\r\n        if (docTop) {\r\n            _document.documentElement.scrollTop = docTop;\r\n        }\r\n    }\r\n\r\n    function update() {\r\n        resize();\r\n\r\n        const _window = self.getWindow();\r\n        var styleHeight = Math.round(parseFloat(ta.style.height));\r\n        var computed = _window.getComputedStyle(ta, null);\r\n\r\n        // Using offsetHeight as a replacement for computed.height in IE, because IE does not account use of border-box\r\n        var actualHeight = computed.boxSizing === 'content-box' ? Math.round(parseFloat(computed.height)) : ta.offsetHeight;\r\n\r\n        // The actual height not matching the style height (set via the resize method) indicates that\r\n        // the max-height has been exceeded, in which case the overflow should be allowed.\r\n        if (actualHeight !== styleHeight) {\r\n            if (computed.overflow === 'hidden') {\r\n                changeOverflow('scroll');\r\n                resize();\r\n                actualHeight = computed.boxSizing === 'content-box' ? Math.round(parseFloat(window.getComputedStyle(ta, null).height)) : ta.offsetHeight;\r\n            }\r\n        } else {\r\n            // Normally keep overflow set to hidden, to avoid flash of scrollbar as the textarea expands.\r\n            if (computed.overflow !== 'hidden') {\r\n                changeOverflow('hidden');\r\n                resize();\r\n                actualHeight = computed.boxSizing === 'content-box' ? Math.round(parseFloat(window.getComputedStyle(ta, null).height)) : ta.offsetHeight;\r\n            }\r\n        }\r\n\r\n        if (cachedHeight !== actualHeight) {\r\n            cachedHeight = actualHeight;\r\n            var evt = createEvent('autosize:resized');\r\n            try {\r\n                ta.dispatchEvent(evt);\r\n            } catch (err) {\r\n                // Firefox will throw an error on dispatchEvent for a detached element\r\n                // https://bugzilla.mozilla.org/show_bug.cgi?id=889376\r\n            }\r\n        }\r\n    }\r\n\r\n    var pageResize = function pageResize() {\r\n        if (ta.clientWidth !== clientWidth) {\r\n            update();\r\n        }\r\n    };\r\n\r\n    var destroy = (function (style) {\r\n        self.removeWindowEventListener('resize', pageResize, false);\r\n        ta.removeEventListener('input', update, false);\r\n        ta.removeEventListener('keyup', update, false);\r\n        ta.removeEventListener('autosize:destroy', destroy, false);\r\n        ta.removeEventListener('autosize:update', update, false);\r\n\r\n        Object.keys(style).forEach(function (key) {\r\n            ta.style[key] = style[key];\r\n        });\r\n\r\n        map['delete'](ta);\r\n    }).bind(ta, {\r\n        height: ta.style.height,\r\n        resize: ta.style.resize,\r\n        overflow: ta.style.overflow,\r\n        overflowX: ta.style.overflowX,\r\n        wordWrap: ta.style.wordWrap\r\n    });\r\n\r\n    ta.addEventListener('autosize:destroy', destroy, false);\r\n\r\n    // IE9 does not fire onpropertychange or oninput for deletions,\r\n    // so binding to onkeyup to catch most of those events.\r\n    // There is no way that I know of to detect something like 'cut' in IE9.\r\n    if ('onpropertychange' in ta && 'oninput' in ta) {\r\n        ta.addEventListener('keyup', update, false);\r\n    }\r\n\r\n    self.addWindowEventListener('resize', pageResize, false);\r\n    ta.addEventListener('input', update, false);\r\n    ta.addEventListener('autosize:update', update, false);\r\n    ta.style.overflowX = 'hidden';\r\n    ta.style.wordWrap = 'break-word';\r\n\r\n    map.set(ta, {\r\n        destroy: destroy,\r\n        update: update\r\n    });\r\n\r\n    init();\r\n}\r\n\r\nfunction destroy(ta) {\r\n    var methods = map.get(ta);\r\n    if (methods) {\r\n        methods.destroy();\r\n    }\r\n}\r\n\r\nfunction update(ta) {\r\n    var methods = map.get(ta);\r\n    if (methods) {\r\n        methods.update();\r\n    }\r\n}\r\n\r\nfunction isRuntimeSupported() {\r\n    // Don't support Node.js and IE8 (or lower)\r\n    const _window = Autodesk.Viewing.getGlobal();\r\n    if (typeof window === 'undefined' || typeof window.getComputedStyle !== 'function')\r\n        return false;\r\n    return true;\r\n}\r\n\r\nconst RUNTIME_SUPPORTED = isRuntimeSupported();\r\n\r\n\r\nexport var autosize = function(el, options) {\r\n    const self = this;\r\n    if (RUNTIME_SUPPORTED && el) {\r\n        Array.prototype.forEach.call(el.length ? el : [el], function (x) {\r\n            return assign.bind(self)(x, options);\r\n        });\r\n    } \r\n    return el;\r\n};\r\n\r\nautosize.destroy = function(el) {\r\n    if (RUNTIME_SUPPORTED && el) {\r\n        Array.prototype.forEach.call(el.length ? el : [el], destroy);\r\n    }\r\n    return el;\r\n}\r\n\r\nautosize.update = function(el) {\r\n    if (RUNTIME_SUPPORTED && el) {\r\n        Array.prototype.forEach.call(el.length ? el : [el], update);\r\n    }\r\n    return el;\r\n}\r\n","'use strict';\r\n\r\n    /**\r\n     * Curring object which generate a string that can be used\r\n     * as a Dom element's 'style' value.\r\n     *\r\n     * @constructor\r\n     */\r\n    export function DomElementStyle() {\r\n\r\n        this.reset();\r\n    }\r\n\r\n    /*\r\n     * Constants\r\n     */\r\n    var BROWSER_PREFIXES = ['-ms-', '-webkit-', '-moz-', '-o-'];\r\n\r\n    var proto = DomElementStyle.prototype;\r\n\r\n    proto.reset = function() {\r\n\r\n        this.attributes = {};\r\n        this.dirty = false;\r\n        this.styleString = '';\r\n\r\n        return this;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param {String} key\r\n     * @param {*} value\r\n     * @param {Object} [options]\r\n     * @param {Boolean} [options.allBrowsers] - Whether to add browser prefix to key\r\n     * @returns {Autodesk.Viewing.Extensions.Markups.Core.Utils.DomeElemStyle}\r\n     */\r\n    proto.setAttribute = function(key, value, options) {\r\n\r\n        this.attributes[key] = value;\r\n\r\n        if (options && options.allBrowsers) {\r\n            var that = this;\r\n            BROWSER_PREFIXES.forEach(function(prefix){\r\n                that.attributes[(prefix+key)] = value;\r\n            });\r\n        }\r\n        this.dirty = true; // Could be optimized\r\n        return this;\r\n    };\r\n\r\n    /**\r\n     * Removes one or more attributes\r\n     * @param {String|Array} key - Key or Keys to be removed\r\n     * @returns {Autodesk.Viewing.Extensions.Markups.Core.Utils.DomElemStyle} this\r\n     */\r\n    proto.removeAttribute = function(key) {\r\n\r\n        if (!Array.isArray(key)) {\r\n            key = [key];\r\n        }\r\n\r\n        var self = this;\r\n        key.forEach(function(k) {\r\n            if (k in self.attributes) {\r\n                delete self.attributes[k];\r\n                self.dirty = true;\r\n            }\r\n        });\r\n        return this;\r\n    };\r\n\r\n    /**\r\n     * Gets the String representation of this style object\r\n     * @returns {string}\r\n     */\r\n    proto.getStyleString = function() {\r\n\r\n        if (this.dirty) {\r\n            this.styleString = generateStyle(this.attributes);\r\n            this.dirty = false;\r\n        }\r\n        return this.styleString;\r\n    };\r\n\r\n    /**\r\n     * Clones the current Object\r\n     *\r\n     * @returns {Autodesk.Viewing.Extensions.Markups.Core.Utils.DomElemStyle}\r\n     */\r\n    proto.clone = function() {\r\n\r\n        var clone = new DomElementStyle();\r\n        var attributes = this.attributes;\r\n\r\n        for (var key in attributes) {\r\n            clone.setAttribute(key, attributes[key]);\r\n        }\r\n        return clone;\r\n    };\r\n\r\n    /**\r\n     * Generates the style value string. Non mutable function.\r\n     *\r\n     * @param {Object} attributes\r\n     * @private\r\n     */\r\n    function generateStyle(attributes) {\r\n\r\n        var elements = [];\r\n        for (var key in attributes) {\r\n            var val = attributes[key];\r\n            elements.push(key);\r\n            elements.push(':');\r\n            elements.push(val);\r\n            elements.push('; ');\r\n        }\r\n        return elements.join('');\r\n    }\r\n","'use strict';\r\n\r\nconst ResizeObserver = require('../../../thirdparty/resize-observer-polyfill/ResizeObserver.min.js'); // Required for Markup Text Input\r\nimport { autosize } from './EditorTextAutosize'\r\nimport { addTraitEventDispatcher } from '../MarkupsCoreUtils'\r\nimport { cloneStyle } from '../StyleUtils'\r\nimport { DomElementStyle } from '../DomElementStyle'\r\n\r\nconst av = Autodesk.Viewing;\r\n\r\n    /**\r\n     * Auxiliary class that handles all input for the Label Markup (MarkupText.js)\r\n     * It instantiates a TEXTAREA where the user can input text. When user input is\r\n     * disabled, the textarea gets hidden and further rendering is delegated to\r\n     * MarkupText.js\r\n     *\r\n     * @param {HTMLElement} parentDiv\r\n     * @param {Object} editor - Core Extension\r\n     * @constructor\r\n     */\r\n    export function EditorTextInput(parentDiv, editor, singleLine, defaultText, maxLength) {\r\n\r\n        this.parentDiv = parentDiv;\r\n        this.editor = editor;\r\n        this.setGlobalManager(editor.viewer.globalManager);\r\n\r\n        // Constants\r\n        this.EVENT_TEXT_CHANGE = 'EVENT_CO2_TEXT_CHANGE';\r\n        this.EVENT_TEXT_SET_ACTIVE = 'EVENT_CO2_TEXT_SET_ACTIVE';\r\n        this.EVENT_TEXT_SET_INACTIVE = 'EVENT_CO2_TEXT_SET_INACTIVE';\r\n\r\n        const _document = this.getDocument();\r\n        // The actual TextArea input\r\n        if (singleLine) {\r\n            this.textArea = _document.createElement('input');\r\n            this.textArea.setAttribute('type', 'text');\r\n        }\r\n        else {\r\n            this.textArea = _document.createElement('textarea');\r\n            this.textArea.rows = '1';\r\n            if (!Autodesk.Viewing.isIE11) { // auto parameter not available in IE11\r\n                this.textArea.dir = 'auto';\r\n            }\r\n        }\r\n\r\n        this.firstEdit = true;\r\n        this.defaultText = defaultText;\r\n        this.textArea.setAttribute('maxlength', maxLength); // TODO: Make constant? Change value?\r\n        this.textArea.setAttribute('data-i18n', defaultText);\r\n        this.startingHeight = 0;\r\n\r\n        autosize.bind(this)(this.textArea);\r\n\r\n        var ro = new ResizeObserver(function(entries, observer) {\r\n            this.setEditFrame();\r\n        }.bind(this));\r\n\r\n        ro.observe(this.textArea);\r\n\r\n        this.styleTextArea = new DomElementStyle(); // TODO: Move this to EditMode.\r\n        this.styleTextArea\r\n                .setAttribute('position', 'absolute')\r\n                .setAttribute('resize', 'none')\r\n                .setAttribute('box-sizing', 'border-box')\r\n                .setAttribute('-moz-box-sizing', 'border-box')\r\n                .setAttribute('-webkit-box-sizing', 'border-box')\r\n                .setAttribute('overflow', 'hidden')\r\n                .setAttribute('outline', 'none')\r\n                .setAttribute('border', 'none')\r\n                .setAttribute('z-index', '1')\r\n                .setAttribute('padding', '10px');\r\n\r\n        // Helper div to measure text width\r\n        this.measureDiv = _document.createElement('div');\r\n\r\n        // Become an event dispatcher\r\n        addTraitEventDispatcher(this);\r\n    }\r\n\r\n    av.GlobalManagerMixin.call(EditorTextInput.prototype);\r\n    var proto = EditorTextInput.prototype;\r\n\r\n    proto.destroy = function() {\r\n\r\n        this.setInactive();\r\n    };\r\n\r\n    /**\r\n     * Initializes itself given an Label Markup (textMarkup)\r\n     * @param {Object} textMarkup\r\n     * @param {Boolean} firstEdit - Whether the markup is being edited for the first time.\r\n     */\r\n    proto.setActive = function(textMarkup, firstEdit) {\r\n\r\n        if (this.textMarkup === textMarkup) {\r\n            return;\r\n        }\r\n\r\n        var placeholderText = Autodesk.Viewing.i18n.translate(this.defaultText);\r\n        this.textArea.setAttribute('placeholder', placeholderText);\r\n\r\n        this.setInactive();\r\n        this.parentDiv.appendChild(this.textArea);\r\n        this.textMarkup = textMarkup;\r\n        this.firstEdit = firstEdit || false;\r\n\r\n        this.constrainToCanvas = firstEdit;\r\n\r\n        this.initFromMarkup();\r\n\r\n        this.constrainToCanvas = false;\r\n\r\n        // On iOS this doesn't work quite well, the keyboard will dismiss after call focus programatically.\r\n        // http://stackoverflow.com/questions/32407185/wkwebview-cant-open-keyboard-for-input-field\r\n        if (!Autodesk.Viewing.isIOSDevice()) {\r\n          // Focus on next frame\r\n          var txtArea = this.textArea;\r\n          const _window = this.getWindow();\r\n          _window.requestAnimationFrame(function(){\r\n              txtArea.focus();\r\n          });\r\n        }\r\n\r\n        var dataBag = {\r\n            markup: this.textMarkup,\r\n            firstEdit: this.firstEdit,\r\n            isActive: true\r\n        };\r\n        this.dispatchEvent({ type: this.EVENT_TEXT_SET_ACTIVE, data: dataBag });\r\n    };\r\n\r\n    /**\r\n     * Closes the editor text input and goes back into normal markup edition mode.\r\n     */\r\n    proto.setInactive = function() {\r\n        var dataBag = {\r\n            markup: this.textMarkup,\r\n            isActive: false\r\n        };\r\n\r\n        // In iOS10, the keyboard always show on screen after tap screen out of text\r\n        // area or save markup to end text edit, call blur to make sure keyboard dismiss.\r\n        if (Autodesk.Viewing.isIOSDevice())\r\n        {\r\n            this.textArea.blur();\r\n        }\r\n\r\n        this.removeWindowEventListener('resize', this.onResizeBinded);\r\n\r\n        if (this.textMarkup) {\r\n            this.textMarkup = null;\r\n            this.parentDiv.removeChild(this.textArea);\r\n        }\r\n        this.style = null;\r\n\r\n        this.dispatchEvent({ type: this.EVENT_TEXT_SET_INACTIVE, data: dataBag });\r\n    };\r\n\r\n    proto.isActive = function() {\r\n\r\n        return !!this.textMarkup;\r\n    };\r\n\r\n    proto.setEditFrame = function() {\r\n        if (this.editor.editFrame.markup && this.textMarkup && this.editor.editFrame.markup === this.textMarkup) {\r\n            var frameWidth = parseFloat(this.textArea.style.width);\r\n            var frameHeight = parseFloat(this.textArea.style.height);\r\n\r\n            var position = this.textMarkup.getClientPosition();\r\n            var rotation = this.textMarkup.getRotation();\r\n\r\n            var xPos = position.x - (frameWidth / 2);\r\n            var yPos = position.y - (this.startingHeight / 2);\r\n\r\n            this.editor.editFrame.setSelection(xPos, yPos, frameWidth, frameHeight, rotation);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Applies Markup styles to TextArea used for editing.\r\n     * It also saves a copy of the style object.\r\n     * @private\r\n     */\r\n    proto.initFromMarkup = function(updateStyleFirst) {\r\n\r\n        var markup = this.textMarkup;\r\n        var position = markup.getClientPosition();\r\n        var size = markup.getClientSize();\r\n\r\n        // Text area padding is relative to the current font size\r\n        var padding = markup.getClientFontSize() / 2;\r\n\r\n        this.startingHeight = size.y;\r\n\r\n        var left = position.x - size.x * 0.5;\r\n        var top = position.y - size.y * 0.5;\r\n\r\n        var lineHeightPercentage = markup.lineHeight + \"%\";\r\n        this.styleTextArea.setAttribute('line-height', lineHeightPercentage);\r\n        this.styleTextArea.setAttribute('padding', padding + 'px');\r\n\r\n        this.setPosAndSize(left, top, size.x, size.y);\r\n        if (updateStyleFirst) {\r\n            this.setStyle(markup.getStyle());\r\n            this.textArea.value = markup.getText();\r\n        } else {\r\n            this.textArea.value = markup.getText();\r\n            this.setStyle(markup.getStyle());\r\n        }\r\n    };\r\n\r\n    proto.setPosAndSize = function(left, top, width, height) {\r\n        if (this.constrainToCanvas) {\r\n            // Check that it doesn't overflow out of the canvas\r\n            if (left + width >= this.editor.viewer.container.clientWidth) {\r\n                left = this.editor.viewer.container.clientWidth - (width + 10);\r\n            }\r\n            if (top + height >= this.editor.viewer.container.clientHeight) {\r\n                top = this.editor.viewer.container.clientHeight - (height + 10);\r\n            }\r\n\r\n            // Make sure text input left side always in the canvas area.\r\n            // Especially on iPhone6 & iPhone7\r\n            if (left < 5) {\r\n                left = 5;\r\n                width = this.editor.viewer.container.clientWidth - 10;\r\n            }\r\n        }\r\n\r\n        this.styleTextArea\r\n            // Size and position\r\n            .setAttribute('left', left + 'px')\r\n            .setAttribute('top', top + 'px')\r\n            .setAttribute('width', width + 'px')\r\n            .setAttribute('height', height + 'px');\r\n    };\r\n\r\n    proto.setStyle = function(style) {\r\n\r\n        if (this.style) {\r\n            // An already present style means that the user\r\n            // has changed the style using the UI buttons.\r\n            // We need to account for the user having changed the\r\n            // width/height of the TextArea. Since there is no event\r\n            // we can detect for it, we do it here.\r\n            var temp = {};\r\n            this.injectSizeValues(temp);\r\n            this.setPosAndSize(\r\n                temp.newPos.x - temp.width * 0.5,\r\n                temp.newPos.y - temp.height * 0.5,\r\n                temp.width, temp.height);\r\n        }\r\n        var fontHeight = this.editor.sizeFromMarkupsToClient(0, style['font-size']).y;\r\n        var strokeWidth = this.editor.sizeFromMarkupsToClient(0, style['stroke-width']).y;\r\n        var textAreaStyle = this.styleTextArea\r\n            // Visuals\r\n            .setAttribute('color', style['stroke-color'])\r\n            .setAttribute('outline', strokeWidth + 'px solid ' + style['stroke-color'])\r\n            .setAttribute('font-family', style['font-family'])\r\n            .setAttribute('font-size', fontHeight + 'px')\r\n            .setAttribute('font-weight', style['font-weight'])\r\n            .setAttribute('font-style', style['font-style'])\r\n            .getStyleString();\r\n        this.textArea.setAttribute('style', textAreaStyle);\r\n        this.style = cloneStyle(style);\r\n        autosize.update(this.textArea);\r\n    };\r\n\r\n    /**\r\n     * Helper function that, for a given markup with some text in it\r\n     * returns an Array of lines in it.\r\n     * @param {Object} markup\r\n     * @returns {{text, lines}|{text: String, lines: Array.<String>}}\r\n     */\r\n    proto.getTextValuesForMarkup = function(markup, sizeUpdateRequired) {\r\n        var active = this.isActive();\r\n        var activeMarkup = this.textMarkup;\r\n        var activeFirstEdit = this.firstEdit;\r\n\r\n        this.setActive(markup, false);\r\n        var textValues = this.getTextValues();\r\n\r\n        var dataBag = {\r\n            markup: markup,\r\n            textValues: textValues\r\n        };\r\n\r\n        if (active) {\r\n            this.setActive(activeMarkup, activeFirstEdit);\r\n        } else {\r\n            if (sizeUpdateRequired) {\r\n                this.injectSizeValues(dataBag);\r\n            }\r\n\r\n            this.setInactive();\r\n        }\r\n\r\n        return dataBag;\r\n    };\r\n\r\n    /**\r\n     * Returns the current text as one string and an array of lines\r\n     * of how the text is being rendered (1 string per line)\r\n     * @returns {{text: String, lines: Array.<String>}}\r\n     */\r\n    proto.getTextValues = function() {\r\n\r\n        var newText = this.textArea.value;\r\n        if (newText === this.defaultText) {\r\n            newText = '';\r\n        }\r\n        return {\r\n            text: newText,\r\n            lines: this.generateLines()\r\n        };\r\n    };\r\n\r\n    /**\r\n     * Function called by UI\r\n     */\r\n    proto.acceptAndExit = function() {\r\n\r\n        // If placeholder text, then remove.\r\n        var textValues = this.getTextValues();\r\n        var textMarkup = this.textMarkup;\r\n\r\n        var dataBag = {\r\n            markup: this.textMarkup,\r\n            style: this.style,\r\n            firstEdit: this.firstEdit,\r\n            newText: textValues.text,\r\n            newLines: textValues.lines\r\n        };\r\n        this.injectSizeValues(dataBag);\r\n\r\n        this.dispatchEvent({ type: this.EVENT_TEXT_CHANGE, data: dataBag });\r\n        this.setInactive();\r\n        textMarkup.updateStyle(true); // Hack: LMV-3628\r\n    };\r\n\r\n    /**\r\n     * Injects position, width and height of the textarea rect\r\n     * @param {Object} dataBag\r\n     * @private\r\n     */\r\n    proto.injectSizeValues = function(dataBag) {\r\n\r\n        // Explicit usage of parseFloat to remove the 'px' suffix.\r\n        var width = parseFloat(this.textArea.style.width);\r\n        var height = parseFloat(this.textArea.style.height);\r\n        var ox = parseFloat(this.textArea.style.left);\r\n        var oy = parseFloat(this.textArea.style.top);\r\n\r\n        dataBag.width = width;\r\n        dataBag.height = height;\r\n        dataBag.newPos = {\r\n            x: ox + (width * 0.5),\r\n            y: oy + (height * 0.5)\r\n        };\r\n    };\r\n\r\n    /**\r\n     * Handler for when the camera moves\r\n     * @param {Object} event - Camera moves event\r\n     * @private\r\n     */\r\n    proto.onCameraChanged = function(event) {\r\n        var str = this.textArea.value;\r\n        this.textMarkup.style = cloneStyle(this.style);\r\n        this.style = null; // TODO: Revisit this code because style changes are lost by doing this.\r\n        this.initFromMarkup(true);\r\n        this.textArea.value = str;\r\n        this.setEditFrame();\r\n    };\r\n\r\n    /**\r\n     * Grabs the text content of the textarea and returns\r\n     * an Array of lines.  Wrapped lines are returned as 2 lines.\r\n     */\r\n    proto.generateLines = function() {\r\n\r\n        // First, get lines separated by line breaks:\r\n        var textContent = this.textArea.value;\r\n        var linesBreaks = textContent.split(/\\r*\\n/);\r\n\r\n        var styleMeasureStr = this.styleTextArea.clone()\r\n            .removeAttribute(['top', 'left', 'width', 'height'])\r\n            .setAttribute('position','absolute')\r\n            .setAttribute('white-space','nowrap')\r\n            .setAttribute('float','left')\r\n            .setAttribute('visibility','hidden')\r\n            .getStyleString();\r\n        this.measureDiv.setAttribute('style', styleMeasureStr);\r\n        this.parentDiv.appendChild(this.measureDiv);\r\n\r\n        var maxLineLength = this.textArea.clientWidth - (2 * parseFloat(this.textArea.style.padding));\r\n\r\n        // Now check whether the lines are wrapped.\r\n        // If so, subdivide into other lines.\r\n        var linesOutput = [];\r\n\r\n        for (var i= 0, len = linesBreaks.length; i<len; ++i) {\r\n            var line = trimRight(linesBreaks[i]);\r\n\r\n            // Add a space in an empty line so it appears in the lines output\r\n            line = (line === '') ? ' ' : line;\r\n            this.splitLine(line, maxLineLength, linesOutput);\r\n        }\r\n\r\n        this.parentDiv.removeChild(this.measureDiv);\r\n        return linesOutput;\r\n    };\r\n\r\n    /**\r\n     * Given a String that represents one line of text that is\r\n     * longer than the max length a line is allowed, this method\r\n     * cuts text into several ones that are no longer than the max\r\n     * length.\r\n     *\r\n     * @param {String} text\r\n     * @param {Number} maxLength\r\n     * @param {Array} output\r\n     * @private\r\n     */\r\n    proto.splitLine = function(text, maxLength, output) {\r\n\r\n        // End condition\r\n        if (text === '') {\r\n            return;\r\n        }\r\n\r\n        var remaining = '';\r\n        var done = false;\r\n\r\n        while (!done){\r\n            this.measureDiv.innerText = text;\r\n            var lineLen = this.measureDiv.clientWidth - (2 * parseFloat(this.measureDiv.style.padding));\r\n            if (lineLen <= maxLength) {\r\n                output.push(text);\r\n                this.splitLine(trimLeft(remaining), maxLength, output);\r\n                done = true;\r\n            } else {\r\n                // Need to try with a shorter word!\r\n                var parts = this.getShorterLine(text);\r\n                if (parts.length === 1) {\r\n                    // text is only one word that is way too long.\r\n                    this.splitWord(text, remaining, maxLength, output);\r\n                    done = true;\r\n                } else {\r\n                    text = parts[0];\r\n                    remaining = parts[1] + remaining;\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Given a line of text such as \"hi there programmer\", it returns\r\n     * an array with 2 parts: [\"hi there\", \" programmer\"].\r\n     *\r\n     * It accounts for special cases with multi-spaces, such as for\r\n     * \"hi there  two-spaces\" returns [\"hi there\", \"  two-spaces\"]\r\n     *\r\n     * When there is only one word, it returns the whole word:\r\n     * \"JustOneWord\" returns [\"JustOneWord\"] (an array of 1 element)\r\n     *\r\n     * @param {String} line\r\n     * @returns {Array}\r\n     */\r\n    proto.getShorterLine = function(line) {\r\n\r\n        // TODO: Account for TABs\r\n        // Will probably never do unless a bug is reported.\r\n\r\n        var iLastSpace = line.lastIndexOf(' ');\r\n        if (iLastSpace === -1) {\r\n            return [line]; // This is a single word\r\n        }\r\n\r\n        // Else\r\n        // Iterate back removing additional spaces (multi spaces)\r\n        while (line.charAt(iLastSpace-1) === ' ') {\r\n            iLastSpace--\r\n        }\r\n\r\n        var trailingWord = line.substr(iLastSpace); // Contains the spaces\r\n        var shorterLine = line.substr(0,iLastSpace);\r\n        return [shorterLine, trailingWord];\r\n    };\r\n\r\n    /**\r\n     * Given a single word, splits it into multiple lines that fits in maxWidth\r\n     * @param {String} word\r\n     * @param {String} remaining\r\n     * @param {Number} maxLength\r\n     * @param {Array} output\r\n     */\r\n    proto.splitWord = function(word, remaining, maxLength, output) {\r\n\r\n        var lenSoFar = 1;\r\n        var fits = true;\r\n        while (fits) {\r\n\r\n            var part = word.substr(0,lenSoFar);\r\n            this.measureDiv.innerText = part;\r\n            var lineLen =  this.measureDiv.clientWidth - (2 * parseFloat(this.measureDiv.style.padding));\r\n\r\n            if (lineLen > maxLength) {\r\n\r\n                if (lenSoFar === 1) {\r\n                    // we can't split 1 character any longer.\r\n                    output.push(part);\r\n                    this.splitWord(word.substr(1), remaining, maxLength, output);\r\n                    return;\r\n                }\r\n\r\n                // It was fine until one less char //\r\n                var okayWord = word.substr(0,lenSoFar-1);\r\n                output.push(okayWord);\r\n                var extraWord = word.substr(lenSoFar-1);\r\n                this.splitLine(extraWord + remaining, maxLength, output);\r\n                return;\r\n            }\r\n\r\n            // Try one more character\r\n            lenSoFar++;\r\n\r\n            // Check if we are done with all characters\r\n            if (lenSoFar > word.length) {\r\n                // Okay it fits\r\n                output.push(word);\r\n                return;\r\n            }\r\n        }\r\n    };\r\n\r\n    function trimRight(text) {\r\n        if (text.length === 0) {\r\n            return \"\";\r\n        }\r\n        var lastNonSpace = text.length-1;\r\n        for (var i=lastNonSpace; i>=0; --i) {\r\n            if (text.charAt(i) !== ' ') {\r\n                lastNonSpace = i;\r\n                break;\r\n            }\r\n        }\r\n        return text.substr(0, lastNonSpace+1);\r\n    }\r\n\r\n    function trimLeft(text) {\r\n        if (text.length === 0) {\r\n            return \"\";\r\n        }\r\n        var firstNonSpace = 0;\r\n        for (var i=0; i<text.length; ++i) {\r\n            if (text.charAt(i) !== ' ') {\r\n                firstNonSpace = i;\r\n                break;\r\n            }\r\n        }\r\n        return text.substr(firstNonSpace);\r\n    }\r\n","'use strict';\r\n\r\nimport { EditMode } from './EditMode'\r\nimport { DeleteCallout } from '../edit-actions/DeleteCallout'\r\nimport { CreateCallout } from '../edit-actions/CreateCallout'\r\nimport { SetCallout } from '../edit-actions/SetCallout'\r\nimport { SetStyle } from '../edit-actions/SetStyle'\r\nimport { SetSize } from '../edit-actions/SetSize'\r\nimport * as MarkupTypes from '../MarkupTypes'\r\nimport * as MarkupEvents from '../MarkupEvents'\r\nimport { EditorTextInput } from './EditorTextInput'\r\n\r\n\r\n    var STARTING_WIDTH_FACTOR = 6;\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @constructor\r\n     */\r\n    export function EditModeCallout(editor) {\r\n\r\n        var styleAttributes = [\r\n            'font-size',\r\n            'stroke-width',\r\n            'stroke-color',\r\n            'stroke-opacity',\r\n            'fill-color',\r\n            'fill-opacity',\r\n            'font-family',\r\n            'font-style',\r\n            'font-weight'\r\n        ];\r\n        EditMode.call(this, editor, MarkupTypes.MARKUP_TYPE_CALLOUT, styleAttributes);\r\n\r\n        this.style['fill-opacity'] = 1.0;\r\n        this.style['fill-color'] = '#ffffff';\r\n\r\n        var helper = new EditorTextInput(this.viewer.container, this.editor, false, 'Text', 360);\r\n        helper.addEventListener(helper.EVENT_TEXT_CHANGE, this.onHelperTextChange.bind(this), false);\r\n        helper.addEventListener(helper.EVENT_TEXT_SET_ACTIVE, this.onHelperSetActive.bind(this), false);\r\n        helper.addEventListener(helper.EVENT_TEXT_SET_INACTIVE, this.onHelperSetActive.bind(this), false);\r\n\r\n        this.textInputHelper = helper;\r\n        this.onHistoryChangeBinded = this.onHistoryChange.bind(this);\r\n        this.minSize = 0; // No need to size it initially\r\n        this.creationMethod = this.CREATION_METHOD_CLICK;\r\n    }\r\n\r\n    EditModeCallout.prototype = Object.create(EditMode.prototype);\r\n    EditModeCallout.prototype.constructor = EditModeCallout;\r\n\r\n    var proto = EditModeCallout.prototype;\r\n\r\n    proto.deleteMarkup = function(markup, cantUndo) {\r\n\r\n        markup = markup || this.selectedMarkup;\r\n        if (markup && markup.type === this.type) {\r\n            var deleteCallout = new DeleteCallout(this.editor, markup);\r\n            deleteCallout.addToHistory = !cantUndo;\r\n            deleteCallout.execute();\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    proto.setStyle = function(style) {\r\n\r\n        if (this.textInputHelper && this.textInputHelper.isActive()) {\r\n\r\n            this.textInputHelper.setStyle(style);\r\n        } else {\r\n            EditMode.prototype.setStyle.call(this, style);\r\n        }\r\n    };\r\n\r\n    proto.notifyAllowNavigation = function(allows) {\r\n\r\n        if (allows && this.textInputHelper && this.textInputHelper.isActive()) {\r\n            this.textInputHelper.acceptAndExit();\r\n        }\r\n    };\r\n\r\n    proto.destroy = function() {\r\n\r\n        if (this.textInputHelper) {\r\n            if (this.textInputHelper.isActive()) {\r\n                this.textInputHelper.acceptAndExit();\r\n            }\r\n            this.textInputHelper.destroy();\r\n            this.textInputHelper = null;\r\n        }\r\n        EditMode.prototype.destroy.call(this);\r\n    };\r\n\r\n    /**\r\n     * Handler to mouse down events, used to start markups creation.\r\n     */\r\n    proto.onMouseDown = function() {\r\n\r\n        if (this.textInputHelper && this.textInputHelper.isActive()) {\r\n            this.textInputHelper.acceptAndExit();\r\n            return;\r\n        }\r\n\r\n        if (this.selectedMarkup) {\r\n            return;\r\n        }\r\n\r\n        var editor = this.editor;\r\n        var mousePosition = editor.getMousePosition();\r\n        var clientFontSize = editor.sizeFromMarkupsToClient(0, this.style['font-size']).y;\r\n        var initialWidth = clientFontSize * STARTING_WIDTH_FACTOR; // Find better way to initialize size.\r\n        var initialHeight = clientFontSize * 1;\r\n\r\n        // Center position.\r\n        var size = this.size = editor.sizeFromClientToMarkups(initialWidth, initialHeight);\r\n        var position = editor.positionFromClientToMarkups(\r\n            mousePosition.x + (initialWidth * 0.5),\r\n            mousePosition.y + (initialHeight * 0.5));\r\n\r\n        this.creationBegin();\r\n        editor.beginActionGroup();\r\n\r\n        // Given the initial width and font size, we assume that the text fits in one line.\r\n        var createCallout = new CreateCallout(\r\n            editor,\r\n            editor.getId(),\r\n            position,\r\n            size,\r\n            '',\r\n            this.style,\r\n            true);\r\n\r\n        createCallout.execute();\r\n        this.creationEnd();\r\n\r\n        this.selectedMarkup = editor.getMarkup(createCallout.targetId);\r\n        this.textInputHelper && this.textInputHelper.setActive(this.selectedMarkup, true);\r\n        this.editor.actionManager.addEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\r\n    };\r\n\r\n    proto.onMouseUp = function(event) {\r\n\r\n    };\r\n\r\n    proto.onMouseDoubleClick = function(markup) {\r\n\r\n        if (markup === this.selectedMarkup) {\r\n            this.editor.selectMarkup(markup);\r\n            this.editor.editFrame.setMarkup(markup);\r\n            this.textInputHelper && this.textInputHelper.setActive(markup, false);\r\n        }\r\n    };\r\n\r\n    proto.onHelperSetActive = function(event) {\r\n        var databag = event.data;\r\n        var markup = databag.markup;\r\n        if (markup) {\r\n            markup.setIsHelperTextActive(databag.isActive);\r\n            markup.setIsShapeVisible(!databag.isActive);\r\n        }\r\n    };\r\n\r\n    proto.onHelperTextChange = function(event) {\r\n\r\n        var dataBag = event.data;\r\n        var textMarkup = dataBag.markup;\r\n        var textStyle = dataBag.style;\r\n        var curSelection = this.selectedMarkup;\r\n\r\n        this.editor.actionManager.removeEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\r\n\r\n        // Deal with edge case first: Creating a Label without text\r\n        if (dataBag.newText === '') {\r\n            this.editor.cancelActionGroup();\r\n\r\n            var deleteCallout = new DeleteCallout(this.editor, textMarkup);\r\n            deleteCallout.execute();\r\n\r\n            if (textMarkup !== curSelection) {\r\n                this.editor.selectMarkup(curSelection);\r\n            }\r\n\r\n            return;\r\n        }\r\n\r\n        // When the text is created for the first time, an action group\r\n        // is already created and it includes the CreateCallout action.\r\n        // Thus, no need to begin another action group.\r\n        if (!dataBag.firstEdit) {\r\n            this.editor.beginActionGroup();\r\n        }\r\n\r\n        // Size change action //\r\n        var position = this.editor.positionFromClientToMarkups(\r\n            dataBag.newPos.x, dataBag.newPos.y\r\n        );\r\n        var size = this.editor.sizeFromClientToMarkups(\r\n            dataBag.width, dataBag.height\r\n        );\r\n        var setSize = new SetSize(\r\n            this.editor,\r\n            textMarkup,\r\n            position,\r\n            size.x,\r\n            size.y);\r\n        setSize.execute();\r\n\r\n        // Text change action //\r\n        var setCallout = new SetCallout(\r\n            this.editor,\r\n            textMarkup,\r\n            textMarkup.position,\r\n            textMarkup.size,\r\n            dataBag.newText,\r\n            textMarkup.isFrameUsed);\r\n        setCallout.execute();\r\n\r\n        var setStyle = new SetStyle(\r\n            this.editor,\r\n            textMarkup,\r\n            textStyle\r\n        );\r\n        setStyle.execute();\r\n\r\n        // However, we do need to close the action group at this point. For both cases.\r\n        this.editor.closeActionGroup();\r\n        this.editor.selectMarkup(curSelection);\r\n    };\r\n\r\n    /**\r\n     * We want to make sure that the Input Helper gets removed from the screen\r\n     * whenever the user attempts to perform an undo or redo action.\r\n     * @param {Event} event\r\n     * @private\r\n     */\r\n    proto.onHistoryChange = function(event) {\r\n\r\n        if (this.textInputHelper && this.textInputHelper.isActive()) {\r\n            this.editor.actionManager.removeEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\r\n            this.textInputHelper.setInactive();\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Notify the markup that the displayed markups are being saved so edit mode can finish current editions.\r\n     */\r\n    proto.onSave = function() {\r\n\r\n        EditMode.prototype.onSave.call(this);\r\n\r\n        // Close input helper if it's open.\r\n        if (this.textInputHelper && this.textInputHelper.isActive()) {\r\n            var firstEdit = this.textInputHelper.firstEdit;\r\n\r\n            this.editor.actionManager.removeEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\r\n            this.textInputHelper.setInactive();\r\n\r\n            // Close action group if open (first edit).\r\n            if (firstEdit) {\r\n                this.editor.cancelActionGroup();\r\n            }\r\n\r\n            this.editor.selectMarkup(null);\r\n            this.selectedMarkup = null;\r\n        }\r\n    };\r\n\r\n    proto.updateTextBoxStyle = function() {\r\n        if (this.isTextInputHelperActive()) {\r\n            this.textInputHelper.onCameraChanged();\r\n        }\r\n    };\r\n","'use strict';\r\n\r\nimport { Markup } from './Markup'\r\nimport * as MarkupTypes from './MarkupTypes'\r\nimport { createMarkupTextSvg, createMarkupPathSvg, createMarkupGroupSvg,\r\n    composeRGBAString, setAttributeToMarkupSvg, setMarkupTextSvgTransform,\r\n    updateMarkupTextSvgClipper, updateMarkupTextSvgHitarea, updateMarkupPathSvgHitarea,\r\n    createSvgElement, addMarkupMetadata, radiansToDegrees, createRectanglePath,\r\n    EDIT_FRAME_DEFAULT_MARGIN } from './MarkupsCoreUtils'\r\nimport { cloneStyle, copyStyle, isStyleEqual } from './StyleUtils'\r\nimport { EditModeCallout } from './edit-modes/EditModeCallout'\r\n\r\n    // LMV ViewerLMV-2170 [Markup] [PDF] Text markup missing/cutoff for normal sized text.\r\n    // If the font size of an SVG text is too small, the text is not rendered independently of its final screen size.\r\n    // To solve the issue we multiply font size by 100 and scale down the text in its transform.\r\n    var FONT_SIZE_SCALE = 100;\r\n\r\n    var STARTING_WIDTH_FACTOR = 6;\r\n\r\n    /**\r\n     * Callout Markup.\r\n     * @constructor\r\n     */\r\n    export function MarkupCallout(id, editor, size) {\r\n\r\n        var styleAttributes = [\r\n            'font-size',\r\n            'stroke-width',\r\n            'stroke-color',\r\n            'stroke-opacity',\r\n            'fill-color',\r\n            'fill-opacity',\r\n            'font-family',\r\n            'font-style',\r\n            'font-weight'\r\n        ];\r\n\r\n        Markup.call(this, id, editor, styleAttributes);\r\n\r\n        // bind to this to pass this.globalManager\r\n        this.addMarkupMetadata = addMarkupMetadata.bind(this);\r\n        this.createSvgElement = createSvgElement.bind(this);\r\n\r\n\r\n        this.type = MarkupTypes.MARKUP_TYPE_CALLOUT;\r\n        this.textShape = createMarkupTextSvg();\r\n        this.rectShape = createMarkupPathSvg();\r\n        this.shape = createMarkupGroupSvg([this.rectShape, this.textShape]);\r\n        this.isFrameUsed = true;\r\n        this.constraintRotation = true;\r\n        this.constraintHeight = true;\r\n        this.constraintWidth = false;\r\n        this.size.x = size.x;\r\n        this.size.y = size.y;\r\n        this.currentText = \"\";\r\n        this.currentTextLines = [\"\"];\r\n        this.prevHighlight = false;\r\n        this.isHelperTextActive = false;\r\n\r\n        // Note: We could have this property be a style property.\r\n        // However, there is no need for this property to be exposed to the user for alteration\r\n        // This value is a percentage of the font size used to offset vertically 2 text lines\r\n        // of the same paragraph.\r\n        // Notice that this value is used by EditorTextInput.js\r\n        this.lineHeight = 130;\r\n\r\n        this.minWidth = this.getClientFontSize() * STARTING_WIDTH_FACTOR;\r\n\r\n        this.bindDomEvents();\r\n    }\r\n\r\n    MarkupCallout.prototype = Object.create(Markup.prototype);\r\n    MarkupCallout.prototype.constructor = MarkupCallout;\r\n\r\n    var proto = MarkupCallout.prototype;\r\n\r\n    proto.getEditMode = function() {\r\n\r\n        return new EditModeCallout(this.editor);\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param {Object} position\r\n     * @param {Object} size\r\n     * @param {String} textString\r\n     */\r\n    proto.set = function(position, size, textString, isFrameUsed) {\r\n\r\n        this.position.x = position.x;\r\n        this.position.y = position.y;\r\n        this.size.x = size.x;\r\n        this.size.y = size.y;\r\n        this.setIsFilledFrameUsed(isFrameUsed);\r\n        this.setText(textString);\r\n    };\r\n\r\n    proto.setSize = function(position, width, height) {\r\n\r\n        this.position.x = position.x;\r\n        this.position.y = position.y;\r\n        this.size.x = width;\r\n        this.size.y = height;\r\n\r\n        var sizeUpdateRequired = true;\r\n\r\n        if (this.isHelperTextActive) {\r\n            this.updateTextBoxStyle();\r\n        } else {\r\n            this.updateStyle(sizeUpdateRequired);\r\n        }\r\n    };\r\n\r\n    proto.setPosition = function(x, y) {\r\n\r\n        this.position.x = x;\r\n        this.position.y = y;\r\n\r\n        if (this.isHelperTextActive) {\r\n            this.updateTextBoxStyle();\r\n        } else {\r\n            this.updateStyle();\r\n        }\r\n    };\r\n\r\n    proto.setStyle = function(style) {\r\n        var stylesEqual = isStyleEqual(style, this.style);\r\n\r\n        if (!stylesEqual) {\r\n            copyStyle(style, this.style);\r\n        }\r\n\r\n        this.updateStyle(!stylesEqual);\r\n    };\r\n\r\n    proto.setText = function(text) {\r\n\r\n        this.currentText = text;\r\n    };\r\n\r\n    /**\r\n     * Returns the raw string value\r\n     * @returns {String}\r\n     */\r\n    proto.getText = function() {\r\n\r\n        return this.currentText;\r\n    };\r\n\r\n    /**\r\n     * Returns a shallow copy of the text lines used for rendering SVG text\r\n     * @returns {Array.<String>}\r\n     */\r\n    proto.getTextLines = function() {\r\n\r\n        return this.currentTextLines.concat();\r\n    };\r\n\r\n    proto.highlightChanged = function() {\r\n\r\n        if (this.highlighted && this.highlighted !== this.prevHighlight) {\r\n            var rect = this.rectShape;\r\n            var text = this.textShape;\r\n            var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\r\n            setAttributeToMarkupSvg(text, 'fill', strokeColor);\r\n\r\n            if (this.isFrameUsed) {\r\n                setAttributeToMarkupSvg(rect, 'stroke', strokeColor);\r\n            }\r\n\r\n            this.prevHighlight = true;\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    };\r\n\r\n    proto.updateTextBoxStyle = function() {\r\n        var editMode = this.editor.duringEditMode && this.editor.editMode;\r\n\r\n        if (!editMode || editMode.type !== this.type) {\r\n            editMode = this.getEditMode();\r\n        }\r\n\r\n        editMode.updateTextBoxStyle();\r\n    };\r\n\r\n    proto.setIsHelperTextActive = function(isActive) {\r\n        this.isHelperTextActive = isActive;\r\n    };\r\n\r\n    /**\r\n     * Applies data values into DOM element style/attribute(s)\r\n     *\r\n     */\r\n    proto.updateStyle = function(sizeUpdateRequired) {\r\n\r\n        if (this.highlightChanged()) {\r\n            this.prevHighlight = false;\r\n            var style = this.style;\r\n            var rect = this.rectShape;\r\n            var text = this.textShape;\r\n            var fontSize = this.style['font-size'];\r\n            var fontFamily = this.style['font-family'];\r\n            var fontWeight = this.style['font-weight'];\r\n            var fontStyle =  this.style['font-style'];\r\n            var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\r\n            var strokeWidth = this.style['stroke-width'];\r\n\r\n            // FONT_SIZE_SCALE is used to scale up fontSize, but it is only needed in cases where the font size is too small\r\n            FONT_SIZE_SCALE = (fontSize > 1) ? 1 : 100;\r\n\r\n            this.rebuildTextSvg(sizeUpdateRequired);\r\n\r\n            var editor = this.editor;\r\n            var textContainerTransform = this.getTextContainerTransform();\r\n            var textTransform = this.getTextTransform();\r\n\r\n            setAttributeToMarkupSvg(text, 'font-family', fontFamily);\r\n            setAttributeToMarkupSvg(text, 'font-size', fontSize * FONT_SIZE_SCALE);\r\n            setAttributeToMarkupSvg(text, 'fill', strokeColor);\r\n            setAttributeToMarkupSvg(text, 'font-weight', fontWeight);\r\n            setAttributeToMarkupSvg(text, 'font-style', fontStyle);\r\n\r\n            setMarkupTextSvgTransform(text, textContainerTransform, textTransform);\r\n            updateMarkupTextSvgClipper(text, this.size.x, this.size.y);\r\n            updateMarkupTextSvgHitarea(text, this.size.x, this.size.y, editor);\r\n\r\n            var path = this.getPath().join(' ');\r\n            var transform = this.getTransform();\r\n            var fillColor = composeRGBAString(style['fill-color'], style['fill-opacity']);\r\n\r\n            setAttributeToMarkupSvg(rect, 'd', path);\r\n            setAttributeToMarkupSvg(rect, 'stroke-width', strokeWidth);\r\n            setAttributeToMarkupSvg(rect, 'stroke', strokeColor);\r\n            setAttributeToMarkupSvg(rect, 'transform', transform);\r\n            setAttributeToMarkupSvg(rect, 'fill', fillColor);\r\n            updateMarkupPathSvgHitarea(rect, editor);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Re-creates SVG tags that render SVG text.\r\n     * Each line is placed around tspan tags which are vertically offset to each other.\r\n     */\r\n    proto.rebuildTextSvg = function(sizeUpdateRequired) {\r\n\r\n        // TODO: Remove the need to get text values from an object in edit mode, should be a function.\r\n        // editMode needs to be set to load markups in view mode\r\n        var editMode = this.editor.duringEditMode && this.editor.editMode;\r\n\r\n        if (!editMode || editMode.type !== this.type) {\r\n            editMode = this.getEditMode();\r\n            editMode.textInputHelper.textArea.value = this.currentText;\r\n            editMode.textInputHelper.setStyle(this.style);\r\n        }\r\n\r\n        if (editMode.textInputHelper.textMarkup && editMode.textInputHelper.textMarkup !== this) {\r\n            return;\r\n        }\r\n\r\n        var style = cloneStyle(editMode.textInputHelper.style);\r\n        var text = editMode.textInputHelper.textArea.value;\r\n\r\n        var textHelperValues = editMode.textInputHelper.getTextValuesForMarkup(this, sizeUpdateRequired);\r\n\r\n        this.currentTextLines = textHelperValues.textValues.lines;\r\n\r\n        if (textHelperValues.newPos) {\r\n            var position = this.editor.positionFromClientToMarkups(textHelperValues.newPos.x, textHelperValues.newPos.y);\r\n            var size = this.editor.sizeFromClientToMarkups(textHelperValues.width, textHelperValues.height);\r\n\r\n            this.position.x = position.x;\r\n            this.position.y = position.y;\r\n            this.size.x = size.x;\r\n            this.size.y = size.y;\r\n        }\r\n\r\n        if (editMode.selectedMarkup !== this && !editMode.textInputHelper.firstEdit) {\r\n            editMode.textInputHelper.textArea.value = text;\r\n            editMode.textInputHelper.setStyle(style);\r\n        }\r\n\r\n        var markup = this.createSvgElement('text');\r\n        markup.setAttribute('id', 'markup');\r\n        markup.setAttribute('alignment-baseline', 'middle');\r\n\r\n        this.textShape.childNodes[0].removeChild(this.textShape.markup);\r\n        this.textShape.childNodes[0].appendChild(markup);\r\n        this.textShape.markup = markup;\r\n\r\n        // For each line, create a tspan, add as child and offset it vertically.\r\n        var yOffset = this.getLineHeight() * FONT_SIZE_SCALE * (this.lineHeight / 100);\r\n\r\n        var padding = (this.getLineHeight() * FONT_SIZE_SCALE) / 2;\r\n        var dx = padding;\r\n        var dy = padding;\r\n\r\n        this.currentTextLines.forEach(function(line){\r\n\r\n            var tspan = this.createSvgElement('tspan');\r\n\r\n            tspan.setAttribute('x', dx);\r\n            tspan.setAttribute('y', dy);\r\n            tspan.textContent = line;\r\n\r\n            markup.appendChild(tspan);\r\n            dy += yOffset;\r\n        }.bind(this));\r\n    };\r\n\r\n    proto.setIsFilledFrameUsed = function(isFrameUsed) {\r\n\r\n        this.isFrameUsed = isFrameUsed;\r\n\r\n        var hasRectShape = this.rectShape.parentNode === this.shape;\r\n        if (isFrameUsed && !hasRectShape) {\r\n            this.shape.insertBefore(this.rectShape, this.shape.firstChild);\r\n        } else if (!isFrameUsed && hasRectShape) {\r\n            this.shape.removeChild(this.rectShape);\r\n        }\r\n    };\r\n\r\n    proto.setIsFilledFrameVisible = function(isVisible) {\r\n\r\n        this.rectShape.markup.style.display = (isVisible && this.isFrameUsed) ? 'block' : 'none';\r\n    };\r\n\r\n    proto.setIsShapeVisible = function(isVisible) {\r\n\r\n        this.shape.style.display = (isVisible) ? 'block' : 'none';\r\n    };\r\n\r\n    proto.setMetadata = function() {\r\n        var metadata = cloneStyle(this.style);\r\n\r\n        metadata.type = this.type;\r\n        metadata.position = [this.position.x, this.position.y].join(\" \");\r\n        metadata.size = [this.size.x, this.size.y].join(\" \");\r\n        metadata.text = String(this.currentText);\r\n        metadata.isframeused = this.isFrameUsed ? 1 : 0;\r\n\r\n        return this.addMarkupMetadata(this.shape, metadata);\r\n    };\r\n\r\n    /**\r\n     * Helper method that returns the font size in client space coords.\r\n     * @returns {Number}\r\n     */\r\n    proto.getClientFontSize = function() {\r\n\r\n        return this.editor.sizeFromMarkupsToClient(0, this.style['font-size']).y;\r\n    };\r\n\r\n    proto.getLineHeight = function() {\r\n        return this.style['font-size'];\r\n    };\r\n\r\n    proto.getTextContainerTransform = function() {\r\n\r\n        var x = this.position.x - this.size.x * 0.5;\r\n        var y = this.position.y + this.size.y * 0.5;\r\n\r\n        return [\r\n            'translate(', x, ',', y, ')',\r\n            'rotate(', radiansToDegrees(-this.rotation), ')',\r\n            'scale(1,-1)'\r\n        ].join(' ');\r\n    };\r\n\r\n    proto.getTextTransform = function() {\r\n\r\n        var lineHeight = this.getLineHeight();\r\n\r\n        var x = this.position.x - this.size.x * 0.5;\r\n        var y = this.position.y + this.size.y * 0.5 - lineHeight;\r\n\r\n        return [\r\n            'translate(', x, ',', y, ')',\r\n            'rotate(', radiansToDegrees(-this.rotation), ')',\r\n            'scale(' + (1/FONT_SIZE_SCALE) + ',' + (-1/FONT_SIZE_SCALE) + ')'\r\n        ].join(' ');\r\n    };\r\n\r\n    proto.cloneShape = function(clone) {\r\n\r\n        clone.textShape = createMarkupTextSvg();\r\n        clone.rectShape = createMarkupPathSvg();\r\n        clone.shape = createMarkupGroupSvg([clone.rectShape, clone.textShape]);\r\n        clone.bindDomEvents();\r\n    };\r\n\r\n    proto.getPath = function() {\r\n        var strokeWidth = this.style['stroke-width'];\r\n\r\n        var w = this.size.x + strokeWidth;\r\n        var h = this.size.y + strokeWidth;\r\n        var x = -w * 0.5;\r\n        var y = -h * 0.5;\r\n\r\n        var path = [];\r\n        createRectanglePath(x, y, w, h, false, path);\r\n\r\n        return path;\r\n    };\r\n\r\n    proto.getBoundingRect = function() {\r\n\r\n        var pos = this.getClientPosition();\r\n        var size = this.getClientSize();\r\n        var strokeWidth = this.style['stroke-width'];\r\n        var width = this.editor.sizeFromMarkupsToClient(strokeWidth, 0).x;\r\n        var margin = width + EDIT_FRAME_DEFAULT_MARGIN;\r\n\r\n        return {\r\n            x: pos.x - size.x / 2,\r\n            y: pos.y - size.y / 2,\r\n            width: size.x,\r\n            height: size.y,\r\n            margin: margin\r\n        }\r\n    };\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\nimport { MarkupCallout } from '../MarkupCallout'\r\nimport { cloneStyle } from '../StyleUtils'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param id\r\n     * @param position\r\n     * @param size\r\n     * @param text\r\n     * @param style\r\n     * @constructor\r\n     */\r\n    export function CreateCallout(editor, id, position, size, text, style, isFrameUsed) {\r\n\r\n        EditAction.call(this, editor, 'CREATE-CALLOUT', id);\r\n\r\n        this.text = text;\r\n        this.position = {x: position.x, y: position.y};\r\n        this.size = {x: size.x, y: size.y};\r\n        this.style = cloneStyle(style);\r\n        this.isFrameUsed = isFrameUsed;\r\n    }\r\n\r\n    CreateCallout.prototype = Object.create(EditAction.prototype);\r\n    CreateCallout.prototype.constructor = CreateCallout;\r\n\r\n    var proto = CreateCallout.prototype;\r\n\r\n    proto.redo = function () {\r\n\r\n        var editor = this.editor;\r\n        var position = this.position;\r\n        var size = this.size;\r\n\r\n        var callout = new MarkupCallout(this.targetId, editor, size);\r\n\r\n        editor.addMarkup(callout);\r\n\r\n        callout.setIsFilledFrameUsed(this.isFrameUsed);\r\n        callout.setText(this.text);\r\n        callout.setSize(position, size.x, size.y);\r\n        callout.setStyle(this.style);\r\n    };\r\n\r\n    proto.undo = function () {\r\n\r\n        var markup = this.editor.getMarkup(this.targetId);\r\n        if (markup) {\r\n            this.editor.removeMarkup(markup);\r\n            markup.destroy();\r\n        }\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\nimport { CreateCallout } from './CreateCallout'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param text\r\n     * @constructor\r\n     */\r\n    export function DeleteCallout(editor, callout) {\r\n\r\n        EditAction.call(this, editor, 'DELETE-CALLOUT', callout.id);\r\n\r\n        var position = {x: callout.position.x, y: callout.position.y};\r\n        var size = {x: callout.size.x, y: callout.size.y};\r\n\r\n        this.createCallout = new CreateCallout(\r\n            editor,\r\n            callout.id,\r\n            position,\r\n            size,\r\n            callout.getText(),\r\n            callout.getStyle(),\r\n            callout.isFrameUsed);\r\n    }\r\n\r\n    DeleteCallout.prototype = Object.create(EditAction.prototype);\r\n    DeleteCallout.prototype.constructor = DeleteCallout;\r\n\r\n    var proto = DeleteCallout.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        this.createCallout.undo();\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        this.createCallout.redo();\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param markup\r\n     * @param position\r\n     * @param size\r\n     * @param text\r\n     * @constructor\r\n     */\r\n    export function SetText(editor, markup, position, size, text) {\r\n\r\n        EditAction.call(this, editor, 'SET-TEXT', markup.id);\r\n\r\n        this.newPosition = {x: position.x, y: position.y};\r\n        this.oldPosition = {x: markup.position.x, y: markup.position.y};\r\n        this.newSize = {x: size.x, y: size.y};\r\n        this.oldSize = {x: markup.size.x, y: markup.size.y};\r\n        this.newText = text;\r\n        this.oldText = markup.getText();\r\n    }\r\n\r\n    SetText.prototype = Object.create(EditAction.prototype);\r\n    SetText.prototype.constructor = SetText;\r\n\r\n    var proto = SetText.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        var text = this.editor.getMarkup(this.targetId);\r\n        text && text.set(this.newPosition, this.newSize, this.newText);\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        var text = this.editor.getMarkup(this.targetId);\r\n        text && text.set(this.oldPosition, this.oldSize, this.oldText);\r\n    };\r\n","'use strict';\r\n\r\nimport { EditMode } from './EditMode'\r\nimport { DeleteText } from '../edit-actions/DeleteText'\r\nimport { DeleteCallout } from '../edit-actions/DeleteCallout'\r\nimport { CreateText } from '../edit-actions/CreateText'\r\nimport { SetText } from '../edit-actions/SetText'\r\nimport { SetSize } from '../edit-actions/SetSize'\r\nimport { SetStyle } from '../edit-actions/SetStyle'\r\nimport * as MarkupTypes from '../MarkupTypes'\r\nimport * as MarkupEvents from '../MarkupEvents'\r\nimport { EditorTextInput } from './EditorTextInput'\r\n\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @constructor\r\n     */\r\n    export function EditModeText(editor) {\r\n\r\n        var styleAttributes = [\r\n            'font-size',\r\n            'stroke-color',\r\n            'stroke-opacity',\r\n            'fill-color',\r\n            'fill-opacity',\r\n            'font-family',\r\n            'font-style',\r\n            'font-weight'\r\n        ];\r\n        EditMode.call(this, editor, MarkupTypes.MARKUP_TYPE_TEXT, styleAttributes);\r\n\r\n        var helper = new EditorTextInput(this.viewer.container, this.editor, false, 'Text', 260);\r\n        helper.addEventListener(helper.EVENT_TEXT_CHANGE, this.onHelperTextChange.bind(this), false);\r\n        helper.addEventListener(helper.EVENT_TEXT_SET_ACTIVE, this.onHelperSetActive.bind(this), false);\r\n        helper.addEventListener(helper.EVENT_TEXT_SET_INACTIVE, this.onHelperSetActive.bind(this), false);\r\n\r\n        this.textInputHelper = helper;\r\n        this.onHistoryChangeBinded = this.onHistoryChange.bind(this);\r\n        this.minSize = 0; // No need to size it initially\r\n        this.creationMethod = this.CREATION_METHOD_CLICK;\r\n    }\r\n\r\n    EditModeText.prototype = Object.create(EditMode.prototype);\r\n    EditModeText.prototype.constructor = EditModeText;\r\n\r\n    var proto = EditModeText.prototype;\r\n\r\n    proto.deleteMarkup = function(markup, cantUndo) {\r\n\r\n        markup = markup || this.selectedMarkup;\r\n        if (markup && markup.type == this.type) {\r\n            var deleteText = new DeleteText(this.editor, markup);\r\n            deleteText.addToHistory = !cantUndo;\r\n            deleteText.execute();\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param style\r\n     */\r\n    proto.setStyle = function(style) {\r\n\r\n        if (this.textInputHelper && this.textInputHelper.isActive()) {\r\n\r\n            this.textInputHelper.setStyle(style);\r\n        } else {\r\n            EditMode.prototype.setStyle.call(this, style);\r\n        }\r\n    };\r\n\r\n    proto.notifyAllowNavigation = function(allows) {\r\n\r\n        if (allows && this.textInputHelper && this.textInputHelper.isActive()) {\r\n            this.textInputHelper.acceptAndExit();\r\n        }\r\n    };\r\n\r\n    proto.destroy = function() {\r\n\r\n        if (this.textInputHelper) {\r\n            if (this.textInputHelper.isActive()) {\r\n                this.textInputHelper.acceptAndExit();\r\n            }\r\n            this.textInputHelper.destroy();\r\n            this.textInputHelper = null;\r\n        }\r\n        EditMode.prototype.destroy.call(this);\r\n    };\r\n\r\n    /**\r\n     * Handler to mouse down events, used to start markups creation.\r\n     */\r\n    proto.onMouseDown = function() {\r\n\r\n        if (this.textInputHelper && this.textInputHelper.isActive()) {\r\n            this.textInputHelper.acceptAndExit();\r\n            return;\r\n        }\r\n\r\n        if (this.selectedMarkup) {\r\n            return;\r\n        }\r\n\r\n        var editor = this.editor;\r\n        var mousePosition = editor.getMousePosition();\r\n        var clientFontSize = editor.sizeFromMarkupsToClient(0, this.style['font-size']).y;\r\n        var initialWidth = clientFontSize * 15; // Find better way to initialize size.\r\n        var initialHeight = clientFontSize * 1;\r\n\r\n        // Center position.\r\n        var size = this.size = editor.sizeFromClientToMarkups(initialWidth, initialHeight);\r\n        var position = editor.positionFromClientToMarkups(\r\n            mousePosition.x + (initialWidth * 0.5),\r\n            mousePosition.y + (initialHeight * 0.5));\r\n\r\n        this.creationBegin();\r\n        editor.beginActionGroup();\r\n\r\n        // Given the initial width and font size, we assume that the text fits in one line.\r\n        var createText = new CreateText(\r\n            editor,\r\n            editor.getId(),\r\n            position,\r\n            size,\r\n            '',\r\n            this.style);\r\n\r\n        createText.execute();\r\n        this.creationEnd();\r\n\r\n        this.selectedMarkup = editor.getMarkup(createText.targetId);\r\n        this.textInputHelper && this.textInputHelper.setActive(this.selectedMarkup, true);\r\n        this.editor.actionManager.addEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\r\n    };\r\n\r\n    proto.updateTextBoxStyle = function() {\r\n        if (this.isTextInputHelperActive()) {\r\n            this.textInputHelper.onCameraChanged();\r\n        }\r\n    };\r\n\r\n    proto.onMouseUp = function(event) {\r\n\r\n    };\r\n\r\n    proto.onMouseDoubleClick = function(markup) {\r\n\r\n        if (markup === this.selectedMarkup) {\r\n            this.editor.selectMarkup(markup);\r\n            this.editor.editFrame.setMarkup(markup);\r\n            this.textInputHelper && this.textInputHelper.setActive(markup, false);\r\n        }\r\n    };\r\n\r\n    proto.onHelperSetActive = function(event) {\r\n        var databag = event.data;\r\n        var markup = databag.markup;\r\n        if (markup) {\r\n            markup.setIsHelperTextActive(databag.isActive);\r\n            markup.setIsShapeVisible(!databag.isActive);\r\n        }\r\n    };\r\n\r\n    proto.onHelperTextChange = function(event) {\r\n\r\n        var dataBag = event.data;\r\n        var textMarkup = dataBag.markup;\r\n        var textStyle = dataBag.style;\r\n        var curSelection = this.selectedMarkup;\r\n\r\n        this.editor.actionManager.removeEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\r\n\r\n        // Deal with edge case first: Creating a Label without text\r\n        if (dataBag.newText === '') {\r\n            this.editor.cancelActionGroup();\r\n\r\n            var deleteCallout = new DeleteCallout(this.editor, textMarkup);\r\n            deleteCallout.execute();\r\n\r\n            if (textMarkup !== curSelection) {\r\n                this.editor.selectMarkup(curSelection);\r\n            }\r\n\r\n            return;\r\n        }\r\n\r\n        // When the text is created for the first time, an action group\r\n        // is already created and it includes the CreateText action.\r\n        // Thus, no need to begin another action group.\r\n        if (!dataBag.firstEdit) {\r\n            this.editor.beginActionGroup();\r\n        }\r\n\r\n        // Size change action //\r\n        var position = this.editor.positionFromClientToMarkups(\r\n            dataBag.newPos.x, dataBag.newPos.y\r\n        );\r\n        var size = this.editor.sizeFromClientToMarkups(\r\n            dataBag.width, dataBag.height\r\n        );\r\n        var setSize = new SetSize(\r\n            this.editor,\r\n            textMarkup,\r\n            position,\r\n            size.x,\r\n            size.y);\r\n        setSize.execute();\r\n\r\n        // Text change action //\r\n        var setText = new SetText(\r\n            this.editor,\r\n            textMarkup,\r\n            textMarkup.position,\r\n            textMarkup.size,\r\n            dataBag.newText);\r\n        setText.execute();\r\n\r\n        var setStyle = new SetStyle(\r\n            this.editor,\r\n            textMarkup,\r\n            textStyle\r\n        );\r\n        setStyle.execute();\r\n\r\n        // However, we do need to close the action group at this point. For both cases.\r\n        this.editor.closeActionGroup();\r\n        this.editor.selectMarkup(curSelection);\r\n    };\r\n\r\n    /**\r\n     * We want to make sure that the Input Helper gets removed from the screen\r\n     * whenever the user attempts to perform an undo or redo action.\r\n     * @param {Event} event\r\n     * @private\r\n     */\r\n    proto.onHistoryChange = function(event) {\r\n\r\n        if (this.textInputHelper && this.textInputHelper.isActive()) {\r\n            this.editor.actionManager.removeEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\r\n            this.textInputHelper.setInactive();\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Notify the markup that the displayed markups are being saved so edit mode can finish current editions.\r\n     */\r\n    proto.onSave = function() {\r\n\r\n        EditMode.prototype.onSave.call(this);\r\n\r\n        // Close input helper if it's open.\r\n        if (this.textInputHelper && this.textInputHelper.isActive()) {\r\n            var firstEdit = this.textInputHelper.firstEdit;\r\n\r\n            this.editor.actionManager.removeEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\r\n            this.textInputHelper.setInactive();\r\n\r\n            // Close action group if open (first edit).s\r\n            if (firstEdit) {\r\n                this.editor.cancelActionGroup();\r\n            }\r\n\r\n            this.editor.selectMarkup(null);\r\n            this.selectedMarkup = null;\r\n        }\r\n    };\r\n\r\n    proto.updateTextBoxStyle = function() {\r\n        if (this.isTextInputHelperActive()) {\r\n            this.textInputHelper.onCameraChanged();\r\n        }\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { Markup } from './Markup'\r\nimport * as MarkupTypes from './MarkupTypes'\r\nimport { composeRGBAString, setAttributeToMarkupSvg, addMarkupMetadata, radiansToDegrees,\r\n    createMarkupTextSvg, setMarkupTextSvgTransform, updateMarkupTextSvgBackground,\r\n    updateMarkupTextSvgClipper, updateMarkupTextSvgHitarea, createSvgElement } from './MarkupsCoreUtils'\r\nimport { cloneStyle, isStyleEqual, copyStyle } from './StyleUtils'\r\nimport { EditModeText } from './edit-modes/EditModeText'\r\n\r\n    // LMV ViewerLMV-2170 [Markup] [PDF] Text markup missing/cutoff for normal sized text.\r\n    // If the font size of an SVG text is too small, the text is not rendered independently of its final screen size.\r\n    // To solve the issue we multiply font size by 100 and scale down the text in its transform.\r\n    var FONT_SIZE_SCALE = 100;\r\n\r\n    var STARTING_WIDTH_FACTOR = 6;\r\n\r\n    /**\r\n     * Text Markup.\r\n     * @constructor\r\n     */\r\n    export function MarkupText(id, editor, size) {\r\n\r\n        var styleAttributes = [\r\n            'font-size',\r\n            'stroke-color',\r\n            'stroke-opacity',\r\n            'fill-color',\r\n            'fill-opacity',\r\n            'font-family',\r\n            'font-style',\r\n            'font-weight'\r\n        ];\r\n\r\n        Markup.call(this, id, editor, styleAttributes);\r\n\r\n        // Bind to this to pass globalManager\r\n        this.createSvgElement = createSvgElement.bind(this);\r\n        this.addMarkupMetadata = addMarkupMetadata.bind(this);\r\n\r\n        this.type = MarkupTypes.MARKUP_TYPE_TEXT;\r\n        this.shape = createMarkupTextSvg();\r\n        this.constraintRotation = true;\r\n        this.constraintHeight = true;\r\n        this.constraintWidth = false;\r\n        this.size.x = size.x;\r\n        this.size.y = size.y;\r\n        this.currentText = \"\";\r\n        this.currentTextLines = [\"\"];\r\n        this.textDirty = true;\r\n        this.textSize = {x: 0, y: 0};\r\n        this.prevHighlight = false;\r\n        this.isHelperTextActive = false;\r\n\r\n        // Note: We could have this property be a style property.\r\n        // However, there is no need for this property to be exposed to the user for alteration\r\n        // This value is a percentage of the font size used to offset vertically 2 text lines\r\n        // of the same paragraph.\r\n        // Notice that this value is used by EditorTextInput.js\r\n        this.lineHeight = 130;\r\n\r\n        this.minWidth = this.getClientFontSize() * STARTING_WIDTH_FACTOR;\r\n\r\n        this.bindDomEvents();\r\n    }\r\n\r\n    MarkupText.prototype = Object.create(Markup.prototype);\r\n    MarkupText.prototype.constructor = MarkupText;\r\n\r\n    var proto = MarkupText.prototype;\r\n\r\n    proto.getEditMode = function() {\r\n\r\n        return new EditModeText(this.editor);\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param {String} position\r\n     * @param {String} size\r\n     * @param {String} textString\r\n     */\r\n    proto.set = function(position, size, textString) {\r\n\r\n        this.position.x = position.x;\r\n        this.position.y = position.y;\r\n        this.size.x = size.x;\r\n        this.size.y = size.y;\r\n\r\n        this.setText(textString);\r\n    };\r\n\r\n    proto.setSize = function(position, width, height) {\r\n\r\n        this.position.x = position.x;\r\n        this.position.y = position.y;\r\n        this.size.x = width;\r\n        this.size.y = height;\r\n\r\n        var sizeUpdateRequired = true;\r\n\r\n        if (this.isHelperTextActive) {\r\n            this.updateTextBoxStyle();\r\n        } else {\r\n            this.updateStyle(sizeUpdateRequired);\r\n        }\r\n    };\r\n\r\n    proto.setPosition = function(x, y) {\r\n\r\n        this.position.x = x;\r\n        this.position.y = y;\r\n\r\n        if (this.isHelperTextActive) {\r\n            this.updateTextBoxStyle();\r\n        } else {\r\n            this.updateStyle();\r\n        }\r\n    };\r\n\r\n    proto.setStyle = function(style) {\r\n\r\n        var stylesEqual = isStyleEqual(style, this.style);\r\n\r\n        if (!stylesEqual) {\r\n            copyStyle(style, this.style);\r\n        }\r\n\r\n        this.updateStyle(!stylesEqual);\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param {String} text\r\n     */\r\n    proto.setText = function(text) {\r\n\r\n        this.currentText = text;\r\n    };\r\n\r\n    /**\r\n     * Returns the raw string value\r\n     * @returns {String}\r\n     */\r\n    proto.getText = function() {\r\n\r\n        return this.currentText;\r\n    };\r\n\r\n    /**\r\n     * Returns a shallow copy of the text lines used for rendering SVG text\r\n     * @returns {Array.<String>}\r\n     */\r\n    proto.getTextLines = function() {\r\n\r\n        return this.currentTextLines.concat();\r\n    };\r\n\r\n    proto.highlightChanged = function() {\r\n\r\n        if (this.highlighted && this.highlighted !== this.prevHighlight) {\r\n            var shape = this.shape;\r\n            var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\r\n            setAttributeToMarkupSvg(shape, 'fill', strokeColor);\r\n\r\n            this.prevHighlight = true;\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    };\r\n\r\n    proto.updateTextBoxStyle = function() {\r\n        var editMode = this.editor.duringEditMode && this.editor.editMode;\r\n\r\n        if (!editMode || editMode.type !== this.type) {\r\n            editMode = this.getEditMode();\r\n        }\r\n\r\n        editMode.updateTextBoxStyle();\r\n    };\r\n\r\n    proto.setIsHelperTextActive = function(isActive) {\r\n        this.isHelperTextActive = isActive;\r\n    };\r\n\r\n    /**\r\n     * Applies data values into DOM element style/attribute(s)\r\n     *\r\n     */\r\n    proto.updateStyle = function(sizeUpdateRequired) {\r\n\r\n        if (this.highlightChanged()) {\r\n            this.prevHighlight = false;\r\n            var style = this.style;\r\n            var shape = this.shape;\r\n            var fontSize = this.style['font-size'];\r\n            var fontFamily = this.style['font-family'];\r\n            var fontWeight = this.style['font-weight'];\r\n            var fontStyle = this.style['font-style'];\r\n            var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\r\n            var fillColor = composeRGBAString(style['fill-color'], style['fill-opacity']);\r\n\r\n            // FONT_SIZE_SCALE is used to scale up fontSize, but it is only needed in cases where the font size is too small\r\n            FONT_SIZE_SCALE = (fontSize > 1) ? 1 : 100;\r\n\r\n            this.rebuildTextSvg(sizeUpdateRequired);\r\n\r\n            setAttributeToMarkupSvg(shape, 'font-family', fontFamily);\r\n            setAttributeToMarkupSvg(shape, 'font-size', fontSize * FONT_SIZE_SCALE);\r\n            setAttributeToMarkupSvg(shape, 'fill', strokeColor);\r\n            setAttributeToMarkupSvg(shape, 'font-weight', fontWeight);\r\n            setAttributeToMarkupSvg(shape, 'font-style', fontStyle);\r\n\r\n            var editor = this.editor;\r\n            var transform = this.getTransform();\r\n            var textTransform = this.getTextTransform();\r\n\r\n            setMarkupTextSvgTransform(shape, transform, textTransform);\r\n            updateMarkupTextSvgBackground(shape, this.size.x, this.size.y, fillColor);\r\n            updateMarkupTextSvgClipper(shape, this.size.x, this.size.y);\r\n            updateMarkupTextSvgHitarea(shape, this.size.x, this.size.y, editor);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Re-creates SVG tags that render SVG text.\r\n     * Each line is placed around tspan tags which are vertically offset to each other.\r\n     */\r\n    proto.rebuildTextSvg = function(sizeUpdateRequired) {\r\n\r\n        // TODO: Remove the need to get text values from an object in edit mode, should be a function.\r\n        // editMode needs to be set to load markups in view mode\r\n        var editMode = this.editor.duringEditMode && this.editor.editMode;\r\n\r\n        if (!editMode || editMode.type !== this.type) {\r\n            editMode = this.getEditMode();\r\n            editMode.textInputHelper.textArea.value = this.currentText;\r\n            editMode.textInputHelper.setStyle(this.style);\r\n        }\r\n\r\n        if (editMode.textInputHelper.textMarkup && editMode.textInputHelper.textMarkup !== this) {\r\n            return;\r\n        }\r\n\r\n        var style = cloneStyle(editMode.textInputHelper.style);\r\n        var text = editMode.textInputHelper.textArea.value;\r\n\r\n        var textHelperValues = editMode.textInputHelper.getTextValuesForMarkup(this, sizeUpdateRequired);\r\n\r\n        this.currentTextLines = textHelperValues.textValues.lines;\r\n\r\n        if (textHelperValues.newPos) {\r\n            var position = this.editor.positionFromClientToMarkups(textHelperValues.newPos.x, textHelperValues.newPos.y);\r\n            var size = this.editor.sizeFromClientToMarkups(textHelperValues.width, textHelperValues.height);\r\n\r\n            this.position.x = position.x;\r\n            this.position.y = position.y;\r\n            this.size.x = size.x;\r\n            this.size.y = size.y;\r\n        }\r\n\r\n        if (editMode.selectedMarkup !== this && !editMode.textInputHelper.firstEdit) {\r\n            editMode.textInputHelper.textArea.value = text;\r\n            editMode.textInputHelper.setStyle(style);\r\n        }\r\n\r\n        var markup = this.createSvgElement('text');\r\n        markup.setAttribute('id', 'markup');\r\n        markup.setAttribute('alignment-baseline', 'middle');\r\n\r\n        this.shape.childNodes[0].removeChild(this.shape.markup);\r\n        this.shape.childNodes[0].appendChild(markup);\r\n        this.shape.markup = markup;\r\n\r\n        // For each line, create a tspan, add as child and offset it vertically.\r\n        var yOffset = this.getLineHeight() * FONT_SIZE_SCALE * (this.lineHeight / 100);\r\n\r\n        var padding = (this.getLineHeight() * FONT_SIZE_SCALE) / 2;\r\n        var dx = padding;\r\n        var dy = padding;\r\n\r\n        this.currentTextLines.forEach(function(line){\r\n\r\n            var tspan = this.createSvgElement('tspan');\r\n\r\n            tspan.setAttribute('x', dx);\r\n            tspan.setAttribute('y', dy);\r\n            tspan.textContent = line;\r\n\r\n            markup.appendChild(tspan);\r\n            dy += yOffset;\r\n        }.bind(this));\r\n    };\r\n\r\n    proto.setIsShapeVisible = function(isVisible) {\r\n\r\n        this.shape.style.display = (isVisible) ? 'block' : 'none';\r\n    };\r\n\r\n    proto.setMetadata = function() {\r\n\r\n        var metadata = cloneStyle(this.style);\r\n\r\n        metadata.type = this.type;\r\n        metadata.position = [this.position.x, this.position.y].join(\" \");\r\n        metadata.size = [this.size.x, this.size.y].join(\" \");\r\n        metadata.text = String(this.currentText);\r\n\r\n        return this.addMarkupMetadata(this.shape, metadata);\r\n    };\r\n\r\n    /**\r\n     * Helper method that returns the font size in client space coords.\r\n     * @returns {Number}\r\n     */\r\n    proto.getClientFontSize = function() {\r\n\r\n        return this.editor.sizeFromMarkupsToClient(0, this.style['font-size']).y;\r\n    };\r\n\r\n    proto.getLineHeight = function() {\r\n\r\n        return this.style['font-size'];\r\n    };\r\n\r\n    proto.getTransform = function() {\r\n\r\n        var x = this.position.x - this.size.x * 0.5;\r\n        var y = this.position.y + this.size.y * 0.5;\r\n\r\n        return [\r\n            'translate(', x, ',', y, ')',\r\n            'rotate(', radiansToDegrees(-this.rotation), ')',\r\n            'scale(1,-1)'\r\n        ].join(' ');\r\n    };\r\n\r\n    proto.getTextTransform = function() {\r\n\r\n        var lineHeight = this.getLineHeight();\r\n\r\n        var x = this.position.x - this.size.x * 0.5;\r\n        var y = this.position.y + this.size.y * 0.5 - lineHeight;\r\n\r\n        return [\r\n            'translate(', x, ',', y, ')',\r\n            'rotate(', radiansToDegrees(-this.rotation), ')',\r\n            'scale(' + (1/FONT_SIZE_SCALE) + ',' + (-1/FONT_SIZE_SCALE) + ')'\r\n        ].join(' ');\r\n    };\r\n\r\n    proto.cloneShape = function(clone) {\r\n\r\n        clone.shape = createMarkupTextSvg();\r\n        clone.bindDomEvents();\r\n    };\r\n\r\n    proto.getBoundingRect = function() {\r\n        var pos = this.getClientPosition();\r\n        var size = this.getClientSize();\r\n        return {\r\n            x: pos.x - size.x / 2,\r\n            y: pos.y - size.y / 2,\r\n            width: size.x,\r\n            height: size.y\r\n        }\r\n    };\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\nimport { MarkupText } from '../MarkupText'\r\nimport { cloneStyle } from '../StyleUtils'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param id\r\n     * @param position\r\n     * @param size\r\n     * @param text\r\n     * @param style\r\n     * @constructor\r\n     */\r\n    export function CreateText(editor, id, position, size, text, style ) {\r\n\r\n        EditAction.call(this, editor, 'CREATE-TEXT', id);\r\n\r\n        this.text = text;\r\n        this.position = {x: position.x, y: position.y};\r\n        this.size = {x: size.x, y: size.y};\r\n        this.style = cloneStyle(style);\r\n    }\r\n\r\n    CreateText.prototype = Object.create(EditAction.prototype);\r\n    CreateText.prototype.constructor = CreateText;\r\n\r\n    var proto = CreateText.prototype;\r\n\r\n    proto.redo = function () {\r\n\r\n        var editor = this.editor;\r\n        var position = this.position;\r\n        var size = this.size;\r\n\r\n        var text = new MarkupText(this.targetId, editor, size);\r\n\r\n        editor.addMarkup(text);\r\n\r\n        text.set(position, size, this.text);\r\n        text.setStyle(this.style);\r\n    };\r\n\r\n    proto.undo = function () {\r\n\r\n        var markup = this.editor.getMarkup(this.targetId);\r\n        if (markup) {\r\n            this.editor.removeMarkup(markup);\r\n            markup.destroy();\r\n        }\r\n    };\r\n\r\n\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\nimport { CreateCircle } from './CreateCircle'\r\n\r\n    /**\r\n     * Markup delete circle action.\r\n     * \r\n     * Implements an {@link Autodesk.Viewing.Extensions.Markups.Core.EditAction|EditAction}\r\n     * for deleting a Circle {@link Autodesk.Viewing.Extensions.Markups.Core.Markup|Markup}.\r\n     * Included in documentation as an example of how to create\r\n     * a specific EditAction that deals with Markup deletion.\r\n     * Developers are encourage to look into this class's source code and copy\r\n     * as much code as they need. Find link to source code below.\r\n     *\r\n     * @tutorial feature_markup\r\n     * @constructor\r\n     * @memberof Autodesk.Viewing.Extensions.Markups.Core\r\n     * @extends Autodesk.Viewing.Extensions.Markups.Core.EditAction\r\n     *\r\n     * @param editor\r\n     * @param circle\r\n     */\r\n    export function DeleteCircle(editor, circle) {\r\n\r\n        EditAction.call(this, editor, 'DELETE-CIRCLE', circle.id);\r\n        this.createCircle = new CreateCircle(\r\n            editor,\r\n            circle.id,\r\n            circle.position,\r\n            circle.size,\r\n            circle.rotation,\r\n            circle.getStyle());\r\n    }\r\n\r\n    DeleteCircle.prototype = Object.create(EditAction.prototype);\r\n    DeleteCircle.prototype.constructor = DeleteCircle;\r\n\r\n    var proto = DeleteCircle.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        this.createCircle.undo();\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        this.createCircle.redo();\r\n    };\r\n\r\n\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\n\r\n    /**\r\n     * Markup set circle action.\r\n     *\r\n     * Implements an {@link Autodesk.Viewing.Extensions.Markups.Core.EditAction|EditAction}\r\n     * for editing properties of a Circle {@link Autodesk.Viewing.Extensions.Markups.Core.Markup|Markup}.\r\n     * Included in documentation as an example of how to create\r\n     * a specific EditAction that deals with Markup edition.\r\n     * Developers are encourage to look into this class's source code and copy\r\n     * as much code as they need. Find link to source code below.\r\n     *\r\n     * @tutorial feature_markup\r\n     * @constructor\r\n     * @memberof Autodesk.Viewing.Extensions.Markups.Core\r\n     * @extends Autodesk.Viewing.Extensions.Markups.Core.EditAction\r\n     *\r\n     * @param editor\r\n     * @param circle\r\n     * @param position\r\n     * @param size\r\n     */\r\n    export function SetCircle(editor, circle, position, size) {\r\n\r\n        EditAction.call(this, editor, 'SET-CIRCLE', circle.id);\r\n\r\n        this.newPosition = {x: position.x, y: position.y};\r\n        this.newSize = {x: size.x, y: size.y};\r\n        this.oldPosition = {x: circle.position.x, y: circle.position.y};\r\n        this.oldSize = {x: circle.size.x, y: circle.size.y};\r\n    }\r\n\r\n    SetCircle.prototype = Object.create(EditAction.prototype);\r\n    SetCircle.prototype.constructor = SetCircle;\r\n\r\n    var proto = SetCircle.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        this.applyState(this.targetId, this.newPosition, this.newSize);\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        this.applyState(this.targetId, this.oldPosition, this.oldSize);\r\n    };\r\n\r\n    proto.merge = function(action) {\r\n\r\n        if (this.targetId === action.targetId &&\r\n            this.type === action.type) {\r\n\r\n            this.newPosition = action.newPosition;\r\n            this.newSize = action.newSize;\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @private\r\n     */\r\n    proto.applyState = function(targetId, position, size) {\r\n\r\n        var circle = this.editor.getMarkup(targetId);\r\n        if(!circle) {\r\n            return;\r\n        }\r\n\r\n        // Different stroke widths make positions differ at sub-pixel level.\r\n        var epsilon = 0.0001;\r\n\r\n        if (Math.abs(circle.position.x - position.x) > epsilon || Math.abs(circle.size.y - size.y) > epsilon ||\r\n            Math.abs(circle.position.y - position.y) > epsilon || Math.abs(circle.size.y - size.y) > epsilon) {\r\n\r\n            circle.set(position, size);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * @returns {boolean}\r\n     */\r\n    proto.isIdentity = function() {\r\n\r\n        return (\r\n            this.newPosition.x === this.oldPosition.x &&\r\n            this.newPosition.y === this.oldPosition.y &&\r\n            this.newSize.x === this.oldSize.x &&\r\n            this.newSize.y === this.oldSize.y);\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { EditMode } from './EditMode'\r\nimport { DeleteCircle } from '../edit-actions/DeleteCircle'\r\nimport { CreateCircle } from '../edit-actions/CreateCircle'\r\nimport { SetCircle } from '../edit-actions/SetCircle'\r\nimport * as MarkupTypes from '../MarkupTypes'\r\n\r\n    /**\r\n     * Markup circle edit mode.\r\n     *\r\n     * Implements a Circle {@link Autodesk.Viewing.Extensions.Markups.Core.EditMode|EditMode}.\r\n     * Included in documentation as an example of how to create\r\n     * an EditMode for a specific markup type. Developers are encourage to look into this class's source code and copy\r\n     * as much code as they need. Find link to source code below.\r\n     *\r\n     * @tutorial feature_markup\r\n     * @constructor\r\n     * @memberof Autodesk.Viewing.Extensions.Markups.Core\r\n     * @extends Autodesk.Viewing.Extensions.Markups.Core.EditMode\r\n     * @param {Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore} editor\r\n     */\r\n    export function EditModeCircle(editor) {\r\n\r\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity', 'fill-color', 'fill-opacity'];\r\n        EditMode.call(this, editor, MarkupTypes.MARKUP_TYPE_CIRCLE, styleAttributes);\r\n    }\r\n\r\n    EditModeCircle.prototype = Object.create(EditMode.prototype);\r\n    EditModeCircle.prototype.constructor = EditModeCircle;\r\n\r\n    var proto = EditModeCircle.prototype;\r\n\r\n    proto.deleteMarkup = function(markup, cantUndo) {\r\n\r\n        markup = markup || this.selectedMarkup;\r\n        if (markup && markup.type == this.type) {\r\n            var deleteCircle = new DeleteCircle(this.editor, markup);\r\n            deleteCircle.addToHistory = !cantUndo;\r\n            deleteCircle.execute();\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * Handler to mouse move events, used to create markups.\r\n     * @param {MouseEvent} event Mouse event.\r\n     * @private\r\n     */\r\n    proto.onMouseMove = function(event) {\r\n\r\n        EditMode.prototype.onMouseMove.call( this, event );\r\n\r\n        var selectedMarkup = this.selectedMarkup;\r\n        if(!selectedMarkup || !this.creating) {\r\n            return;\r\n        }\r\n\r\n        var editor = this.editor;\r\n\r\n        var final = this.getFinalMouseDraggingPosition();\r\n        final = editor.clientToMarkups(final.x, final.y);\r\n\r\n        var sizeX = Math.abs(this.firstPosition.x - final.x);\r\n        var sizeY = Math.abs(this.firstPosition.y - final.y);\r\n\r\n        var position = {x: (this.firstPosition.x + final.x) * 0.5, y: (this.firstPosition.y + final.y) * 0.5};\r\n        var size = this.size = {x: sizeX, y: sizeY};\r\n\r\n        var setCircle = new SetCircle(\r\n            editor,\r\n            selectedMarkup,\r\n            position,\r\n            size);\r\n\r\n        setCircle.execute();\r\n    };\r\n\r\n    /**\r\n     * Handler to mouse down events, used to start markups creation.\r\n     * @private\r\n     */\r\n    proto.onMouseDown = function() {\r\n\r\n        EditMode.prototype.onMouseDown.call(this);\r\n\r\n        if (this.selectedMarkup) {\r\n            return;\r\n        }\r\n\r\n        var editor = this.editor;\r\n        var mousePosition = editor.getMousePosition();\r\n\r\n        this.initialX = mousePosition.x;\r\n        this.initialY = mousePosition.y;\r\n\r\n        // Calculate center and size.\r\n        var position = this.firstPosition = editor.clientToMarkups(this.initialX, this.initialY);\r\n        var size = this.size = editor.sizeFromClientToMarkups(1, 1);\r\n\r\n        // Create circle.\r\n        editor.beginActionGroup();\r\n\r\n        var markupId = editor.getId();\r\n        var create = new CreateCircle(\r\n            editor,\r\n            markupId,\r\n            position,\r\n            size,\r\n            0,\r\n            this.style);\r\n        create.execute();\r\n\r\n        this.selectedMarkup = editor.getMarkup(markupId);\r\n        this.creationBegin();\r\n    };\r\n","'use strict';\r\n\r\nimport { Markup } from './Markup'\r\nimport * as MarkupTypes from './MarkupTypes'\r\nimport { createMarkupPathSvg, composeRGBAString, setAttributeToMarkupSvg, \r\n        updateMarkupPathSvgHitarea, addMarkupMetadata, createEllipsePath } from './MarkupsCoreUtils'\r\nimport { cloneStyle } from './StyleUtils'\r\nimport { EditModeCircle } from './edit-modes/EditModeCircle'\r\n\r\n    /**\r\n     *\r\n     * @param id\r\n     * @param editor\r\n     * @constructor\r\n     */\r\n    export function MarkupCircle(id, editor) {\r\n\r\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity', 'fill-color', 'fill-opacity'];\r\n        Markup.call(this, id, editor, styleAttributes);\r\n\r\n        // bind to this to pass this.globalManager\r\n        this.addMarkupMetadata = addMarkupMetadata.bind(this);\r\n\r\n        this.type = MarkupTypes.MARKUP_TYPE_CIRCLE;\r\n        this.shape = createMarkupPathSvg();\r\n\r\n        this.bindDomEvents();\r\n    }\r\n\r\n    MarkupCircle.prototype = Object.create(Markup.prototype);\r\n    MarkupCircle.prototype.constructor = MarkupCircle;\r\n\r\n    var proto = MarkupCircle.prototype;\r\n\r\n    proto.getEditMode = function() {\r\n\r\n        return new EditModeCircle(this.editor);\r\n    };\r\n\r\n    proto.set = function(position, size) {\r\n\r\n        this.setSize(position, size.x, size.y);\r\n    };\r\n\r\n    /**\r\n     * Applies data values into DOM element style/attribute(s)\r\n     *\r\n     */\r\n    proto.updateStyle = function() {\r\n\r\n        var style = this.style;\r\n        var shape = this.shape;\r\n        var path = this.getPath().join(' ');\r\n\r\n        var strokeWidth = this.style['stroke-width'];\r\n        var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\r\n        var fillColor = composeRGBAString(style['fill-color'], style['fill-opacity']);\r\n        var transform = this.getTransform();\r\n\r\n        setAttributeToMarkupSvg(shape, 'd', path);\r\n        setAttributeToMarkupSvg(shape, 'stroke-width', strokeWidth);\r\n        setAttributeToMarkupSvg(shape, 'stroke', strokeColor);\r\n        setAttributeToMarkupSvg(shape, 'fill', fillColor);\r\n        setAttributeToMarkupSvg(shape, 'transform', transform);\r\n        updateMarkupPathSvgHitarea(shape, this.editor);\r\n    };\r\n\r\n    proto.setMetadata = function() {\r\n\r\n        var metadata = cloneStyle(this.style);\r\n\r\n        metadata.type = this.type;\r\n        metadata.position = [this.position.x, this.position.y].join(\" \");\r\n        metadata.size = [this.size.x, this.size.y].join(\" \");\r\n        metadata.rotation = String(this.rotation);\r\n\r\n        return this.addMarkupMetadata(this.shape, metadata);\r\n    };\r\n\r\n    proto.getPath = function() {\r\n\r\n        var size = this.size;\r\n        if (size.x === 1 || size.y === 1) {\r\n            return [''];\r\n        }\r\n\r\n        var strokeWidth = this.style['stroke-width'];\r\n\r\n        var ellipseW = size.x - strokeWidth;\r\n        var ellipseH = size.y - strokeWidth;\r\n\r\n        var ellipseX = -0.5*ellipseW;\r\n        var ellipseY = 0;\r\n\r\n        var path = [];\r\n        createEllipsePath(ellipseX, ellipseY, ellipseW, ellipseH, false, path);\r\n\r\n        return path;\r\n    };\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\nimport { MarkupCircle } from '../MarkupCircle'\r\nimport { cloneStyle } from '../StyleUtils'\r\n\r\n    /**\r\n     * Markup create circle action.\r\n     *\r\n     * Implements an {@link Autodesk.Viewing.Extensions.Markups.Core.EditAction|EditAction}\r\n     * for creating a Circle {@link Autodesk.Viewing.Extensions.Markups.Core.Markup|Markup}.\r\n     * Included in documentation as an example of how to create\r\n     * a specific EditAction that deals with Markup creation.\r\n     * Developers are encourage to look into this class's source code and copy\r\n     * as much code as they need. Find link to source code below.\r\n     *\r\n     * @tutorial feature_markup\r\n     * @constructor\r\n     * @memberof Autodesk.Viewing.Extensions.Markups.Core\r\n     * @extends Autodesk.Viewing.Extensions.Markups.Core.EditAction\r\n     *\r\n     * @param editor\r\n     * @param id\r\n     * @param position\r\n     * @param size\r\n     * @param rotation\r\n     * @param style\r\n     */\r\n    export function CreateCircle(editor, id, position, size, rotation, style) {\r\n\r\n        EditAction.call(this, editor, 'CREATE-CIRCLE', id);\r\n\r\n        this.selectOnExecution = false;\r\n        this.position = {x: position.x, y: position.y};\r\n        this.size = {x: size.x, y: size.y};\r\n        this.rotation = rotation;\r\n        this.style = cloneStyle(style);\r\n    }\r\n\r\n    CreateCircle.prototype = Object.create(EditAction.prototype);\r\n    CreateCircle.prototype.constructor = CreateCircle;\r\n\r\n    var proto = CreateCircle.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        var editor = this.editor;\r\n        var circle = new MarkupCircle(this.targetId, editor);\r\n\r\n        editor.addMarkup(circle);\r\n\r\n        circle.setSize(this.position, this.size.x, this.size.y);\r\n        circle.setRotation(this.rotation);\r\n        circle.setStyle(this.style);\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        var markup = this.editor.getMarkup(this.targetId);\r\n        markup && this.editor.removeMarkup(markup);\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\nimport { CreateCloud } from './CreateCloud'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param cloud\r\n     * @constructor\r\n     */\r\n    export function DeleteCloud(editor, cloud) {\r\n\r\n        EditAction.call(this, editor, 'DELETE-CLOUD', cloud.id);\r\n        this.createCloud = new CreateCloud(\r\n            editor,\r\n            cloud.id,\r\n            cloud.position,\r\n            cloud.size,\r\n            cloud.rotation,\r\n            cloud.getStyle());\r\n    }\r\n\r\n    DeleteCloud.prototype = Object.create(EditAction.prototype);\r\n    DeleteCloud.prototype.constructor = DeleteCloud;\r\n\r\n    var proto = DeleteCloud.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        this.createCloud.undo();\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        this.createCloud.redo();\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param cloud\r\n     * @param position\r\n     * @param size\r\n     * @constructor\r\n     */\r\n    export function SetCloud(editor, cloud, position, size) {\r\n\r\n        EditAction.call(this, editor, 'SET-CLOUD', cloud.id);\r\n\r\n        this.newPosition = {x: position.x, y: position.y};\r\n        this.newSize = {x: size.x, y: size.y};\r\n        this.oldPosition = {x: cloud.position.x, y: cloud.position.y};\r\n        this.oldSize = {x: cloud.size.x, y: cloud.size.y};\r\n    }\r\n\r\n    SetCloud.prototype = Object.create(EditAction.prototype);\r\n    SetCloud.prototype.constructor = SetCloud;\r\n\r\n    var proto = SetCloud.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        this.applyState(this.targetId, this.newPosition, this.newSize, this.newStrokeWidth, this.newColor);\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        this.applyState(this.targetId, this.oldPosition, this.oldSize, this.oldStrokeWidth, this.oldColor);\r\n    };\r\n\r\n    proto.merge = function(action) {\r\n\r\n        if (this.targetId === action.targetId &&\r\n            this.type === action.type) {\r\n\r\n            this.newPosition = action.newPosition;\r\n            this.newSize = action.newSize;\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @private\r\n     */\r\n    proto.applyState = function(targetId, position, size) {\r\n\r\n        var cloud = this.editor.getMarkup(targetId);\r\n        if(!cloud) {\r\n            return;\r\n        }\r\n\r\n        // Different stroke widths make positions differ at sub-pixel level.\r\n        var epsilon = 0.0001;\r\n\r\n        if (Math.abs(cloud.position.x - position.x) > epsilon || Math.abs(cloud.size.y - size.y) > epsilon ||\r\n            Math.abs(cloud.position.y - position.y) > epsilon || Math.abs(cloud.size.y - size.y) > epsilon) {\r\n\r\n            cloud.set(position, size);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * @returns {boolean}\r\n     */\r\n    proto.isIdentity = function() {\r\n\r\n        return (\r\n            this.newPosition.x === this.oldPosition.x &&\r\n            this.newPosition.y === this.oldPosition.y &&\r\n            this.newSize.x === this.oldSize.x &&\r\n            this.newSize.y === this.oldSize.y);\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { EditMode } from './EditMode'\r\nimport { DeleteCloud } from '../edit-actions/DeleteCloud'\r\nimport { CreateCloud } from '../edit-actions/CreateCloud'\r\nimport { SetCloud } from '../edit-actions/SetCloud'\r\nimport * as MarkupTypes from '../MarkupTypes'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @constructor\r\n     */\r\n    export function EditModeCloud(editor) {\r\n\r\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity', 'fill-color', 'fill-opacity'];\r\n        EditMode.call(this, editor, MarkupTypes.MARKUP_TYPE_CLOUD, styleAttributes);\r\n    }\r\n\r\n    EditModeCloud.prototype = Object.create(EditMode.prototype);\r\n    EditModeCloud.prototype.constructor = EditModeCloud;\r\n\r\n    var proto = EditModeCloud.prototype;\r\n\r\n    proto.deleteMarkup = function(markup, cantUndo) {\r\n\r\n        markup = markup || this.selectedMarkup;\r\n        if (markup && markup.type == this.type) {\r\n            var deleteCloud = new DeleteCloud(this.editor, markup);\r\n            deleteCloud.addToHistory = !cantUndo;\r\n            deleteCloud.execute();\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * Handler to mouse move events, used to create markups.\r\n     * @param {MouseEvent} event Mouse event.\r\n     * @private\r\n     */\r\n    proto.onMouseMove = function(event) {\r\n\r\n        EditMode.prototype.onMouseMove.call( this, event );\r\n\r\n        var selectedMarkup = this.selectedMarkup;\r\n        if(!selectedMarkup || !this.creating) {\r\n            return;\r\n        }\r\n\r\n        var editor = this.editor;\r\n\r\n        var pos = this.getFinalMouseDraggingPosition();\r\n        var final = editor.clientToMarkups(pos.x, pos.y);\r\n        var position = { x: (this.firstPosition.x + final.x) / 2, y: (this.firstPosition.y + final.y) / 2 };\r\n        var size = this.size = { x: Math.abs(final.x - this.firstPosition.x), y: Math.abs(final.y - this.firstPosition.y) };\r\n        var setCloud = new SetCloud(\r\n            editor,\r\n            selectedMarkup,\r\n            position,\r\n            size);\r\n\r\n        setCloud.execute();\r\n    };\r\n\r\n    /**\r\n     * Handler to mouse down events, used to start markups creation.\r\n     * @private\r\n     */\r\n    proto.onMouseDown = function() {\r\n\r\n        EditMode.prototype.onMouseDown.call(this);\r\n\r\n        if (this.selectedMarkup) {\r\n            return;\r\n        }\r\n\r\n        var editor = this.editor;\r\n        var mousePosition = editor.getMousePosition();\r\n\r\n        this.initialX = mousePosition.x;\r\n        this.initialY = mousePosition.y;\r\n\r\n        // Calculate center and size.\r\n        var position = this.firstPosition = editor.clientToMarkups(this.initialX, this.initialY);\r\n        var size = this.size = editor.sizeFromClientToMarkups(1, 1);\r\n\r\n        // Create Cloud.\r\n        editor.beginActionGroup();\r\n\r\n        var markupId = editor.getId();\r\n        var create = new CreateCloud(\r\n            editor,\r\n            markupId,\r\n            position,\r\n            size,\r\n            0,\r\n            this.style);\r\n\r\n        create.execute();\r\n\r\n        this.selectedMarkup = editor.getMarkup(markupId);\r\n        this.creationBegin();\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { Markup } from './Markup'\r\nimport * as MarkupTypes from './MarkupTypes'\r\nimport { createMarkupPathSvg, composeRGBAString, setAttributeToMarkupSvg,\r\n    updateMarkupPathSvgHitarea, addMarkupMetadata, createEllipsePath } from './MarkupsCoreUtils'\r\nimport { cloneStyle } from './StyleUtils'\r\nimport { EditModeCloud } from './edit-modes/EditModeCloud'\r\n\r\n    /**\r\n     *\r\n     * @param id\r\n     * @param editor\r\n     * @constructor\r\n     */\r\n    export function MarkupCloud(id, editor) {\r\n\r\n        var styleAttributes = ['stroke-width', 'stroke-linejoin', 'stroke-color', 'stroke-opacity', 'fill-color', 'fill-opacity'];\r\n        Markup.call(this, id, editor, styleAttributes);\r\n\r\n        // bind to this to pass this.globalManager\r\n        this.addMarkupMetadata = addMarkupMetadata.bind(this);\r\n\r\n        this.type = MarkupTypes.MARKUP_TYPE_CLOUD;\r\n        this.shape = createMarkupPathSvg();\r\n\r\n        this.bindDomEvents();\r\n    }\r\n\r\n    MarkupCloud.prototype = Object.create(Markup.prototype);\r\n    MarkupCloud.prototype.constructor = MarkupCloud;\r\n\r\n    var proto = MarkupCloud.prototype;\r\n\r\n    proto.getEditMode = function() {\r\n\r\n        return new EditModeCloud(this.editor);\r\n    };\r\n\r\n    /**\r\n     * Sets position and size in markup space coordinates.\r\n     * @param {Object} position\r\n     * @param {Object} size\r\n     */\r\n    proto.set = function(position, size) {\r\n\r\n        this.setSize(position, size.x, size.y);\r\n    };\r\n\r\n    /**\r\n     * Applies data values into DOM element style/attribute(s)\r\n     *\r\n     */\r\n    proto.updateStyle = function() {\r\n\r\n        var style = this.style;\r\n        var shape = this.shape;\r\n        var path = this.getPath().join(' ');\r\n\r\n        var strokeWidth = this.style['stroke-width'];\r\n        var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\r\n        var fillColor = composeRGBAString(style['fill-color'], style['fill-opacity']);\r\n        var transform = this.getTransform();\r\n\r\n        setAttributeToMarkupSvg(shape, 'd', path);\r\n        setAttributeToMarkupSvg(shape, 'stroke-width', strokeWidth);\r\n        setAttributeToMarkupSvg(shape, 'stroke', strokeColor);\r\n        setAttributeToMarkupSvg(shape, 'fill', fillColor);\r\n        setAttributeToMarkupSvg(shape, 'transform', transform);\r\n        updateMarkupPathSvgHitarea(shape, this.editor);\r\n    };\r\n\r\n    proto.setMetadata = function() {\r\n\r\n        var metadata = cloneStyle(this.style);\r\n\r\n        metadata.type = this.type;\r\n        metadata.position = [this.position.x, this.position.y].join(\" \");\r\n        metadata.size = [this.size.x, this.size.y].join(\" \");\r\n        metadata.rotation = String(this.rotation);\r\n\r\n        return this.addMarkupMetadata(this.shape, metadata);\r\n    };\r\n\r\n    /**\r\n     * Helper function that creates intermediate points given the\r\n     * current position and size.\r\n     * @returns {Array}\r\n     */\r\n    proto.getPath = function() {\r\n\r\n        var position = this.position;\r\n        var size = this.size;\r\n        var strokeWidth = this.style['stroke-width'];\r\n        var radius = strokeWidth * 2;\r\n\r\n        function createArcTo(x, y, xRadius, yRadius, path) {\r\n\r\n            path.push('a');\r\n            path.push(xRadius);\r\n            path.push(yRadius);\r\n            path.push(0);\r\n            path.push(1);\r\n            path.push(1);\r\n            path.push(x);\r\n            path.push(y);\r\n\r\n            return path;\r\n        }\r\n\r\n        function createCorner(corner, xRadius, yRadius, strokeWidth, path) {\r\n\r\n            switch(corner) {\r\n\r\n                case 'LT':\r\n                    return createArcTo( xRadius,-yRadius, xRadius, yRadius, path);\r\n                    break;\r\n\r\n                case 'RT':\r\n                    return createArcTo( xRadius, yRadius, xRadius, yRadius, path);\r\n                    break;\r\n\r\n                case 'RB':\r\n                    return createArcTo(-xRadius, yRadius, xRadius, yRadius, path);\r\n                    break;\r\n\r\n                case 'LB':\r\n                    return createArcTo(-xRadius,-yRadius, xRadius, yRadius, path);\r\n                    break;\r\n            }\r\n        }\r\n\r\n        function getSideParameters(x1, x2, radius, strokeWidth) {\r\n\r\n            var diameter = radius * 2;\r\n            var length = Math.abs(x2 - x1 - strokeWidth);\r\n            var count = Math.round(length / diameter);\r\n\r\n            diameter += (length - diameter * count) / count;\r\n            radius = diameter * 0.5;\r\n\r\n            var xValueInset = diameter * 0.05;\r\n            var yValueOffset = radius * 3.5 / 3.0;\r\n\r\n            return {\r\n                count: count,\r\n                radius: radius,\r\n                diameter: diameter,\r\n                p1: {x: xValueInset, y: -yValueOffset },\r\n                p2: {x: diameter - xValueInset, y: -yValueOffset},\r\n                p3: {x: diameter, y: 0}\r\n            };\r\n        }\r\n\r\n        function createTSide(hSidesParameters, path){\r\n\r\n            var sp = hSidesParameters;\r\n            for(var i = 0; i < sp.count; ++i) {\r\n\r\n                path.push('c');\r\n                path.push(sp.p1.x);\r\n                path.push(sp.p1.y);\r\n                path.push(sp.p2.x);\r\n                path.push(sp.p2.y);\r\n                path.push(sp.p3.x);\r\n                path.push(sp.p3.y);\r\n            }\r\n\r\n            return path;\r\n        }\r\n\r\n        function createRSide(vSidesParameters, path){\r\n\r\n            var sp = vSidesParameters;\r\n            for(var i = 0; i < sp.count; ++i) {\r\n                path.push('c');\r\n                path.push(-sp.p1.y);\r\n                path.push(sp.p1.x);\r\n                path.push(-sp.p2.y);\r\n                path.push(sp.p2.x);\r\n                path.push(-sp.p3.y);\r\n                path.push(sp.p3.x);\r\n            }\r\n\r\n            return path;\r\n        }\r\n\r\n        function createBSide(hSidesParameters, path){\r\n\r\n            var sp = hSidesParameters;\r\n            for(var i = 0; i < sp.count; ++i) {\r\n                path.push('c');\r\n                path.push(-sp.p1.x);\r\n                path.push(-sp.p1.y);\r\n                path.push(-sp.p2.x);\r\n                path.push(-sp.p2.y);\r\n                path.push(-sp.p3.x);\r\n                path.push(-sp.p3.y);\r\n            }\r\n\r\n            return path;\r\n        }\r\n\r\n        function createLSide(vSidesParameters, path){\r\n\r\n            var sp = vSidesParameters;\r\n            for(var i = 0; i < sp.count; ++i) {\r\n                path.push('c');\r\n                path.push(sp.p1.y);\r\n                path.push(-sp.p1.x);\r\n                path.push(sp.p2.y);\r\n                path.push(-sp.p2.x);\r\n                path.push(sp.p3.y);\r\n                path.push(-sp.p3.x);\r\n            }\r\n\r\n            return path;\r\n        }\r\n\r\n        var l = position.x;\r\n        var t = position.y;\r\n        var r = position.x + size.x;\r\n        var b = position.y + size.y;\r\n\r\n        var minSize = radius * 5;\r\n        var path = [];\r\n\r\n        if (size.x < minSize || size.y < minSize) {\r\n\r\n            var w = size.x - strokeWidth;\r\n            var h = size.y - strokeWidth;\r\n            var x = -w * 0.5;\r\n            var y = 0;\r\n\r\n            createEllipsePath(x, y, w, h, false, path);\r\n        } else {\r\n\r\n            var hSidesParameters = getSideParameters(l, r, radius, strokeWidth);\r\n            var vSidesParameters = getSideParameters(t, b, radius, strokeWidth);\r\n\r\n            var cornerSizeX = hSidesParameters.diameter;\r\n            var cornerSizeY = vSidesParameters.diameter;\r\n            var cornerRadiusX = hSidesParameters.radius;\r\n            var cornerRadiusY = vSidesParameters.radius;\r\n\r\n            hSidesParameters = getSideParameters(l + cornerSizeX, r - cornerSizeX, radius, strokeWidth);\r\n            vSidesParameters = getSideParameters(t + cornerSizeY, b - cornerSizeY, radius, strokeWidth);\r\n\r\n            var halfStrokeWidth = strokeWidth * 0.5;\r\n            var x =-size.x * 0.5 + halfStrokeWidth + cornerRadiusX;\r\n            var y =-size.y * 0.5 + halfStrokeWidth + cornerRadiusY * 2;\r\n\r\n            path.push('M');\r\n            path.push(x);\r\n            path.push(y);\r\n\r\n            createCorner('LT', cornerRadiusX, cornerRadiusY, strokeWidth, path);\r\n            createTSide(hSidesParameters, path);\r\n            createCorner('RT', cornerRadiusX, cornerRadiusY, strokeWidth, path);\r\n            createRSide(vSidesParameters, path);\r\n            createCorner('RB', cornerRadiusX, cornerRadiusY, strokeWidth, path);\r\n            createBSide(hSidesParameters, path);\r\n            createCorner('LB', cornerRadiusX, cornerRadiusY, strokeWidth, path);\r\n            createLSide(vSidesParameters, path);\r\n        }\r\n\r\n        path.push('z');\r\n        return path;\r\n    };\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\nimport { MarkupCloud } from '../MarkupCloud'\r\nimport { cloneStyle } from '../StyleUtils'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param id\r\n     * @param position\r\n     * @param size\r\n     * @param rotation\r\n     * @param style\r\n     * @constructor\r\n     */\r\n    export function CreateCloud(editor, id, position, size, rotation, style) {\r\n\r\n        EditAction.call(this, editor, 'CREATE-CLOUD', id);\r\n\r\n        this.selectOnExecution = false;\r\n        this.position = {x: position.x, y: position.y};\r\n        this.size = {x: size.x, y: size.y};\r\n        this.rotation = rotation;\r\n        this.style = cloneStyle(style);\r\n    }\r\n\r\n    CreateCloud.prototype = Object.create(EditAction.prototype);\r\n    CreateCloud.prototype.constructor = CreateCloud;\r\n\r\n    var proto = CreateCloud.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        var editor = this.editor;\r\n        var cloud = new MarkupCloud(this.targetId, editor);\r\n\r\n        editor.addMarkup(cloud);\r\n\r\n        cloud.set(this.position, this.size);\r\n        cloud.setRotation(this.rotation);\r\n        cloud.setStyle(this.style);\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        var markup = this.editor.getMarkup(this.targetId);\r\n        markup && this.editor.removeMarkup(markup);\r\n    };\r\n","'use strict';\r\n\r\nimport { Markup } from './Markup'\r\nimport { createMarkupPathSvg, setAttributeToMarkupSvg, updateMarkupPathSvgHitarea,\r\n    composeRGBAString, addMarkupMetadata } from './MarkupsCoreUtils'\r\nimport { cloneStyle } from './StyleUtils'\r\n\r\n    /**\r\n     * Base class for Pen Markup rendering (currently freehand and highlighter)\r\n     *\r\n     * Derived classes must implement getEditMode()\r\n     * @param id\r\n     * @param editor\r\n     * @constructor\r\n     */\r\n    export function MarkupPen(id, editor) {\r\n\r\n        var styleAttributes = ['stroke-width', 'stroke-color','stroke-opacity'];\r\n        Markup.call(this, id, editor, styleAttributes);\r\n\r\n        // bind to this to pass this.globalManager\r\n        this.addMarkupMetadata = addMarkupMetadata.bind(this);\r\n\r\n        this.shape = createMarkupPathSvg();\r\n\r\n        this.bindDomEvents();\r\n    }\r\n\r\n    MarkupPen.prototype = Object.create(Markup.prototype);\r\n    MarkupPen.prototype.constructor = MarkupPen;\r\n\r\n    var proto = MarkupPen.prototype;\r\n\r\n    /**\r\n     * Sets top-left and bottom-right values in client space coordinates (2d).\r\n     *\r\n     * @param position\r\n     * @param size\r\n     * @param locations\r\n     */\r\n    proto.set = function(position, size, locations, isAbsoluteCoords) {\r\n\r\n        this.rotation = 0; // Reset angle //\r\n        this.isAbsoluteCoords = isAbsoluteCoords;\r\n        if (this.isAbsoluteCoords) {\r\n            this.updatePath(locations);\r\n        } else {\r\n            this.locations = locations.slice(0);\r\n\r\n            this.size.x = (size.x === 0) ? 1 : size.x;\r\n            this.size.y = (size.y === 0) ? 1 : size.y;\r\n\r\n            this.setSize(position, size.x, size.y);\r\n            this.updateStyle();\r\n        }\r\n    };\r\n\r\n    proto.setPosition = function(x,y) {\r\n\r\n        this.position.x = x;\r\n        this.position.y = y;\r\n\r\n        var shape = this.shape;\r\n        var transform = this.getTransform();\r\n\r\n        setAttributeToMarkupSvg(shape, 'transform', transform);\r\n        updateMarkupPathSvgHitarea(shape, this.editor);\r\n    };\r\n\r\n    /**\r\n     * Applies data values into DOM element style/attribute(s)\r\n     *\r\n     */\r\n    proto.updateStyle = function() {\r\n\r\n        var style = this.style;\r\n        var shape = this.shape;\r\n        var path = this.getPath().join(' ');\r\n\r\n        var strokeWidth = this.style['stroke-width'];\r\n        var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\r\n        var fillColor = 'none';\r\n\r\n        setAttributeToMarkupSvg(shape, 'stroke-width', strokeWidth);\r\n        setAttributeToMarkupSvg(shape, 'stroke-linejoin', 'round');\r\n        setAttributeToMarkupSvg(shape, 'stroke-linecap', 'round');\r\n        setAttributeToMarkupSvg(shape, 'stroke', strokeColor);\r\n        setAttributeToMarkupSvg(shape, 'fill', fillColor);\r\n\r\n        this.updatePath(path);\r\n        updateMarkupPathSvgHitarea(shape, this.editor);\r\n    };\r\n\r\n    proto.updatePath = function(path) {\r\n        var shape = this.shape;\r\n        var transform = this.isAbsoluteCoords ? 'scale(1)' : this.getTransform();\r\n\r\n        setAttributeToMarkupSvg(shape, 'transform', transform);\r\n        setAttributeToMarkupSvg(shape, 'd', path);\r\n    };\r\n\r\n    /**\r\n     * Changes the position and size of the markup.\r\n     * This gets called by the Autodesk.Viewing.Extensions.Markups.Core.SetSize edit action\r\n     * @param {{x: Number, y: Number}} position\r\n     * @param {Number} width\r\n     * @param {Number} height\r\n     */\r\n    proto.setSize = function (position, width, height) {\r\n\r\n        width = (width === 0 ? 1 : width);\r\n        height = (height === 0 ? 1 : height);\r\n\r\n        var locations = this.locations;\r\n        var locationsCount = locations.length;\r\n\r\n        var scaleX = width / this.size.x;\r\n        var scaleY = height / this.size.y;\r\n\r\n        for(var i = 0; i < locationsCount; ++i) {\r\n\r\n            var point = locations[i];\r\n\r\n            point.x *= scaleX;\r\n            point.y *= scaleY;\r\n        }\r\n\r\n        this.position.x = position.x;\r\n        this.position.y = position.y;\r\n\r\n        this.size.x = width;\r\n        this.size.y = height;\r\n\r\n        this.updateStyle();\r\n    };\r\n\r\n    proto.setMetadata = function() {\r\n\r\n        var metadata = cloneStyle(this.style);\r\n\r\n        metadata.type = this.type;\r\n        metadata.position = [this.position.x, this.position.y].join(\" \");\r\n        metadata.size = [this.size.x, this.size.y].join(\" \");\r\n        metadata.rotation = String(this.rotation);\r\n        metadata.locations = this.locations.map(function(point){\r\n            return [point.x, point.y].join(\" \");\r\n        }).join(\" \");\r\n\r\n        return this.addMarkupMetadata(this.shape, metadata);\r\n    };\r\n\r\n    proto.getPath = function() {\r\n\r\n        var path = [];\r\n        var locations = this.locations;\r\n        var locationsCount = locations.length;\r\n\r\n        if (locationsCount > 1) {\r\n\r\n            path.push('M');\r\n            path.push(+(locations[0].x).toFixed(6));\r\n            path.push(+(locations[0].y).toFixed(6));\r\n\r\n            for (var i = 1; i < locationsCount; ++i) {\r\n\r\n                var locationA = locations[i - 1];\r\n                var locationB = locations[i];\r\n\r\n                path.push('l');\r\n                path.push(+(locationB.x - locationA.x).toFixed(6));\r\n                path.push(+(locationB.y - locationA.y).toFixed(6));\r\n            }\r\n        }\r\n\r\n        return path;\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { EditMode } from './EditMode'\r\nimport { simplify } from '../MarkupsCoreUtils'\r\n\r\n    /**\r\n     * Base class for editing Pen tools (currently freehand and highlighter)\r\n     *\r\n     * Any class extending EditModePen should contain at least the following methods:\r\n     * - createPen()\r\n     * - deletePen()\r\n     * - setPen()\r\n     *\r\n     * @param editor\r\n     * @constructor\r\n     */\r\n    export function EditModePen(editor, type, styleAttributes) {\r\n        EditMode.call(this, editor, type, styleAttributes);\r\n\r\n        this.smoothen = true;\r\n        this.bufferSize = 8;\r\n    }\r\n\r\n    EditModePen.prototype = Object.create(EditMode.prototype);\r\n\r\n    var proto = EditModePen.prototype;\r\n\r\n    proto.deleteMarkup = function(markup, cantUndo) {\r\n\r\n        markup = markup || this.selectedMarkup;\r\n        if (markup && markup.type === this.type) {\r\n            var deleteMarkup = this.deletePen(markup);\r\n            deleteMarkup.addToHistory = !cantUndo;\r\n            deleteMarkup.execute();\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * Handler to mouse move events, used to create markups.\r\n     * @param {MouseEvent} event Mouse event.\r\n     * @private\r\n     */\r\n    proto.onMouseMove = function(event) {\r\n\r\n        EditMode.prototype.onMouseMove.call( this, event );\r\n\r\n        var selectedMarkup = this.selectedMarkup;\r\n        if (!selectedMarkup || !this.creating) {\r\n            return;\r\n        }\r\n\r\n        var editor = this.editor;\r\n        var mousePosition = editor.getMousePosition();\r\n        var movements = this.movements;\r\n\r\n        var location = editor.clientToMarkups(mousePosition.x, mousePosition.y);\r\n        if (this.smoothen) {\r\n            this.appendToBuffer(location);\r\n            this.amendPath();\r\n        } else {\r\n            var dx = this.lastX - mousePosition.x;\r\n            var dy = this.lastY - mousePosition.y;\r\n            var moveTol = 25; // 5^2, compare to square to avoid using square root of distance\r\n\r\n            if (movements.length > 1 && (dx*dx + dy*dy) < moveTol) {\r\n                movements[movements.length - 1] = location;\r\n                this.removeFromAbsolutePath(1);\r\n            } else {\r\n                movements.push(location);\r\n                this.lastX = mousePosition.x;\r\n                this.lastY = mousePosition.y;\r\n            }\r\n\r\n            this.addToAbsolutePath([location]);\r\n        }\r\n\r\n        var setPen = this.setPen(this.position, this.size, this.absolutePath, true);\r\n        setPen.execute();\r\n    };\r\n\r\n    /**\r\n     * Handler to mouse down events, used to start markups creation.\r\n     * @private\r\n     */\r\n    proto.onMouseDown = function() {\r\n\r\n        EditMode.prototype.onMouseDown.call(this);\r\n\r\n        if (this.selectedMarkup) {\r\n            return;\r\n        }\r\n\r\n        var editor = this.editor;\r\n\r\n        editor.snapper && editor.snapper.clearSnapped();\r\n        var mousePosition = editor.getMousePosition();\r\n\r\n        this.lastX = this.initialX = mousePosition.x;\r\n        this.lastY = this.initialY = mousePosition.y;\r\n\r\n        //set the starting point\r\n        var position = this.position = editor.clientToMarkups(this.initialX, this.initialY);\r\n        this.movements = [position];\r\n        if (this.smoothen) {\r\n            this.buffer = []; // Reset buffer\r\n            this.movementsLastIndex = null;\r\n            this.appendToBuffer(position);\r\n        }\r\n\r\n        var size = this.size = editor.sizeFromClientToMarkups(1, 1);\r\n\r\n        // Create pen.\r\n        editor.beginActionGroup();\r\n\r\n        var markupId = editor.getId();\r\n        var create = this.createPen(markupId, position, size, 0, [{x: 0, y: 0 }]);\r\n\r\n        create.execute();\r\n\r\n        this.createAbsolutePath(position);\r\n\r\n        this.selectedMarkup = editor.getMarkup(markupId);\r\n        this.creationBegin();\r\n    };\r\n\r\n    proto.onMouseUp = function() {\r\n\r\n        if (!this.creating) {\r\n            EditMode.prototype.onMouseUp.call(this);\r\n            return;\r\n        }\r\n\r\n        var movements = this.movements;\r\n        var cameraWidth = this.viewer.impl.camera.right - this.viewer.impl.camera.left;\r\n        var cameraHeight = this.viewer.impl.camera.top - this.viewer.impl.camera.bottom;\r\n        var cameraDiagSq = cameraWidth*cameraWidth + cameraHeight*cameraHeight;\r\n\r\n        movements = simplify(movements, cameraDiagSq * 0.00000001, true);\r\n\r\n        var xs = movements.map(function(item) { return item.x });\r\n        var ys = movements.map(function(item) { return item.y });\r\n\r\n        var l = Math.min.apply(null, xs);\r\n        var t = Math.min.apply(null, ys);\r\n        var r = Math.max.apply(null, xs);\r\n        var b = Math.max.apply(null, ys);\r\n\r\n        var width = r - l;  // Already in markup coords space\r\n        var height = b - t; // Already in markup coords space\r\n\r\n        var position = {\r\n            x: l + width * 0.5,\r\n            y: t + height * 0.5\r\n        };\r\n        var size = this.size = {x: width, y: height};\r\n\r\n        // Adjust points to relate from the shape's center\r\n        var locations = movements.map(function(point){\r\n            return {\r\n                x: point.x - position.x,\r\n                y: point.y - position.y\r\n            };\r\n        });\r\n\r\n        var setPen = this.setPen(position, size, locations, false);\r\n        setPen.execute();\r\n\r\n        EditMode.prototype.onMouseUp.call(this);\r\n    };\r\n\r\n    proto.createPen = function() {\r\n        console.error('createPen not implemented');\r\n    };\r\n\r\n    proto.deletePen = function() {\r\n        console.error('deletePen not implemented');\r\n    };\r\n\r\n    proto.setPen = function() {\r\n        console.error('setPen not implemented');\r\n    };\r\n\r\n    proto.useWithSnapping = function () {\r\n        return false;\r\n    };\r\n\r\n    proto.createAbsolutePath = function(point) {\r\n\r\n        this.absolutePath = 'M' + +(point.x).toFixed(6) + ' ' + +(point.y).toFixed(6);\r\n        this.absolutePathIndexes = [0];\r\n    };\r\n\r\n    proto.removeFromAbsolutePath = function(numToRemove) {\r\n\r\n        numToRemove = Math.min(numToRemove, this.absolutePathIndexes.length);\r\n        if (numToRemove > 0) {\r\n            this.absolutePath = this.absolutePath.slice(0, this.absolutePathIndexes[this.absolutePathIndexes.length - numToRemove]);\r\n            this.absolutePathIndexes.splice(this.absolutePathIndexes.length - numToRemove);\r\n        }\r\n    };\r\n\r\n    proto.addToAbsolutePath = function(points) {\r\n\r\n       for (var i = 0; i < points.length; i++) {\r\n            this.absolutePathIndexes.push(this.absolutePath.length);\r\n            this.absolutePath += ' L' + +(points[i].x).toFixed(6) + ' ' + +(points[i].y).toFixed(6);\r\n        }\r\n    };\r\n\r\n    proto.appendToBuffer = function(point) {\r\n\r\n        this.buffer.push(point);\r\n        while (this.buffer.length > this.bufferSize) {\r\n            this.buffer.shift();\r\n        }\r\n    };\r\n\r\n    proto.amendPath = function() {\r\n\r\n        var point = this.getAveragePoint(0);\r\n        if (point) {\r\n            if (this.movementsLastIndex) {\r\n                this.removeFromAbsolutePath(this.movements.length - this.movementsLastIndex);\r\n                this.movements.splice(this.movementsLastIndex);\r\n            }\r\n\r\n            // Add the smoothed part of the path that will not change\r\n            var tmpBuffer = [point];\r\n            this.movementsLastIndex = this.movements.length + 1;\r\n\r\n            // Get the last part of the path (close to the current mouse position)\r\n            // This part will change if the mouse moves again\r\n            for (var offset = 2; offset < this.buffer.length; offset += 2) {\r\n                var pt = this.getAveragePoint(offset);\r\n                tmpBuffer.push(pt);\r\n            }\r\n\r\n            this.addToAbsolutePath(tmpBuffer);\r\n\r\n            // Set the complete current path coordinates\r\n            this.movements.push.apply(this.movements, tmpBuffer);\r\n\r\n        }\r\n    };\r\n\r\n    // Calculate the average point, starting at offset in the buffer\r\n    proto.getAveragePoint = function(offset) {\r\n\r\n        var len = this.buffer.length;\r\n        if (len % 2 === 1 || len >= this.bufferSize) {\r\n            var totalX = 0;\r\n            var totalY = 0;\r\n            var pt;\r\n            var count = 0;\r\n            for (var i = offset; i < len; i++) {\r\n                count++;\r\n                pt = this.buffer[i];\r\n                totalX += pt.x;\r\n                totalY += pt.y;\r\n            }\r\n            return {\r\n                x: totalX / count,\r\n                y: totalY / count\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\nimport { CreateFreehand } from './CreateFreehand'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param freehand\r\n     * @constructor\r\n     */\r\n    export function DeleteFreehand(editor, freehand) {\r\n        EditAction.call(this, editor, 'DELETE-FREEHAND', freehand.id);\r\n        this.createFreehand = new CreateFreehand(\r\n            editor,\r\n            freehand.id,\r\n            freehand.position,\r\n            freehand.size,\r\n            freehand.rotation,\r\n            freehand.locations,\r\n            freehand.getStyle());\r\n    }\r\n\r\n    DeleteFreehand.prototype = Object.create(EditAction.prototype);\r\n    DeleteFreehand.prototype.constructor = DeleteFreehand;\r\n\r\n    var proto = DeleteFreehand.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        this.createFreehand.undo();\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        this.createFreehand.redo();\r\n    };\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param freehand\r\n     * @param position\r\n     * @param size\r\n     * @param locations\r\n     * @constructor\r\n     */\r\n    export function SetFreehand(editor, freehand, position, size, locations, isAbsoluteCoords) {\r\n\r\n        EditAction.call(this, editor, 'SET-FREEHAND', freehand.id);\r\n\r\n        this.position = position;\r\n        this.size = size;\r\n        this.locations = isAbsoluteCoords ? locations : locations.slice(0);\r\n        this.isAbsoluteCoords = isAbsoluteCoords;\r\n\r\n        // No need to save old data\r\n    }\r\n\r\n    SetFreehand.prototype = Object.create(EditAction.prototype);\r\n    SetFreehand.prototype.constructor = SetFreehand;\r\n\r\n    var proto = SetFreehand.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        var freehand = this.editor.getMarkup(this.targetId);\r\n        if (!freehand) {\r\n            return;\r\n        }\r\n\r\n        freehand.set(this.position, this.size, this.locations, this.isAbsoluteCoords);\r\n    };\r\n\r\n    proto.undo = function() {\r\n        // No need for undo.\r\n    };\r\n\r\n    proto.merge = function(action) {\r\n\r\n        if (this.targetId === action.targetId &&\r\n            this.type === action.type) {\r\n\r\n            this.locations = action.isAbsoluteCoords ? action.locations : action.locations.slice(0);\r\n            this.position = action.position;\r\n            this.size = action.size;\r\n            this.isAbsoluteCoords = action.isAbsoluteCoords;\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * @returns {boolean}\r\n     */\r\n    proto.isIdentity = function() {\r\n\r\n        return false; // No need to optimize, always false.\r\n    };\r\n","'use strict';\r\n\r\nimport { EditModePen } from './EditModePen'\r\nimport { DeleteFreehand } from '../edit-actions/DeleteFreehand'\r\nimport { CreateFreehand } from '../edit-actions/CreateFreehand'\r\nimport { SetFreehand } from '../edit-actions/SetFreehand'\r\nimport * as MarkupTypes from '../MarkupTypes'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @constructor\r\n     */\r\n    export function EditModeFreehand(editor) {\r\n\r\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity'];\r\n        EditModePen.call(this, editor, MarkupTypes.MARKUP_TYPE_FREEHAND, styleAttributes);\r\n    }\r\n\r\n    EditModeFreehand.prototype = Object.create(EditModePen.prototype);\r\n    EditModeFreehand.prototype.constructor = EditModeFreehand;\r\n\r\n    var proto = EditModeFreehand.prototype;\r\n\r\n    proto.createPen = function(markupId, position, size, rotation, locations) {\r\n        return new CreateFreehand(this.editor,\r\n            markupId,\r\n            position,\r\n            size,\r\n            rotation,\r\n            locations,\r\n            this.style);\r\n    };\r\n\r\n    proto.deletePen = function(markup) {\r\n        return new DeleteFreehand(this.editor, markup);\r\n    };\r\n\r\n    proto.setPen = function(position, size, locations, isAbsoluteCoords) {\r\n        return new SetFreehand(this.editor,\r\n            this.selectedMarkup,\r\n            position,\r\n            size,\r\n            locations,\r\n            isAbsoluteCoords);\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { MarkupPen } from './MarkupPen'\r\nimport * as MarkupTypes from './MarkupTypes'\r\nimport { EditModeFreehand } from './edit-modes/EditModeFreehand'\r\n\r\n\r\n    /**\r\n     *\r\n     * @param id\r\n     * @param editor\r\n     * @constructor\r\n     */\r\n    export function MarkupFreehand(id, editor) {\r\n\r\n        MarkupPen.call(this, id, editor);\r\n        this.type = MarkupTypes.MARKUP_TYPE_FREEHAND;\r\n    }\r\n\r\n    MarkupFreehand.prototype = Object.create(MarkupPen.prototype);\r\n    MarkupFreehand.prototype.constructor = MarkupFreehand;\r\n\r\n    var proto = MarkupFreehand.prototype;\r\n\r\n    proto.getEditMode = function() {\r\n\r\n        return new EditModeFreehand(this.editor);\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\nimport { MarkupFreehand } from '../MarkupFreehand'\r\nimport { cloneStyle } from '../StyleUtils'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param id\r\n     * @param position\r\n     * @param size\r\n     * @param rotation\r\n     * @param locations\r\n     * @param style\r\n     * @constructor\r\n     */\r\n    export function CreateFreehand(editor, id, position, size, rotation, locations, style) {\r\n\r\n        EditAction.call(this, editor, 'CREATE-FREEHAND', id);\r\n\r\n        this.selectOnExecution = false;\r\n        this.position = position;\r\n        this.size = size;\r\n        this.rotation = rotation;\r\n        this.movements = locations.slice(0);\r\n        this.style = cloneStyle(style);\r\n    }\r\n\r\n    CreateFreehand.prototype = Object.create(EditAction.prototype);\r\n    CreateFreehand.prototype.constructor = CreateFreehand;\r\n\r\n    var proto = CreateFreehand.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        var editor = this.editor;\r\n        var freehand = new MarkupFreehand(this.targetId, editor);\r\n\r\n        editor.addMarkup(freehand);\r\n\r\n        freehand.set(this.position, this.size, this.movements, false);\r\n        freehand.setRotation(this.rotation);\r\n        freehand.setStyle(this.style);\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        var markup = this.editor.getMarkup(this.targetId);\r\n        markup && this.editor.removeMarkup(markup);\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\nimport { CreatePolyline } from './CreatePolyline'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param polyline\r\n     * @constructor\r\n     */\r\n    export function DeletePolyline(editor, polyline) {\r\n\r\n        EditAction.call(this, editor, 'DELETE-POLYLINE', polyline.id);\r\n        this.createPolyline = new CreatePolyline(\r\n            editor,\r\n            polyline.id,\r\n            polyline.position,\r\n            polyline.size,\r\n            polyline.rotation,\r\n            polyline.locations,\r\n            polyline.getStyle(),\r\n            polyline.closed);\r\n    }\r\n\r\n    DeletePolyline.prototype = Object.create(EditAction.prototype);\r\n    DeletePolyline.prototype.constructor = DeletePolyline;\r\n\r\n    var proto =  DeletePolyline.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        this.createPolyline.undo();\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        this.createPolyline.redo();\r\n    };\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param polyline\r\n     * @param position\r\n     * @param size\r\n     * @param locations\r\n     * @param closed\r\n     * @constructor\r\n     */\r\n    export function SetPolyline(editor, polyline, position, size, locations, closed) {\r\n\r\n        EditAction.call(this, editor, 'SET-POLYLINE', polyline.id);\r\n\r\n        this.position = position;\r\n        this.size = size;\r\n        this.locations = locations.concat();\r\n        this.closed = closed;\r\n\r\n        // No need to save old data\r\n    }\r\n\r\n    SetPolyline.prototype = Object.create(EditAction.prototype);\r\n    SetPolyline.prototype.constructor = SetPolyline;\r\n\r\n    var proto = SetPolyline.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        var polyline = this.editor.getMarkup(this.targetId);\r\n        if(!polyline) {\r\n            return;\r\n        }\r\n\r\n        polyline.set(this.position, this.size, this.locations, this.closed);\r\n    };\r\n\r\n    proto.undo = function() {\r\n        // No need for undo.\r\n    };\r\n\r\n    proto.merge = function(action) {\r\n\r\n        if (this.targetId === action.targetId &&\r\n            this.type === action.type) {\r\n\r\n            this.locations = action.locations.concat();\r\n            this.position = action.position;\r\n            this.size = action.size;\r\n            this.closed = action.closed;\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * @returns {boolean}\r\n     */\r\n    proto.isIdentity = function() {\r\n\r\n        return false; // No need to optimize, always false.\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { EditMode } from './EditMode'\r\nimport { DeletePolyline } from '../edit-actions/DeletePolyline'\r\nimport { CreatePolyline } from '../edit-actions/CreatePolyline'\r\nimport { SetPolyline } from '../edit-actions/SetPolyline'\r\nimport * as MarkupTypes from '../MarkupTypes'\r\nimport { areMarkupsPointsInClientRange } from '../MarkupsCoreUtils'\r\n\r\n    var SNAP_RANGE = 25;\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @constructor\r\n     */\r\n    export function EditModePolyline(editor) {\r\n\r\n        var styleAttributes = ['stroke-width', 'stroke-color','stroke-opacity', 'fill-color', 'fill-opacity'];\r\n        EditMode.call(this, editor, MarkupTypes.MARKUP_TYPE_POLYLINE, styleAttributes);\r\n\r\n        this.creationMethod = this.CREATION_METHOD_CLICKS;\r\n        this.movements = [];\r\n    }\r\n\r\n    EditModePolyline.prototype = Object.create(EditMode.prototype);\r\n    EditModePolyline.prototype.constructor = EditModePolyline;\r\n\r\n    var proto = EditModePolyline.prototype;\r\n\r\n    proto.deleteMarkup = function(markup, cantUndo) {\r\n\r\n        markup = markup || this.selectedMarkup;\r\n        if (markup && markup.type == this.type) {\r\n            var movements = this.movements;\r\n            if (this.creating && movements.length >= 2) {\r\n                movements.pop();\r\n                movements.pop();\r\n                var lastIndex = movements.length - 1;\r\n                if (lastIndex >= 0) {\r\n                    // duplicate last location\r\n                    var lastMove = movements[lastIndex];\r\n                    movements.push(lastMove);\r\n                    var locations = setPositionAndSize(movements, this);\r\n                    var setPolyline = new SetPolyline(\r\n                        this.editor,\r\n                        markup,\r\n                        this.position,\r\n                        this.size,\r\n                        locations);\r\n\r\n                    setPolyline.execute();\r\n                }\r\n            }\r\n            else {\r\n                var deletePolyline = new DeletePolyline(this.editor, markup);\r\n                deletePolyline.addToHistory = !cantUndo;\r\n                deletePolyline.execute();\r\n                this.creationEnd();\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * Handler to mouse move events, used to create markups.\r\n     * @param {MouseEvent} event Mouse event.\r\n     * @private\r\n     */\r\n    proto.onMouseMove = function(event) {\r\n\r\n        EditMode.prototype.onMouseMove.call(this, event);\r\n\r\n        var editor = this.editor;\r\n        var selectedMarkup = this.selectedMarkup;\r\n\r\n        if(!selectedMarkup || !this.creating) {\r\n            return;\r\n        }\r\n\r\n        this.dragging = true;\r\n\r\n        var movements = this.movements;\r\n        movements.splice(movements.length-1, 1);\r\n\r\n        var mousePosition = editor.getMousePosition();\r\n        mousePosition = editor.clientToMarkups(mousePosition.x, mousePosition.y);\r\n\r\n        // Close polyline if user clicks close to initial point.\r\n        if (movements.length >= 2 &&\r\n            areMarkupsPointsInClientRange(movements[0], mousePosition, SNAP_RANGE, this.editor)) {\r\n            mousePosition = movements[0]; // Snap!\r\n        }\r\n\r\n        movements.push(mousePosition);\r\n\r\n        var locations = setPositionAndSize(movements, this);\r\n        var setPolyline = new SetPolyline(\r\n            editor,\r\n            selectedMarkup,\r\n            this.position,\r\n            this.size,\r\n            locations);\r\n\r\n        setPolyline.execute();\r\n    };\r\n\r\n    /**\r\n     * Handler to mouse down events, used to start markups creation.\r\n     * @private\r\n     */\r\n    proto.onMouseDown = function(event) {\r\n\r\n        EditMode.prototype.onMouseDown.call(this);\r\n\r\n        // User selected an already created markup.\r\n        if (this.selectedMarkup && !this.creating) {\r\n            return;\r\n        }\r\n\r\n        if (this.creating) {\r\n            return;\r\n        }\r\n\r\n        // Creation process.\r\n        var editor = this.editor;\r\n        var mousePosition = editor.getMousePosition();\r\n\r\n        mousePosition = editor.clientToMarkups(mousePosition.x, mousePosition.y);\r\n\r\n        var size = this.size = editor.sizeFromClientToMarkups(1, 1);\r\n        this.movements = [mousePosition, mousePosition];\r\n\r\n        editor.beginActionGroup();\r\n\r\n        var markupId = editor.getId();\r\n        var create = new CreatePolyline(\r\n            editor,\r\n            markupId,\r\n            mousePosition,\r\n            size,\r\n            0,\r\n            [{x:0, y:0}],\r\n            this.style);\r\n\r\n        create.execute();\r\n\r\n        this.selectedMarkup = editor.getMarkup(markupId);\r\n        this.creationBegin();\r\n    };\r\n\r\n    /**\r\n     * Handler to mouse down events, used to start markups creation.\r\n     * @private\r\n     */\r\n    proto.onMouseUp = function() {\r\n\r\n        EditMode.prototype.onMouseUp.call(this);\r\n\r\n        if(!this.creating) {\r\n            return;\r\n        }\r\n\r\n        this.dragging = false;\r\n\r\n        // Creation process.\r\n        var editor = this.editor;\r\n        var mousePosition = editor.getMousePosition();\r\n        var movements = this.movements;\r\n        var closed = false;\r\n\r\n        mousePosition = editor.clientToMarkups(mousePosition.x, mousePosition.y);\r\n\r\n        if (movements.length > 1 &&\r\n            areMarkupsPointsInClientRange(movements[movements.length-2], mousePosition, SNAP_RANGE, this.editor)) {\r\n            return;\r\n        }\r\n\r\n        // Close polyline if user clicks close to initial point.\r\n        if (movements.length > 2 &&\r\n            areMarkupsPointsInClientRange(movements[0], mousePosition, SNAP_RANGE, this.editor)) {\r\n            mousePosition = movements[0]; // Snap!\r\n            closed = true;\r\n        }\r\n\r\n        movements.splice(movements.length-1, 1);\r\n\r\n        if (!closed) {\r\n            movements.push(mousePosition);\r\n            movements.push(mousePosition);\r\n        }\r\n\r\n        var polyline = this.selectedMarkup;\r\n        var locations = setPositionAndSize(movements, polyline);\r\n        var setPolyline = new SetPolyline(\r\n            editor,\r\n            polyline,\r\n            polyline.position,\r\n            polyline.size,\r\n            locations,\r\n            closed);\r\n\r\n        setPolyline.execute();\r\n\r\n        if (closed) {\r\n            this.creationEnd();\r\n        }\r\n    };\r\n\r\n    proto.destroy = function() {\r\n        this.onMouseDoubleClick();\r\n        EditMode.prototype.creationEnd.call(this);\r\n        EditMode.prototype.destroy.call(this);\r\n    };\r\n\r\n    proto.creationEnd = function() {\r\n\r\n        // To pass isMinSizeValid,\r\n        // probably that test should be done with the markup size (not the recorded by the edit mode).\r\n        if (this.selectedMarkup) {\r\n            this.size.x = this.selectedMarkup.size.x;\r\n            this.size.y = this.selectedMarkup.size.y;\r\n        }\r\n\r\n        EditMode.prototype.creationEnd.call(this);\r\n\r\n        this.closed = false;\r\n        this.movements = [];\r\n        this.dragging = false;\r\n        this.creating = false;\r\n    };\r\n\r\n    proto.creationCancel = function() {\r\n\r\n        EditMode.prototype.creationCancel.call(this);\r\n\r\n        this.closed = false;\r\n        this.movements = [];\r\n        this.dragging = false;\r\n        this.creating = false;\r\n    };\r\n\r\n\r\n    proto.onMouseDoubleClick = function(event) {\r\n\r\n        if(!this.creating) {\r\n           return;\r\n        }\r\n\r\n        var movements = this.movements;\r\n        movements.splice(Math.max(0, movements.length-1));\r\n\r\n        if (movements.length < 2 ) {\r\n\r\n            this.creationCancel();\r\n        } else {\r\n\r\n            var polyline = this.selectedMarkup;\r\n            var locations = setPositionAndSize(movements, polyline);\r\n            var setPolyline = new SetPolyline(\r\n                this.editor,\r\n                polyline,\r\n                polyline.position,\r\n                polyline.size,\r\n                locations,\r\n                this.closed);\r\n\r\n            setPolyline.execute();\r\n            this.creationEnd();\r\n        }\r\n    };\r\n\r\n    function setPositionAndSize(locations, markup) {\r\n\r\n        // determine the position of the top-left and bottom-right points\r\n        var minFn = function(collection, key){\r\n            var targets = collection.map(function(item){\r\n                return item[key];\r\n            });\r\n            return Math.min.apply(null, targets);\r\n        };\r\n\r\n        var maxFn = function(collection, key){\r\n            var targets = collection.map(function(item){\r\n                return item[key];\r\n            });\r\n            return Math.max.apply(null, targets);\r\n        };\r\n\r\n        var l = minFn(locations, 'x');\r\n        var t = minFn(locations, 'y');\r\n        var r = maxFn(locations, 'x');\r\n        var b = maxFn(locations, 'y');\r\n        var w = r - l;\r\n        var h = b - t;\r\n\r\n        markup.size = {x: w, y: h};\r\n        markup.position = {x: l + w * 0.5, y: t + h * 0.5};\r\n\r\n        // Adjust points to relate from the shape's center\r\n        var position = markup.position;\r\n        return locations.map(function(point){\r\n            return {\r\n                x: point.x - position.x,\r\n                y: point.y - position.y\r\n            };\r\n        });\r\n    }\r\n\r\n","'use strict';\r\n\r\nimport { Markup } from './Markup'\r\nimport * as MarkupTypes from './MarkupTypes'\r\nimport { createMarkupPathSvg, composeRGBAString,\r\n    setAttributeToMarkupSvg, updateMarkupPathSvgHitarea, addMarkupMetadata } from './MarkupsCoreUtils'\r\nimport { cloneStyle } from './StyleUtils'\r\nimport { EditModePolyline } from './edit-modes/EditModePolyline'\r\n\r\n    /**\r\n     *\r\n     * @param id\r\n     * @param editor\r\n     * @constructor\r\n     */\r\n    export function MarkupPolyline(id, editor) {\r\n\r\n        var styleAttributes = ['stroke-width', 'stroke-color','stroke-opacity', 'fill-color', 'fill-opacity'];\r\n        Markup.call(this, id, editor, styleAttributes);\r\n\r\n        // bind to this to pass this.globalManager\r\n        this.addMarkupMetadata = addMarkupMetadata.bind(this);\r\n\r\n        this.type = MarkupTypes.MARKUP_TYPE_POLYLINE;\r\n        this.shape = createMarkupPathSvg('path');\r\n\r\n        this.bindDomEvents();\r\n    }\r\n\r\n    MarkupPolyline.prototype = Object.create(Markup.prototype);\r\n    MarkupPolyline.prototype.constructor = MarkupPolyline;\r\n\r\n    var proto = MarkupPolyline.prototype;\r\n\r\n    proto.getEditMode = function() {\r\n\r\n        return new EditModePolyline(this.editor);\r\n    };\r\n\r\n    /**\r\n     * Sets top-left and bottom-right values in client space coordinates (2d).\r\n     *\r\n     * @param position\r\n     * @param size\r\n     * @param locations\r\n     * @param closed\r\n     */\r\n    proto.set = function(position, size, locations, closed) {\r\n\r\n        this.rotation = 0; // Reset angle //\r\n        this.locations = locations.concat();\r\n\r\n        this.size.x = (size.x === 0) ? 1 : size.x;\r\n        this.size.y = (size.y === 0) ? 1 : size.y;\r\n\r\n        this.closed = closed;\r\n\r\n        this.setSize(position, size.x, size.y);\r\n        this.updateStyle();\r\n    };\r\n\r\n\r\n    /**\r\n     * Applies data values into DOM element style/attribute(s)\r\n     *\r\n     */\r\n    proto.updateStyle = function() {\r\n\r\n        var style = this.style;\r\n        var shape = this.shape;\r\n\r\n        var strokeWidth = this.style['stroke-width'];\r\n        var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\r\n        var fillColor = this.closed ? composeRGBAString(style['fill-color'], style['fill-opacity']) : 'none';\r\n        var transform = this.getTransform();\r\n\r\n        setAttributeToMarkupSvg(shape, 'd',  this.getPath().join(' '));\r\n        setAttributeToMarkupSvg(shape, 'stroke-width', strokeWidth);\r\n        setAttributeToMarkupSvg(shape, 'stroke', strokeColor);\r\n        setAttributeToMarkupSvg(shape, 'fill', fillColor);\r\n        setAttributeToMarkupSvg(shape, 'transform', transform);\r\n        updateMarkupPathSvgHitarea(shape, this.editor);\r\n    };\r\n\r\n    /**\r\n     * Changes the position and size of the markup.\r\n     * This gets called by the Autodesk.Viewing.Extensions.Markups.Core.SetSize edit action\r\n     * @param {{x: Number, y: Number}} position\r\n     * @param {Number} width\r\n     * @param {Number} height\r\n     */\r\n    proto.setSize = function (position, width, height) {\r\n\r\n        width = (width === 0 ? 1 : width);\r\n        height = (height === 0 ? 1 : height);\r\n\r\n        var locations = this.locations;\r\n        var locationsCount = locations.length;\r\n\r\n        var scaleX = width / this.size.x;\r\n        var scaleY = height / this.size.y;\r\n\r\n        for(var i = 0; i < locationsCount; ++i) {\r\n\r\n            var point = locations[i];\r\n\r\n            point.x *= scaleX;\r\n            point.y *= scaleY;\r\n        }\r\n\r\n        this.position.x = position.x;\r\n        this.position.y = position.y;\r\n\r\n        this.size.x = width;\r\n        this.size.y = height;\r\n\r\n        this.updateStyle();\r\n    };\r\n\r\n    proto.setMetadata = function() {\r\n\r\n        var metadata = cloneStyle(this.style);\r\n\r\n        metadata.type = this.type;\r\n        metadata.position = [this.position.x, this.position.y].join(\" \");\r\n        metadata.size = [this.size.x, this.size.y].join(\" \");\r\n        metadata.rotation = String(this.rotation);\r\n        metadata.locations = this.locations.map(function(point){\r\n            return [point.x, point.y].join(\" \");\r\n        }).join(\" \");\r\n\r\n        return this.addMarkupMetadata(this.shape, metadata);\r\n    };\r\n\r\n    proto.getPath = function() {\r\n\r\n        var path = [];\r\n        var locations = this.locations;\r\n        var locationsCount = locations.length;\r\n\r\n        if (locationsCount === 0) {\r\n            return ' ';\r\n        }\r\n\r\n        path.push('M');\r\n        path.push(locations[0].x);\r\n        path.push(locations[0].y);\r\n\r\n        for (var i = 1; i < locationsCount; ++i) {\r\n\r\n            var locationA = locations[i - 1];\r\n            var locationB = locations[i];\r\n\r\n            path.push('l');\r\n            path.push(locationB.x - locationA.x);\r\n            path.push(locationB.y - locationA.y);\r\n        }\r\n\r\n        this.closed && path.push('z');\r\n        return path;\r\n    };\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\nimport { MarkupPolyline } from '../MarkupPolyLine'\r\nimport { cloneStyle } from '../StyleUtils'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param id\r\n     * @param position\r\n     * @param size\r\n     * @param rotation\r\n     * @param locations\r\n     * @param closed\r\n     * @param style\r\n     * @constructor\r\n     */\r\n    export function CreatePolyline(editor, id, position, size, rotation, locations, style, closed) {\r\n\r\n        EditAction.call(this, editor, 'CREATE-POLYLINE', id);\r\n\r\n        this.selectOnExecution = false;\r\n        this.position = position;\r\n        this.size = size;\r\n        this.rotation = rotation;\r\n        this.movements = locations.concat();\r\n        this.closed = closed;\r\n        this.style = cloneStyle(style);\r\n    }\r\n\r\n    CreatePolyline.prototype = Object.create(EditAction.prototype);\r\n    CreatePolyline.prototype.constructor = CreatePolyline;\r\n\r\n    var proto = CreatePolyline.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        var editor = this.editor;\r\n        var polyline = new MarkupPolyline(this.targetId, editor);\r\n\r\n        editor.addMarkup(polyline);\r\n\r\n        polyline.set(this.position, this.size, this.movements, this.closed);\r\n        polyline.setRotation(this.rotation);\r\n        polyline.setStyle(this.style);\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        var markup = this.editor.getMarkup(this.targetId);\r\n        markup && this.editor.removeMarkup(markup);\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\nimport { CreatePolycloud } from './CreatePolycloud'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param polycloud\r\n     * @constructor\r\n     */\r\n    export function DeletePolycloud(editor, polycloud) {\r\n\r\n        EditAction.call(this, editor, 'DELETE-POLYCLOUD', polycloud.id);\r\n        this.createPolycloud = new CreatePolycloud(\r\n            editor,\r\n            polycloud.id,\r\n            polycloud.position,\r\n            polycloud.size,\r\n            polycloud.rotation,\r\n            polycloud.locations,\r\n            polycloud.getStyle(),\r\n            polycloud.closed);\r\n    }\r\n\r\n    DeletePolycloud.prototype = Object.create(EditAction.prototype);\r\n    DeletePolycloud.prototype.constructor = DeletePolycloud;\r\n\r\n    var proto =  DeletePolycloud.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        this.createPolycloud.undo();\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        this.createPolycloud.redo();\r\n    };\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param polycloud\r\n     * @param position\r\n     * @param size\r\n     * @param locations\r\n     * @param closed\r\n     * @constructor\r\n     */\r\n    export function SetPolycloud(editor, polycloud, position, size, locations, closed) {\r\n\r\n        EditAction.call(this, editor, 'SET-POLYCLOUD', polycloud.id);\r\n\r\n        this.position = position;\r\n        this.size = size;\r\n        this.locations = locations.concat();\r\n        this.closed = closed;\r\n\r\n        // No need to save old data\r\n    }\r\n\r\n    SetPolycloud.prototype = Object.create(EditAction.prototype);\r\n    SetPolycloud.prototype.constructor = SetPolycloud;\r\n\r\n    var proto = SetPolycloud.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        var polycloud = this.editor.getMarkup(this.targetId);\r\n        if(!polycloud) {\r\n            return;\r\n        }\r\n\r\n        polycloud.set(this.position, this.size, this.locations, this.closed);\r\n    };\r\n\r\n    proto.undo = function() {\r\n        // No need for undo.\r\n    };\r\n\r\n    proto.merge = function(action) {\r\n\r\n        if (this.targetId === action.targetId &&\r\n            this.type === action.type) {\r\n\r\n            this.locations = action.locations.concat();\r\n            this.position = action.position;\r\n            this.size = action.size;\r\n            this.closed = action.closed;\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * @returns {boolean}\r\n     */\r\n    proto.isIdentity = function() {\r\n\r\n        return false; // No need to optimize, always false.\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { EditMode } from './EditMode'\r\nimport { DeletePolycloud } from '../edit-actions/DeletePolycloud'\r\nimport { CreatePolycloud } from '../edit-actions/CreatePolycloud'\r\nimport { SetPolycloud } from '../edit-actions/SetPolycloud'\r\nimport * as MarkupTypes from '../MarkupTypes'\r\nimport { areMarkupsPointsInClientRange } from '../MarkupsCoreUtils'\r\n\r\n    var SNAP_RANGE = 25;\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @constructor\r\n     */\r\n    export function EditModePolycloud(editor) {\r\n\r\n        var styleAttributes = ['stroke-width', 'stroke-color','stroke-opacity', 'fill-color', 'fill-opacity'];\r\n        EditMode.call(this, editor, MarkupTypes.MARKUP_TYPE_POLYCLOUD, styleAttributes);\r\n\r\n        this.creationMethod = this.CREATION_METHOD_CLICKS;\r\n        this.movements = [];\r\n    }\r\n\r\n    EditModePolycloud.prototype = Object.create(EditMode.prototype);\r\n    EditModePolycloud.prototype.constructor = EditModePolycloud;\r\n\r\n    var proto = EditModePolycloud.prototype;\r\n\r\n    proto.deleteMarkup = function(markup, cantUndo) {\r\n\r\n        markup = markup || this.selectedMarkup;\r\n        if (markup && markup.type == this.type) {\r\n            var movements = this.movements;\r\n            if (this.creating && movements.length >= 2) {\r\n                movements.pop();\r\n                movements.pop();\r\n                var lastIndex = movements.length - 1;\r\n                if (lastIndex >= 0) {\r\n                    // duplicate last location\r\n                    var lastMove = movements[lastIndex];\r\n                    movements.push(lastMove);\r\n                    var locations = setPositionAndSize(movements, this);\r\n                    var setPolycloud = new SetPolycloud(\r\n                        this.editor,\r\n                        markup,\r\n                        this.position,\r\n                        this.size,\r\n                        locations);\r\n\r\n                    setPolycloud.execute();\r\n                }\r\n            }\r\n            else {\r\n                var deletePolycloud = new DeletePolycloud(this.editor, markup);\r\n                deletePolycloud.addToHistory = !cantUndo;\r\n                deletePolycloud.execute();\r\n                this.creationEnd();\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * Handler to mouse move events, used to create markups.\r\n     * @param {MouseEvent} event Mouse event.\r\n     * @private\r\n     */\r\n    proto.onMouseMove = function(event) {\r\n\r\n        EditMode.prototype.onMouseMove.call(this, event);\r\n\r\n        var editor = this.editor;\r\n        var selectedMarkup = this.selectedMarkup;\r\n\r\n        if(!selectedMarkup || !this.creating) {\r\n            return;\r\n        }\r\n\r\n        this.dragging = true;\r\n\r\n        var movements = this.movements;\r\n        movements.splice(movements.length-1, 1);\r\n\r\n        var mousePosition = editor.getMousePosition();\r\n        mousePosition = editor.clientToMarkups(mousePosition.x, mousePosition.y);\r\n\r\n        // Close polycloud if user clicks close to initial point.\r\n        if (movements.length >= 2 &&\r\n            areMarkupsPointsInClientRange(movements[0], mousePosition, SNAP_RANGE, this.editor)) {\r\n            mousePosition = movements[0]; // Snap!\r\n        }\r\n\r\n        movements.push(mousePosition);\r\n\r\n        var locations = setPositionAndSize(movements, this);\r\n        var setPolycloud = new SetPolycloud(\r\n            editor,\r\n            selectedMarkup,\r\n            this.position,\r\n            this.size,\r\n            locations);\r\n\r\n        setPolycloud.execute();\r\n    };\r\n\r\n    /**\r\n     * Handler to mouse down events, used to start markups creation.\r\n     * @private\r\n     */\r\n    proto.onMouseDown = function() {\r\n\r\n        EditMode.prototype.onMouseDown.call(this);\r\n\r\n        // User selected an already created markup.\r\n        if (this.selectedMarkup && !this.creating) {\r\n            return;\r\n        }\r\n\r\n        if (this.creating) {\r\n            return;\r\n        }\r\n\r\n        // Creation process.\r\n        var editor = this.editor;\r\n        var mousePosition = editor.getMousePosition();\r\n\r\n        mousePosition = editor.clientToMarkups(mousePosition.x, mousePosition.y);\r\n\r\n        var size = this.size = editor.sizeFromClientToMarkups(1, 1);\r\n        this.movements = [mousePosition, mousePosition];\r\n\r\n        editor.beginActionGroup();\r\n\r\n        var markupId = editor.getId();\r\n        var create = new CreatePolycloud(\r\n            editor,\r\n            markupId,\r\n            mousePosition,\r\n            size,\r\n            0,\r\n            [{x: 0, y: 0 }],\r\n            this.style);\r\n\r\n        create.execute();\r\n\r\n        this.selectedMarkup = editor.getMarkup(markupId);\r\n        this.creationBegin();\r\n    };\r\n\r\n    /**\r\n     * Handler to mouse down events, used to start markups creation.\r\n     * @private\r\n     */\r\n    proto.onMouseUp = function(event) {\r\n\r\n        EditMode.prototype.onMouseUp.call(this);\r\n\r\n        if(!this.creating) {\r\n            return;\r\n        }\r\n\r\n        this.dragging = false;\r\n\r\n        // Creation process.\r\n        var editor = this.editor;\r\n        var mousePosition = editor.getMousePosition();\r\n        var movements = this.movements;\r\n        var closed = false;\r\n\r\n        mousePosition = editor.clientToMarkups(mousePosition.x, mousePosition.y);\r\n\r\n        if (movements.length > 1 &&\r\n            areMarkupsPointsInClientRange(movements[movements.length-2], mousePosition, SNAP_RANGE, this.editor)) {\r\n            return;\r\n        }\r\n\r\n        // Close polycloud if user clicks close to initial point.\r\n        if (movements.length > 2 &&\r\n            areMarkupsPointsInClientRange(movements[0], mousePosition, SNAP_RANGE, this.editor)) {\r\n            mousePosition = movements[0]; // Snap!\r\n            closed = true;\r\n        }\r\n\r\n        movements.splice(movements.length-1, 1);\r\n\r\n        if (!closed) {\r\n            movements.push(mousePosition);\r\n            movements.push(mousePosition);\r\n        }\r\n\r\n        var polycloud = this.selectedMarkup;\r\n        var locations = setPositionAndSize(movements, polycloud);\r\n        var setPolycloud = new SetPolycloud(\r\n            editor,\r\n            polycloud,\r\n            polycloud.position,\r\n            polycloud.size,\r\n            locations,\r\n            closed);\r\n\r\n        setPolycloud.execute();\r\n\r\n        if (closed) {\r\n            this.creationEnd();\r\n        }\r\n    };\r\n\r\n    proto.onMouseDoubleClick = function(event) {\r\n\r\n        if(!this.creating) {\r\n            return;\r\n        }\r\n\r\n        var movements = this.movements;\r\n        movements.splice(Math.max(0, movements.length-1));\r\n\r\n        if (movements.length < 2 ) {\r\n\r\n            this.creationCancel();\r\n        } else {\r\n\r\n            var polycloud = this.selectedMarkup;\r\n            var locations = setPositionAndSize(movements, polycloud);\r\n            var setPolycloud = new SetPolycloud(\r\n                this.editor,\r\n                polycloud,\r\n                polycloud.position,\r\n                polycloud.size,\r\n                locations,\r\n                true);\r\n\r\n            setPolycloud.execute();\r\n            this.creationEnd();\r\n        }\r\n    };\r\n\r\n    proto.destroy = function() {\r\n        this.onMouseDoubleClick();\r\n        EditMode.prototype.creationEnd.call(this);\r\n        EditMode.prototype.destroy.call(this);\r\n    };\r\n\r\n    proto.creationEnd = function() {\r\n\r\n        // To pass isMinSizeValid,\r\n        // probably that test should be done with the markup size (not the recorded by the edit mode).\r\n        if (this.selectedMarkup) {\r\n            this.size.x = this.selectedMarkup.size.x;\r\n            this.size.y = this.selectedMarkup.size.y;\r\n        }\r\n        \r\n        EditMode.prototype.creationEnd.call(this);\r\n\r\n        this.closed = false;\r\n        this.movements = [];\r\n        this.dragging = false;\r\n        this.creating = false;\r\n    };\r\n\r\n    proto.creationCancel = function() {\r\n\r\n        EditMode.prototype.creationCancel.call(this);\r\n\r\n        this.closed = false;\r\n        this.movements = [];\r\n        this.dragging = false;\r\n        this.creating = false;\r\n    };\r\n\r\n    function setPositionAndSize(locations, markup) {\r\n\r\n        // determine the position of the top-left and bottom-right points\r\n        var minFn = function(collection, key){\r\n            var targets = collection.map(function(item){\r\n                return item[key];\r\n            });\r\n            return Math.min.apply(null, targets);\r\n        };\r\n\r\n        var maxFn = function(collection, key){\r\n            var targets = collection.map(function(item){\r\n                return item[key];\r\n            });\r\n            return Math.max.apply(null, targets);\r\n        };\r\n\r\n        var strokeWidth = markup.style['stroke-width'];\r\n        var radius = strokeWidth * 2 + strokeWidth * 0.5;\r\n\r\n        var l = minFn(locations, 'x') - radius;\r\n        var t = minFn(locations, 'y') - radius;\r\n        var r = maxFn(locations, 'x') + radius;\r\n        var b = maxFn(locations, 'y') + radius;\r\n        var w = r - l;\r\n        var h = b - t;\r\n\r\n        markup.size = {x: w, y: h};\r\n        markup.position = {x: l + w * 0.5, y: t + h * 0.5};\r\n\r\n        // Adjust points to relate from the shape's center\r\n        var position = markup.position;\r\n        return locations.map(function(point){\r\n            return {\r\n                x: point.x - position.x,\r\n                y: point.y - position.y\r\n            };\r\n        });\r\n    }\r\n","'use strict';\r\n\r\nimport { Markup } from './Markup'\r\nimport * as MarkupTypes from './MarkupTypes'\r\nimport { createMarkupPathSvg, composeRGBAString, setAttributeToMarkupSvg,\r\n    updateMarkupPathSvgHitarea, addMarkupMetadata } from './MarkupsCoreUtils'\r\nimport { cloneStyle } from './StyleUtils'\r\nimport { EditModePolycloud } from './edit-modes/EditModePolycloud'\r\n\r\n    /**\r\n     *\r\n     * @param id\r\n     * @param editor\r\n     * @constructor\r\n     */\r\n    export function MarkupPolycloud(id, editor) {\r\n\r\n        var styleAttributes = ['stroke-width', 'stroke-color','stroke-opacity', 'fill-color', 'fill-opacity'];\r\n        Markup.call(this, id, editor, styleAttributes);\r\n\r\n        // bind to this to pass this.globalManager\r\n        this.addMarkupMetadata = addMarkupMetadata.bind(this);\r\n\r\n        this.type = MarkupTypes.MARKUP_TYPE_POLYCLOUD;\r\n        this.locations = [];\r\n        this.shape = createMarkupPathSvg();\r\n\r\n        this.bindDomEvents();\r\n    }\r\n\r\n    MarkupPolycloud.prototype = Object.create(Markup.prototype);\r\n    MarkupPolycloud.prototype.constructor = MarkupPolycloud;\r\n\r\n    var proto = MarkupPolycloud.prototype;\r\n\r\n    proto.getEditMode = function() {\r\n\r\n        return new EditModePolycloud(this.editor);\r\n    };\r\n\r\n    /**\r\n     *\r\n     * Sets top-left and bottom-right values in client space coordinates (2d).\r\n     * @param position\r\n     * @param size\r\n     * @param locations\r\n     * @param closed\r\n     */\r\n    proto.set = function(position, size, locations, closed) {\r\n\r\n        this.rotation = 0; // Reset angle //\r\n        this.locations = locations.concat();\r\n\r\n        this.size.x = (size.x === 0) ? 1 : size.x;\r\n        this.size.y = (size.y === 0) ? 1 : size.y;\r\n\r\n        this.closed = closed;\r\n\r\n        this.setSize(position, size.x, size.y);\r\n        this.updateStyle();\r\n    };\r\n\r\n    /**\r\n     * Applies data values into DOM element style/attribute(s)\r\n     *\r\n     */\r\n    proto.updateStyle = function() {\r\n\r\n        var style = this.style;\r\n        var shape = this.shape;\r\n        var path = this.getPath().join(' ');\r\n\r\n        var strokeWidth = this.style['stroke-width'];\r\n        var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\r\n        var fillColor = this.closed ? composeRGBAString(style['fill-color'], style['fill-opacity']) : 'none';\r\n        var transform = this.getTransform();\r\n\r\n        setAttributeToMarkupSvg(shape, 'd', path);\r\n        setAttributeToMarkupSvg(shape, 'stroke-width', strokeWidth);\r\n        setAttributeToMarkupSvg(shape, 'stroke', strokeColor);\r\n        setAttributeToMarkupSvg(shape, 'fill', fillColor);\r\n        setAttributeToMarkupSvg(shape, 'transform', transform);\r\n        updateMarkupPathSvgHitarea(shape, this.editor);\r\n    };\r\n\r\n    /**\r\n     * Changes the position and size of the markup.\r\n     * This gets called by the Autodesk.Viewing.Extensions.Markups.Core.SetSize edit action\r\n     * @param {{x: Number, y: Number}} position\r\n     * @param {Number} width\r\n     * @param {Number} height\r\n     */\r\n    proto.setSize = function (position, width, height) {\r\n\r\n        width = (width === 0 ? 1 : width);\r\n        height = (height === 0 ? 1 : height);\r\n\r\n        var locations = this.locations;\r\n        var locationsCount = locations.length;\r\n\r\n        var scaleX = width / this.size.x;\r\n        var scaleY = height / this.size.y;\r\n\r\n        for(var i = 0; i < locationsCount; ++i) {\r\n\r\n            var point = locations[i];\r\n\r\n            point.x *= scaleX;\r\n            point.y *= scaleY;\r\n        }\r\n\r\n        this.position.x = position.x;\r\n        this.position.y = position.y;\r\n\r\n        this.size.x = width;\r\n        this.size.y = height;\r\n\r\n        this.updateStyle();\r\n    };\r\n\r\n    proto.setMetadata = function() {\r\n\r\n        var metadata = cloneStyle(this.style);\r\n\r\n        metadata.type = this.type;\r\n        metadata.position = [this.position.x, this.position.y].join(\" \");\r\n        metadata.size = [this.size.x, this.size.y].join(\" \");\r\n        metadata.rotation = String(this.rotation);\r\n        metadata.locations = this.locations.map(function(point){\r\n            return [point.x, point.y].join(\" \");\r\n        }).join(\" \");\r\n\r\n        return this.addMarkupMetadata(this.shape, metadata);\r\n    };\r\n\r\n    proto.getPath = function() {\r\n\r\n        function getOrientation(locations) {\r\n\r\n            switch (locations.length) {\r\n\r\n                case 0:\r\n                case 1:\r\n                    return 1;\r\n                case 2:\r\n\r\n                    var fstPoint = locations[0];\r\n                    var sndPoint = locations[1];\r\n\r\n                    return fstPoint.y > sndPoint.y ? 1 : -1;\r\n                default:\r\n\r\n                    var pointA = locations[0];\r\n                    var pointB = locations[1];\r\n                    var pointC = locations[2];\r\n\r\n                    var orientation =\r\n                        (pointB.x - pointA.x) * (pointB.y + pointA.y) +\r\n                        (pointC.x - pointB.x) * (pointC.y + pointB.y);\r\n\r\n                    return orientation < 0 ? 1 : -1;\r\n            }\r\n        }\r\n\r\n        function getSides(locations, closed) {\r\n\r\n            var locationsCount = locations.length;\r\n\r\n            var sides = [];\r\n            var sidesCount = locationsCount - (closed ? 0 : 1);\r\n\r\n            for(var i = 0; i < sidesCount; ++i) {\r\n\r\n                var locationA = locations[i];\r\n                var locationB = locations[(i+1)%locationsCount];\r\n\r\n                var dx = locationB.x - locationA.x;\r\n                var dy = locationB.y - locationA.y;\r\n\r\n                var length = Math.sqrt(dx * dx + dy * dy);\r\n\r\n                sides.push({\r\n                    index: i,\r\n                    pointA: new THREE.Vector3(locationA.x, locationA.y, 0),\r\n                    pointB: new THREE.Vector3(locationB.x, locationB.y, 0),\r\n                    vecAB:  new THREE.Vector3(dx / length, dy / length, 0),\r\n                    vecBA:  new THREE.Vector3(-dx / length, -dy / length, 0),\r\n                    length: length\r\n                });\r\n            }\r\n\r\n            return sides;\r\n        }\r\n\r\n        function updateCorners(side, cornerA, cornerB, orientation) {\r\n            var rA = cornerA.radius;\r\n            var rB = cornerB.radius;\r\n            var D = side.length;\r\n\r\n            if (rA > 0 && rB > 0 && rA + rB > D && Math.abs(rA - rB) < D) {\r\n                // Corner arcs overlap, so correct them by finding the circle-circle intersection\r\n                var a = side.pointA.x;\r\n                var b = side.pointA.y;\r\n                var c = side.pointB.x;\r\n                var d = side.pointB.y;\r\n\r\n                var delta = 0.25 * Math.sqrt((D + rA + rB) * (D + rA - rB) * (D - rA + rB) * (-D + rA + rB));\r\n                var xS = (a + c) / 2 + (c - a) * (rA*rA - rB*rB) / (2*D*D);\r\n                var xT = 2*(b - d) / (D*D) * delta;\r\n                var yS = (b + d) / 2 + (d - b) * (rA*rA - rB*rB) / (2*D*D);\r\n                var yT = 2*(a - c) / (D*D) * delta;\r\n                var x1 = xS + xT;\r\n                var x2 = xS - xT;\r\n                var y1 = yS - yT;\r\n                var y2 = yS + yT;\r\n                var testPointOnCircle = Math.abs((x1 - a) * (x1 - a) + (y1 - b) * (y1 - b) - rA * rA);\r\n                if (testPointOnCircle > 0.0000001) {\r\n                    var tmp = y1;\r\n                    y1 = y2;\r\n                    y2 = tmp;\r\n                }\r\n\r\n                var intersec = new THREE.Vector3(x1, y1, 0);\r\n                var intersecSide = Math.sign(intersec.clone().sub(side.pointA).cross(side.vecAB).z);\r\n                if (intersecSide !== orientation) {\r\n                    intersec.set(x2, y2, 0);\r\n                }\r\n\r\n                cornerA.pointB = intersec.clone();\r\n                cornerB.pointA = intersec.clone();\r\n\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        }\r\n\r\n        function updateSides(sides, corners, radius, orientation) {\r\n\r\n            var diameter = radius * 2;\r\n            var sidesCount = sides.length;\r\n\r\n            for(var i = 0; i < sidesCount; ++i) {\r\n\r\n                var side = sides[i];\r\n                var cornerA = corners[i];\r\n                var cornerB = corners[(i+1)%sidesCount];\r\n\r\n                side.bodyA = side.vecAB.clone().multiplyScalar(cornerA.radius).add(side.pointA);\r\n                side.bodyB = side.vecBA.clone().multiplyScalar(cornerB.radius).add(side.pointB);\r\n\r\n                if (updateCorners(side, cornerA, cornerB, orientation)) {\r\n                    side.body = 0;\r\n                    side.bodyDiameter = side.bodyCount = 0;\r\n                } else {\r\n                    side.body = side.bodyB.clone().sub(side.bodyA).length();\r\n                    side.bodyCount = Math.round(side.body / diameter);\r\n                    if (side.bodyCount === 0 && side.body > 0.5*radius) {\r\n                        side.bodyCount = 1;\r\n                    }\r\n                    side.bodyDiameter = diameter + (side.body - diameter * side.bodyCount) / side.bodyCount;\r\n                }\r\n\r\n                side.bodyRadius = side.bodyDiameter * 0.5;\r\n            }\r\n        }\r\n\r\n        function getCorners(sides, radius, closed) {\r\n\r\n            var corners = [];\r\n            var sidesCount = sides.length;\r\n\r\n            for(var i = 0; i < sidesCount; ++i) {\r\n\r\n                var sideA = sides[i !== 0 ? i-1 : sidesCount-1];\r\n                var sideB = sides[i];\r\n                var large = sideA.vecBA.clone().cross(sideB.vecAB).z < 0;\r\n\r\n                var sidesTooShort = sideA.length < radius || sideB.length < radius;\r\n                if (sidesTooShort || (i === 0 && !closed)) {\r\n\r\n                    corners.push({\r\n                        pointA: sideB.pointA.clone(),\r\n                        pointB: sideB.pointA.clone(),\r\n                        radius: 0,\r\n                        large: false\r\n                    });\r\n                } else {\r\n\r\n                    corners.push({\r\n                        pointA: sideB.pointA.clone().add(sideA.vecBA.clone().multiplyScalar(radius)),\r\n                        pointB: sideB.pointA.clone().add(sideB.vecAB.clone().multiplyScalar(radius)),\r\n                        radius: radius,\r\n                        large: large\r\n                    });\r\n                }\r\n            }\r\n\r\n            return corners;\r\n        }\r\n\r\n        function createSidePath(side, orientation, path) {\r\n\r\n            var count = side.bodyCount;\r\n            if (count === 0) {\r\n                return;\r\n            }\r\n\r\n            var radius = side.bodyRadius;\r\n            var diameter = side.bodyDiameter;\r\n\r\n            var xValueInset = diameter * 0.05;\r\n            var yValueOffset = radius * 3.5 / 3.0;\r\n\r\n            var p1 = new THREE.Vector3(xValueInset, orientation * -yValueOffset);\r\n            var p2 = new THREE.Vector3(diameter - xValueInset, orientation * -yValueOffset);\r\n            var p3 = new THREE.Vector3(diameter, 0);\r\n\r\n            var angle = Math.acos(side.vecAB.x) * (side.vecAB.y < 0 ? -1 : 1);\r\n            var rotation = new THREE.Matrix4().makeRotationZ(angle);\r\n\r\n            p1.applyMatrix4(rotation);\r\n            p2.applyMatrix4(rotation);\r\n            p3.applyMatrix4(rotation);\r\n\r\n            for (var i = 0; i < count; ++i) {\r\n\r\n                path.push('c');\r\n                path.push(p1.x);\r\n                path.push(p1.y);\r\n                path.push(p2.x);\r\n                path.push(p2.y);\r\n                path.push(p3.x);\r\n                path.push(p3.y);\r\n            }\r\n        }\r\n\r\n        function createCornerPath(corner, first, orientation, path) {\r\n\r\n            if (first) {\r\n\r\n                path.push('M');\r\n                path.push(corner.pointA.x);\r\n                path.push(corner.pointA.y);\r\n            }\r\n\r\n            var large = orientation === 1 ? corner.large : !corner.large;\r\n\r\n            if (corner.radius !== 0) {\r\n\r\n                path.push('a');\r\n                path.push(corner.radius);\r\n                path.push(corner.radius);\r\n                path.push(0);\r\n                path.push(large ? 1 : 0);\r\n                path.push(orientation === 1 ? 1 : 0);\r\n                path.push(corner.pointB.x - corner.pointA.x);\r\n                path.push(corner.pointB.y - corner.pointA.y);\r\n            }\r\n            return path;\r\n        }\r\n\r\n\r\n        var strokeWidth = this.style['stroke-width'];\r\n        var radius = strokeWidth * 2;\r\n        var orientation = getOrientation(this.locations);\r\n        var closed = this.closed;\r\n        var path = [];\r\n\r\n        var sides = getSides(this.locations, closed);\r\n        var corners = getCorners(sides, radius, closed);\r\n        var cornersCount = corners.length;\r\n\r\n        updateSides(sides, corners, radius, orientation);\r\n\r\n        for(var i = 0; i < cornersCount; ++i) {\r\n\r\n            createCornerPath(corners[i], i === 0, orientation, path);\r\n            createSidePath(sides[i], orientation, path);\r\n        }\r\n\r\n        closed && path.push('z');\r\n        return path;\r\n    };\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\nimport { MarkupPolycloud } from '../MarkupPolycloud'\r\nimport { cloneStyle } from '../StyleUtils'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param id\r\n     * @param position\r\n     * @param size\r\n     * @param rotation\r\n     * @param locations\r\n     * @param closed\r\n     * @param style\r\n     * @constructor\r\n     */\r\n    export function CreatePolycloud(editor, id, position, size, rotation, locations, style, closed) {\r\n\r\n        EditAction.call(this, editor, 'CREATE-POLYCLOUD', id);\r\n\r\n        this.selectOnExecution = false;\r\n        this.position = position;\r\n        this.size = size;\r\n        this.rotation = rotation;\r\n        this.movements = locations.concat();\r\n        this.style = cloneStyle(style);\r\n        this.closed = closed;\r\n    }\r\n\r\n    CreatePolycloud.prototype = Object.create(EditAction.prototype);\r\n    CreatePolycloud.prototype.constructor = CreatePolycloud;\r\n\r\n    var proto = CreatePolycloud.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        var editor = this.editor;\r\n        var polyline = new MarkupPolycloud(this.targetId, editor);\r\n\r\n        editor.addMarkup(polyline);\r\n\r\n        polyline.set(this.position, this.size, this.movements, this.closed);\r\n        polyline.setRotation(this.rotation);\r\n        polyline.setStyle(this.style);\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        var markup = this.editor.getMarkup(this.targetId);\r\n        markup && this.editor.removeMarkup(markup);\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\nimport { CreateHighlight } from './CreateHighlight'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param highlight\r\n     * @constructor\r\n     */\r\n    export function DeleteHighlight(editor, highlight) {\r\n        EditAction.call(this, editor, 'DELETE-HIGHLIGHT', highlight.id);\r\n        this.createHighlight = new CreateHighlight(\r\n            editor,\r\n            highlight.id,\r\n            highlight.position,\r\n            highlight.size,\r\n            highlight.rotation,\r\n            highlight.locations,\r\n            highlight.getStyle());\r\n    }\r\n\r\n    DeleteHighlight.prototype = Object.create(EditAction.prototype);\r\n    DeleteHighlight.prototype.constructor = DeleteHighlight;\r\n\r\n    var proto = DeleteHighlight.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        this.createHighlight.undo();\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        this.createHighlight.redo();\r\n    };\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param highlight\r\n     * @param position\r\n     * @param size\r\n     * @param locations\r\n     * @constructor\r\n     */\r\n    export function SetHighlight(editor, highlight, position, size, locations, isAbsoluteCoords) {\r\n\r\n        EditAction.call(this, editor, 'SET-HIGHLIGHT', highlight.id);\r\n\r\n        this.position = position;\r\n        this.size = size;\r\n        this.locations = isAbsoluteCoords ? locations : locations.slice(0);\r\n        this.isAbsoluteCoords = isAbsoluteCoords;\r\n\r\n        // No need to save old data\r\n    }\r\n\r\n    SetHighlight.prototype = Object.create(EditAction.prototype);\r\n    SetHighlight.prototype.constructor = SetHighlight;\r\n\r\n    var proto = SetHighlight.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        var highlight = this.editor.getMarkup(this.targetId);\r\n        if (!highlight) {\r\n            return;\r\n        }\r\n\r\n        highlight.set(this.position, this.size, this.locations, this.isAbsoluteCoords);\r\n    };\r\n\r\n    proto.undo = function() {\r\n        // No need for undo.\r\n    };\r\n\r\n    proto.merge = function(action) {\r\n\r\n        if (this.targetId === action.targetId &&\r\n            this.type === action.type) {\r\n\r\n            this.locations = action.isAbsoluteCoords ? action.locations : action.locations.slice(0);\r\n            this.position = action.position;\r\n            this.size = action.size;\r\n            this.isAbsoluteCoords = action.isAbsoluteCoords;\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * @returns {boolean}\r\n     */\r\n    proto.isIdentity = function() {\r\n\r\n        return false; // No need to optimize, always false.\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { EditModePen } from './EditModePen'\r\nimport { DeleteHighlight } from '../edit-actions/DeleteHighlight'\r\nimport { CreateHighlight } from '../edit-actions/CreateHighlight'\r\nimport { SetHighlight } from '../edit-actions/SetHighlight'\r\nimport * as MarkupTypes from '../MarkupTypes'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @constructor\r\n     */\r\n    export function EditModeHighlight(editor) {\r\n\r\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity'];\r\n        EditModePen.call(this, editor, MarkupTypes.MARKUP_TYPE_HIGHLIGHT, styleAttributes);\r\n\r\n        var normaStrokeWidth = editor.getStrokeWidth();\r\n        this.style['stroke-opacity'] = 0.50;\r\n        this.style['stroke-color'] = '#ffff00';\r\n        this.style['stroke-width'] = 4 * normaStrokeWidth; // Very Thick\r\n    }\r\n\r\n    EditModeHighlight.prototype = Object.create(EditModePen.prototype);\r\n    EditModeHighlight.prototype.constructor = EditModeHighlight;\r\n\r\n    var proto = EditModeHighlight.prototype;\r\n\r\n    proto.createPen = function(markupId, position, size, rotation, locations) {\r\n        return new CreateHighlight(this.editor,\r\n            markupId,\r\n            position,\r\n            size,\r\n            rotation,\r\n            locations,\r\n            this.style);\r\n    };\r\n\r\n    proto.deletePen = function(markup) {\r\n        return new DeleteHighlight(this.editor, markup);\r\n    };\r\n\r\n    proto.setPen = function(position, size, locations, isAbsoluteCoords) {\r\n        return new SetHighlight(this.editor,\r\n            this.selectedMarkup,\r\n            position,\r\n            size,\r\n            locations,\r\n            isAbsoluteCoords);\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { MarkupPen } from './MarkupPen'\r\nimport * as MarkupTypes from './MarkupTypes'\r\nimport { EditModeHighlight } from './edit-modes/EditModeHighlight'\r\n\r\n    /**\r\n     *\r\n     * @param id\r\n     * @param editor\r\n     * @constructor\r\n     */\r\n    export function MarkupHighlight(id, editor) {\r\n\r\n        MarkupPen.call(this, id, editor);\r\n        this.type = MarkupTypes.MARKUP_TYPE_HIGHLIGHT;\r\n    }\r\n\r\n    MarkupHighlight.prototype = Object.create(MarkupPen.prototype);\r\n    MarkupHighlight.prototype.constructor = MarkupHighlight;\r\n\r\n    var proto = MarkupHighlight.prototype;\r\n\r\n    proto.getEditMode = function() {\r\n\r\n        return new EditModeHighlight(this.editor);\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\nimport { MarkupHighlight } from '../MarkupHighlight'\r\nimport { cloneStyle } from '../StyleUtils'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param id\r\n     * @param position\r\n     * @param size\r\n     * @param rotation\r\n     * @param locations\r\n     * @param style\r\n     * @constructor\r\n     */\r\n    export function CreateHighlight(editor, id, position, size, rotation, locations, style) {\r\n\r\n        EditAction.call(this, editor, 'CREATE-HIGHLIGHT', id);\r\n\r\n        this.selectOnExecution = false;\r\n        this.position = position;\r\n        this.size = size;\r\n        this.rotation = rotation;\r\n        this.movements = locations.slice(0);\r\n        this.style = cloneStyle(style);\r\n    }\r\n\r\n    CreateHighlight.prototype = Object.create(EditAction.prototype);\r\n    CreateHighlight.prototype.constructor = CreateHighlight;\r\n\r\n    var proto = CreateHighlight.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        var editor = this.editor;\r\n        var highlight = new MarkupHighlight(this.targetId, editor);\r\n\r\n        editor.addMarkup(highlight);\r\n\r\n        highlight.set(this.position, this.size, this.movements, false);\r\n        highlight.setRotation(this.rotation);\r\n        highlight.setStyle(this.style);\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        var markup = this.editor.getMarkup(this.targetId);\r\n        markup && this.editor.removeMarkup(markup);\r\n    };\r\n\r\n\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\nimport { CreateDimension } from './CreateDimension'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param dimension\r\n     * @constructor\r\n     */\r\n    export function DeleteDimension(editor, dimension) {\r\n\r\n        // Confusing naming here. Dimension.secondAnchor is the starting point of the dimension,\r\n        // and dimension.firstAnchor is the final point. In CreateDimension the firstAnchor argument\r\n        // is the first point of the dimension and the secondAnchor argument is the second\r\n        // point of the argument. So construct CreateDimension with the secondAnchor before\r\n        // the firstAnchor. \r\n        EditAction.call(this, editor, 'DELETE-DIMENSION', dimension.id);\r\n        this.createDimension = new CreateDimension(\r\n            editor,\r\n            dimension.id,\r\n            dimension.secondAnchor,\r\n            dimension.firstAnchor,\r\n            dimension.currentText,\r\n            dimension.getStyle());\r\n    }\r\n\r\n    DeleteDimension.prototype = Object.create(EditAction.prototype);\r\n    DeleteDimension.prototype.constructor = DeleteDimension;\r\n\r\n    var proto = DeleteDimension.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        this.createDimension.undo();\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        this.createDimension.redo();\r\n    };\r\n\r\n\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param dimension\r\n     * @param firstAnchor\r\n     * @param secondAnchor\r\n     * @constructor\r\n     */\r\n    export function SetDimension(editor, dimension, firstAnchor, secondAnchor, text) {\r\n\r\n        EditAction.call(this, editor, 'SET-DIMENSION', dimension.id);\r\n\r\n        this.newFirstAnchor = {x: firstAnchor.x, y: firstAnchor.y};\r\n        this.newSecondAnchor = {x: secondAnchor.x, y: secondAnchor.y};   \r\n        this.oldFirstAnchor = {x: dimension.firstAnchor.x, y: dimension.firstAnchor.y};\r\n        this.oldSecondAnchor = {x: dimension.secondAnchor.x, y: dimension.secondAnchor.y}; \r\n        this.newText = text;\r\n        this.oldText = dimension.currentText;\r\n    }\r\n\r\n    SetDimension.prototype = Object.create(EditAction.prototype);\r\n    SetDimension.prototype.constructor = SetDimension;\r\n\r\n    var proto = SetDimension.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        this.applyState(this.newFirstAnchor, this.newSecondAnchor, this.newText);    \r\n\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        this.applyState(this.oldFirstAnchor, this.oldSecondAnchor, this.oldText);\r\n\r\n    };\r\n\r\n    proto.merge = function(action) {\r\n\r\n        if (this.targetId === action.targetId &&\r\n            this.type === action.type) {\r\n\r\n            this.newFirstAnchor = action.newFirstAnchor;\r\n            this.newSecondAnchor = action.newSecondAnchor;\r\n            this.newText = action.newText;\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @private\r\n     */\r\n    proto.applyState = function(firstAnchor, secondAnchor, text) {\r\n\r\n        var dimension = this.editor.getMarkup(this.targetId);\r\n\r\n        if(!dimension) {\r\n            return;\r\n        }\r\n\r\n        dimension.set(firstAnchor.x, firstAnchor.y, secondAnchor.x, secondAnchor.y, text);\r\n\r\n    };\r\n\r\n    /**\r\n     * @returns {boolean}\r\n     */\r\n    proto.isIdentity = function() {\r\n\r\n        return ((this.newText === this.oldText) && (\r\n            !this.newFirstAnchor || !this.newSecondAnchor ||\r\n            this.newFirstAnchor.x === this.oldFirstAnchor.x &&\r\n            this.newFirstAnchor.y === this.oldFirstAnchor.y &&\r\n            this.newSecondAnchor.x === this.oldSecondAnchor.x &&\r\n            this.newSecondAnchor.y === this.oldSecondAnchor.y));\r\n    };\r\n","'use strict';\r\n\r\nimport { EditMode } from './EditMode'\r\nimport { DeleteDimension } from '../edit-actions/DeleteDimension'\r\nimport { CreateDimension } from '../edit-actions/CreateDimension'\r\nimport { SetDimension } from '../edit-actions/SetDimension'\r\nimport { SetStyle } from '../edit-actions/SetStyle'\r\nimport * as MarkupTypes from '../MarkupTypes'\r\nimport * as MarkupEvents from '../MarkupEvents'\r\nimport { EditorTextInput } from './EditorTextInput'\r\nimport { measureTextLines, radiansToDegrees } from '../MarkupsCoreUtils'\r\n\r\n    var MeasureCommon = Autodesk.Viewing.MeasureCommon;\r\n    \r\n    var MAX_LETTERS = 15;\r\n    var SPACE = '\\u00A0'; // Non-breaking space\r\n    var _cursorPosition;\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @constructor\r\n     */\r\n    export function EditModeDimension(editor) {\r\n\r\n        var self = this;\r\n\r\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity', 'font-size', 'font-family', 'font-style', 'font-weight'];\r\n        EditMode.call(this, editor, MarkupTypes.MARKUP_TYPE_DIMENSION, styleAttributes);\r\n\r\n        this.onHistoryChangeBinded = this.onHistoryChange.bind(this);\r\n\r\n        this.measurement = new MeasureCommon.Measurement(MeasureCommon.MeasurementTypes.MEASUREMENT_DISTANCE);\r\n        var viewer = this.viewer;\r\n        var measureExt = viewer.getExtension('Autodesk.Measure');\r\n        \r\n        function abortDimensionMarkup() {\r\n            self.cancelEditModeChange = true;\r\n            editor.enterEditMode(); // Selects default edit mode.\r\n        }\r\n\r\n        if (!measureExt) {\r\n            console.error('Demension markup cant work without measure extension. Please load measure extension first');\r\n            abortDimensionMarkup();\r\n        }\r\n\r\n        this.sharedMeasureConfig = measureExt.sharedMeasureConfig;\r\n        \r\n        // If PDF, force calibration\r\n        if ((measureExt.forceCalibrate || viewer.model.getData().isLeaflet || viewer.model.getData().isPdf) && !measureExt.calibrationTool.isCalibrated()) {\r\n            measureExt.openCalibrationRequiredDialog('dimension');\r\n            abortDimensionMarkup();\r\n        }\r\n    }\r\n\r\n    EditModeDimension.prototype = Object.create(EditMode.prototype);\r\n    EditModeDimension.prototype.constructor = EditModeDimension;\r\n\r\n    var proto = EditModeDimension.prototype;\r\n\r\n    proto.deleteMarkup = function(markup, cantUndo) {\r\n\r\n        markup = markup || this.selectedMarkup;\r\n        if (markup && markup.type == this.type) {\r\n            var deleteDimension = new DeleteDimension(this.editor, markup);\r\n            deleteDimension.addToHistory = !cantUndo;\r\n            deleteDimension.execute();\r\n            this.creating = false;\r\n            this.dragging = false;\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    proto.updateTextBoxStyle = function(style) {\r\n        if (this.isTextInputHelperActive()) {\r\n            if (!style) {\r\n                style = this.textInputHelper.textMarkup.getStyle();\r\n            }\r\n\r\n            this.textInputHelper.setStyle(style);\r\n            this.updateTextBox(this.textInputHelper.textMarkup);\r\n        }\r\n    };\r\n\r\n    proto.setStyle = function(style) {\r\n\r\n        EditMode.prototype.setStyle.call(this, style);\r\n        this.updateTextBoxStyle(style);\r\n\r\n    };\r\n\r\n    proto.notifyAllowNavigation = function(allows) {\r\n\r\n        if (allows && this.isTextInputHelperActive()) {\r\n            this.textInputHelper.acceptAndExit();\r\n        }\r\n    };\r\n\r\n    proto.creationBegin = function() {\r\n        EditMode.prototype.creationBegin.call(this);\r\n    };\r\n\r\n    proto.creationEnd = function() {\r\n\r\n        this.dragging = false;\r\n        EditMode.prototype.creationEnd.call(this);\r\n    };\r\n\r\n    proto.isMinSizeValid = function() {\r\n\r\n        if (this.minSize !== 0) {\r\n            var tmp = this.editor.sizeFromMarkupsToClient(this.selectedMarkup.size.x, this.selectedMarkup.size.y);\r\n            return (tmp.x*tmp.x) >= (this.minSize * this.minSize);\r\n        }\r\n\r\n        return true;\r\n    };\r\n\r\n    proto.creationCancel = function() {\r\n\r\n        EditMode.prototype.creationCancel.call(this);\r\n\r\n        this.creating = false;\r\n        this.dragging = false;\r\n\r\n    };\r\n\r\n    proto.destroy = function() {\r\n\r\n        if (this.textInputHelper) {\r\n\r\n            if (this.textInputHelper.isActive()) {\r\n                this.textInputHelper.acceptAndExit();\r\n            }\r\n\r\n            this.editor.actionManager.removeEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\r\n\r\n            this.textInputHelper.destroy();\r\n            this.textInputHelper = null;\r\n        }\r\n\r\n        this.updateViewportId();\r\n\r\n        EditMode.prototype.destroy.call(this);\r\n    };\r\n\r\n    proto.getDistance = function() {\r\n\r\n        var distance = null;\r\n\r\n        this.measurement.computeResult(this.measurement.picks, this.viewer);\r\n\r\n        if (this.viewer.model && this.measurement.distanceXYZ) {\r\n            var d = Autodesk.Viewing.Private.convertUnits(this.viewer.model.getUnitString(), this.sharedMeasureConfig.units, this.sharedMeasureConfig.calibrationFactor, this.measurement.distanceXYZ);\r\n            return Autodesk.Viewing.Private.formatValueWithUnits(d, this.sharedMeasureConfig.units, 3, this.sharedMeasureConfig.precision);\r\n        }\r\n\r\n        return distance;\r\n    };\r\n\r\n    proto.updateMeasurement = function(measurementNumber) {\r\n        var editor = this.editor;\r\n\r\n        var pick = this.measurement.getPick(measurementNumber);\r\n        \r\n        if (_cursorPosition) {\r\n            pick.geomType = MeasureCommon.SnapType.SNAP_VERTEX;\r\n            pick.geomVertex = _cursorPosition;\r\n            pick.intersectPoint = _cursorPosition;\r\n        } else {\r\n            editor.snapper.copyResults(pick);\r\n        }\r\n\r\n        return pick;\r\n    };\r\n\r\n    proto.updateViewportId = function(viewportId) {\r\n        if (this.viewer.model && this.viewer.model.is2d()) {\r\n            if (!viewportId) {\r\n                this.viewer.impl.updateViewportId(0);\r\n                this.editor.snapper.setViewportId(null);\r\n            }\r\n            else {\r\n                // Pass viewport Id to LineShader to make all other geometries with different viewport transparent\r\n                this.viewer.impl.updateViewportId(viewportId);\r\n                this.editor.snapper.setViewportId(viewportId);  \r\n            \r\n            }\r\n        }\r\n    };\r\n\r\n    proto.pickFirstAnchor = function() {\r\n        var editor = this.editor;\r\n        this.measurement.clearAllPicks();\r\n        var mousePosition = editor.getMousePosition();\r\n\r\n        this.initialX = mousePosition.x;\r\n        this.initialY = mousePosition.y;\r\n\r\n        this.firstAnchor = editor.positionFromClientToMarkups(this.initialX, this.initialY);\r\n\r\n        editor.beginActionGroup();\r\n\r\n        var dimensionId = editor.getId();\r\n        var create = new CreateDimension(editor, dimensionId, this.firstAnchor, null, this.currentText, this.style);\r\n        create.execute();\r\n\r\n        this.selectedMarkup = editor.getMarkup(dimensionId);\r\n        this.creationBegin();\r\n        \r\n        var pick = this.updateMeasurement(1);\r\n        this.updateViewportId(pick.viewportIndex2d);\r\n    };\r\n\r\n    proto.pickSecondAnchor = function(mouseDown) {\r\n\r\n        var editor = this.editor;\r\n        var selectedMarkup = this.selectedMarkup;\r\n\r\n        this.secondAnchor = this.getFinalMouseDraggingPosition();\r\n\r\n        this.updateMeasurement(2);\r\n\r\n        // Correct Perpendicular\r\n        if (MeasureCommon.correctPerpendicularPicks(this.measurement.getPick(1), this.measurement.getPick(2), this.viewer, editor.snapper)){\r\n            var newPos = MeasureCommon.getSnapResultPosition(this.measurement.getPick(2), this.viewer);\r\n            this.secondAnchor = editor.project(newPos);\r\n            editor.snapper.indicator.render();\r\n        }\r\n\r\n        var secondAnchor = editor.positionFromClientToMarkups(this.secondAnchor.x, this.secondAnchor.y);\r\n\r\n        this.size.x = selectedMarkup.size.x;\r\n        this.size.y = selectedMarkup.size.y;\r\n\r\n        selectedMarkup.currentText = this.getDistance();         \r\n\r\n        var setDimension = new SetDimension(editor, selectedMarkup, this.firstAnchor, secondAnchor, selectedMarkup.currentText);\r\n        setDimension.execute();\r\n\r\n        var setStyle = new SetStyle(editor, selectedMarkup, this.style);\r\n        setStyle.execute();\r\n\r\n        // Open 'Add Length' textbox if no measurement has being taken.\r\n        if (mouseDown && !selectedMarkup.currentText && this.isMinSizeValid()) {\r\n            selectedMarkup.currentText = '';\r\n            this.editor.selectMarkup(null);\r\n            this.updateTextBox(selectedMarkup);\r\n        } \r\n    };\r\n\r\n\r\n    /**\r\n     * Handler to mouse down events, used to start markups creation.\r\n     * @private\r\n     */\r\n    proto.onMouseDown = function(event) {\r\n\r\n        // Right click - do nothing.\r\n        if (Autodesk.Viewing.Private.isRightClick(event, this.viewer.navigation)) {\r\n            return;\r\n        }\r\n\r\n        _cursorPosition = null;\r\n\r\n        // Textbox is open.\r\n        if (this.isTextInputHelperActive()) {\r\n            this.textInputHelper.acceptAndExit();\r\n            return;\r\n        }\r\n\r\n        EditMode.prototype.onMouseDown.call(this);\r\n\r\n        // User selected an already created markup.\r\n        if (this.selectedMarkup && !this.creating) {\r\n            return;\r\n        }\r\n        \r\n        var isSnapped = this.editor.snapper.isSnapped();\r\n\r\n        // Picked first point.\r\n        if (!this.selectedMarkup && !this.creating && isSnapped) {\r\n            this.pickFirstAnchor();\r\n        }\r\n\r\n        // Picked second point.\r\n        else if (this.selectedMarkup && this.creating) {\r\n\r\n            if (isSnapped) {\r\n                this.pickSecondAnchor(true);   \r\n            } else {\r\n                this.deleteMarkup(this.selectedMarkup, true);\r\n                this.creating = true;\r\n            }\r\n\r\n            this.updateViewportId();\r\n            this.creationEnd();\r\n        }\r\n    };\r\n\r\n    proto.onMouseUp = function(event) {\r\n\r\n        if (this.dragging) {\r\n            this.onMouseDown(event);   \r\n            this.dragging = false; \r\n        }\r\n    };\r\n\r\n\r\n    /**\r\n     * Handler to mouse move events, used to create markups.\r\n     * @param {MouseEvent} event Mouse event.\r\n     * @private\r\n     */\r\n    proto.onMouseMove = function(event) {\r\n\r\n        _cursorPosition = null;\r\n\r\n        if(!this.selectedMarkup || !this.creating) {\r\n            return;\r\n        }\r\n\r\n        this.dragging = true;\r\n        this.pickSecondAnchor(false);\r\n    };\r\n\r\n    proto.getFinalMouseDraggingPosition = function() {\r\n\r\n        var editor = this.editor;\r\n        var bounds = editor.getBounds();\r\n        var mousePosition = editor.getMousePosition();\r\n\r\n        if (!editor.snapper.isSnapped()) {\r\n            if (editor.viewer.model && editor.viewer.model.is2d()) {\r\n                _cursorPosition = MeasureCommon.inverseProject(mousePosition, editor.viewer);\r\n            }\r\n        }\r\n\r\n        var initialX = this.initialX;\r\n        var initialY = this.initialY;\r\n\r\n        var finalX = Math.min(Math.max(bounds.x, mousePosition.x), bounds.x + bounds.width);\r\n        var finalY = Math.min(Math.max(bounds.y, mousePosition.y), bounds.y + bounds.height);\r\n\r\n        if (finalX == initialX &&\r\n            finalY == initialY) {\r\n            finalX++;\r\n            finalY++;\r\n        }\r\n\r\n        // Make straight line when shift key is down.\r\n        if (editor.input.constrainAxis && editor.viewer.model.is2d()) {\r\n            var dx = Math.abs(finalX - initialX);\r\n            var dy = Math.abs(finalY - initialY);\r\n\r\n            if (dx > dy) {\r\n                finalY = initialY;\r\n            } \r\n            else {\r\n                finalX = initialX;\r\n            }\r\n\r\n            editor.snapper.onMouseMove({ x:finalX, y:finalY });\r\n            \r\n            if (editor.snapper.isSnapped()) {\r\n                editor.snapper.copyResults(this.measurement.getPick(2));\r\n                _cursorPosition = null;\r\n            } else {\r\n                _cursorPosition = MeasureCommon.inverseProject({ x:finalX, y:finalY }, editor.viewer);\r\n            }\r\n        }\r\n\r\n        return { x:finalX, y:finalY };\r\n    };\r\n\r\n    proto.isVisibleChar = function(keyCode) {\r\n\r\n    return  ((keyCode > 47 && keyCode < 58)  || // number keys\r\n            (keyCode == 32)                  || // spacebar\r\n            (keyCode > 64 && keyCode < 91)   || // letter keys\r\n            (keyCode > 95 && keyCode < 112)  || // numpad keys\r\n            (keyCode > 185 && keyCode < 193) || // ;=,-./` (in order)\r\n            (keyCode > 218 && keyCode < 223));   // [\\]' (in order)\r\n    };\r\n\r\n    proto.measureTextLine = function(text, markup, editor) {\r\n\r\n        text = text.replace(new RegExp(' ', 'g'), SPACE);\r\n        text = text.length === 0 ? markup.initialText : text;\r\n        return measureTextLines([text + '|'], this.style, editor)[0];\r\n\r\n    };\r\n\r\n    proto.handleKeyDown = function (e) {\r\n        var textInputHelper = this.textInputHelper;\r\n        \r\n        if (e.keyCode === Autodesk.Viewing.KeyCode.ENTER) {\r\n            return;\r\n        }\r\n\r\n        var markup = textInputHelper.textMarkup;\r\n        var text = textInputHelper.textArea.value;\r\n\r\n        if (e.keyCode === Autodesk.Viewing.KeyCode.BACKSPACE) {\r\n            text = text.substring(0, text.length-1);\r\n        }\r\n\r\n        if (text.length < MAX_LETTERS && this.isVisibleChar(e.keyCode)) {\r\n            text = text + e.key;            \r\n        }\r\n\r\n        var size = this.measureTextLine(text, markup, this.editor);\r\n                \r\n        this.updateTextBox(markup, size);\r\n    };\r\n\r\n    proto.updateTextBox = function(markup, size) {\r\n\r\n        if (!this.textInputHelper) {\r\n            this.textInputHelper = new EditorTextInput(this.viewer.container, this.editor, true, markup.initialText, MAX_LETTERS);\r\n            this.textInputHelper.addEventListener(this.textInputHelper.EVENT_TEXT_CHANGE, this.onHelperTextChange.bind(this), false);\r\n            this.handleKeyDownBinded = this.handleKeyDown.bind(this);\r\n        }\r\n\r\n        markup.text.style.display = 'none';\r\n        \r\n        if (!size) {\r\n            size = this.measureTextLine(this.textInputHelper.textArea.value, markup, this.editor);\r\n        }\r\n\r\n        var transform = this.getTextAreaTransform(markup, size);\r\n\r\n        this.textInputHelper.styleTextArea.setAttribute('text-align', 'center');\r\n        \r\n        this.textInputHelper.setActive(markup, false);\r\n\r\n        \r\n        // Override textArea attributes\r\n        this.textInputHelper.textArea.style.position = 'static';\r\n        this.textInputHelper.textArea.style.padding = '0';\r\n        this.textInputHelper.textArea.style.width = size.width + 'px';\r\n        this.textInputHelper.textArea.style.height = size.height + 'px';\r\n        this.textInputHelper.textArea.style.transform = transform; // Maybe need to add 'allBrowsers' support\r\n\r\n        this.editor.actionManager.removeEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\r\n        this.editor.actionManager.addEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);    \r\n        this.textInputHelper.textArea.removeEventListener('keydown', this.handleKeyDownBinded);\r\n        this.textInputHelper.textArea.addEventListener('keydown', this.handleKeyDownBinded);    \r\n        \r\n    };\r\n\r\n    proto.getTextAreaTransform = function(markup, size) {\r\n\r\n        var position = markup.getClientPosition();\r\n        var rotation = radiansToDegrees(markup.rotation) % 360;\r\n\r\n        if (rotation > 90 && rotation <= 270 && markup.shouldFlip()) {\r\n            rotation = 180 + rotation;\r\n        }\r\n    \r\n        return [\r\n            'translate(', (position.x - (size.width/2)) + 'px,',(position.y - this.viewer.container.clientHeight - size.height) + 'px)',\r\n            'rotate(', rotation + 'deg)',\r\n            'translate(0px,', size.height +'px)'\r\n        ].join(' ');\r\n    };\r\n\r\n    proto.onMouseDoubleClick = function(markup) {\r\n\r\n        if (markup === this.selectedMarkup) {\r\n            this.editor.selectMarkup(null);\r\n            this.updateTextBox(markup);\r\n        }\r\n    };\r\n\r\n    proto.onHelperTextChange = function(event) {\r\n\r\n        var dataBag = event.data;\r\n        var markup = dataBag.markup;\r\n        var textStyle = dataBag.style;\r\n        var editor = this.editor;\r\n\r\n        markup.text.style.display = 'block';\r\n\r\n        if (dataBag.newText === '') {\r\n            dataBag.newText = markup.initialText;\r\n        }\r\n\r\n        // When the text is created for the first time, an action group\r\n        // is already created and it includes the CreateText action.\r\n        // Thus, no need to begin another action group.\r\n        if (!dataBag.firstEdit) {\r\n            editor.beginActionGroup();\r\n        }\r\n\r\n        var setStyle = new SetStyle(editor, markup, textStyle);\r\n        setStyle.execute();\r\n\r\n        var setDimension = new SetDimension(editor, markup, markup.firstAnchor, markup.secondAnchor, dataBag.newText);\r\n        setDimension.execute();\r\n\r\n        editor.closeActionGroup();\r\n        editor.selectMarkup(null);\r\n    };\r\n\r\n    /**\r\n     * We want to make sure that the Input Helper gets removed from the screen\r\n     * whenever the user attempts to perform an undo or redo action.\r\n     * @param {Event} event\r\n     * @private\r\n     */\r\n    proto.onHistoryChange = function(event) {\r\n        if (this.isTextInputHelperActive()) {\r\n            this.textInputHelper.textMarkup.text.style.display = 'block';\r\n            this.editor.actionManager.removeEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\r\n            this.textInputHelper.setInactive();\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Notify the markup that the displayed markups are being saved so edit mode can finish current editions.\r\n     */\r\n    proto.onSave = function() {\r\n\r\n        EditMode.prototype.onSave.call(this);\r\n\r\n        // Close input helper if it's open.\r\n        if (this.isTextInputHelperActive()) {\r\n            var editor = this.editor;\r\n            editor.actionManager.removeEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\r\n            var markup = this.textInputHelper.textMarkup;\r\n            this.textInputHelper.acceptAndExit();\r\n            markup.text.style.display = 'block';\r\n        }\r\n    };\r\n\r\n    proto.useWithSnapping = function () {\r\n        return true;\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { Markup } from './Markup'\r\nimport * as MarkupTypes from './MarkupTypes'\r\nimport { createMarkupPathSvg, createMarkupTextSvg, composeRGBAString, addMarkupMetadata,\r\n    radiansToDegrees, degreesToRadians, measureTextLines, setMarkupTextSvgTransform,\r\n    setAttributeToMarkupSvg, updateMarkupPathSvgHitarea, createSvgElement, checkLineSegment,\r\n    updateMarkupTextSvgBackground, updateMarkupTextSvgClipper, updateMarkupTextSvgHitarea \r\n} from './MarkupsCoreUtils'\r\nimport { cloneStyle } from './StyleUtils'\r\nimport { EditModeDimension } from './edit-modes/EditModeDimension'\r\n\r\n    var DIMENSION_MARKUP_HEIGHT = 10;\r\n    var TEXT_OFFSET = 2;\r\n    var DEFAULT_TEXT = 'Add Length';\r\n    var BACKGROUND_COLOR = 'none';//'#ffffff';\r\n\r\n    /**\r\n     *\r\n     * @param id\r\n     * @param editor\r\n     * @constructor\r\n     */\r\n    export function MarkupDimension(id, editor) {\r\n\r\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity', 'font-size', 'font-family', 'font-style', 'font-weight'];\r\n        Markup.call(this, id, editor, styleAttributes);\r\n\r\n        this.type = MarkupTypes.MARKUP_TYPE_DIMENSION;\r\n        this.constraintHeight = true;\r\n        this.constraintWidth = true;\r\n\r\n        // bind to this to pass this.globalManager\r\n        this.addMarkupMetadata = addMarkupMetadata.bind(this);\r\n        this.createSvgElement = createSvgElement.bind(this);\r\n        this.checkLineSegment = checkLineSegment.bind(this);\r\n        this.measureTextLines = measureTextLines.bind(this);\r\n\r\n        \r\n        this.firstAnchor = new THREE.Vector3();\r\n        this.secondAnchor = new THREE.Vector3();\r\n        this.shape = createMarkupPathSvg();\r\n        this.text = createMarkupTextSvg();\r\n        this.shape.appendChild(this.text);\r\n        this.textSize = {x: 0, y: 0};\r\n        this.initialText = DEFAULT_TEXT;\r\n        this.currentText = ' ';\r\n\r\n        if (!this.viewer.model.is2d()) {\r\n            this.preventReposition = true;\r\n            this.constraintRotation = true;\r\n        }\r\n\r\n        this.bindDomEvents();\r\n    }\r\n\r\n    MarkupDimension.prototype = Object.create(Markup.prototype);\r\n    MarkupDimension.prototype.constructor = MarkupDimension;\r\n\r\n    var proto = MarkupDimension.prototype;\r\n\r\n    proto.getEditMode = function() {\r\n\r\n        return new EditModeDimension(this.editor);\r\n    };\r\n\r\n    /**\r\n     * Sets top-left and bottom-right values in client space coordinates (2d).\r\n     * Notice that for the Dimension, the top left is the \"secondAnchor\" of the Dimension and\r\n     * the bottom right is the \"firstAnchor\" of it.\r\n     *\r\n     * @param {Number} xO - secondAnchor\r\n     * @param {Number} yO - secondAnchor\r\n     * @param {Number} xF - firstAnchor\r\n     * @param {Number} yF - firstAnchor\r\n     */\r\n    proto.set = function(xO, yO, xF, yF, text) {\r\n\r\n        var vO = new THREE.Vector2(xO, yO);\r\n        var vF = new THREE.Vector2(xF, yF);\r\n        var vDir = vF.clone().sub(vO).normalize();\r\n\r\n        this.size.x = vO.distanceTo(vF); // TODO: Clamp min length\r\n        this.rotation = Math.acos(vDir.dot(new THREE.Vector2(1,0)));\r\n        this.rotation = yF > yO ? (Math.PI*2)-this.rotation : this.rotation;\r\n\r\n        var firstAnchor = this.firstAnchor;\r\n        var secondAnchor = this.secondAnchor;\r\n\r\n        firstAnchor.set(xF, yF, 0);\r\n        secondAnchor.set(xO, yO, 0);\r\n\r\n        this.position.x = secondAnchor.x + (firstAnchor.x - secondAnchor.x) * 0.5;\r\n        this.position.y = secondAnchor.y + (firstAnchor.y - secondAnchor.y) * 0.5;\r\n\r\n        this.currentText = text;\r\n        this.updateStyle();\r\n    };\r\n\r\n    /**\r\n     * Changes the rotation of the markup to the given angle.\r\n     * This gets called by the Autodesk.Viewing.Extensions.Markups.Core.SetRotation edit action\r\n     *\r\n     * @param {Number} angle\r\n     */\r\n    proto.setRotation = function(angle) {\r\n\r\n        if (radiansToDegrees(angle) === 90) {\r\n            angle = degreesToRadians(-90);\r\n        }\r\n\r\n        this.rotation = angle;\r\n\r\n        var xF = Math.cos(-angle);\r\n        var yF = Math.sin(-angle);\r\n        var vFDir = new THREE.Vector2(xF, yF); // already normalized\r\n        vFDir.multiplyScalar(this.size.x*0.5);\r\n\r\n        var vCenter = new THREE.Vector2(this.position.x, this.position.y);\r\n        var vO = vCenter.clone().sub(vFDir);\r\n        var vF = vCenter.clone().add(vFDir);\r\n\r\n        this.firstAnchor.set(vF.x, vF.y, 0);\r\n        this.secondAnchor.set(vO.x, vO.y, 0);\r\n\r\n        this.updateStyle();\r\n    };\r\n\r\n    /**\r\n     * Changes the position and size of the markup.\r\n     * This gets called by the namespace.SetSize edit action\r\n     * @param {{x: Number, y: Number}} position - Dimension's center\r\n     * @param {Number} width - Dimension's length\r\n     * @param {Number} height - We ignore this one because we use the Dimension's stroke width instead\r\n     */\r\n    proto.setSize = function(position, width, height) {\r\n\r\n        var xF = Math.cos(-this.rotation);\r\n        var yF = Math.sin(-this.rotation);\r\n        var vFDir = new THREE.Vector2(xF, yF); // already normalized\r\n        vFDir.multiplyScalar(width*0.5);\r\n\r\n        var vCenter = new THREE.Vector2(position.x, position.y);\r\n        var vO = vCenter.clone().sub(vFDir);\r\n        var vF = vCenter.clone().add(vFDir);\r\n\r\n        this.firstAnchor.set(vF.x, vF.y, 0);\r\n        this.secondAnchor.set(vO.x, vO.y, 0);\r\n\r\n        this.position.x = position.x;\r\n        this.position.y = position.y;\r\n        this.size.x = width;\r\n\r\n        this.updateStyle();\r\n    };\r\n\r\n    /**\r\n     * Helper method that returns the font size in client space coords.\r\n     * @returns {Number}\r\n     */\r\n    proto.getClientFontSize = function() {\r\n\r\n        return this.editor.sizeFromMarkupsToClient(0, this.style['font-size']).y;\r\n    };\r\n\r\n    proto.updateStyle = function() {\r\n\r\n        var style = this.style;\r\n        var shape = this.shape;\r\n        var strokeWidth = style['stroke-width'];\r\n        var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\r\n        var transform = this.getTransform();\r\n\r\n        this.rebuildTextSvg(this.currentText);\r\n\r\n        setAttributeToMarkupSvg(shape, 'd', this.getPath().join(' '));\r\n        setAttributeToMarkupSvg(shape, 'stroke-width', strokeWidth / 2);\r\n        setAttributeToMarkupSvg(shape, 'stroke', strokeColor);\r\n        setAttributeToMarkupSvg(shape, 'fill', strokeColor);\r\n        setAttributeToMarkupSvg(shape, 'transform', transform);\r\n        updateMarkupPathSvgHitarea(shape, this.editor);\r\n    };\r\n\r\n    proto.rebuildTextSvg = function(value) {\r\n        var style = this.style;\r\n        var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\r\n        var strokeWidth = style['stroke-width'];\r\n        var backgroundColor = (value === ' ') ? 'none' : BACKGROUND_COLOR;\r\n\r\n        var markup = this.createSvgElement('text');\r\n        markup.setAttribute('id', 'markup');\r\n        markup.setAttribute('alignment-baseline', 'middle');\r\n\r\n        var text = this.text;\r\n        var editor = this.editor;\r\n\r\n        text.childNodes[0].removeChild(text.markup);\r\n        text.childNodes[0].appendChild(markup);\r\n        text.markup = markup;\r\n\r\n        var tspan = this.createSvgElement('tspan');\r\n        tspan.textContent = value;\r\n        markup.appendChild(tspan);\r\n\r\n        var lineSize = this.measureTextLines([value], style, editor)[0]; // Only one line for measurement\r\n        var textSize = this.textSize = editor.sizeFromClientToMarkups(lineSize.width, lineSize.height);\r\n        \r\n        var edgeH = DIMENSION_MARKUP_HEIGHT * strokeWidth / 2;\r\n        var textOffset = TEXT_OFFSET * strokeWidth / 2;\r\n        var offset = (textSize.x + (2 * strokeWidth) >= this.size.x) ? textOffset + edgeH / 2 : textOffset; // If the line is too short for the given text, put it under.\r\n\r\n        this.size.y = edgeH + textSize.y + offset;\r\n\r\n        var textTransform = this.getTextTransform((4/5 * textSize.y) +  offset, true); // Text height is Always 4/5 of the entire label height.\r\n        var backgroundTransform = this.getTextTransform(textSize.y + offset, false);\r\n\r\n        setAttributeToMarkupSvg(text, 'font-family', style['font-family']);\r\n        setAttributeToMarkupSvg(text, 'font-size', style['font-size']);\r\n        setAttributeToMarkupSvg(text, 'font-weight', style['font-weight']);\r\n        setAttributeToMarkupSvg(text, 'font-style', style['font-style']);\r\n        setAttributeToMarkupSvg(text, 'text-rendering', 'auto');\r\n        setAttributeToMarkupSvg(text, 'fill', strokeColor);\r\n        setMarkupTextSvgTransform(text, backgroundTransform, textTransform); \r\n        updateMarkupTextSvgBackground(text, textSize.x, textSize.y, backgroundColor);\r\n        updateMarkupTextSvgClipper(text, textSize.x, textSize.y);\r\n        updateMarkupTextSvgHitarea(text, textSize.x, textSize.y, editor);\r\n    };\r\n\r\n    proto.shouldFlip = function(){\r\n        return (this.firstAnchor.x < this.secondAnchor.x);\r\n    };\r\n\r\n    proto.getTextTransform = function(offset, inverse) {\r\n\r\n        var flip = this.shouldFlip() ? -1 : 1;\r\n\r\n        inverse = inverse ? -1 : 1;\r\n\r\n        if (radiansToDegrees(this.rotation) === 90) {\r\n            this.rotation = degreesToRadians(-90);\r\n        }\r\n\r\n        return [\r\n            'translate(', this.position.x , ',', this.position.y, ')',\r\n            'rotate(', radiansToDegrees(-this.rotation), ')',\r\n            'translate(', -flip * this.textSize.x / 2, ',', -flip*offset, ')',\r\n            'scale(' + flip + ',' + flip*inverse + ')'\r\n        ].join(' ');\r\n    };\r\n\r\n    /**\r\n     * Used by the EditFrame to move the markup in Client Space coordinates\r\n     * @param {Number} x - New X location for the markup. Notice that markups are centered on this value.\r\n     * @param {Number} y - New Y location for the markup. Notice that markups are centered on this value.\r\n     */\r\n    proto.setPosition = function (x, y) {\r\n\r\n        var firstAnchor = this.firstAnchor;\r\n        var secondAnchor = this.secondAnchor;\r\n\r\n        var dx = firstAnchor.x - secondAnchor.x;\r\n        var dy = firstAnchor.y - secondAnchor.y;\r\n\r\n        var xo = x + dx * 0.5;\r\n        var yo = y + dy * 0.5;\r\n\r\n        firstAnchor.x = xo;\r\n        firstAnchor.y = yo;\r\n\r\n        secondAnchor.x = xo - dx;\r\n        secondAnchor.y = yo - dy;\r\n\r\n        this.position.x = secondAnchor.x + (firstAnchor.x - secondAnchor.x) * 0.5;\r\n        this.position.y = secondAnchor.y + (firstAnchor.y - secondAnchor.y) * 0.5;\r\n\r\n        this.updateStyle();\r\n    };\r\n\r\n    proto.generatePoint3d = function(idTarget) {\r\n\r\n        var firstAnchor = this.editor.positionFromMarkupsToClient(this.firstAnchor.x, this.firstAnchor.y);\r\n        var secondAnchor = this.editor.positionFromMarkupsToClient(this.secondAnchor.x, this.secondAnchor.y);\r\n\r\n        var direction = firstAnchor.clone().sub(secondAnchor).normalize();\r\n\r\n        var point2d = this.checkLineSegment(firstAnchor.x, firstAnchor.y, firstAnchor.x + direction.x * 200, firstAnchor.y + direction.y * 200, idTarget);\r\n        var point3d = point2d && this.viewer.clientToWorld(point2d.x, point2d.y);\r\n\r\n        return point3d && point3d.point;\r\n    };\r\n\r\n    proto.setMetadata = function() {\r\n\r\n        this.text.setAttribute('pointer-events', 'none');\r\n\r\n        var metadata = cloneStyle(this.style);\r\n\r\n        metadata.type = this.type;\r\n        metadata.firstAnchor = [this.firstAnchor.x, this.firstAnchor.y].join(\" \");\r\n        metadata.secondAnchor = [this.secondAnchor.x, this.secondAnchor.y].join(\" \");\r\n        metadata.text = String(this.currentText);\r\n\r\n        return this.addMarkupMetadata(this.shape, metadata);\r\n    };\r\n\r\n\r\n    /**\r\n     * Returns the raw string value\r\n     * @returns {String}\r\n     */\r\n    proto.getText = function() {\r\n\r\n        // if the current text is 'Add Length', you want the textbox will be empty when the user open it.\r\n        return (this.currentText === this.initialText) ? '' : this.currentText;\r\n    };\r\n\r\n    proto.getPath = function() {\r\n\r\n        //   1_                            _4\r\n        //   | |                          | |\r\n        //   | |2                        3| |\r\n        //  0|  --------------------------  |\r\n        //   |  --------------------------  |\r\n        //   | |7                       6 | |\r\n        //   |_|          TEXT            |_|\r\n        //   8                             5\r\n        \r\n        var strokeWidth = this.style['stroke-width'];\r\n        var segmentLength = this.size.x - strokeWidth / 2; // segment length (p2 to p3 length)\r\n        var edgeH = DIMENSION_MARKUP_HEIGHT * strokeWidth / 2; // Edge height (p1 to p8 length)\r\n\r\n        return [\r\n            'M', -segmentLength * 0.5           ,    0              ,   // 0\r\n            'l', 0                              ,    edgeH / 2      ,   // 1\r\n            'l', 0                              ,    -edgeH / 2     ,   // 2\r\n            'l', segmentLength                  ,    0              ,   // 3\r\n            'l', 0                              ,    edgeH / 2      ,   // 4\r\n            'l', 0                              ,    -edgeH         ,   // 5\r\n            'l', 0                              ,    edgeH / 2      ,   // 6\r\n            'l', -segmentLength                 ,    0              ,   // 7\r\n            'l', 0                              ,    -edgeH / 2     ,   // 8\r\n            'z'\r\n        ];\r\n    };\r\n\r\n    proto.cloneShape = function(clone) {\r\n        \r\n        clone.shape = createMarkupPathSvg();\r\n        clone.text = createMarkupTextSvg();\r\n        clone.shape.appendChild(clone.text);\r\n        clone.bindDomEvents();\r\n    };\r\n\r\n    proto.getBoundingRect = function() {\r\n        var pos = this.getClientPosition();\r\n        var size = this.getClientSize();\r\n        return {\r\n            x: pos.x - size.x / 2,\r\n            y: pos.y - size.y / 2,\r\n            width: size.x,\r\n            height: size.y\r\n        }\r\n    };\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\nimport { MarkupDimension } from '../MarkupDimension'\r\nimport { cloneStyle } from '../StyleUtils'\r\n\r\n    /**\r\n     * @constructor\r\n     */\r\n    export function CreateDimension(editor, id, firstAnchor, secondAnchor, text, style) {\r\n\r\n        EditAction.call(this, editor, 'CREATE-DIMENSION', id);\r\n\r\n        this.selectOnExecution = false;\r\n        this.secondAnchor = secondAnchor;\r\n        this.firstAnchor = firstAnchor;\r\n        this.text = text;\r\n        this.style = cloneStyle(style);\r\n    }\r\n\r\n    CreateDimension.prototype = Object.create(EditAction.prototype);\r\n    CreateDimension.prototype.constructor = CreateDimension;\r\n\r\n    var proto = CreateDimension.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        var editor = this.editor;\r\n        var dimension = new MarkupDimension(this.targetId, editor);\r\n\r\n        editor.addMarkup(dimension);\r\n\r\n        // Don't display the dimension markup when there is only one Anchor (First click, before mouse move).\r\n        if (this.secondAnchor) {\r\n            dimension.set(this.firstAnchor.x, this.firstAnchor.y, this.secondAnchor.x, this.secondAnchor.y, this.text);\r\n            dimension.setStyle(this.style);\r\n        }        \r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        var markup = this.editor.getMarkup(this.targetId);\r\n        markup && this.editor.removeMarkup(markup);\r\n    };\r\n\r\n\r\n","const canvg = require('../../thirdparty/canvg/canvg.js'); // Required for Markup Thumbnails\r\nimport * as MarkupType from '../core/MarkupTypes'\r\nimport { CreateArrow } from './edit-actions/CreateArrow'\r\nimport { CreateRectangle } from './edit-actions/CreateRectangle'\r\nimport { CreateText } from './edit-actions/CreateText'\r\nimport { CreateCallout } from './edit-actions/CreateCallout'\r\nimport { CreateCircle } from './edit-actions/CreateCircle'\r\nimport { CreateCloud } from './edit-actions/CreateCloud'\r\nimport { CreateFreehand } from './edit-actions/CreateFreehand'\r\nimport { CreatePolyline } from './edit-actions/CreatePolyline'\r\nimport { CreatePolycloud } from './edit-actions/CreatePolycloud'\r\nimport { CreateHighlight } from './edit-actions/CreateHighlight'\r\nimport { CreateDimension } from './edit-actions/CreateDimension'\r\nimport { DomElementStyle } from './DomElementStyle'\r\n\r\n\r\n    var av = Autodesk.Viewing;\r\n    var avp = Autodesk.Viewing.Private;\r\n\r\n    const _gWindow = av.getGlobal();\r\n    const _gDocument = _gWindow.document;\r\n\r\n    // Change these constants to alter the default sizes in pixels of strokes and fonts.\r\n    export var MARKUP_DEFAULT_STROKE_WIDTH_IN_PIXELS = 1;\r\n    export var MARKUP_DEFAULT_FONT_WIDTH_IN_PIXELS = 10;\r\n    export var MARKUP_DEFAULT_HITAREAS_MARGIN_IN_PIXELS = 15;\r\n    export var EDIT_FRAME_DEFAULT_MARGIN = 7;\r\n\r\n    /**\r\n     * // isTouchDevice is an LMV function. Hammer is included by LMV as well\r\n     * @returns {boolean}\r\n     */\r\n    export var isTouchDevice = function() {\r\n        // isTouchDevice() is an LMV function.\r\n        // Hammer (a touch detection lib) is packaged with LMV as well\r\n        if (av.isTouchDevice && typeof Hammer === \"function\") {\r\n            return av.isTouchDevice();\r\n        }\r\n        return false;\r\n    };\r\n\r\n    //// SVG  //////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n    /**\r\n     *\r\n     * @param type\r\n     * @returns {Element}\r\n     */\r\n    export var createSvgElement = function(type) {\r\n\r\n        const _document = (this && this.getDocument && this.getDocument()) || _gDocument;\r\n        // See https://developer.mozilla.org/en-US/docs/Web/API/Document/createElementNS\r\n        var namespace = 'http://www.w3.org/2000/svg';\r\n        return  _document.createElementNS(namespace, type);\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param {Element} svg - an SVGElement\r\n     * @returns {Element} svg param is returned back\r\n     */\r\n    export var setSvgParentAttributes = function(svg) {\r\n\r\n        // See: https://developer.mozilla.org/en-US/docs/Web/SVG/Namespaces_Crash_Course\r\n        svg.setAttribute('version', '1.1'); // Notice that this is the SVG version, not the \"MARKUP DATA VERSION\"!\r\n        svg.setAttribute('baseProfile', 'full');\r\n        svg.setAttribute('layer-order-id', 'markups-svg');\r\n        return svg;\r\n    };\r\n\r\n    export var createMarkupGroupSvg = function(children) {\r\n        children = children || [];\r\n        var svg = createSvgElement('g');\r\n        svg.setAttribute('cursor', 'default');\r\n        svg.setAttribute('pointer-events', 'none');\r\n\r\n        for (var i = 0; i < children.length; i++) {\r\n            svg.appendChild(children[i]);\r\n        }\r\n\r\n        return svg;\r\n    };\r\n\r\n    export var createMarkupPathSvg = function() {\r\n\r\n        var svg = createSvgElement('g');\r\n        svg.setAttribute('cursor', 'inherit');\r\n        svg.setAttribute('pointer-events', 'none');\r\n\r\n        var markup = createSvgElement('path');\r\n        markup.setAttribute('id', 'markup');\r\n\r\n        var hitarea = createSvgElement('path');\r\n        hitarea.setAttribute('id', 'hitarea');\r\n        hitarea.setAttribute('fill', 'transparent');\r\n        hitarea.setAttribute('stroke', 'transparent');\r\n\r\n        svg.markup = markup;\r\n        svg.hitarea = hitarea;\r\n\r\n        svg.appendChild(markup);\r\n        svg.appendChild(hitarea);\r\n\r\n        return svg;\r\n    };\r\n\r\n    export var setAttributeToMarkupSvg = function(svg, attribute, value) {\r\n\r\n        svg.markup.setAttribute(attribute, value);\r\n    };\r\n\r\n    export var updateMarkupPathSvgHitarea = function(svg, editor) {\r\n\r\n        var markup = svg.markup;\r\n        var hitarea = svg.hitarea;\r\n\r\n        var hitareaMargin = editor.sizeFromClientToMarkups(0, MARKUP_DEFAULT_HITAREAS_MARGIN_IN_PIXELS).y;\r\n        hitareaMargin += parseFloat(markup.getAttribute('stroke-width')) + hitareaMargin;\r\n\r\n        var markupFill = markup.getAttribute('fill');\r\n        var markupStroke = markup.getAttribute('stroke');\r\n        var strokeEnabled = markupStroke !== '' && markupStroke !== 'none';\r\n        var fillEnabled = markupFill !== '' && markupFill !== 'none';\r\n\r\n        hitarea.setAttribute('d', markup.getAttribute('d'));\r\n        hitarea.setAttribute('stroke-width', hitareaMargin);\r\n        hitarea.setAttribute('transform', markup.getAttribute('transform'));\r\n\r\n        if (editor.duringEditMode && !editor.navigating) {\r\n            if (strokeEnabled && fillEnabled) {\r\n                svg.setAttribute('pointer-events', 'painted');\r\n                return;\r\n            }\r\n\r\n            if (strokeEnabled) {\r\n                svg.setAttribute('pointer-events', 'stroke');\r\n                return;\r\n            }\r\n\r\n            if (fillEnabled) {\r\n                svg.setAttribute('pointer-events', 'fill');\r\n                return;\r\n            }\r\n        }\r\n\r\n        svg.setAttribute('pointer-events', 'none');\r\n    };\r\n    \r\n    export var createMarkupTextSvg = function() {\r\n\r\n        var svg = createSvgElement('g');\r\n        svg.setAttribute('cursor', 'default');\r\n\r\n        var clipperId = 'markup-clipper-' + getUniqueID();\r\n        var clipperUrl = 'url(#' + clipperId + ')';\r\n\r\n        var clipper = createSvgElement('clipPath');\r\n        clipper.setAttribute('id', clipperId);\r\n        clipper.removeAttribute('pointer-events');\r\n        clipper.rect = createSvgElement('rect');\r\n        clipper.appendChild(clipper.rect);\r\n\r\n        var background = createSvgElement('rect');\r\n        background.setAttribute('id', 'markup-background');\r\n        background.removeAttribute('pointer-events');\r\n\r\n        var markup = createSvgElement('text');\r\n        markup.setAttribute('id', 'markup');\r\n\r\n        var hitarea = createSvgElement('rect');\r\n        hitarea.setAttribute('id', 'hitarea');\r\n        hitarea.setAttribute('fill', 'transparent');\r\n        hitarea.setAttribute('stroke', 'none');\r\n        hitarea.setAttribute('stroke-width', '0');\r\n\r\n        var clippedArea = createSvgElement('g');\r\n        clippedArea.setAttribute('clip-path', clipperUrl);\r\n        clippedArea.appendChild(clipper);\r\n        clippedArea.appendChild(background);\r\n        clippedArea.appendChild(markup);\r\n\r\n        svg.appendChild(clippedArea);\r\n        svg.appendChild(hitarea);\r\n\r\n        svg.clipper = clipper;\r\n        svg.background = background;\r\n        svg.markup = markup;\r\n        svg.hitarea = hitarea;\r\n\r\n        return svg;\r\n    };\r\n\r\n    export var setMarkupTextSvgTransform = function(svg, transform, textTransform) {\r\n\r\n        svg.clipper.rect.setAttribute('transform', transform);\r\n        svg.background.setAttribute('transform', transform);\r\n        svg.markup.setAttribute('transform', textTransform);\r\n        svg.hitarea.setAttribute('transform', transform);\r\n    };\r\n\r\n    export var updateMarkupTextSvgHitarea = function(svg, w, h, editor) {\r\n\r\n        var hitarea = svg.hitarea;\r\n        var hitareaMargin = editor.sizeFromClientToMarkups(0, MARKUP_DEFAULT_HITAREAS_MARGIN_IN_PIXELS).y;\r\n\r\n        hitarea.setAttribute('x', -hitareaMargin);\r\n        hitarea.setAttribute('y', -hitareaMargin);\r\n        hitarea.setAttribute('width', w + hitareaMargin * 2);\r\n        hitarea.setAttribute('height', h + hitareaMargin * 2);\r\n        svg.setAttribute(\"pointer-events\", editor.navigating ? \"none\" : \"painted\");\r\n    };\r\n\r\n    export var updateMarkupTextSvgBackground = function(svg, w, h, color) {\r\n\r\n        var background = svg.background;\r\n\r\n        background.setAttribute('x', 0);\r\n        background.setAttribute('y', 0);\r\n        background.setAttribute('width', w);\r\n        background.setAttribute('height', h);\r\n        background.setAttribute('fill', color);\r\n    };\r\n\r\n    export var updateMarkupTextSvgClipper = function(svg, w, h) {\r\n\r\n        var clipper = svg.clipper;\r\n\r\n        clipper.rect.setAttribute('x', 0);\r\n        clipper.rect.setAttribute('y', 0);\r\n        clipper.rect.setAttribute('width', w);\r\n        clipper.rect.setAttribute('height', h);\r\n    };\r\n\r\n    /**\r\n     * Helper function that injects metadata for the whole Markup document.\r\n     * Metadata includes: version.\r\n     * @param {Element} svg - an SVGElement\r\n     * @param {Object} metadata - Dictionary with attributes\r\n     */\r\n    export var addSvgMetadata = function(svg ,metadata) {\r\n\r\n        const _document = (this && this.getDocument && this.getDocument()) || _gDocument;\r\n\r\n        var metadataNode = _document.createElementNS('http://www.w3.org/2000/svg', 'metadata');\r\n        var dataVersionNode = _document.createElement('markup_document');\r\n\r\n        metadataNode.appendChild(dataVersionNode);\r\n\r\n        // NOTE: We could iterate over the properties, but we don't because these are the only ones supported\r\n        dataVersionNode.setAttribute(\"data-model-version\", metadata[\"data-model-version\"]); // Version. For example: \"1\"\r\n\r\n        svg.insertBefore(metadataNode, svg.firstChild);\r\n        return metadataNode;\r\n    };\r\n\r\n    /**\r\n     * Helper function that injects metadata for specific markup svg nodes.\r\n     * @param {Element} markupNode - an SVGElement for the markup\r\n     * @param {Object} metadata - Dictionary where all key/value pairs are added as metadata entries.\r\n     * @returns {Element}\r\n     */\r\n    export var addMarkupMetadata = function(markupNode, metadata) {\r\n\r\n        const _document = (this && this.getDocument && this.getDocument()) || _gDocument;\r\n\r\n        var metadataNode = _document.createElementNS('http://www.w3.org/2000/svg', 'metadata');\r\n        var dataVersionNode = _document.createElement('markup_element');\r\n\r\n        metadataNode.appendChild(dataVersionNode);\r\n        for (var key in metadata) {\r\n            if (metadata.hasOwnProperty(key)) {\r\n                dataVersionNode.setAttribute(key, metadata[key]);\r\n            }\r\n        }\r\n\r\n        markupNode.insertBefore(metadataNode, markupNode.firstChild);\r\n        return metadataNode;\r\n    };\r\n\r\n    /**\r\n     * Removes al metadata nodes from an Svg node structure.\r\n     * Method will remove all metadata nodes from children nodes as well.\r\n     * @param svgNode\r\n     */\r\n    export var removeAllMetadata = function(svgNode) {\r\n\r\n        if (svgNode.getElementsByTagName) {\r\n            var nodes = svgNode.getElementsByTagName(\"metadata\");\r\n            for (var i=0; i<nodes.length; ++i) {\r\n                var metadataNode = nodes[i];\r\n                metadataNode.parentNode && metadataNode.parentNode.removeChild(metadataNode);\r\n            }\r\n        }\r\n\r\n        // Transverse children nodes\r\n        var svgChildren = svgNode.children || svgNode.childNodes;\r\n        if (svgChildren) {\r\n            for (i=0; i<svgChildren.length; ++i) {\r\n                removeAllMetadata(svgChildren[i]);\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Utility function that transfers children from an Html/Svg node into another one.\r\n     * @param nodeFrom - The node instance from where children will be taken.\r\n     * @param nodeInto - The node that's going to parent the transferred children.\r\n     */\r\n    export var transferChildNodes = function(nodeFrom, nodeInto) {\r\n\r\n        var svgChildren = nodeFrom.children || nodeFrom.childNodes;\r\n        var tmpArray = [];\r\n        for (var i=0; i<svgChildren.length; ++i){\r\n            tmpArray.push(svgChildren[i]); // Avoid appendChild\r\n        }\r\n        tmpArray.forEach(function(node){\r\n            nodeInto.appendChild(node);\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Generate a unique id.\r\n     * @returns {string}\r\n     */\r\n    export var getUniqueID = function() {\r\n        return THREE.Math.generateUUID();\r\n    };\r\n\r\n\r\n    /**\r\n     * Serializes an SVG node into a String.\r\n     * @param domNode\r\n     * @returns {string}\r\n     */\r\n    export var svgNodeToString = function(domNode){\r\n\r\n        function removeHitareas(svg, hitareas) {\r\n\r\n            var hitarea = svg.hitarea;\r\n            var hitareaParent = hitarea && hitarea.parentNode;\r\n\r\n            if (hitareaParent) {\r\n\r\n                hitareas.push({hitarea: hitarea, parent: hitareaParent});\r\n                hitareaParent.removeChild(hitarea);\r\n            }\r\n\r\n            var children = svg.childNodes;\r\n            var childrenCount = children.length;\r\n\r\n            for(var i = 0; i < childrenCount; ++i) {\r\n                removeHitareas(children.item(i), hitareas);\r\n            }\r\n        }\r\n\r\n        function addHitareas(hitareas) {\r\n\r\n            var hitareasCount = hitareas.length;\r\n            for(var i = 0; i < hitareasCount; ++i) {\r\n\r\n                var hitarea = hitareas[i];\r\n                hitarea.parent.appendChild(hitarea.hitarea);\r\n            }\r\n        }\r\n\r\n        var result;\r\n        try {\r\n            var hitareas = [];\r\n            removeHitareas(domNode, hitareas);\r\n\r\n            var xmlSerializer = new XMLSerializer();\r\n            result = xmlSerializer.serializeToString(domNode);\r\n\r\n            addHitareas(hitareas);\r\n\r\n        } catch (err) {\r\n            result = '';\r\n            console.warn('svgNodeToString failed to generate string representation of domNode.');\r\n        }\r\n        return result;\r\n    };\r\n\r\n    export var stringToSvgNode = function(stringNode){\r\n\r\n        var node = null;\r\n        try {\r\n            var domParser = new DOMParser();\r\n            var doc = domParser.parseFromString(stringNode, \"text/xml\");\r\n            node = doc.firstChild; // We should only be getting 1 child anyway.\r\n        } catch (err) {\r\n            node = null;\r\n            console.warn('stringToSvgNode failed to generate an HTMLElement from its string representation.');\r\n        }\r\n        return node;\r\n    };\r\n\r\n    /**\r\n     * Injects functions and members to a client object which will\r\n     * receive the ability to dispatch events.\r\n     * Mechanism is the same as in Autodesk.Viewing.Viewer.\r\n     *\r\n     * Note: All of the code here comes from Autodesk.Viewing.Viewer\r\n     *\r\n     * @param {Object} client - Object that will become an event dispatcher.\r\n     */\r\n    export var addTraitEventDispatcher = function(client) {\r\n\r\n        // Inject member variable\r\n        client.listeners = {};\r\n\r\n        // Inject functions\r\n        client.addEventListener = function(type, listener) {\r\n            if (typeof this.listeners[type] == \"undefined\"){\r\n                this.listeners[type] = [];\r\n            }\r\n            this.listeners[type].push(listener);\r\n        };\r\n        client.hasEventListener = function (type, listener) {\r\n            if (this.listeners === undefined) return false;\r\n            var listeners = this.listeners;\r\n            if (listeners[ type ] !== undefined && listeners[ type ].indexOf(listener) !== -1) {\r\n                return true;\r\n            }\r\n            return false;\r\n        };\r\n        client.removeEventListener = function(type, listener) {\r\n            if (this.listeners[type] instanceof Array){\r\n                var li = this.listeners[type];\r\n                for (var i=0, len=li.length; i < len; i++){\r\n                    if (li[i] === listener){\r\n                        li.splice(i, 1);\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        };\r\n        client.dispatchEvent = function(event) {\r\n            if (typeof event == \"string\"){\r\n                event = { type: event };\r\n            }\r\n            if (!event.target){\r\n                event.target = this;\r\n            }\r\n\r\n            if (!event.type){\r\n                throw new Error(\"event type unknown.\");\r\n            }\r\n\r\n            if (this.listeners[event.type] instanceof Array) {\r\n                var typeListeners = this.listeners[event.type].slice();\r\n                for (var i=0; i < typeListeners.length; i++) {\r\n                    typeListeners[i].call(this, event);\r\n                }\r\n            }\r\n        };\r\n    };\r\n\r\n    /**\r\n     * Removes the EventDispatcher trait\r\n     *\r\n     * @param {Object} client\r\n     */\r\n    export var removeTraitEventDispatcher = function(client) {\r\n\r\n        try {\r\n            delete client.listeners;\r\n            delete client.addEventListener;\r\n            delete client.hasEventListener;\r\n            delete client.removeEventListener;\r\n            delete client.dispatchEvent;\r\n        } catch (e) {\r\n            // nothing\r\n        }\r\n    };\r\n\r\n    //// Math  /////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n    /**\r\n     * Calculates the pixel position in client space coordinates of a point in world space.\r\n     * @param {THREE.Vector3} point Point in world space coordinates.\r\n     * @param viewer\r\n     * @param snap Round values to closest pixel center.\r\n     * @returns {THREE.Vector3} Point transformed and projected into client space coordinates.\r\n     */\r\n    export var worldToClient = function(point, viewer, snap) {\r\n\r\n        var p = worldToViewport(point, viewer);\r\n        var result = viewportToClient(p.x, p.y, viewer);\r\n        result.z = 0;\r\n\r\n        // snap to the center of the\r\n        if (snap) {\r\n            result.x = Math.floor(result.x) + 0.5;\r\n            result.y = Math.floor(result.y) + 0.5;\r\n        }\r\n\r\n        return result;\r\n    };\r\n\r\n    export var clientToWorld = function(clientX, clientY, depth, viewer) {\r\n\r\n        var point = clientToViewport(clientX, clientY, viewer);\r\n        point.z = depth;\r\n\r\n        point.unproject(viewer.impl.camera);\r\n        return point;\r\n    };\r\n\r\n    export var clientToViewport = function(clientX, clientY, viewer) {\r\n\r\n        return viewer.impl.clientToViewport(clientX, clientY);\r\n    };\r\n\r\n    export var viewportToClient = function(viewportX, viewportY, viewer) {\r\n\r\n        return viewer.impl.viewportToClient(viewportX, viewportY);\r\n    };\r\n\r\n    /**\r\n     * Calculates the world position of a point in client space coordinates.\r\n     * @param {Object} point - { x:Number, y:Number, z:Number }\r\n     * @param {Object} viewer - LMV instance\r\n     * @returns {THREE.Vector3}\r\n     */\r\n    export var worldToViewport = function(point, viewer) {\r\n\r\n        var p = new THREE.Vector3();\r\n\r\n        p.x = point.x;\r\n        p.y = point.y;\r\n        p.z = point.z;\r\n\r\n        p.project(viewer.impl.camera);\r\n        return p;\r\n    };\r\n\r\n    export var metersToModel = function(meters, viewer) {\r\n\r\n        var modelToMeter = viewer.model.getUnitScale();\r\n        var meterToModel = 1 / modelToMeter;\r\n\r\n        return meterToModel * meters;\r\n    };\r\n\r\n    export var radiansToDegrees = function (radians) {\r\n\r\n        return radians * (180 / Math.PI);\r\n    };\r\n\r\n    export var degreesToRadians = function(degrees) {\r\n\r\n        return degrees * (Math.PI / 180);\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param value\r\n     * @returns {number}\r\n     */\r\n    export var sign = function (value) {\r\n\r\n        return (value >= 0) ? 1 : -1;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param pointA\r\n     * @param pointB\r\n     * @param range\r\n     * @param editor\r\n     * @returns {boolean}\r\n     */\r\n    export var areMarkupsPointsInClientRange = function(pointA, pointB, range, editor){\r\n\r\n        range = editor.sizeFromClientToMarkups(0, range).y;\r\n\r\n        var dx = pointA.x - pointB.x;\r\n        var dy = pointA.y - pointB.y;\r\n\r\n        return range * range >= dx * dx + dy * dy;\r\n    };\r\n\r\n    //// LMV ui ////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n    export var hideLmvUi = function(viewer) {\r\n\r\n        // If the viewer is no gui, then there is nothing to hide\r\n        if(!viewer.toolbar) {\r\n            return;\r\n        }\r\n\r\n        // Exit other tools and hide HudMessages.\r\n        viewer.setActiveNavigationTool();\r\n\r\n        dismissLmvHudMessage();\r\n        hideLmvPanels(true, viewer);\r\n        hideLmvToolsAndPanels(viewer);\r\n    };\r\n\r\n    export var restoreLmvUi = function(viewer) {\r\n\r\n        // If the viewer is no gui, then there is nothing to hide\r\n        if(!viewer.toolbar) {\r\n            return;\r\n        }\r\n\r\n        dismissLmvHudMessage();\r\n        hideLmvPanels(false, viewer);\r\n        showLmvToolsAndPanels(viewer);\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param hide\r\n     * @param viewer\r\n     */\r\n    export var hideLmvPanels = function(hide, viewer) {\r\n\r\n        var dockingPanels = viewer.dockingPanels;\r\n\r\n        // Panels may not be present when dealing with an instance of Viewer3D.js\r\n        // (as opposed to an instance of GuiViewer3D.js)\r\n        if (!dockingPanels) return;\r\n\r\n        for (var i = 0; i < dockingPanels.length; ++i) {\r\n\r\n            var panel = dockingPanels[i];\r\n            var panelContainer = panel.container;\r\n\r\n            if (panelContainer.classList.contains(\"dockingPanelVisible\")) {\r\n                panelContainer.style.display = hide ? \"none\" : \"block\";\r\n\r\n                // Call the visibility changed notification if any additional\r\n                // stuff needs to be done (update the date i.e. PropertyPanel, etc).\r\n                panel.visibilityChanged();\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Shows panels and tools in the viewer.\r\n     * @param viewer\r\n     */\r\n    export var showLmvToolsAndPanels = function(viewer) {\r\n\r\n        // Restore view cube.\r\n        if(viewer && viewer.model && !viewer.model.is2d()) {\r\n            viewer.getExtension(\"Autodesk.ViewCubeUi\", function(ext) {\r\n                ext.displayViewCube(true, false);\r\n                ext.displayHomeButton(true);\r\n            }); \r\n        }\r\n\r\n        // TODO: Find or ask for a better way to restore this buttons.\r\n        const _document = viewer.getDocument();\r\n        var anim = _document.getElementsByClassName('toolbar-animation-subtoolbar');\r\n\r\n        if (anim.length > 0) {\r\n            anim[0].style.display = '';\r\n        }\r\n\r\n        // toolbar is absent when dealing with an instance of Viewer3D (instead of GuiViewer3D)\r\n        if (viewer.toolbar) {\r\n            var viewerContainer = viewer.toolbar.container;\r\n            var viewerContainerChildrenCount = viewerContainer.children.length;\r\n            for(var i = 0; i < viewerContainerChildrenCount; ++i) {\r\n                viewerContainer.children[i].style.display = \"\";\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Hides panels and tools in the viewer.\r\n     * @param viewer\r\n     */\r\n    export var hideLmvToolsAndPanels = function(viewer) {\r\n\r\n        // Hide Panels and tools.\r\n        if (viewer && viewer.model && !viewer.model.is2d()) {\r\n            viewer.getExtension(\"Autodesk.ViewCubeUi\", function(ext) {\r\n                ext.displayViewCube(false, false);\r\n                ext.displayHomeButton(false);\r\n            });\r\n            \r\n        }\r\n\r\n        const _document = viewer.getDocument();\r\n        // TODO: Find or ask for a better way to hide this buttons.\r\n        var anim = _document.getElementsByClassName('toolbar-animation-subtoolbar');\r\n\r\n        if (anim.length > 0) {\r\n            anim[0].style.display = 'none';\r\n\r\n            var animator = viewer.impl.keyFrameAnimator;\r\n            if (animator && !animator.isPaused) {\r\n                animator.pauseCameraAnimations();\r\n                animator.pause();\r\n\r\n                var playButton = viewer.modelTools.getControl('toolbar-animationPlay');\r\n                if (playButton) {\r\n                    playButton.setIcon('toolbar-animation-pause-icon');\r\n                    playButton.setToolTip('Pause');\r\n                }\r\n            }\r\n        }\r\n\r\n        // toolbar is absent when dealing with an instance of Viewer3D (instead of GuiViewer3D)\r\n        if (viewer.toolbar) {\r\n            var viewerContainer = viewer.toolbar.container;\r\n            var viewerContainerChildrenCount = viewerContainer.children.length;\r\n            for(var i = 0; i < viewerContainerChildrenCount; ++i) {\r\n                viewerContainer.children[i].style.display = \"none\";\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Dismisses all LMV HudMessages\r\n     */\r\n    export var dismissLmvHudMessage = function() {\r\n\r\n        // Using try/catch block since we are accessing the Private namespace of LMV.\r\n        try {\r\n            var keepDismissing = true;\r\n            while (keepDismissing) {\r\n                keepDismissing = Autodesk.Viewing.Private.HudMessage.dismiss();\r\n            }\r\n        } catch (ignore) {\r\n            // Failing to show the message is an okay fallback scenario\r\n            console.warn(\"[CO2]Failed to dismiss LMV HudMessage\");\r\n        }\r\n    };\r\n\r\n    //// Styles ////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n    export var getStrokeWidth = function(widthInPixels, editor) {\r\n\r\n        var size = editor.sizeFromClientToMarkups(0, widthInPixels);\r\n        return size.y;\r\n    };\r\n\r\n    /**\r\n     * Creates markups from a parsed svg string child\r\n     * @param child - child of a parsed SVG string\r\n     * @param editor - MarkupsCore\r\n     * @returns {*} Markup Object\r\n     */\r\n    export var createMarkupFromSVG = function(child, editor) {\r\n        // var self = this;\r\n        if (!child.childNodes[0]) {\r\n            return null;\r\n        }\r\n\r\n        var meta = child.childNodes[0].childNodes[0] || '';\r\n\r\n        var getCurrentStyle = function(editor, metadata) {\r\n\r\n            var source = ['stroke-width', 'stroke-color', 'stroke-opacity', 'fill-color', 'fill-opacity',\r\n                'font-family', 'font-size','font-style','font-weight','stroke-linejoin'];\r\n            var style = {};\r\n            for (var i=0; i < source.length; i++) {\r\n                var value = metadata.getAttribute(source[i]);\r\n                if(value == null) {\r\n                    continue;\r\n                }\r\n                switch (source[i]) {\r\n                    case 'font-size':\r\n                    case 'stroke-width':\r\n                    case 'stroke-opacity':\r\n                    case 'fill-opacity':\r\n                        style[source[i]] = parseFloat(value);\r\n                        break;\r\n                    case 'stroke-linejoin':\r\n                        break;\r\n                    case 'font-family':\r\n                    case 'font-style':\r\n                    case 'font-weight':\r\n                    case 'stroke-color':\r\n                    case 'fill-color':\r\n                        style[source[i]] = value;\r\n                        break;\r\n                    default:\r\n                        avp.logger.warn('Style not recognized.');\r\n                        break;\r\n                }\r\n            }\r\n            return style;\r\n        };\r\n\r\n        var isClosed = function() {\r\n            var path = child.childNodes[1] || '';\r\n            var closed = false;\r\n            if (typeof path !== 'string'){\r\n                var d = path.getAttribute('d').split(' ');\r\n                if (d[d.length-1].toLowerCase() === 'z'){\r\n                    closed = true;\r\n                }\r\n            }\r\n            return closed;\r\n        };\r\n\r\n        var getLocations = function() {\r\n            var locations = [];\r\n            var locStr = meta.getAttribute('locations').split(\" \") || '';\r\n\r\n            for(var i=0; i< locStr.length; i+=2) {\r\n                var pointPair = {x:parseFloat(locStr[i]), y:parseFloat(locStr[i+1])};\r\n                locations.push( pointPair )\r\n            }\r\n            return locations;\r\n        };\r\n\r\n        var getAttributeVector = function(attribute) {\r\n            var posVec = new THREE.Vector3();\r\n            var value = meta.getAttribute(attribute) || meta.getAttribute(attribute.toLowerCase());\r\n            var strPos = value.split(\" \");\r\n            posVec.x = parseFloat(strPos[0]);\r\n            posVec.y = parseFloat(strPos[1]);\r\n            return posVec;\r\n        };\r\n\r\n        var getPosition = function() {\r\n            return getAttributeVector('position');\r\n        };\r\n\r\n        var getSize = function() {\r\n            return getAttributeVector('size');\r\n        };\r\n\r\n        var getRotation = function() {\r\n            var strRot = meta.getAttribute('rotation') || '';\r\n            return parseFloat(strRot);\r\n        };\r\n\r\n        var getText = function() {\r\n            return meta.getAttribute('text') || '';\r\n        };\r\n\r\n        var getIsFrameUsed = function() {\r\n            return !!parseInt(meta.getAttribute('isframeused'));\r\n        };\r\n\r\n        if (typeof meta !== 'string') {\r\n            // get the type of the child\r\n            var position, size, rotation, locations, tail, head, closed, text, firstAnchor, secondAnchor;\r\n            var id = editor.getId();\r\n            var style = getCurrentStyle(editor, meta);\r\n            var type = meta.getAttribute('type') || '';\r\n            var createMarkup;\r\n            switch(type) {\r\n                case MarkupType.MARKUP_TYPE_ARROW:\r\n                    tail = getAttributeVector('tail');\r\n                    head = getAttributeVector('head');\r\n                    createMarkup = new CreateArrow(editor, id, tail, head, style);\r\n                    break;\r\n\r\n                case MarkupType.MARKUP_TYPE_RECTANGLE:\r\n                    position = getPosition();\r\n                    size = getSize();\r\n                    rotation = getRotation();\r\n                    createMarkup = new CreateRectangle(editor, id, position, size, rotation, style);\r\n                    break;\r\n\r\n                case MarkupType.MARKUP_TYPE_TEXT:\r\n                    position = getPosition();\r\n                    size = getSize();\r\n                    text = getText();\r\n                    createMarkup = new CreateText(editor, id, position, size, text, style );\r\n                    break;\r\n\r\n                case MarkupType.MARKUP_TYPE_CALLOUT:\r\n                    position = getPosition();\r\n                    size = getSize();\r\n                    text = getText();\r\n                    var isFrameUsed = getIsFrameUsed();\r\n                    createMarkup = new CreateCallout(editor, id, position, size, text, style, isFrameUsed);\r\n                    break;\r\n\r\n                case MarkupType.MARKUP_TYPE_CIRCLE:\r\n                    position = getPosition();\r\n                    size = getSize();\r\n                    rotation = getRotation();\r\n                    createMarkup = new CreateCircle(editor, id, position, size, rotation, style);\r\n                    break;\r\n\r\n                case MarkupType.MARKUP_TYPE_CLOUD:\r\n                    position = getPosition();\r\n                    size = getSize();\r\n                    rotation = getRotation();\r\n                    createMarkup = new CreateCloud(editor, id, position, size, rotation, style);\r\n                    break;\r\n\r\n                case MarkupType.MARKUP_TYPE_FREEHAND:\r\n                    position = getPosition();\r\n                    size = getSize();\r\n                    rotation = getRotation();\r\n                    locations = getLocations();\r\n                    createMarkup = new CreateFreehand(editor, id, position, size, rotation, locations, style);\r\n                    break;\r\n\r\n                case MarkupType.MARKUP_TYPE_POLYLINE:\r\n                    position = getPosition();\r\n                    size = getSize();\r\n                    rotation = getRotation();\r\n                    locations = getLocations();\r\n                    closed = isClosed();\r\n                    createMarkup = new CreatePolyline(editor, id, position, size, rotation, locations, style, closed);\r\n                    break;\r\n\r\n                case MarkupType.MARKUP_TYPE_POLYCLOUD:\r\n                    position = getPosition();\r\n                    size = getSize();\r\n                    rotation = getRotation();\r\n                    locations = getLocations();\r\n                    closed = isClosed();\r\n                    createMarkup = new CreatePolycloud(editor, id, position, size, rotation, locations, style, closed);\r\n                    break;\r\n\r\n                case MarkupType.MARKUP_TYPE_HIGHLIGHT:\r\n                    position = getPosition();\r\n                    size = getSize();\r\n                    rotation = getRotation();\r\n                    locations = getLocations();\r\n                    createMarkup = new CreateHighlight(editor, id, position, size, rotation, locations, style);\r\n                    break;\r\n\r\n                case MarkupType.MARKUP_TYPE_DIMENSION:\r\n                    firstAnchor = getAttributeVector('firstAnchor');\r\n                    secondAnchor = getAttributeVector('secondAnchor');\r\n                    text = getText();\r\n                    createMarkup = new CreateDimension(editor, id, firstAnchor, secondAnchor, text, style);\r\n                    break;\r\n\r\n                default:\r\n                    createMarkup = null;\r\n                    break;\r\n            }\r\n            if (createMarkup){\r\n                createMarkup.addToHistory = false;\r\n                createMarkup.execute();\r\n                var markupList = editor.svgLayersMap[editor.activeLayer].markups;\r\n\r\n                for(var i = 0; i < markupList.length; ++i) {\r\n                    if (markupList[i].id === id) {\r\n                        return markupList[i];\r\n                    }\r\n                }\r\n            }\r\n            return null;\r\n        }\r\n    };\r\n    \r\n\r\n    export var composeRGBAString = function(hexRGBString, opacity) {\r\n\r\n        if(!hexRGBString || !opacity || opacity <= 0) {\r\n            return 'none';\r\n        }\r\n\r\n        return ['rgba(' +\r\n            parseInt('0x' + hexRGBString.substr(1,2)), ',',\r\n            parseInt('0x' + hexRGBString.substr(3,2)), ',',\r\n            parseInt('0x' + hexRGBString.substr(5,2)), ',', opacity, ')'].join('');\r\n    };\r\n\r\n    //// Id Target Collision ///////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n    /**\r\n     *\r\n     * @param x0\r\n     * @param y0\r\n     * @param x1\r\n     * @param y1\r\n     * @param idTarget\r\n     */\r\n    export var checkLineSegment = function(x0, y0, x1, y1, idTarget) {\r\n\r\n        const _window = (this && this.getWindow && this.getWindow()) || _gWindow;\r\n        var deviceRatio = _window.devicePixelRatio || 1;\r\n\r\n        x0 *= deviceRatio;\r\n        y0 *= deviceRatio;\r\n        x1 *= deviceRatio;\r\n        y1 *= deviceRatio;\r\n\r\n        var idTargetWidth = idTarget.width;\r\n        var idTargetHeight = idTarget.height;\r\n        var idTargetBuffer = idTarget.buffer;\r\n\r\n        x0 = Math.round(x0);\r\n        x1 = Math.round(x1);\r\n        y0 = Math.round(idTargetHeight - y0);\r\n        y1 = Math.round(idTargetHeight - y1);\r\n\r\n        function point(x, y) {\r\n\r\n            x = Math.round(x);\r\n            y = Math.round(y);\r\n\r\n            var dx = 0;\r\n            var dy = 0;\r\n\r\n            for(var j = -deviceRatio; j <= deviceRatio; j+=deviceRatio*2){\r\n                dy += check(x,y+j) ? j : 0;\r\n            }\r\n\r\n            for(var i = -deviceRatio; i <= deviceRatio; i+=deviceRatio*2){\r\n                dx += check(x+i,y) ? i : 0;\r\n            }\r\n\r\n            return {\r\n                x: Math.round(x / deviceRatio + dx),\r\n                y: Math.round((idTargetHeight - y) / deviceRatio - dy)};\r\n        }\r\n\r\n        function check(x, y) {\r\n\r\n            // Probably better to clip line at the beginning.\r\n            if (x < 0 || x >= idTargetWidth ||\r\n                y < 0 || y >= idTargetHeight) {\r\n                return false;\r\n            }\r\n\r\n            var index = (y * idTargetWidth + x) *4;\r\n            return (\r\n                idTargetBuffer[index  ] !== 0xFF ||\r\n                idTargetBuffer[index+1] !== 0xFF ||\r\n                idTargetBuffer[index+2] !== 0xFF);\r\n        }\r\n\r\n        // DDA Line algorithm\r\n        var dx = (x1 - x0);\r\n        var dy = (y1 - y0);\r\n\r\n        var m = dx !== 0 ? dy / dx : 1;\r\n        var x = x0;\r\n        var y = y0;\r\n\r\n        if (dx !== 0 && Math.abs(m) <= 1) {\r\n\r\n            if (x0 <= x1) {\r\n                for (; x <= x1; ++x, y += m) {\r\n                    if (check(x, Math.round(y))) {\r\n                        return point(x, y);\r\n                    }\r\n                }\r\n            } else {\r\n                for (; x >= x1; --x, y -= m) {\r\n                    if (check(x, Math.round(y))) {\r\n                        return point(x, y);\r\n                    }\r\n                }\r\n            }\r\n        } else {\r\n\r\n            m = dx !== 0 ? 1/m : 0;\r\n            if (y0 <= y1) {\r\n                for (; y <= y1; ++y, x += m) {\r\n                    if (check(Math.round(x), y)) {\r\n                        return point(x, y);\r\n                    }\r\n                }\r\n            } else {\r\n                for (; y >= y1; --y, x -= m) {\r\n                    if (check(Math.round(x), y)) {\r\n                        return point(x, y);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param polygon\r\n     * @param idTarget\r\n     */\r\n    export var checkPolygon = function(polygon, idTarget) {\r\n\r\n        // Return if incorrect parameters.\r\n        if(!polygon || polygon.verxtexCount < 3 || !idTarget) {\r\n            return null;\r\n        }\r\n\r\n        const _window = (this && this.getWindow && this.getWindow()) || _gWindow;\r\n        var deviceRatio = _window.devicePixelRatio || 1;\r\n\r\n        var idTargetWidth = idTarget.width;\r\n        var idTargetHeight = idTarget.height;\r\n        var idTargetBuffer = idTarget.buffer;\r\n\r\n        var vertexCount = polygon.vertexCount;\r\n        var xVertices = Float32Array.from(polygon.xVertices); // Clone to scale by device pixel ratio and to\r\n        var yVertices = Float32Array.from(polygon.yVertices); // change y coordinates to OpenGL style.\r\n\r\n        function point(x, y) {\r\n\r\n            var dx = 0;\r\n            var dy = 0;\r\n\r\n            for(var j = -deviceRatio; j <= deviceRatio; j+=deviceRatio*2){\r\n                dy += check(x,y+j) ? j : 0;\r\n            }\r\n\r\n            for(var i = -deviceRatio; i <= deviceRatio; i+=deviceRatio*2){\r\n                dx += check(x+i,y) ? i : 0;\r\n            }\r\n\r\n            return {\r\n                x: Math.round(x / deviceRatio) + dx,\r\n                y: Math.round((idTargetHeight - y) / deviceRatio - dy)};\r\n        }\r\n\r\n        function check(x, y) {\r\n\r\n            if (x < 0 || x >= idTargetWidth ||\r\n                y < 0 || y >= idTargetHeight) {\r\n                return false;\r\n            }\r\n\r\n            var index = (y * idTargetWidth + x) * 4;\r\n            return (\r\n                idTargetBuffer[index  ] !== 0xFF ||\r\n                idTargetBuffer[index+1] !== 0xFF ||\r\n                idTargetBuffer[index+2] !== 0xFF) && isInsidePolygon(x, y);\r\n        }\r\n\r\n        function isInsidePolygon(x, y) {\r\n\r\n            var result = false;\r\n            var vertexCount = polygon.vertexCount;\r\n            for(var i = 0, j = vertexCount-1; i < vertexCount; j = i++) {\r\n\r\n                if (((yVertices[i] > y) != (yVertices[j] > y)) &&\r\n                     (x < (xVertices[j] - xVertices[i]) * (y - yVertices[i]) / (yVertices[j] - yVertices[i]) + xVertices[i]) ) {\r\n                    result = !result;\r\n                }\r\n            }\r\n            return result;\r\n        }\r\n\r\n        // Change coordinates to OpenGL style and calculate polygon's bounding box.\r\n        var bbX0 = Number.POSITIVE_INFINITY;\r\n        var bbY0 = Number.POSITIVE_INFINITY;\r\n        var bbX1 = Number.NEGATIVE_INFINITY;\r\n        var bbY1 = Number.NEGATIVE_INFINITY;\r\n\r\n        for(var i = 0; i < vertexCount; ++i) {\r\n\r\n            var bbX = xVertices[i] = xVertices[i] * deviceRatio;\r\n            var bbY = yVertices[i] = idTargetHeight - yVertices[i] * deviceRatio;\r\n\r\n            bbX0 = Math.min(bbX0, bbX);\r\n            bbY0 = Math.min(bbY0, bbY);\r\n            bbX1 = Math.max(bbX1, bbX);\r\n            bbY1 = Math.max(bbY1, bbY);\r\n        }\r\n\r\n        if (bbX1 < 0 || bbX0 > idTargetWidth ||\r\n            bbY1 < 0 || bbY0 > idTargetHeight) {\r\n            return null;\r\n        }\r\n\r\n        var bbW = Math.round(bbX1 - bbX0);\r\n        var bbH = Math.round(bbY1 - bbY0);\r\n\r\n        var bbCenterX = Math.round((bbX0 + bbX1)*0.5);\r\n        var bbCenterY = Math.round((bbY0 + bbY1)*0.5);\r\n\r\n        // Check\r\n        var x = bbCenterX;\r\n        var y = bbCenterY;\r\n\r\n        var w = 1;\r\n        var h = 1;\r\n\r\n        do {\r\n\r\n            var endX = x + w;\r\n            var endY = y + h;\r\n\r\n            for(; x < endX; ++x) {\r\n                if (check(x,y)) {\r\n                    return point(x,y);\r\n                }\r\n            }\r\n\r\n            for(; y < endY; ++y) {\r\n                if (check(x,y)) {\r\n                    return point(x,y);\r\n                }\r\n            }\r\n\r\n            if (w < bbW) {\r\n                endX = x - ++w; ++w;\r\n            } else {\r\n                endX = x - w;\r\n            }\r\n\r\n            if (h < bbH) {\r\n                endY = y - ++h; ++h;\r\n            } else {\r\n                endY = y - h;\r\n            }\r\n\r\n            for(; x > endX; --x) {\r\n                if (check(x,y)) {\r\n                    return point(x,y);\r\n                }\r\n            }\r\n\r\n            for(; y > endY; --y) {\r\n                if (check(x,y)) {\r\n                    return point(x,y);\r\n                }\r\n            }\r\n        } while(w < bbW || h < bbH);\r\n     };\r\n\r\n    //// CSS ///////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n    /**\r\n     *\r\n     * @returns {*}\r\n     */\r\n    export var createStyleSheet = function() {\r\n\r\n        const _document = (this && this.getDocument && this.getDocument()) || _gDocument;\r\n        var style = _document.createElement(\"style\");\r\n\r\n        // This is WebKit hack.\r\n        style.appendChild(_document.createTextNode(\"\"));\r\n        _document.head.appendChild(style);\r\n\r\n        return style.sheet;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param styleSheet\r\n     * @param selector\r\n     * @param styles\r\n     * @param index\r\n     */\r\n    export var addRuleToStyleSheet = function(styleSheet, selector, styles, index) {\r\n\r\n        if(\"insertRule\" in styleSheet) {\r\n            styleSheet.insertRule(selector + \"{\" + styles + \"}\", index);\r\n        }\r\n        else if(\"addRule\" in styleSheet) {\r\n            styleSheet.addRule(selector, styles, index);\r\n        }\r\n    };\r\n\r\n    //// SVG ///////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n    /**\r\n     *\r\n     * @param lines\r\n     * @param style\r\n     * @param editor\r\n     */\r\n    export var measureTextLines = function(lines, style, editor) {\r\n\r\n        // Measure div style is line style with some custom layout properties.\r\n        var fontSize = editor.sizeFromMarkupsToClient(0, style['font-size']).y;\r\n\r\n        var measureStyle = new DomElementStyle()\r\n            .setAttribute('font-family', style['font-family'])\r\n            .setAttribute('font-size', fontSize + 'px')\r\n            .setAttribute('font-weight', style['font-weight'] ? 'bold' : '')\r\n            .setAttribute('font-style', style['font-style'] ? 'italic' : '')\r\n\r\n            .removeAttribute(['top', 'left', 'width', 'height', 'overflow-y'])\r\n            .setAttribute('position','absolute')\r\n            .setAttribute('white-space','nowrap')\r\n            .setAttribute('float','left')\r\n            .setAttribute('visibility','hidden')\r\n            .getStyleString();\r\n\r\n        const _document = (this && this.getDocument && this.getDocument()) || _gDocument;\r\n        // Create measure div.\r\n        var measure = _document.createElement('div');\r\n\r\n        measure.setAttribute('style', measureStyle);\r\n        editor.viewer.container.appendChild(measure);\r\n\r\n        // Measure.\r\n        var result = [];\r\n\r\n        var linesCount = lines.length;\r\n        for(var i = 0; i < linesCount; ++i) {\r\n\r\n            measure.innerText = lines[i];\r\n            result.push({\r\n                line: lines[i],\r\n                width: measure.clientWidth,\r\n                height: measure.clientHeight\r\n            });\r\n        }\r\n\r\n        // Remove measure div and return result.\r\n        editor.viewer.container.removeChild(measure);\r\n        return result;\r\n    };\r\n\r\n    export var createArcTo = function(x, y, xRadius, yRadius, relative, path) {\r\n\r\n        path.push(relative ? 'a' : 'A');\r\n        path.push(xRadius);\r\n        path.push(yRadius);\r\n        path.push(0);\r\n        path.push(1);\r\n        path.push(1);\r\n        path.push(x);\r\n        path.push(y);\r\n\r\n        return path;\r\n    };\r\n\r\n    export var createEllipsePath = function (x, y, w, h, relative, path) {\r\n\r\n        var halfW = w * 0.5;\r\n        var halfH = h * 0.5;\r\n\r\n        path.push(relative ? 'm' : 'M');\r\n        path.push(x);\r\n        path.push(y);\r\n\r\n        createArcTo(w, 0, halfW, halfH, true, path);\r\n        createArcTo(-w, 0, halfW, halfH, true, path);\r\n\r\n        path.push('z');\r\n    };\r\n\r\n    export var createRectanglePath = function (x, y, w, h, relative, path) {\r\n\r\n        path.push(relative ? 'm' : 'M');\r\n        path.push(x);\r\n        path.push(y);\r\n        path.push('l');\r\n        path.push(w);\r\n        path.push(0);\r\n        path.push('l');\r\n        path.push(0);\r\n        path.push(h);\r\n        path.push('l');\r\n        path.push(-w);\r\n        path.push(0);\r\n        path.push('z');\r\n    };\r\n\r\n    export var renderToCanvas = function(svg, viewBox, width, height, ctx, callback) {\r\n\r\n        // Creating a new svg element, that will be drawn into the canvas.\r\n        var tmpSvg = createSvgElement('svg');\r\n        \r\n        if (!av.isIE11) {\r\n            tmpSvg.setAttribute('xmlns','http://www.w3.org/2000/svg');    \r\n        }\r\n\r\n        tmpSvg.setAttribute('width',width);\r\n        tmpSvg.setAttribute('height',height);\r\n        tmpSvg.setAttribute('viewBox',viewBox);\r\n        tmpSvg.setAttribute('transform', 'scale(1,-1)');\r\n        \r\n        var markupGroup = svg.parentNode.cloneNode(true);\r\n\r\n        // Adding the markup itself to the temp SVG\r\n        tmpSvg.appendChild(markupGroup);\r\n        \r\n        const _window = (this && this.getWindow && this.getWindow()) || _gWindow;\r\n        const _document = (this && this.getDocument && this.getDocument()) || _gDocument;\r\n        // Get the SVG as string\r\n        var temp = _document.createElement('div');\r\n        var node = tmpSvg.cloneNode(true);\r\n        temp.appendChild(node);\r\n        var data = temp.innerHTML;\r\n        \r\n        tmpSvg = temp = node = null;\r\n\r\n        var renderWithCanvg = function() {\r\n            canvg(ctx.canvas, data, {ignoreMouse: true, ignoreDimensions: true, ignoreClear: true, renderCallback: callback});\r\n        };\r\n\r\n        // IE11 blocks 'tainted' canvas for security reasons. canvg is a library that solves that issue, and draws on the canvas without tainting it.\r\n        if (av.isIE11) {\r\n            renderWithCanvg();\r\n        }\r\n        else {\r\n            var img = new Image();\r\n\r\n            img.onload = function() {\r\n                ctx.drawImage(img, 0, 0);\r\n                callback();\r\n            };\r\n\r\n            img.onerror = function() {\r\n                renderWithCanvg();\r\n            };\r\n\r\n            img.src = 'data:image/svg+xml;base64,' + _window.btoa(unescape( encodeURIComponent( data )));\r\n        }\r\n    };\r\n\r\n    /*\r\n     Taken from Simplify.js, a high-performance JS polyline simplification library\r\n     (c) 2013, Vladimir Agafonkin\r\n     mourner.github.io/simplify-js\r\n    */\r\n   export var simplify = function(points, tolerance, highestQuality) {\r\n\r\n        if (points.length <= 2) return points;\r\n\r\n        // square distance between 2 points\r\n        function getSqDist(p1, p2) {\r\n\r\n            var dx = p1.x - p2.x,\r\n                dy = p1.y - p2.y;\r\n\r\n            return dx * dx + dy * dy;\r\n        }\r\n\r\n        // square distance from a point to a segment\r\n        function getSqSegDist(p, p1, p2) {\r\n\r\n            var x = p1.x,\r\n                y = p1.y,\r\n                dx = p2.x - x,\r\n                dy = p2.y - y;\r\n\r\n            if (dx !== 0 || dy !== 0) {\r\n\r\n                var t = ((p.x - x) * dx + (p.y - y) * dy) / (dx * dx + dy * dy);\r\n\r\n                if (t > 1) {\r\n                    x = p2.x;\r\n                    y = p2.y;\r\n\r\n                } else if (t > 0) {\r\n                    x += dx * t;\r\n                    y += dy * t;\r\n                }\r\n            }\r\n\r\n            dx = p.x - x;\r\n            dy = p.y - y;\r\n\r\n            return dx * dx + dy * dy;\r\n        }\r\n        // rest of the code doesn't care about point format\r\n\r\n        // basic distance-based simplification\r\n        function simplifyRadialDist(points, sqTolerance) {\r\n\r\n            var prevPoint = points[0],\r\n                newPoints = [prevPoint],\r\n                point;\r\n\r\n            for (var i = 1, len = points.length; i < len; i++) {\r\n                point = points[i];\r\n\r\n                if (getSqDist(point, prevPoint) > sqTolerance) {\r\n                    newPoints.push(point);\r\n                    prevPoint = point;\r\n                }\r\n            }\r\n\r\n            if (prevPoint !== point) newPoints.push(point);\r\n\r\n            return newPoints;\r\n        }\r\n\r\n        function simplifyDPStep(points, first, last, sqTolerance, simplified) {\r\n            var maxSqDist = sqTolerance,\r\n                index;\r\n\r\n            for (var i = first + 1; i < last; i++) {\r\n                var sqDist = getSqSegDist(points[i], points[first], points[last]);\r\n\r\n                if (sqDist > maxSqDist) {\r\n                    index = i;\r\n                    maxSqDist = sqDist;\r\n                }\r\n            }\r\n\r\n            if (maxSqDist > sqTolerance) {\r\n                if (index - first > 1) simplifyDPStep(points, first, index, sqTolerance, simplified);\r\n                simplified.push(points[index]);\r\n                if (last - index > 1) simplifyDPStep(points, index, last, sqTolerance, simplified);\r\n            }\r\n        }\r\n\r\n        // simplification using Ramer-Douglas-Peucker algorithm\r\n        function simplifyDouglasPeucker(points, sqTolerance) {\r\n            var last = points.length - 1;\r\n\r\n            var simplified = [points[0]];\r\n            simplifyDPStep(points, 0, last, sqTolerance, simplified);\r\n            simplified.push(points[last]);\r\n\r\n            return simplified;\r\n        }\r\n\r\n        // both algorithms combined for awesome performance\r\n        var sqTolerance = tolerance !== undefined ? tolerance * tolerance : 1;\r\n\r\n        points = highestQuality ? points : simplifyRadialDist(points, sqTolerance);\r\n        points = simplifyDouglasPeucker(points, sqTolerance);\r\n\r\n        return points;\r\n    }\r\n\r\n","'use strict';\r\n\r\n    /**\r\n     * This class will group actions edit actions that should be executed as a whole.\r\n     * When a group is open actions can be added to it, similar actions will be merged into one during this process.\r\n     * This class is not intended to be used by users, it's a helper class of EditActionManager.\r\n     * @constructor\r\n     */\r\n    export function EditActionGroup() {\r\n\r\n        this.actions = [];\r\n        this.closed = true;\r\n    }\r\n\r\n    var proto = EditActionGroup.prototype;\r\n\r\n    /**\r\n     *\r\n     * @returns {boolean}\r\n     */\r\n    proto.open = function() {\r\n\r\n        if(!this.closed) {\r\n            return false;\r\n        }\r\n\r\n        this.closed = false;\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @returns {boolean}\r\n     */\r\n    proto.close = function() {\r\n\r\n        if (this.closed) {\r\n            return false;\r\n        }\r\n\r\n        this.closed = true;\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @returns {number} targetId\r\n     */\r\n    proto.undo = function() {\r\n\r\n        var actions = this.actions;\r\n        var actionsMaxIndex = actions.length - 1;\r\n\r\n        var targetId = -1;\r\n        for(var i = actionsMaxIndex; i >= 0; --i) {\r\n\r\n            var action =  actions[i];\r\n            action.undo();\r\n\r\n            if (action.targetId !== -1) {\r\n                targetId = action.targetId;\r\n            }\r\n        }\r\n\r\n        return targetId;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @returns {number} targetId\r\n     */\r\n    proto.redo = function() {\r\n\r\n        var actions = this.actions;\r\n        var actionsCount = actions.length;\r\n\r\n        var targetId = -1;\r\n        for(var i = 0; i < actionsCount; ++i) {\r\n\r\n            var action =  actions[i];\r\n            action.redo();\r\n\r\n            if (action.targetId !== -1) {\r\n                targetId = action.targetId;\r\n            }\r\n        }\r\n\r\n        return targetId;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @returns {boolean}\r\n     */\r\n    proto.isOpen = function() {\r\n\r\n        return !this.closed;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @returns {boolean}\r\n     */\r\n    proto.isClosed = function() {\r\n\r\n        return this.closed;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @returns {boolean}\r\n     */\r\n    proto.isEmpty = function() {\r\n\r\n        return this.actions.length === 0;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param {EditAction} action\r\n     */\r\n    proto.addAction = function(action) {\r\n\r\n        if (this.closed) {\r\n            return false;\r\n        }\r\n\r\n        this.actions.push(action);\r\n        this.compact();\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    proto.compact = function() {\r\n\r\n        var actions = this.actions;\r\n        var actionsCount = actions.length;\r\n\r\n        for(var i = 0; i < actionsCount; ++i) {\r\n\r\n            // If an action does nothing, remove it.\r\n            var actionA = actions[i];\r\n            if (actionA.isIdentity()) {\r\n                actions.splice(i, 1);\r\n                --actionsCount;\r\n                --i;\r\n                continue;\r\n            }\r\n\r\n            // If an action can be merged, merge it.\r\n            for (var j = i + 1; j < actionsCount; ++j) {\r\n\r\n                var actionB = actions[j];\r\n                if (actionA.type === actionB.type &&\r\n                    actionA.merge(actionB)) {\r\n                    actions.splice(j, 1);\r\n                    --actionsCount;\r\n                    --i;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    proto.getTargetId = function() {\r\n      var actions = this.actions;\r\n      var actionsCount = actions.length;\r\n      var targetId = -1;\r\n      for(var i = 0; i < actionsCount; ++i) {\r\n        var action =  actions[i];\r\n        if (action.targetId !== -1) {\r\n          targetId = action.targetId;\r\n        }\r\n      }\r\n      return targetId;\r\n    }","'use strict';\r\n\r\nimport { addTraitEventDispatcher } from '../MarkupsCoreUtils'\r\nimport * as MarkupEvents from '../MarkupEvents'\r\nimport { EditActionGroup } from './EditActionGroup'\r\n\r\n    /**\r\n     *\r\n     * @param historySize\r\n     * @constructor\r\n     */\r\n    export function EditActionManager(historySize) {\r\n\r\n        this.historySize = historySize;\r\n\r\n        this.undoStack = [];\r\n        this.redoStack = [];\r\n\r\n        addTraitEventDispatcher(this);\r\n    }\r\n\r\n    var proto = EditActionManager.prototype;\r\n\r\n    /**\r\n     *\r\n     * @param action\r\n     */\r\n    proto.execute = function(action) {\r\n\r\n        var redoStack = this.redoStack;\r\n        var undoStack = this.undoStack;\r\n\r\n        redoStack.splice(0, redoStack.length);\r\n\r\n        action.redo();\r\n\r\n        var group = this.getEditActionGroup();\r\n        if (group.isOpen()) {\r\n            group.addAction(action);\r\n        } else {\r\n            group.open();\r\n            group.addAction(action);\r\n            group.close();\r\n        }\r\n\r\n        if (undoStack.length > this.historySize) {\r\n            undoStack.splice(0,1);\r\n        }\r\n\r\n        var targetId = action.selectOnExecution ? action.targetId : -1;\r\n        this.dispatchEvent(\r\n            {type: MarkupEvents.EVENT_HISTORY_CHANGED, data: {action: 'execute', targetId: targetId}});\r\n    };\r\n\r\n    proto.beginActionGroup = function() {\r\n\r\n        var undoStack = this.undoStack;\r\n        var undoStackCount = undoStack.length;\r\n        var group = null;\r\n\r\n        if (undoStackCount === 0 || undoStack[undoStackCount-1].isClosed()) {\r\n\r\n            group = this.getEditActionGroup();\r\n            group.open();\r\n        } else {\r\n            console.warn('Markups - Undo/Redo - Action edit group already open.');\r\n        }\r\n    };\r\n\r\n    proto.closeActionGroup = function() {\r\n\r\n        var undoStack = this.undoStack;\r\n        var undoStackCount = undoStack.length;\r\n\r\n        if (undoStackCount === 0) {\r\n\r\n            console.warn('Markups - Undo/Redo - There is no action edit group to close.');\r\n            return;\r\n        }\r\n\r\n        var group = undoStack[undoStackCount-1];\r\n        if(!group.close()) {\r\n            console.warn('Markups - Undo/Redo - Action edit group already closed.');\r\n        }\r\n\r\n        if (group.isEmpty()) {\r\n            undoStack.pop();\r\n        }\r\n    };\r\n\r\n    proto.cancelActionGroup = function() {\r\n\r\n        var undoStack = this.undoStack;\r\n        var undoStackCount = undoStack.length;\r\n\r\n        if (undoStackCount === 0) {\r\n\r\n            console.warn('Markups - Undo/Redo - There is no action edit group to close.');\r\n            return;\r\n        }\r\n\r\n        var group = undoStack[undoStackCount-1];\r\n        if(!group.close()) {\r\n            console.warn('Markups - Undo/Redo - Action edit group already closed.');\r\n            return;\r\n        }\r\n\r\n        group.undo();\r\n        undoStack.pop();\r\n\r\n        this.dispatchEvent(\r\n            {type: MarkupEvents.EVENT_HISTORY_CHANGED, data: {action: 'cancel', targetId: -1}});\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        var undoStack = this.undoStack;\r\n        var redoStack = this.redoStack;\r\n\r\n        if (undoStack.length === 0) {\r\n            return;\r\n        }\r\n\r\n        var group = undoStack.pop();\r\n        var targetId = group.undo();\r\n\r\n        redoStack.push(group);\r\n\r\n        this.dispatchEvent(\r\n            {type: MarkupEvents.EVENT_HISTORY_CHANGED, data: {action:'undo', targetId: targetId}});\r\n    };\r\n\r\n    proto.redo = function() {\r\n\r\n        var undoStack = this.undoStack;\r\n        var redoStack = this.redoStack;\r\n\r\n        if (redoStack.length === 0) {\r\n            return;\r\n        }\r\n\r\n        var group = redoStack.pop();\r\n        var targetId = group.redo();\r\n\r\n        undoStack.push(group);\r\n\r\n        this.dispatchEvent(\r\n            {type: MarkupEvents.EVENT_HISTORY_CHANGED, data: {action:'redo', targetId: targetId}});\r\n    };\r\n\r\n    proto.clear = function() {\r\n\r\n        this.undoStack.splice(0, this.undoStack.length);\r\n        this.redoStack.splice(0, this.redoStack.length);\r\n\r\n        this.dispatchEvent(\r\n            {type: MarkupEvents.EVENT_HISTORY_CHANGED, data: {action:'clear', targetId: -1}});\r\n    };\r\n\r\n    proto.isUndoStackEmpty = function() {\r\n\r\n        return this.undoStack.length === 0;\r\n    };\r\n\r\n    proto.isRedoStackEmpty = function() {\r\n\r\n        return this.redoStack.length === 0;\r\n    };\r\n\r\n    proto.getLastElementInUndoStack = function() {\r\n\r\n        var undoStack = this.undoStack;\r\n        var undoStackCount = undoStack.length;\r\n        return undoStack[undoStackCount-1];\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @return action\r\n     * @private\r\n     */\r\n    proto.getEditActionGroup = function() {\r\n\r\n        var undoStack = this.undoStack;\r\n        var undoStackCount = this.undoStack.length;\r\n\r\n        var group = null;\r\n\r\n        if (undoStackCount === 0 || undoStack[undoStackCount-1].isClosed()) {\r\n            group = new EditActionGroup();\r\n            undoStack.push(group);\r\n        } else {\r\n            group = undoStack[undoStackCount-1];\r\n        }\r\n\r\n        return group;\r\n    };\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param id\r\n     * @param markup\r\n     * @param position\r\n     * @constructor\r\n     */\r\n    export function CloneMarkup(editor, id, markup, position) {\r\n\r\n        EditAction.call(this, editor, 'CLONE-MARKUP', id);\r\n\r\n        this.clone = markup.clone();\r\n        this.clone.id = id;\r\n        this.position = {x: position.x, y: position.y};\r\n    }\r\n\r\n    CloneMarkup.prototype = Object.create(EditAction.prototype);\r\n    CloneMarkup.prototype.constructor = CloneMarkup;\r\n\r\n    var proto = CloneMarkup.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        var editor = this.editor;\r\n        var clone = this.clone;\r\n        var position = this.position;\r\n\r\n        if (editor.getMarkup(this.targetId)) {\r\n            return;\r\n        }\r\n\r\n        var markup = clone.clone();\r\n        markup.setPosition(position.x, position.y);\r\n\r\n        editor.addMarkup(markup);\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        var markup = this.editor.getMarkup(this.targetId);\r\n        markup && this.editor.removeMarkup(markup);\r\n    };\r\n\r\n\r\n","'use strict';\r\n\r\nimport { CloneMarkup } from '../edit-actions/CloneMarkup'\r\nimport { addTraitEventDispatcher } from '../MarkupsCoreUtils'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @constructor\r\n     */\r\n    export function Clipboard(editor) {\r\n\r\n        this.editor = editor;\r\n        this.content = null;\r\n        this.pastePosition = {x:0, y: 0};\r\n\r\n        addTraitEventDispatcher(this);\r\n    }\r\n\r\n    var proto = Clipboard.prototype;\r\n\r\n    proto.copy = function() {\r\n\r\n        var selectedMarkup = this.editor.getSelection();\r\n        if(!selectedMarkup) {\r\n            return;\r\n        }\r\n\r\n        this.content = selectedMarkup.clone();\r\n        this.pastePosition.x = selectedMarkup.position.x;\r\n        this.pastePosition.y = selectedMarkup.position.y;\r\n    };\r\n\r\n    proto.cut = function() {\r\n\r\n        var selectedMarkup = this.editor.getSelection();\r\n        if(!selectedMarkup) {\r\n            return;\r\n        }\r\n\r\n        this.copy();\r\n        this.editor.deleteMarkup(selectedMarkup);\r\n    };\r\n\r\n    proto.paste = function() {\r\n\r\n        var content = this.content;\r\n        if(!content) {\r\n            return;\r\n        }\r\n\r\n        var editor = this.editor;\r\n        var position = this.pastePosition;\r\n        var delta = editor.sizeFromClientToMarkups(20, 20);\r\n\r\n        position.x += delta.x;\r\n        position.y -= delta.y;\r\n\r\n        var cloneMarkup = new CloneMarkup(editor, editor.getId(), content, position);\r\n        cloneMarkup.execute();\r\n    };\r\n","'use strict';\r\n\r\nimport { isTouchDevice } from '../MarkupsCoreUtils'\r\n\r\n    var av = Autodesk.Viewing;\r\n    var avp = av.Private;\r\n\r\n    var _mouseEnabled = false;\r\n    var _mousePrevValue = false;\r\n    var _lock = false;\r\n\r\n    export function InputHandler() {\r\n\r\n        this.editor = null;\r\n        this.mousePosition = {x:0, y:0};\r\n        this.makeSameXY = false; // TODO: FIND a better way to name and communicate these.\r\n        this.snapRotations = false;\r\n        this.keepAspectRatio = false;\r\n        this.constrainAxis = false;\r\n        this.duringEditMode = false;\r\n\r\n        this.onWheelBinded = this.onWheel.bind(this);\r\n        this.onTouchDragBinded = this.onTouchDrag.bind(this);\r\n        this.onTouchPanBinded = this.onTouchPan.bind(this);\r\n        this.onTouchPinchBinded = this.onTouchPinch.bind(this);\r\n        this.onSingleTapBinded = this.onSingleTap.bind(this);\r\n        this.onDoubleTapBinded = this.onDoubleTap.bind(this);\r\n        this.onMouseMoveBinded = this.onMouseMove.bind(this);\r\n        this.onMouseUpBinded = this.onMouseUp.bind(this);\r\n        this.onMouseDownBinded = this.onMouseDown.bind(this);\r\n        this.onMouseDoubleClickBinded = this.onMouseDoubleClick.bind(this);\r\n        this.onHammerInputBinded = this.onHammerInput.bind(this);\r\n        this.isMouseDown = false;\r\n    }\r\n\r\n    av.GlobalManagerMixin.call(InputHandler.prototype);\r\n    var proto = InputHandler.prototype;\r\n\r\n    proto.attachTo = function(editor) {\r\n\r\n        this.editor && this.detachFrom(this.editor);\r\n        this.editor = editor;\r\n\r\n        if (isTouchDevice()) {\r\n\r\n            this.hammer = new av.Hammer.Manager(editor.svg, {\r\n                recognizers: [\r\n                    av.GestureRecognizers.drag,\r\n                    av.GestureRecognizers.doubletap,\r\n                    av.GestureRecognizers.doubletap2,\r\n                    av.GestureRecognizers.singletap,\r\n                    av.GestureRecognizers.singletap2,\r\n                    av.GestureRecognizers.press,\r\n                    av.GestureRecognizers.pan,\r\n                    av.GestureRecognizers.pinch\r\n                ],\r\n                handlePointerEventMouse: false,\r\n                inputClass: av.isIE11 ? av.Hammer.PointerEventInput : av.Hammer.TouchInput\r\n            });\r\n\r\n            this.hammer.get('doubletap2').recognizeWith('doubletap');\r\n            this.hammer.get('singletap2').recognizeWith('singletap');\r\n            this.hammer.get('singletap').requireFailure('doubletap');\r\n        }\r\n    };\r\n\r\n    proto.onHammerInput = function(event) {\r\n\r\n        this.setMouseDisabledWhenTouching(event);\r\n    };\r\n\r\n    proto.setMouseDisabledWhenTouching = function(event) {\r\n\r\n        if (event.isFirst && !_lock) {\r\n            this.enableMouseButtons(false);\r\n            _lock = true;\r\n        } else if (event.isFinal) {\r\n            var _this = this;\r\n            setTimeout(function() {\r\n                _this.enableMouseButtons(_mousePrevValue);\r\n                _lock = false;\r\n            }, 10);\r\n        }\r\n    };\r\n\r\n    proto.enableMouseButtons = function(state) {\r\n\r\n        if (state && !_mouseEnabled)\r\n        {\r\n            this.editor.svg.addEventListener('mousedown', this.onMouseDownBinded);\r\n            this.editor.svg.addEventListener('dblclick', this.onMouseDoubleClickBinded);\r\n            this.editor.svg.addEventListener('wheel', this.onWheelBinded);\r\n            this.editor.svg.addEventListener('DOMMouseScroll', this.onWheelBinded); // Firefox\r\n            this.addDocumentEventListener('mousemove', this.onMouseMoveBinded);\r\n            this.addDocumentEventListener('mouseup', this.onMouseUpBinded);\r\n        }\r\n        else if (!state && _mouseEnabled)\r\n        {\r\n            this.editor.svg.removeEventListener('mousedown', this.onMouseDownBinded);\r\n            this.editor.svg.removeEventListener('dblclick', this.onMouseDoubleClickBinded);\r\n            this.editor.svg.removeEventListener('wheel', this.onWheelBinded);\r\n            this.editor.svg.removeEventListener('DOMMouseScroll', this.onWheelBinded);\r\n            this.removeDocumentEventListener('mousemove', this.onMouseMoveBinded);\r\n            this.removeDocumentEventListener('mouseup', this.onMouseUpBinded);\r\n\r\n        }\r\n\r\n        _mousePrevValue = _mouseEnabled;\r\n        _mouseEnabled = state;\r\n    };\r\n\r\n    proto.detachFrom = function(editor) {\r\n\r\n        this.hammer && this.hammer.destroy();\r\n\r\n        this.removeDocumentEventListener('mousemove', this.onMouseMoveBinded);\r\n        this.removeDocumentEventListener('mouseup', this.onMouseUpBinded);\r\n\r\n        if (this.editor) {\r\n            this.editor.svg.removeEventListener('mousedown', this.onMouseDownBinded);\r\n            this.editor.svg.removeEventListener('dblclick', this.onMouseDoubleClickBinded);\r\n        }\r\n\r\n        this.editor = editor;\r\n    };\r\n\r\n    proto.enterEditMode = function() {\r\n        if (this.duringEditMode) {\r\n            return;\r\n        }\r\n\r\n        if (this.hammer) {\r\n            this.hammer.on('dragstart dragmove dragend', this.onTouchDragBinded);\r\n            this.hammer.on('panstart panmove panend', this.onTouchPanBinded);\r\n            this.hammer.on('pinchstart pinchmove pinchend', this.onTouchPinchBinded);\r\n            this.hammer.on('singletap', this.onSingleTapBinded);\r\n            this.hammer.on('singletap2', this.onSingleTapBinded);\r\n            this.hammer.on('doubletap', this.onDoubleTapBinded);\r\n            this.hammer.on('doubletap2', this.onDoubleTapBinded);\r\n            this.hammer.on('hammer.input', this.onHammerInputBinded);\r\n\r\n\t\t\tthis.hammer.get('drag').requireFailure('pinch');\r\n            this.hammer.get('drag').requireFailure('pan');\r\n        }\r\n\r\n        if (!av.isMobileDevice()) {\r\n            this.enableMouseButtons(true);\r\n        }\r\n\r\n        this.duringEditMode = true;\r\n    };\r\n\r\n    proto.leaveEditMode = function() {\r\n        if (!this.duringEditMode) {\r\n            return;\r\n        }\r\n\r\n        if (this.hammer) {\r\n            this.hammer.off('dragstart dragmove dragend', this.onTouchDragBinded);\r\n\t\t\tthis.hammer.off('panstart panmove panend', this.onTouchPanBinded);\r\n            this.hammer.off('pinchstart pinchmove pinchend', this.onTouchPinchBinded);\r\n            this.hammer.off('singletap', this.onSingleTapBinded);\r\n            this.hammer.off('singletap2', this.onSingleTapBinded);\r\n            this.hammer.off('doubletap', this.onDoubleTapBinded);\r\n            this.hammer.off('doubletap2', this.onDoubleTapBinded);\r\n            this.hammer.off('hammer.input', this.onHammerInputBinded);\r\n        }\r\n\r\n        if (!av.isMobileDevice()) {\r\n            this.enableMouseButtons(false);\r\n        }\r\n\r\n        this.duringEditMode = false;\r\n    };\r\n\r\n    proto.enterViewMode = function() {\r\n\r\n    };\r\n\r\n    proto.leaveViewMode = function() {\r\n\r\n    };\r\n\r\n    proto.getMousePosition = function() {\r\n\r\n        return {x: this.mousePosition.x, y: this.mousePosition.y};\r\n    };\r\n\r\n    proto.onWheel = function(event) {\r\n\r\n        if (!av.isMobileDevice()) {\r\n            this.editor.viewer.toolController.mousewheel(event);\r\n        }\r\n\r\n        event.preventDefault();\r\n    };\r\n\r\n    proto.onMouseMove = function(event) {\r\n\r\n        processMouseEvent(this, event);\r\n\r\n        if (!av.isMobileDevice()) {\r\n            this.editor.viewer.toolController.mousemove(event);\r\n        }\r\n\r\n        this.editor.onMouseMove(event);\r\n        event.preventDefault();\r\n    };\r\n\r\n\r\n    proto.onMouseDownRightClick = function(event) {\r\n\r\n        const _document = this.getDocument();\r\n        // Don't do blur in full screen (IE issue)\r\n        if (!(av.isIE11 && av.inFullscreen(_document))) {\r\n            _document.activeElement && _document.activeElement.blur && _document.activeElement.blur();\r\n        }\r\n\r\n        var controller = this.editor.viewer.toolController;\r\n        controller.__clientToCanvasCoords(event);\r\n\r\n        this.editor.markupTool.handleButtonDown(event, 2);\r\n    };\r\n\r\n    proto.onMouseUpRightClick = function(event) {\r\n\r\n        var controller = this.editor.viewer.toolController;\r\n        controller.__clientToCanvasCoords(event);\r\n\r\n        this.editor.markupTool.handleButtonUp(event, 2);\r\n    };\r\n\r\n    proto.onMouseDown = function(event) {\r\n\r\n        processMouseEvent(this, event);\r\n\r\n        // Panning when right clicking\r\n        if (!av.isMobileDevice() && (avp.isRightClick(event, this.editor.viewer.navigation) || avp.isMiddleClick(event))) {\r\n            this.onMouseDownRightClick(event);\r\n            return;\r\n        }\r\n        \r\n        this.isMouseDown = true;\r\n        this.editor.onMouseDown(event);\r\n        event.preventDefault();\r\n    };\r\n\r\n    proto.onMouseUp = function(event) {\r\n\r\n        processMouseEvent(this, event);\r\n\r\n        if (!av.isMobileDevice() && (avp.isRightClick(event, this.editor.viewer.navigation) || avp.isMiddleClick(event))) {\r\n            this.onMouseUpRightClick(event);\r\n            return;\r\n        }\r\n\r\n        this.isMouseDown = false;\r\n        this.editor.onMouseUp(event);\r\n        event.preventDefault();\r\n    };\r\n\r\n    proto.onMouseDoubleClick = function(event) {\r\n\r\n        processMouseEvent(this, event);\r\n        this.editor.onMouseDoubleClick(event);\r\n        event.preventDefault();\r\n    };\r\n\r\n    proto.onTouchDrag = function(event) {\r\n\r\n        convertEventHammerToMouse(event);\r\n        switch (event.type) {\r\n          case 'dragstart':\r\n                this.onMouseDown(event);\r\n                break;\r\n            case 'dragmove':\r\n                this.onMouseMove(event);\r\n                break;\r\n           case 'dragend':\r\n                this.onMouseUp(event);\r\n                break;\r\n        }\r\n        event.preventDefault();\r\n    };\r\n\r\n    proto.onTouchPan = function(event) {\r\n\r\n        var gestureHandler = this.editor.viewer.toolController.getTool(\"gestures\");\r\n        gestureHandler.distributeGesture(event);\r\n        event.preventDefault();\r\n    };\r\n\r\n    proto.onTouchPinch = function(event) {\r\n\r\n        processMouseEvent(this, event);\r\n\r\n        var gestureHandler = this.editor.viewer.toolController.getTool(\"gestures\");\r\n        gestureHandler.distributeGesture(event);\r\n        \r\n        this.mousePosition.x = this.mousePosition.y = null;\r\n        this.editor.callSnapperMouseMove();\r\n\r\n        event.preventDefault();\r\n    };\r\n\r\n    proto.onSingleTap = function(event) {\r\n\r\n        convertEventHammerToMouse(event);\r\n\r\n        this.onMouseDown(event);\r\n        this.onMouseUp(event);\r\n        event.preventDefault();\r\n    };\r\n\r\n    proto.onDoubleTap = function(event) {\r\n\r\n        convertEventHammerToMouse(event);\r\n        this.onMouseDoubleClick(event);\r\n        event.preventDefault();\r\n    };\r\n\r\n    function processMouseEvent(input, event) {\r\n\r\n        var rect = input.editor.svg.getBoundingClientRect();\r\n\r\n        input.makeSameXY = event.shiftKey;\r\n        input.snapRotations = event.shiftKey;\r\n        input.keepAspectRatio = event.shiftKey;\r\n        input.constrainAxis = event.shiftKey;\r\n\r\n        input.mousePosition.x = event.clientX - rect.left;\r\n        input.mousePosition.y = event.clientY - rect.top;\r\n    }\r\n\r\n    function convertEventHammerToMouse(event) {\r\n\r\n        // Convert Hammer touch-event X,Y into mouse-event X,Y.\r\n        event.shiftKey = false;\r\n        event.clientX = event.pointers[0].clientX;\r\n        event.clientY = event.pointers[0].clientY;\r\n    }\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\n\r\n    export function SetPosition(editor, markup, position) {\r\n\r\n        EditAction.call(this, editor, 'SET-POSITION', markup.id);\r\n\r\n        this.newPosition = {x: position.x, y: position.y};\r\n        this.oldPosition = {x: markup.position.x, y: markup.position.y};\r\n    }\r\n\r\n    SetPosition.prototype = Object.create(EditAction.prototype);\r\n    SetPosition.prototype.constructor = SetPosition;\r\n\r\n    var proto = SetPosition.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        var markup = this.editor.getMarkup(this.targetId);\r\n        markup && markup.setPosition(this.newPosition.x, this.newPosition.y);\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        var markup = this.editor.getMarkup(this.targetId);\r\n        markup && markup.setPosition(this.oldPosition.x, this.oldPosition.y);\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param action\r\n     * @returns {boolean}\r\n     */\r\n    proto.merge = function(action) {\r\n\r\n        if (this.targetId === action.targetId &&\r\n            this.type === action.type) {\r\n\r\n            this.newPosition = action.newPosition;\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * @returns {boolean}\r\n     */\r\n    proto.isIdentity = function() {\r\n\r\n        var newPosition = this.newPosition;\r\n        var oldPosition = this.oldPosition;\r\n\r\n        return newPosition.x === oldPosition.x && newPosition.y === oldPosition.y;\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { EditAction } from './EditAction'\r\n\r\n    /**\r\n     *\r\n     * @param editor\r\n     * @param markup\r\n     * @param angle\r\n     * @constructor\r\n     */\r\n    export function SetRotation(editor, markup, angle) {\r\n\r\n        EditAction.call(this, editor, 'SET-ROTATION', markup.id);\r\n\r\n        var curAngle = markup.getRotation();\r\n\r\n        this.newRotation = {angle: angle};\r\n        this.oldRotation = {angle: curAngle};\r\n    }\r\n\r\n    SetRotation.prototype = Object.create(EditAction.prototype);\r\n    SetRotation.prototype.constructor = SetRotation;\r\n\r\n    var proto = SetRotation.prototype;\r\n\r\n    proto.redo = function() {\r\n\r\n        var markup = this.editor.getMarkup(this.targetId);\r\n        markup && markup.setRotation(this.newRotation.angle);\r\n    };\r\n\r\n    proto.undo = function() {\r\n\r\n        var markup = this.editor.getMarkup(this.targetId);\r\n        markup && markup.setRotation(this.oldRotation.angle);\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param action\r\n     * @returns {boolean}\r\n     */\r\n    proto.merge = function(action) {\r\n\r\n        if (this.targetId === action.targetId &&\r\n            this.type === action.type) {\r\n\r\n            this.newRotation = action.newRotation;\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    /**\r\n     * @returns {boolean}\r\n     */\r\n    proto.isIdentity = function() {\r\n\r\n        return this.newRotation.angle === this.oldRotation.angle;\r\n    };\r\n\r\n","'use strict';\r\n\r\nimport { EDIT_FRAME_DEFAULT_MARGIN, \r\n         addTraitEventDispatcher, isTouchDevice, degreesToRadians } from './MarkupsCoreUtils'\r\nimport * as MarkupEvents from './MarkupEvents'\r\nimport { CloneMarkup } from './edit-actions/CloneMarkup'\r\nimport { SetPosition } from './edit-actions/SetPosition'\r\nimport { SetSize } from './edit-actions/SetSize'\r\nimport { SetRotation } from './edit-actions/SetRotation'\r\n\r\n     var av = Autodesk.Viewing;\r\n     var avp = Autodesk.Viewing.Private;\r\n\r\n    /**\r\n     * A component to handle the selection of markups.\r\n     *\r\n     *\r\n     *      Sample\r\n     *\r\n     *      var containingDiv = document.getElementById('containingDiv3d-app-wrapper');\r\n     *      var selectionComponent = new EditFrame(containingDiv);\r\n     *      selectionComponent.setSelection(100, 100, 300, 150, 0);\r\n     *\r\n     * @param {HTMLElement} containingDiv The container where the selection layer will live.\r\n     * @param {Object} editor\r\n     * @constructor\r\n     */\r\n    export function EditFrame(containingDiv, editor) {\r\n\r\n        this.containingDiv = containingDiv;\r\n        this.editor = editor;\r\n        this.setGlobalManager(this.editor.viewer.globalManager);\r\n        this.selectionLayer = createSelectionLayer.bind(this)();\r\n\r\n        this.frameMargin = EDIT_FRAME_DEFAULT_MARGIN;\r\n\r\n        this.selection = {\r\n            x: 0,\r\n            y: 0,\r\n            width: 0,\r\n            height: 0,\r\n            rotation: 0,\r\n            element: null,\r\n            active: false,\r\n            dragging: false,\r\n            resizing: false,\r\n            //a dictionary of all the drag points\r\n            //the key for each drag point will be its cardinal/ordinal direction\r\n            handle: {}\r\n        };\r\n\r\n        createSelectorBox.bind(this)();\r\n\r\n        if (isTouchDevice()) {\r\n            this.hammer = new av.Hammer.Manager(this.selectionLayer, {\r\n                recognizers: [\r\n                    av.GestureRecognizers.drag,\r\n                    av.GestureRecognizers.doubletap,\r\n                    av.GestureRecognizers.doubletap2,\r\n                    av.GestureRecognizers.pan,\r\n                    av.GestureRecognizers.pinch\r\n                ],\r\n                handlePointerEventMouse: false,\r\n                inputClass: av.isIE11 ? av.Hammer.PointerEventInput : av.Hammer.TouchInput\r\n            });\r\n\r\n            this.onHammerDragBinded = this.onHammerDrag.bind(this);\r\n            this.onHammerDoubleTapBinded = this.onHammerDoubleTap.bind(this);\r\n            this.onTouchPanBinded = this.onTouchPan.bind(this);\r\n            this.onTouchPinchBinded = this.onTouchPinch.bind(this);\r\n\r\n            this.hammer.on(\"dragstart dragmove dragend\", this.onHammerDragBinded);\r\n            this.hammer.on(\"doubletap\", this.onHammerDoubleTapBinded);\r\n            this.hammer.on(\"doubletap2\", this.onHammerDoubleTapBinded);\r\n            this.hammer.on(\"panstart panmove panend\", this.onTouchPanBinded);\r\n            this.hammer.on(\"pinchstart pinchmove pinchend\", this.onTouchPinchBinded);\r\n\r\n            this.hammer.get('drag').requireFailure('pinch');\r\n            this.hammer.get('drag').requireFailure('pan');\r\n        }\r\n\r\n        handleSelectionBoxDragging.bind(this)();\r\n        handleSelectionBoxResizing.bind(this)();\r\n        handleSelectionDoubleClick.bind(this)();\r\n        handleSelectionBoxRotating.bind(this)();\r\n\r\n        //add the selection into the container given to us\r\n        this.containingDiv.appendChild(this.selectionLayer);\r\n\r\n        addTraitEventDispatcher(this);\r\n    }\r\n\r\n    av.GlobalManagerMixin.call(EditFrame.prototype);\r\n    var proto = EditFrame.prototype;\r\n\r\n    proto.unload = function() {\r\n\r\n        this.containingDiv.removeChild(this.selectionLayer);\r\n        this.selectionLayer = null;\r\n    };\r\n    /**\r\n     * Draws a selection box with the given attributes\r\n     *\r\n     * @param {number} x - The x coordinate to place the selection box\r\n     * @param {number} y - The y coordinate to place the selection box\r\n     * @param {number} width - The width of the selection box\r\n     * @param {number} height - The height of the selection box\r\n     * @param {number} rotation - The amount of degrees to rotate the selection box\r\n     */\r\n    proto.setSelection = function (x, y, width, height, rotation) {\r\n\r\n        var margin = this.frameMargin;\r\n        var doubleMargin = margin * 2;\r\n\r\n        updateSelectorBoxDimensions.bind(this)(width + doubleMargin, height + doubleMargin);\r\n        updateSelectorBoxPosition.bind(this)(x - margin, y - margin, rotation);\r\n        updateSelectionBoxState.bind(this)(true); //activate the selection box\r\n        this.selectionLayer.style.visibility = 'visible';\r\n    };\r\n\r\n    /**\r\n     * Displays the selection box based on the position, dimension, and rotation of a given markup\r\n     *\r\n     * @param {Autodesk.Viewing.Extensions.Markups.Core.Markup} markup - the markup that should appear as selected\r\n     */\r\n    proto.setMarkup = function (markup) {\r\n\r\n        this.hammer && this.hammer.set({enable: markup !== null});\r\n        this.markup = markup;\r\n\r\n        updateSelectionBoxState.bind(this)(false);\r\n\r\n        if (markup) {\r\n            var boundingBox = markup.getBoundingRect();\r\n            var rotation = markup.getRotation();\r\n            this.frameMargin = boundingBox.margin !== undefined ? boundingBox.margin : EDIT_FRAME_DEFAULT_MARGIN;\r\n\r\n            this.setSelection(boundingBox.x, boundingBox.y, boundingBox.width, boundingBox.height, rotation);\r\n\r\n            this.enableResizeHandles();\r\n            this.enableRotationHandle();\r\n\r\n            if (markup.preventReposition) {\r\n                this.selectionLayer.firstChild.style.cursor = '';\r\n            }\r\n            else {\r\n                this.selectionLayer.firstChild.style.cursor = 'move';\r\n            }\r\n        }\r\n    };\r\n\r\n    proto.startDrag = function (event) {\r\n\r\n        if (this.markup && this.markup.preventReposition) return;\r\n\r\n        this.onMouseMove = this._onRepositionMouseMove.bind(this);\r\n        this.onMouseUp = this._onRepositionMouseUp.bind(this);\r\n        this._onRepositionMouseDown(event, this.editor.getMousePosition());\r\n    };\r\n\r\n     proto.isActive = function() {\r\n        return this.selection.active;\r\n     };\r\n\r\n    proto.isDragging = function () {\r\n\r\n        return this.selection.dragging;\r\n    };\r\n\r\n    proto.isResizing = function () {\r\n\r\n        return this.selection.resizing;\r\n    };\r\n\r\n    proto.isRotating = function () {\r\n\r\n        return this.selection.rotating;\r\n    };\r\n\r\n    proto.onMouseMove = function (event) {\r\n\r\n        //dummy fn\r\n    };\r\n\r\n    proto.onMouseUp = function (event) {\r\n        //dummy fn\r\n    };\r\n\r\n    proto.onWheel = function (event) {\r\n        this.editor.viewer.toolController.mousewheel(event);\r\n    };\r\n\r\n    proto.onTouchPan = function(event) {\r\n        var gestureHandler = this.editor.viewer.toolController.getTool(\"gestures\");\r\n        gestureHandler.distributeGesture(event);\r\n        event.preventDefault();\r\n    };\r\n\r\n    proto.onTouchPinch = function(event) {\r\n        var gestureHandler = this.editor.viewer.toolController.getTool(\"gestures\");\r\n        gestureHandler.distributeGesture(event);\r\n        event.preventDefault();\r\n    };\r\n\r\n     proto.onHammerDrag = function(event) {\r\n\r\n         function updateEditorInput(input, parent, event) {\r\n\r\n             //TODO: Change this when refactoring input in edit frame.\r\n             var rect = parent.getBoundingClientRect();\r\n             input.mousePosition.x = event.pageX - rect.left;\r\n             input.mousePosition.y = event.pageY - rect.top;\r\n         }\r\n\r\n        //console.log('EditFrame drag ' + event.type);\r\n         convertEventHammerToMouse(event);\r\n         switch (event.type) {\r\n             case 'dragstart':\r\n                 updateEditorInput(this.editor.input, this.editor.svg, event);\r\n                 this.editor.callSnapperMouseDown();\r\n                 // Check whether to translate, rotate or resize\r\n                 if (isRotatePoint(event.target)) {\r\n                     // Rotate\r\n                     this._onRotationMouseDown(event);\r\n                 } else if (isDragPoint(event.target)) {\r\n                     // Resize\r\n                     this._onResizeMouseDown(event);\r\n                 } else {\r\n                     this.startDrag(event);\r\n                 }\r\n                 event.preventDefault();\r\n                 break;\r\n             case 'dragmove':\r\n                 updateEditorInput(this.editor.input, this.editor.svg, event);\r\n                 this.editor.callSnapperMouseMove();\r\n                 this.onMouseMove(event);\r\n                 event.preventDefault();\r\n                 break;\r\n             case 'dragend':\r\n                 updateEditorInput(this.editor.input, this.editor.svg, event);\r\n                 this.onMouseUp(event);\r\n                 event.preventDefault();\r\n                 break;\r\n         }\r\n     };\r\n\r\n    proto.onHammerDoubleTap = function(event) {\r\n\r\n        function updateEditorInput(input, parent, event) {\r\n\r\n            //TODO: Change this when refactoring input in edit frame.\r\n            var rect = parent.getBoundingClientRect();\r\n            input.mousePosition.x = event.pageX - rect.left;\r\n            input.mousePosition.y = event.pageY - rect.top;\r\n        }\r\n\r\n        convertEventHammerToMouse(event);\r\n        updateEditorInput(this.editor.input, this.editor.svg, event);\r\n\r\n        this.selection.dragging = false;\r\n        this.editor.editMode && this.editor.editMode.onMouseDoubleClick(this.markup);\r\n    };\r\n\r\n    proto.enableResizeHandles = function () {\r\n\r\n        var markup = this.markup;\r\n        var handle;\r\n\r\n        if (markup.isHeightConstrained() || markup.isWidthConstrained()) {\r\n            //hide all the handles\r\n            for (var direction in this.selection.handle) {\r\n                handle = this.selection.handle[direction];\r\n                if(handle) handle.style.display = 'none';\r\n            }\r\n\r\n            //show only the resize points that are allowed\r\n            if (!markup.isHeightConstrained()) {\r\n                this.selection.handle['n'].style.display = 'block';\r\n                this.selection.handle['s'].style.display = 'block';\r\n            }\r\n            if (!markup.isWidthConstrained()) {\r\n                this.selection.handle['w'].style.display = 'block';\r\n                this.selection.handle['e'].style.display = 'block';\r\n            }\r\n        } else {\r\n            //no constraints, show all resize handles\r\n            for (var direction in this.selection.handle) {\r\n                handle = this.selection.handle[direction];\r\n                if(handle) handle.style.display = 'block';\r\n            }\r\n        }\r\n    };\r\n\r\n    proto.enableRotationHandle = function () {\r\n\r\n        var markup = this.markup;\r\n        var display = markup.isRotationConstrained() ? 'none' : 'block';\r\n        this.selection.rotationHandle.style.display = display;\r\n        this.selection.rotationBridge.style.display = display;\r\n    };\r\n\r\n     function convertEventHammerToMouse(event) {\r\n         // Convert Hammer touch-event X,Y into mouse-event X,Y.\r\n         event.pageX = event.pointers[0].clientX;\r\n         event.pageY = event.pointers[0].clientY;\r\n     }\r\n\r\n    /**\r\n     * Creates an element spanning the full height and width of its parent.\r\n     * It serves as our surface to draw the selection box.\r\n     *\r\n     * @return {HTMLElement}\r\n     */\r\n    function createSelectionLayer() {\r\n\r\n        const _document = this.getDocument();\r\n        var selectionLayer = _document.createElement('div');\r\n        selectionLayer.style.position = 'absolute';\r\n        selectionLayer.style.top = 0;\r\n        selectionLayer.style.bottom = 0;\r\n        selectionLayer.style.left = 0;\r\n        selectionLayer.style.right = 0;\r\n        //don't let the selection box be visible outside the selection layer\r\n        selectionLayer.style.overflow = 'hidden';\r\n        selectionLayer.style.visibility = 'hidden';\r\n        togglePointerEvents(selectionLayer, false);\r\n        return selectionLayer;\r\n    }\r\n\r\n    /**\r\n     * Creates a single drag point with the corresponding styles\r\n     *\r\n     * @param {number} diameter - The size of the drag point\r\n     * @param {string} position - The cardinal(n, s, w, e) or ordinal(nw, nw, sw, se) direction of the point\r\n     * @return {HTMLElement}\r\n     */\r\n    function createDragPoint(position) {\r\n\r\n        const _document = this.getDocument();\r\n        var point = _document.createElement('div');\r\n\r\n        setResizeCursor(point, position);\r\n        point.className = 'selector-drag-point autodesk-markups-extension-core-make-me-bigger sdp-handle-' + position;\r\n        point.classList.add('adsk-viewing-viewer');\r\n        point.setAttribute('data-sdp-handle', position);\r\n\r\n        return point;\r\n    }\r\n\r\n    function createRotatePoint () {\r\n        const _document = this.getDocument();\r\n        var point = _document.createElement('div');\r\n        point.classList.add('adsk-viewing-viewer');\r\n        point.classList.add('selector-rotate-point');\r\n        point.classList.add('autodesk-markups-extension-core-make-me-bigger');\r\n        setResizeCursor(point, 'w');\r\n\r\n        return point;\r\n    }\r\n\r\n    function createRotationBridge() {\r\n        const _document = this.getDocument();\r\n        var rotationBridge = _document.createElement('div');\r\n        rotationBridge.classList.add('adsk-viewing-viewer');\r\n        rotationBridge.classList.add('selector-rotate-point');\r\n        rotationBridge.classList.add('autodesk-markups-extension-core-make-me-bigger');\r\n        rotationBridge.classList.add('rotation-bridge');\r\n        setResizeCursor(rotationBridge, 'w');\r\n\r\n        return rotationBridge;\r\n    }\r\n\r\n    function setResizeCursor (element, direction) {\r\n\r\n        var cursor;\r\n        switch(direction) {\r\n            case 'n':\r\n            case 's':\r\n                cursor = 'ns-resize';\r\n                break;\r\n            case 'w':\r\n            case 'e':\r\n                cursor = 'ew-resize';\r\n                break;\r\n            case 'ne':\r\n            case 'sw':\r\n                cursor = 'nesw-resize';\r\n                break;\r\n            case 'nw':\r\n            case 'se':\r\n                cursor = 'nwse-resize';\r\n                break;\r\n        }\r\n        element.style.cursor = cursor;\r\n    }\r\n\r\n    /**\r\n     * Creates the 8 drag points of the selection box.\r\n     *\r\n     * @this EditFrame\r\n     */\r\n    function createDragPoints(selector) {\r\n\r\n        ['n', 's', 'w', 'e', 'nw', 'ne', 'sw', 'se'].forEach(function (direction) {\r\n            //store the drag point and put it in the DOM\r\n            this.selection.handle[direction] = createDragPoint.call(this, direction);\r\n            selector.appendChild(this.selection.handle[direction]);\r\n        }.bind(this));\r\n    }\r\n\r\n    /**\r\n     * Determines if an element is a drag point\r\n     *\r\n     * @return {boolean}\r\n     */\r\n    function isDragPoint(element) {\r\n\r\n        return matchesSelectorAux(element, '.selector-drag-point');\r\n    }\r\n\r\n    /**\r\n     * Determines if an element is a rotate point\r\n     *\r\n     * @return {boolean}\r\n     */\r\n    function isRotatePoint(element) {\r\n\r\n        return matchesSelectorAux(element, '.selector-rotate-point');\r\n    }\r\n\r\n    /**\r\n     * Creates the element that will be used as the selection box. It also\r\n     * takes care of adding the drag handles\r\n     *\r\n     * @return {HTMLElement} - the selection box\r\n     * @this EditFrame\r\n     */\r\n    function createSelectorBox() {\r\n\r\n        const _document = this.getDocument();\r\n        var selectorBox = _document.createElement('div');\r\n        togglePointerEvents(selectorBox, true);\r\n        selectorBox.classList.add('selector-box');\r\n\r\n        this.selection.rotationBridge = createRotationBridge.bind(this)();\r\n        selectorBox.appendChild(this.selection.rotationBridge);\r\n\r\n        this.selection.rotationHandle = createRotatePoint.bind(this)();\r\n        selectorBox.appendChild(this.selection.rotationHandle);\r\n\r\n        createDragPoints.bind(this)(selectorBox);\r\n\r\n        //store the selector box\r\n        this.selection.element = selectorBox;\r\n\r\n        if (!av.isMobileDevice()) {\r\n            this.onWheelBinded = this.onWheel.bind(this);\r\n            this.selection.element.addEventListener('wheel', this.onWheelBinded);\r\n            this.selection.element.addEventListener('DOMMouseScroll', this.onWheelBinded); // firefox\r\n        }\r\n\r\n        //add the selection box to the selection layer\r\n        this.selectionLayer.appendChild(this.selection.element);\r\n\r\n        //we are just creating the box, start it out hidden\r\n        updateSelectionBoxState.bind(this)(false);\r\n\r\n        return selectorBox;\r\n    }\r\n\r\n    /**\r\n     * Utility to create the CSS translate3d value from a given 2d point\r\n     *\r\n     * @param {number} x - coordinate\r\n     * @param {number} y - coordinate\r\n     * @return {string}\r\n     */\r\n    function toTranslate3d(x, y) {\r\n\r\n        return 'translate3d(' + x + 'px,' + y + 'px,0)';\r\n    }\r\n\r\n\r\n    /**\r\n     * Updates the display state of the selection box\r\n     *\r\n     * @param {boolean} active - The new state of the the selection box\r\n     * @this EditFrame\r\n     */\r\n    function updateSelectionBoxState(active) {\r\n\r\n        this.selection.active = active;\r\n        this.selection.element.style.display = active ? 'block' : 'none';\r\n    }\r\n\r\n    /**\r\n     * Updates the position and rotation of the selection box.\r\n     *\r\n     * @param {number} x - The x coordinate to place the selection box\r\n     * @param {number} y - The y coordinate to place the selection box\r\n     * @param {number} rotation - The amount of degrees to rotate the selection box\r\n     * @this EditFrame\r\n     */\r\n    function updateSelectorBoxPosition(x, y, rotation) {\r\n\r\n        this.selection.x = x;\r\n        this.selection.y = y;\r\n        this.selection.rotation = rotation;\r\n        var size = this.markup.getBoundingRect();\r\n        //TODO: consider DomElementStyle\r\n\r\n        size.width += this.frameMargin * 2;\r\n        size.height += this.frameMargin * 2;\r\n\r\n        var transform = toTranslate3d(x, y) + ' rotate(' + rotation + 'rad)';\r\n        var transformOrigin = (size.width / 2) + 'px ' + (size.height / 2) + 'px';\r\n\r\n        this.selection.element.style.msTransform =\r\n            this.selection.element.style.webkitTransform =\r\n            this.selection.element.style.transform = transform;\r\n        this.selection.element.style.msTransformOrigin =\r\n            this.selection.element.style.webkitTransformOrigin =\r\n            this.selection.element.style.transformOrigin = transformOrigin;\r\n    }\r\n\r\n    /**\r\n     * Updates the dimensions of the selection box (width and height).\r\n     *\r\n     * @param {number} width - The new width of the selection box\r\n     * @param {number} height - The new height of the selection box\r\n     * @this EditFrame\r\n     */\r\n    function updateSelectorBoxDimensions(width, height) {\r\n\r\n        this.selection.width = width;\r\n        this.selection.height = height;\r\n        this.selection.element.style.width = width + 'px';\r\n        this.selection.element.style.height = height + 'px';\r\n    }\r\n\r\n    /**\r\n     * Attaches all the necessary listeners to handle a drag action.\r\n     *\r\n     * @this EditFrame\r\n     */\r\n    function handleSelectionBoxDragging () {\r\n\r\n        this.selection.element.addEventListener('mousedown', this._onRepositionMouseDown.bind(this));\r\n    }\r\n\r\n    /**\r\n     * Handles panning when right clicking down\r\n     * @param event\r\n     * @returns {boolean} returns true if the event was handled\r\n     * @private\r\n     */\r\n    proto._handleRightClickDown = function(event) {\r\n\r\n        if (!av.isMobileDevice() && (avp.isRightClick(event, this.editor.viewer.navigation) || avp.isMiddleClick(event))) {\r\n            this.editor.input.onMouseDownRightClick(event);\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    };\r\n\r\n    var ignoreFirstMouseMove = false;\r\n    proto._onRepositionMouseDown = function (event, cursor) {\r\n\r\n        if (this._handleRightClickDown(event))\r\n            return;\r\n\r\n        // Return for markups that are not allowed to be repositioned.\r\n        if (this.markup && this.markup.preventReposition) return;\r\n\r\n        // ignore the first mouse move for the Microsoft Surface\r\n        ignoreFirstMouseMove = !av.isMobileDevice() && av.isTouchDevice();\r\n        //a synthetic start means that the event was triggered manually and not as a\r\n        //result of a mousedown on the edit frame\r\n        const _window = this.getWindow();\r\n        var syntheticStart = !(event instanceof _window.MouseEvent);\r\n\r\n        //during a real mousedown, ignore events originating from a resizing handle\r\n        if (!syntheticStart && (isDragPoint(event.target) || isRotatePoint(event.target))) return;\r\n\r\n        //get the cursor position\r\n        cursor = syntheticStart ?  cursor : this.editor.getMousePosition();\r\n\r\n        //store the initial cursor and axis constrains\r\n        this.initialCursor = cursor;\r\n        this.initialPosition = this.markup.getClientPosition();\r\n        this.areAxisConstrained = false;\r\n        this.axisConstrains = new THREE.Vector2(1,1);\r\n\r\n        //update the function that will handle the mousemove and mouseup events\r\n        this.onMouseMove = this._onRepositionMouseMove.bind(this);\r\n        this.onMouseUp = this._onRepositionMouseUp.bind(this);\r\n\r\n        if (this.selection.dragging)\r\n            return;\r\n\r\n        this.selection.dragging = true;\r\n        this.editor.beginActionGroup();\r\n\r\n        //if alt down I drop a clone.\r\n        if (event && event.altKey) {\r\n            var editor = this.editor;\r\n            var cloneMarkup = new CloneMarkup(editor, editor.getId(), this.markup, this.markup.position);\r\n            cloneMarkup.execute();\r\n        }\r\n\r\n        this.dispatchEvent({ type: MarkupEvents.EVENT_EDITFRAME_EDITION_START }); // Moving around\r\n    };\r\n\r\n    proto._onRepositionMouseMove = function(event) {\r\n\r\n        // This check is needed for selecting markups on devices that have touch screen + mouse (eg: Microsoft Surface)\r\n        if (ignoreFirstMouseMove) {\r\n            ignoreFirstMouseMove = false;\r\n            return;\r\n        }\r\n        //ignore mousemove events if the dragging state hasn't been activated\r\n        if (!this.selection.dragging || !this.markup || this.markup.preventReposition) return;\r\n\r\n        //get the position of the cursor relative to selection layer\r\n        var cursor = this.editor.getMousePosition();\r\n\r\n        //constrain axis if shift key is down.\r\n        var constrainAxis = this.editor.input.constrainAxis;\r\n        if (this.areAxisConstrained !== constrainAxis) {\r\n            this.areAxisConstrained = constrainAxis;\r\n            this.axisConstrains = constrainAxis ? new THREE.Vector2(0, 0) : new THREE.Vector2(1,1);\r\n\r\n            this.initialPosition.x += cursor.x - this.initialCursor.x;\r\n            this.initialPosition.y += cursor.y - this.initialCursor.y;\r\n\r\n            this.initialCursor.x = cursor.x;\r\n            this.initialCursor.y = cursor.y;\r\n        }\r\n\r\n        //determine how many pixel we have to shift the\r\n        //selection box to keep the cursor on the drag point\r\n        var movement = {\r\n            x: cursor.x - this.initialCursor.x,\r\n            y: cursor.y - this.initialCursor.y\r\n        };\r\n\r\n        var deadZone = 15;\r\n        if (this.axisConstrains.x === 0 && this.axisConstrains.y === 0) {\r\n\r\n            if (Math.abs(movement.x) > deadZone) {\r\n                this.axisConstrains.x = 1;\r\n                movement.x += movement.x < 0 ?  deadZone : -deadZone;\r\n            } else\r\n            if (Math.abs(movement.y) > deadZone) {\r\n                this.axisConstrains.y = 1;\r\n                movement.y += movement.y < 0 ?  deadZone : -deadZone;\r\n            }\r\n        }\r\n\r\n        var x = this.initialPosition.x + movement.x * this.axisConstrains.x;\r\n        var y = this.initialPosition.y + movement.y * this.axisConstrains.y;\r\n\r\n        updateSelectorBoxPosition.bind(this)(x, y, this.selection.rotation);\r\n\r\n        //tell the markup to start transforming\r\n        //the markup expects an (x, y) coordinate that\r\n        //uses an origin at the center, adjust our x, y because\r\n        //our origin starts at the top left\r\n        var position = this.editor.positionFromClientToMarkups(x, y);\r\n        var setPosition = new SetPosition(this.editor, this.markup, position);\r\n        setPosition.execute();\r\n    };\r\n\r\n    proto._onRepositionMouseUp = function () {\r\n\r\n        if (this.markup && this.markup.preventReposition) return;\r\n\r\n        this.last = null;\r\n\r\n        //this should never be called after the mouse up because we are no longer repositioning\r\n        this.onMouseMove = function () {/*do nothing*/};\r\n        this.onMouseUp = function () {/*do nothing*/};\r\n\r\n        if(!this.selection.dragging) {\r\n            return;\r\n        }\r\n\r\n        this.editor.closeActionGroup();\r\n        this.selection.dragging = false;\r\n        this.dispatchEvent({ type: MarkupEvents.EVENT_EDITFRAME_EDITION_END }); // Moving around\r\n    };\r\n\r\n    proto._onResizeMouseDown = function (event) {\r\n\r\n        if (this._handleRightClickDown(event))\r\n            return;\r\n\r\n        var target = event.target;\r\n\r\n        //is the target where the mousedown occurred a drag point\r\n        if (!isDragPoint(target)) {\r\n            return;\r\n        }\r\n\r\n        //keep a reference to the point where the drag started\r\n        this.selection.handle.resizing = target;\r\n        //figure out which direction this point should resize\r\n        var direction = this.selection.handle.resizing.getAttribute('data-sdp-handle');\r\n        //set the cursor position for the entire layer\r\n        this.containingDiv.style.cursor = direction + '-resize';\r\n\r\n        var cursor = this.editor.getMousePosition();\r\n\r\n        var position = this.markup.getClientPosition();\r\n        var size = this.markup.getBoundingRect();\r\n\r\n        //store the center\r\n        this.initial = {\r\n            x: position.x,\r\n            y: position.y,\r\n            width: size.width,\r\n            height: size.height,\r\n            mouseX: cursor.x,\r\n            mouseY: cursor.y\r\n        };\r\n\r\n        this.onMouseMove = this._onResizeMouseMove.bind(this);\r\n        this.onMouseUp = this._onResizeMouseUp.bind(this);\r\n\r\n        if (this.selection.resizing) {\r\n            return;\r\n        }\r\n\r\n        this.selection.resizing = true;\r\n        this.editor.beginActionGroup();\r\n\r\n        setHandleSelected(event.target, true);\r\n\r\n        //notify the markup that dragging has started\r\n        this.dispatchEvent({ type: MarkupEvents.EVENT_EDITFRAME_EDITION_START }); // Resizing\r\n    };\r\n\r\n    proto._onResizeMouseMove = function (event) {\r\n\r\n        if (!this.selection.resizing) return;\r\n\r\n        var cursor = this.editor.getMousePosition();\r\n        var initial = this.initial;\r\n\r\n        var movement = {\r\n            x: cursor.x - initial.mouseX,\r\n            y: cursor.y - initial.mouseY\r\n        };\r\n\r\n        var vector = new THREE.Vector3(movement.x, movement.y, 0);\r\n        var undoRotation = new THREE.Matrix4().makeRotationZ(-this.selection.rotation);\r\n        movement = vector.applyMatrix4(undoRotation);\r\n\r\n        var x = initial.x,\r\n            y = initial.y,\r\n            width = initial.width,\r\n            height = initial.height;\r\n\r\n        var localSpaceDelta = new THREE.Vector3();\r\n\r\n        //get the direction of the arrow being dragged\r\n        var direction = this.selection.handle.resizing.getAttribute('data-sdp-handle');\r\n\r\n        // TODO: Make a mechanism to configure and use this feature from Markups Core.\r\n        // If shift is pressed, figure aspect ratio is maintained.\r\n        if (this.editor.input.keepAspectRatio && ['nw', 'ne', 'sw', 'se'].indexOf(direction) !== -1) {\r\n\r\n            var delta = new THREE.Vector3(movement.x, movement.y, 0);\r\n            switch (direction){\r\n                case 'nw': movement.set(-initial.width,-initial.height, 0); break;\r\n                case 'ne': movement.set( initial.width,-initial.height, 0); break;\r\n                case 'sw': movement.set( initial.width,-initial.height, 0); break;\r\n                case 'se': movement.set( initial.width, initial.height, 0); break;\r\n            }\r\n            movement.normalize();\r\n            movement = delta.projectOnVector(movement);\r\n        }\r\n\r\n        var translations = {\r\n            n: function () {\r\n                height -= movement.y;\r\n                localSpaceDelta.y = movement.y;\r\n            },\r\n            s: function () {\r\n                height += movement.y;\r\n                localSpaceDelta.y = movement.y;\r\n            },\r\n            w: function () {\r\n                width -= movement.x;\r\n                localSpaceDelta.x = movement.x;\r\n            },\r\n            e: function () {\r\n                width += movement.x;\r\n                localSpaceDelta.x = movement.x;\r\n            },\r\n            nw: function () {\r\n                this.n();\r\n                this.w();\r\n            },\r\n            ne: function () {\r\n                this.n();\r\n                this.e();\r\n            },\r\n            sw: function () {\r\n                this.s();\r\n                this.w();\r\n            },\r\n            se: function () {\r\n                this.s();\r\n                this.e();\r\n            }\r\n        };\r\n\r\n        translations[direction]();\r\n\r\n        // Check if new size is smaller than min width or height\r\n        if (width <= this.markup.getMinWidth() || height <= this.markup.getMinHeight()) return;\r\n\r\n        var redoRotation = new THREE.Matrix4().makeRotationZ(this.selection.rotation);\r\n        var actualDelta = localSpaceDelta.applyMatrix4(redoRotation);\r\n\r\n        var newPos = this.editor.positionFromClientToMarkups(\r\n            x + (actualDelta.x * 0.5),\r\n            y + (actualDelta.y * 0.5));\r\n\r\n        var newSize = this.editor.sizeFromClientToMarkups(width, height);\r\n\r\n        var setSize = new SetSize(this.editor, this.markup, newPos, newSize.x, newSize.y);\r\n        setSize.execute();\r\n    };\r\n\r\n    function setHandleSelected (handle, isSelected) {\r\n        if (isSelected) {\r\n            handle.classList.add('selected');\r\n        } else {\r\n            handle.classList.remove('selected');\r\n        }\r\n    }\r\n\r\n    proto._onResizeMouseUp = function (event) {\r\n        this.selection.resizing = false;\r\n        this.selection.handle.resizing = null;\r\n        this.containingDiv.style.cursor = '';\r\n\r\n        for (var direction in this.selection.handle) {\r\n            if (this.selection.handle[direction]) {\r\n                setHandleSelected(this.selection.handle[direction], false);\r\n            }\r\n        }\r\n\r\n\r\n        this.editor.closeActionGroup();\r\n        this.dispatchEvent({ type: MarkupEvents.EVENT_EDITFRAME_EDITION_END }); // Resizing\r\n\r\n        //this should never be called after the mouse up because we are no longer resizing\r\n        this.onMouseMove = function () {/*do nothing*/\r\n        };\r\n        this.onMouseUp = function () {/*do nothing*/\r\n        };\r\n    };\r\n\r\n\r\n    /**\r\n     * Attaches all the necessary listeners to handle a resizing action.\r\n     *\r\n     * @this EditFrame\r\n     */\r\n    function handleSelectionBoxResizing() {\r\n        this.selectionLayer.addEventListener('mousedown', this._onResizeMouseDown.bind(this));\r\n    }\r\n\r\n    function handleSelectionBoxRotating () {\r\n\r\n        this.selection.element.addEventListener('mousedown', this._onRotationMouseDown.bind(this));\r\n    }\r\n\r\n    var initialRotation;\r\n    var initialHandlePosition;\r\n\r\n    proto._onRotationMouseDown = function (event) {\r\n\r\n        if (this._handleRightClickDown(event))\r\n            return;\r\n\r\n        //ignore anything not coming from the rotation point\r\n        if (!isRotatePoint(event.target)) return;\r\n\r\n        this.editor.beginActionGroup();\r\n        this.selection.rotating = true;\r\n\r\n        //store the initial cursor\r\n        initialHandlePosition = this.editor.getMousePosition();\r\n\r\n        initialRotation = this.selection.rotation || 0;\r\n\r\n        //update the function that will handle the mousemove and mouseup events\r\n        this.onMouseMove = this._onRotationMouseMove.bind(this);\r\n        this.onMouseUp = this._onRotationMouseUp.bind(this);\r\n\r\n        setHandleSelected(event.target, true);\r\n\r\n        this.dispatchEvent({ type: MarkupEvents.EVENT_EDITFRAME_EDITION_START }); // Rotating\r\n    };\r\n\r\n     proto._onRotationMouseMove = function (event) {\r\n\r\n        //ignore mousemove events if the dragging state hasn't been activated\r\n        if (!this.selection.rotating) return;\r\n\r\n        var cursor = this.editor.getMousePosition();\r\n        var position = this.markup.getClientPosition();\r\n\r\n        var r = getAngleBetweenPoints(position, cursor);\r\n        var r2 = getAngleBetweenPoints(position, initialHandlePosition);\r\n        var rotation = r - r2 + initialRotation;\r\n\r\n        // TODO: Make a mechanism to configure and use this feature from Markups Core.\r\n        if (this.editor.input.snapRotations) {\r\n            var snap = degreesToRadians(22.5);\r\n            rotation = Math.ceil(rotation / snap) * snap;\r\n        }\r\n\r\n         //pass rotation as degrees\r\n         updateSelectorBoxPosition.bind(this)(this.selection.x, this.selection.y, rotation);\r\n\r\n        //convert to radians\r\n        var setRotation = new SetRotation(this.editor, this.markup, rotation);\r\n        setRotation.execute();\r\n    };\r\n\r\n    proto._onRotationMouseUp = function (event) {\r\n\r\n        this.selection.rotating = false;\r\n        initialRotation = null;\r\n        initialHandlePosition = null;\r\n        setHandleSelected(this.selection.rotationHandle, false);\r\n        this.editor.closeActionGroup();\r\n        this.dispatchEvent({ type: MarkupEvents.EVENT_EDITFRAME_EDITION_END }); // Rotating\r\n    };\r\n\r\n    /**\r\n     * Attaches double click listener and pass events to markup, markups such as text use it to enter text edit\r\n     * mode.\r\n     *\r\n     * @this EditFrame\r\n     */\r\n    function handleSelectionDoubleClick() {\r\n\r\n        var doubleClick = function (event) {\r\n            if (event.defaultPrevented) {\r\n                return;\r\n            }\r\n            this.selection.dragging = false;\r\n            var editMode = this.editor.editMode;\r\n            editMode && editMode.onMouseDoubleClick(this.markup);\r\n        }.bind(this);\r\n\r\n        var selectorBoxWrapper = this.selectionLayer;\r\n        selectorBoxWrapper.addEventListener('dblclick', doubleClick);\r\n    }\r\n\r\n    function togglePointerEvents(element, state) {\r\n\r\n        element.style.pointerEvents = state ? 'auto' : 'none';\r\n    }\r\n\r\n    function getAngleBetweenPoints (p1, p2) {\r\n\r\n        return Math.atan2(p2.y - p1.y, p2.x - p1.x);\r\n    }\r\n\r\n     function matchesSelectorAux(domElem, selector) {\r\n         if (domElem.matches) return domElem.matches(selector); //Un-prefixed\r\n         if (domElem.msMatchesSelector) return domElem.msMatchesSelector(selector);  //IE\r\n         if (domElem.mozMatchesSelector) return domElem.mozMatchesSelector(selector); //Firefox (Gecko)\r\n         if (domElem.webkitMatchesSelector) return domElem.webkitMatchesSelector(selector); // Opera, Safari, Chrome\r\n         return false;\r\n     }\r\n","'use strict';\r\n\r\n    var avp = Autodesk.Viewing.Private;\r\n\r\n    export function MarkupTool() {\r\n\r\n        Autodesk.Viewing.ToolInterface.call(this);\r\n        this.names = [\"markups.core\"];\r\n        this.panTool = null;\r\n        this.allowNav = false;\r\n        this.is2d = false;\r\n\r\n        this.coreExt = null;\r\n        this.hotkeysEnabled = true;\r\n\r\n        var _ctrlDown = false;\r\n        var _shiftDown = false;\r\n\r\n        // Non-ToolInterface methods //\r\n\r\n        this.allowNavigation = function(allow) {\r\n            this.allowNav = allow;\r\n        };\r\n        this.setCoreExtension = function(coreExt) {\r\n            this.coreExt = coreExt;\r\n        };\r\n        this.setHotkeysEnabled = function(enabled) {\r\n            this.hotkeysEnabled = enabled;\r\n        };\r\n\r\n\r\n        // ToolInterface methods //\r\n\r\n        this.activate = function(name, viewerApi) {\r\n            this.panTool = viewerApi.toolController.getTool(\"pan\");\r\n            if (this.panTool) {\r\n                this.panTool.activate(\"pan\"); // TODO: What if we want \"zoom\" here?\r\n            }\r\n\r\n            this.is2d = viewerApi.model.is2d();\r\n            this.viewer = viewerApi;\r\n        };\r\n\r\n        this.deactivate = function(name) {\r\n            if (this.panTool) {\r\n                this.panTool.deactivate(\"pan\");\r\n            }\r\n        };\r\n\r\n        this.handleKeyDown = function(event, keyCode) {\r\n\r\n            if (!this.coreExt.editMode) {\r\n                return false;\r\n            }\r\n\r\n            if (!this.hotkeysEnabled) {\r\n                return true; // Consume event\r\n            }\r\n\r\n            // Don't propagate key handling down to tool //\r\n\r\n            switch (keyCode) {\r\n                case Autodesk.Viewing.KeyCode.CONTROL: _ctrlDown = true; break;\r\n                case Autodesk.Viewing.KeyCode.SHIFT: _shiftDown = true; break;\r\n\r\n                case Autodesk.Viewing.KeyCode.x: _ctrlDown && !this.allowNav && this.coreExt.cut(); break;\r\n                case Autodesk.Viewing.KeyCode.c: _ctrlDown && !this.allowNav && this.coreExt.copy(); break;\r\n                case Autodesk.Viewing.KeyCode.v: _ctrlDown && !this.allowNav && this.coreExt.paste(); break;\r\n                case Autodesk.Viewing.KeyCode.d:\r\n                    if (_ctrlDown && !this.allowNav) {\r\n                        // Duplicate\r\n                        this.coreExt.copy();\r\n                        this.coreExt.paste();\r\n                    }\r\n                    break;\r\n                case Autodesk.Viewing.KeyCode.z:\r\n                    if (_ctrlDown && !_shiftDown && !this.allowNav) {\r\n                        this.coreExt.undo();\r\n                    }\r\n                    else if (_ctrlDown && _shiftDown && !this.allowNav) {\r\n                        this.coreExt.redo(); // Also support Ctrl+Y\r\n                    }\r\n                    break;\r\n                case Autodesk.Viewing.KeyCode.y: _ctrlDown && !this.allowNav && this.coreExt.redo(); break; // Also support ctrl+shift+z\r\n                case Autodesk.Viewing.KeyCode.ESCAPE: this.coreExt.onUserCancel(); break;\r\n\r\n                case Autodesk.Viewing.KeyCode.BACKSPACE: // Fall through\r\n                case Autodesk.Viewing.KeyCode.DELETE:\r\n                    var selectedMarkup = this.coreExt.getSelection();\r\n                    if (selectedMarkup) {\r\n                        this.coreExt.deleteMarkup(selectedMarkup);\r\n                    }\r\n                    break;\r\n                case Autodesk.Viewing.KeyCode.F12:\r\n                    return false; // To allow opening developer console.\r\n                    break;\r\n                default: break;\r\n            }\r\n\r\n            return true; // Consume event\r\n        };\r\n        this.handleKeyUp = function(event, keyCode) {\r\n\r\n            if (!this.coreExt.editMode) {\r\n                return false;\r\n            }\r\n\r\n            if (!this.hotkeysEnabled) {\r\n                return true; // Consume event\r\n            }\r\n\r\n            // Don't propagate key handling down to tool\r\n\r\n            switch (keyCode) {\r\n                case Autodesk.Viewing.KeyCode.CONTROL: _ctrlDown = false; break;\r\n                case Autodesk.Viewing.KeyCode.SHIFT: _shiftDown = false; break;\r\n                default: break;\r\n            }\r\n\r\n            return true; // Consume event ONLY\r\n        };\r\n\r\n        this.update = function() {\r\n            if (this.allowNav && this.panTool && this.panTool.update) {\r\n                return this.panTool.update();\r\n            }\r\n            return false;\r\n        };\r\n\r\n        this.handleSingleClick = function( event, button ) {\r\n            if (this.allowNav) {\r\n                // If pan tool won't handle single click, then pass over the event.\r\n                if (this.panTool && this.panTool.handleSingleClick)\r\n                    return this.panTool.handleSingleClick(event, button);\r\n                else\r\n                    return false;\r\n            }\r\n            return true; // Consume event\r\n        };\r\n        this.handleDoubleClick = function( event, button ) {\r\n            if (this.allowNav) {\r\n                // If pan tool won't handle double click, then pass over the event\r\n                if (this.panTool && this.panTool.handleDoubleClick) {\r\n                    return this.panTool.handleDoubleClick(event, button);\r\n                }\r\n                else\r\n                    return false;\r\n            }\r\n            return true; // Consume event\r\n        };\r\n        this.handleSingleTap = function( event ) {\r\n            if (this.allowNav) {\r\n                // If pan tool won't handle single tap, then pass over the event\r\n                if (this.panTool && this.panTool.handleSingleTap) {\r\n                    return this.panTool.handleSingleTap(event);\r\n                }\r\n                else\r\n                    return false;\r\n            }\r\n            return true; // Consume event\r\n        };\r\n        this.handleDoubleTap = function( event ) {\r\n            if (this.allowNav) {\r\n                // If pan tool won't handle double tap, then pass over the event\r\n                if (this.panTool && this.panTool.handleDoubleTap) {\r\n                    return this.panTool.handleDoubleTap(event);\r\n                }\r\n                else\r\n                    return false;\r\n            }\r\n            return true; // Consume event\r\n        };\r\n        this.handleWheelInput = function(delta, event) {\r\n            if (this.allowNav || this.is2d) {\r\n                // If pan tool won't handle wheel input, then pass over the event\r\n                if (this.panTool && this.panTool.handleWheelInput) {\r\n                    this.coreExt.callSnapperMouseMove();\r\n                    return this.panTool.handleWheelInput(delta, event);\r\n                }\r\n                else\r\n                    return false;\r\n            }\r\n            return true; // Consume event\r\n        };\r\n        this.handleButtonDown = function(event, button) {\r\n            if (this.allowNav || (this.is2d && (avp.isRightClick(event, this.viewer.navigation) || avp.isMiddleClick(event)))) {\r\n                // If pan tool won't handle button down, then pass over the event\r\n                if (this.panTool && this.panTool.handleButtonDown) {\r\n                    return this.panTool.handleButtonDown(event, button);\r\n                }\r\n                else\r\n                    return false;\r\n            }\r\n            return true; // Consume event\r\n        };\r\n        this.handleButtonUp = function(event, button) {\r\n            if (this.allowNav || (this.is2d && (avp.isRightClick(event, this.viewer.navigation) || avp.isMiddleClick(event)))) {\r\n                // If pan tool won't handle button up, then pass over the event\r\n                if (this.panTool && this.panTool.handleButtonUp) {\r\n                    return this.panTool.handleButtonUp(event, button);\r\n                }\r\n                else\r\n                    return false;\r\n            }\r\n            return true; // Consume event\r\n        };\r\n        this.handleMouseMove = function(event) {\r\n            if (this.allowNav || this.is2d) {\r\n                // If pan tool won't handle button move, then pass over the event\r\n                if (this.panTool && this.panTool.handleMouseMove) {\r\n                    return this.panTool.handleMouseMove(event);\r\n                }\r\n                else\r\n                    return false;\r\n            }\r\n            return true; // Consume event\r\n        };\r\n        this.handleGesture = function(event) {\r\n            if (this.allowNav || this.is2d) {\r\n                // If pan tool won't handle gesture, then pass over the event\r\n                if (this.panTool && this.panTool.handleGesture) {\r\n                    return this.panTool.handleGesture(event);\r\n                }\r\n                else\r\n                    return false;\r\n            }\r\n            return true; // Consume event\r\n        };\r\n        this.handleBlur = function(event) {\r\n            if (this.allowNav) {\r\n                // If pan tool won't handle blur, then pass over the event\r\n                if (this.panTool && this.panTool.handleBlur) {\r\n                    return this.panTool.handleBlur(event);\r\n                }\r\n                else\r\n                    return false;\r\n            }\r\n            return true; // Consume event\r\n        };\r\n    }\r\n","\r\n// Maps EditMode id (string) into a contructor/class\r\nvar _editModes = {};\r\n\r\nclass EditModeManager {\r\n    constructor(){\r\n        // nothing //\r\n    }\r\n\r\n    register(id, clazz) {\r\n        if (id in _editModes)\r\n            throw new Error(`EditMode with id (${id}) already registered.`);\r\n        \r\n            _editModes[id] = clazz;\r\n    }\r\n\r\n    unregister(id) {\r\n        if (id in _editModes)\r\n            delete _editModes[id];\r\n    }\r\n\r\n    getClass(id) {\r\n        return _editModes[id] || null;\r\n    }\r\n\r\n    getRegistered() {\r\n        var ret = {}\r\n        for (var id in _editModes) {\r\n            if (_editModes.hasOwnProperty(id)) {\r\n                ret[id] = _editModes[id];\r\n            }\r\n        }\r\n        return ret; // shallow copy.\r\n    }\r\n}\r\n\r\n\r\nexport var theEditModeManager =  new EditModeManager();","\r\nimport { theEditModeManager } from '../EditModeManager'\r\nimport * as MarkupTypes from '../MarkupTypes'\r\n\r\nimport { EditModeArrow } from './EditModeArrow'\r\nimport { EditModeText } from './EditModeText'\r\nimport { EditModeRectangle } from './EditModeRectangle'\r\nimport { EditModeCircle } from './EditModeCircle'\r\nimport { EditModeCloud } from './EditModeCloud'\r\nimport { EditModeFreehand } from './EditModeFreehand'\r\nimport { EditModeHighlight } from './EditModeHighlight'\r\nimport { EditModePolyline } from './EditModePolyline'\r\nimport { EditModePolycloud } from './EditModePolycloud'\r\nimport { EditModeCallout } from './EditModeCallout'\r\nimport { EditModeDimension } from './EditModeDimension'\r\n\r\n\r\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_ARROW, EditModeArrow);\r\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_TEXT, EditModeText);\r\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_RECTANGLE, EditModeRectangle);\r\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_CIRCLE, EditModeCircle);\r\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_CLOUD, EditModeCloud);\r\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_FREEHAND, EditModeFreehand);\r\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_HIGHLIGHT, EditModeHighlight);\r\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_POLYLINE, EditModePolyline);\r\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_POLYCLOUD, EditModePolycloud);\r\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_CALLOUT, EditModeCallout);\r\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_DIMENSION, EditModeDimension);\r\n\r\n","\n      import API from \"!../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../node_modules/css-loader/dist/cjs.js!./Markups.css\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../node_modules/css-loader/dist/cjs.js!./Markups.css\";\n       export default content && content.locals ? content.locals : undefined;\n","'use strict';\r\n\r\nimport { EditActionManager } from './edit-actions/EditActionManager'\r\nimport * as MarkupEvents from './MarkupEvents'\r\nimport * as MarkupTypes from './MarkupTypes'\r\nimport { addTraitEventDispatcher, createSvgElement, setSvgParentAttributes,\r\n    MARKUP_DEFAULT_STROKE_WIDTH_IN_PIXELS, MARKUP_DEFAULT_FONT_WIDTH_IN_PIXELS,\r\n    hideLmvUi, restoreLmvUi, dismissLmvHudMessage, \r\n    removeAllMetadata, transferChildNodes, addSvgMetadata,\r\n    svgNodeToString, checkPolygon, stringToSvgNode, createMarkupFromSVG,\r\n    worldToClient, clientToWorld } from './MarkupsCoreUtils'\r\nimport { cloneStyle, copyStyle, createStyle } from './StyleUtils'\r\nimport { DomElementStyle } from './DomElementStyle'\r\nimport { Clipboard } from './edit-clipboard/Clipboard'\r\nimport { InputHandler } from './edit-input/InputHandler'\r\nimport { EditFrame } from './EditFrame'\r\nimport { MarkupTool } from './MarkupTool'\r\nimport { EditModeArrow } from './edit-modes/EditModeArrow'\r\n\r\nimport * as Blah from './edit-modes/BuiltinEditModes' // IMPORTANT!!\r\nimport CSS from './Markups.css' // IMPORTANT!!\r\n\r\n\r\n    var MeasureCommon = Autodesk.Viewing.MeasureCommon;\r\n\r\n    var PERSPECTIVE_MODE_SCALE = 1000;\r\n\r\n    /**\r\n     * Extension that allows end users to draw 2D markups on top of 2D and 3D models.\r\n     *\r\n     * @tutorial feature_markup\r\n     * @param {Autodesk.Viewing.Viewer3D} viewer - Viewer instance used to operate on.\r\n     * @param {object} options - Same Dictionary object passed into {@link Autodesk.Viewing.Viewer3D|Viewer3D}'s constructor.\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#show|show()}.\r\n     * @param {boolean} [options.markupDisableHotkeys] - Disables hotkeys for copy, cut, paste, duplicate, undo, redo and deselect.\r\n     * @param {Autodesk.Viewing.ToolInterface} [options.markupToolClass] - Class override for input handling.\r\n     * Use it to override/extend default hotkeys and/or mouse/gesture input.\r\n     * @memberof Autodesk.Viewing.Extensions.Markups.Core\r\n     * @constructor\r\n     */\r\n    export function MarkupsCore(viewer, options) {\r\n\r\n        Autodesk.Viewing.Extension.call(this, viewer, options);\r\n\r\n        this.options = this.options || {};\r\n        this.markups = [];\r\n        this.styles = {};\r\n\r\n        this.activeLayer = '';\r\n        this.duringViewMode = false;\r\n        this.duringEditMode = false;\r\n\r\n        this.svgLayersMap = {};\r\n\r\n        // Add action manager.\r\n        this.actionManager = new EditActionManager( 50 ); // history of 50 actions.\r\n        this.actionManager.addEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onEditActionHistoryChanged.bind(this));\r\n\r\n        this.nextId = 0; // Used to identify markups by id during an edit session.\r\n\r\n        // Clipboard.\r\n        this.clipboard = new Clipboard(this);\r\n\r\n        // Default Input handler.\r\n        this.input = new InputHandler();\r\n        this.input.setGlobalManager(this.globalManager);\r\n\r\n        // Bind functions so they have access to globalManager\r\n        this.createSvgElement = createSvgElement.bind(this);\r\n        this.addSvgMetadata = addSvgMetadata.bind(this);\r\n        this.checkPolygon = checkPolygon.bind(this);\r\n\r\n        // Extension will dispatch events.\r\n        addTraitEventDispatcher(this);\r\n\r\n        viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT, function() {\r\n            this.getStrokeWidth();\r\n            this.getFontWidth();\r\n        }.bind(this), { once: true });\r\n\r\n        // Handled events.\r\n        this.onCameraChangeBinded = this.onCameraChange.bind(this);\r\n        this.onViewerResizeBinded = function(event) {\r\n            // This is ugly, but we need to do this twice\r\n            var self = this;\r\n            // First usage is to avoid a blinking scenario\r\n            self.onViewerResize(event);\r\n            requestAnimationFrame(function(){\r\n                // Second one is to actually make it work on some resize scenarios.\r\n                // Check the unlikely scenario that we are no longer in view mode.\r\n                if (self.duringViewMode) {\r\n                    self.onViewerResize(event);\r\n                }\r\n            });\r\n        }.bind(this);\r\n\r\n        this.onMarkupSelectedBinded = this.onMarkupSelected.bind(this);\r\n        this.onMarkupEnterEditionBinded = this.onMarkupEnterEdition.bind(this);\r\n        this.onMarkupCancelEditionBinded = this.onMarkupCancelEdition.bind(this);\r\n        this.onMarkupDeleteEditionBinded = this.onMarkupDeleteEdition.bind(this);\r\n        this.onToolChangeBinded = this.onToolChange.bind(this);\r\n        this.onUnitsCalibrationStartsBinded = this.onUnitsCalibrationStarts.bind(this);\r\n\r\n        viewer.addEventListener(MeasureCommon.Events.UNITS_CALIBRATION_STARTS_EVENT, this.onUnitsCalibrationStartsBinded);\r\n    }\r\n\r\n    MarkupsCore.prototype = Object.create(Autodesk.Viewing.Extension.prototype);\r\n    MarkupsCore.prototype.constructor = MarkupsCore;\r\n\r\n    var proto = MarkupsCore.prototype;\r\n\r\n    proto.load = async function () {\r\n\r\n        // Add layer where annotations will actually live\r\n        var svg = this.svg = this.createSvgElement('svg');\r\n        setSvgParentAttributes(svg);\r\n\r\n        // NOTE: Required since LMV renders Y coordinates upwards,\r\n        // while browser's Y coordinates goes downwards.\r\n        var svgStyle = new DomElementStyle();\r\n        svgStyle.setAttribute('position', 'absolute');\r\n        svgStyle.setAttribute('left', '0');\r\n        svgStyle.setAttribute('top', '0');\r\n        svgStyle.setAttribute('transform', 'scale(1,-1)', { allBrowsers: true});\r\n        svgStyle.setAttribute('transformOrigin', '0, 0', { allBrowsers: true});\r\n        svg.setAttribute('style', svgStyle.getStyleString());\r\n\r\n        this.bounds = {x:0, y:0, width:0, height:0};\r\n\r\n        this.input.attachTo(this);\r\n\r\n        //Instantiate edit frame.\r\n        this.editFrame = new EditFrame(this.viewer.container, this);\r\n        this.editFrame.addEventListener(MarkupEvents.EVENT_EDITFRAME_EDITION_START, function(){this.disableMarkupInteractions(true);}.bind(this));\r\n        this.editFrame.addEventListener(MarkupEvents.EVENT_EDITFRAME_EDITION_END, function(){this.disableMarkupInteractions(false);}.bind(this));\r\n\r\n        // Register tool\r\n        var toolClass = this.options.markupToolClass || MarkupTool;\r\n        this.changeMarkupTool(toolClass, !this.options.markupDisableHotkeys);\r\n\r\n        await this.viewer.loadExtension('Autodesk.Snapping');\r\n\r\n        this.snapper = new Autodesk.Viewing.Extensions.Snapping.Snapper(this.viewer, {markupMode:true});\r\n        this.viewer.toolController.registerTool(this.snapper);\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Change the markup tool's class in order to implement a different behaviour to the UI.\r\n     * @param {Autodesk.Viewing.Extensions.Markups.Core.MarkupTool} toolClass - Implementation or extension of MarkupTool's class.\r\n     * @param {boolean} enableHotKeys - Whether to enable markup's hot-keys or not.\r\n     */\r\n    proto.changeMarkupTool = function(toolClass, enableHotKeys) {\r\n        if (this.markupTool) {\r\n            this.viewer.toolController.deregisterTool(this.markupTool);\r\n            this.markupTool = null;\r\n        }\r\n\r\n        this.markupTool = new toolClass();\r\n        this.markupTool.setCoreExtension(this);\r\n        this.markupTool.setHotkeysEnabled(enableHotKeys);\r\n        this.viewer.toolController.registerTool(this.markupTool);\r\n    };\r\n\r\n    proto.unload = function() {\r\n\r\n        this.hide();\r\n\r\n        this.input.detachFrom(this);\r\n\r\n        this.editFrame.unload();\r\n\r\n        if (this.markupTool) {\r\n            this.viewer.toolController.deregisterTool(this.markupTool);\r\n            this.markupTool = null;\r\n        }\r\n\r\n        if (this.snapper) {\r\n            this.viewer.toolController.deregisterTool(this.snapper);\r\n            this.snapper = null;\r\n        }\r\n\r\n        var svg = this.svg;\r\n        if (svg && this.onMouseDownBinded) {\r\n            svg.removeEventListener(\"mousedown\", this.onMouseDownBinded);\r\n            this.onMouseDownBinded = null;\r\n        }\r\n        if (svg.parentNode) {\r\n            svg.parentNode.removeChild(svg);\r\n        }\r\n        this.editModeSvgLayerNode = null;\r\n        this.svg = null;\r\n\r\n        return true;\r\n    };\r\n\r\n    MarkupsCore.prototype.getStrokeWidth = function() {\r\n        \r\n        if (!this.initialStrokeWidth || (this.viewer.model && !this.viewer.model.is2d())) {\r\n            this.initialStrokeWidth = this.sizeFromClientToMarkups(0, MARKUP_DEFAULT_STROKE_WIDTH_IN_PIXELS).y;\r\n        }\r\n\r\n        return this.initialStrokeWidth;\r\n    };\r\n\r\n    MarkupsCore.prototype.getFontWidth = function() {\r\n        \r\n        if (!this.initialFontWidth || (this.viewer.model && !this.viewer.model.is2d())) {\r\n            this.initialFontWidth = this.sizeFromClientToMarkups(0, MARKUP_DEFAULT_FONT_WIDTH_IN_PIXELS).y;\r\n        }\r\n\r\n        return this.initialFontWidth;\r\n    };\r\n\r\n    /**\r\n     * Toggle in and out of Edit mode. In Edit mode the user is able to draw markups on the canvas.\r\n     *\r\n     * See also\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#enterEditMode|enterEditMode()} and\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#leaveEditMode|leaveEditMode()}\r\n     */\r\n    MarkupsCore.prototype.toggleEditMode = function() {\r\n\r\n        if (this.duringEditMode) {\r\n            this.leaveEditMode();\r\n        } else {\r\n            this.enterEditMode();\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Enables mouse interactions and mobile device gestures over the Viewer canvas to create or draw markups.\r\n     *\r\n     * Exit Edit mode by calling {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#leaveEditMode|leaveEditMode()}.\r\n     *\r\n     * See also\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#show|show()}\r\n     * @param {string} layerId - [optional] Identifier for the layer of markups to be edited. Example \"Layer1\".\r\n     * @returns {boolean} Returns true if editMode is active\r\n     */\r\n    MarkupsCore.prototype.enterEditMode = function(layerId) {\r\n\r\n        function disableLayerMarkups(layer, disable){\r\n            if (layer){\r\n                var layerMarkups = layer.markups;\r\n                for (var k = 0; k < layerMarkups.length; k++){\r\n                    var m = layerMarkups[k];\r\n                    m.disableInteractions(disable);\r\n                }\r\n            }\r\n        }\r\n        if (layerId) {\r\n            if (!this.svgLayersMap[layerId]) {\r\n                // if layerId is supplied but it does not exist in the svgLayerMap then create the new layer\r\n                console.warn(\"No such layer exists.\");\r\n                return false;\r\n            }\r\n        }\r\n\r\n        // If not currently shown, then show\r\n        if (!this.duringViewMode) {\r\n            if (!this.show()){\r\n                return false; // Failed to enter view mode.\r\n            }\r\n        }\r\n\r\n        // Initialize the edit mode layer if it does not exist\r\n        if(!this.editModeSvgLayerNode) {\r\n            var parSvg = this.createSvgElement('g');\r\n            this.editModeSvgLayerNode = {\r\n                markups: [],\r\n                svg: parSvg\r\n            };\r\n            this.editModeSvgLayerNode.svg.setAttribute('cursor', 'default');\r\n        }\r\n\r\n\r\n        if ((this.editModeSvgLayerNode.svg.parentNode != this.svg) || !layerId) {\r\n            this.svg.appendChild(this.editModeSvgLayerNode.svg);\r\n        }\r\n        this.svg.setAttribute('cursor', 'crosshair');\r\n\r\n\r\n        if (layerId) {\r\n            var layer = this.svgLayersMap[layerId];\r\n            // If the layer exists in the layer map, use the information stored for that specific layer.\r\n            if (layer) {\r\n                // Remove the edit layer when entering edit mode of a specific edit mode.\r\n                var editModeLayerParentNode = this.editModeSvgLayerNode.svg.parentNode;\r\n                editModeLayerParentNode && editModeLayerParentNode.removeChild(this.editModeSvgLayerNode.svg);\r\n\r\n                // disable the markups in the editModeLayer\r\n                disableLayerMarkups(this.editModeSvgLayerNode, true);\r\n\r\n                // Enable interactions for markups in the current edit layer and disable interactions for markups in\r\n                // the other layers.\r\n                for (var key in this.svgLayersMap){\r\n                    var markups = this.svgLayersMap[key].markups;\r\n                    for (var i = 0; i < markups.length; i++) {\r\n                        var markup = markups[i];\r\n                        if (key !== layerId.toString()){\r\n                            // disable all not in the current layer.\r\n                            markup.disableInteractions(true);\r\n                        } else {\r\n                            // enable all markups in current layer.\r\n                            markup.disableInteractions(false);\r\n                        }\r\n                    }\r\n                }\r\n\r\n                // assign the current layer to the global active layer\r\n                this.activeLayer = layerId;\r\n                this.editingLayer = layerId;\r\n                var svgParent = layer.svg;\r\n\r\n                // remove previous svg layer child from svg\r\n                svgParent.parentNode && this.svg.removeChild(svgParent);\r\n\r\n                // reassign the markups in that layer to the global markups list\r\n                this.markups = layer.markups.slice();\r\n\r\n                // re-append svg layer child to svg to make it the top most layer\r\n                this.svg.appendChild(svgParent);\r\n            }\r\n        } else {\r\n            // disable interactions for the previous markups\r\n            // Example: enterEditMode(layer) -> enterEditMode()\r\n            if (this.editingLayer) {\r\n                for (var k = 0; k < this.markups.length; k++) {\r\n                    var m = this.markups[k];\r\n                    m.disableInteractions(true);\r\n                }\r\n                disableLayerMarkups(this.editModeSvgLayerNode, false);\r\n            }\r\n            this.editingLayer = '';\r\n            if (!this.editModeSvgLayerNode) {\r\n                this.markups = [];\r\n            }else{\r\n                this.markups = this.editModeSvgLayerNode.markups.slice();\r\n            }\r\n            this.activeLayer = '';\r\n        }\r\n\r\n        this.input.enterEditMode();\r\n        this.activateTool(true);\r\n        this.styles = {}; // Clear EditMode styles.\r\n        this.defaultStyle = null;\r\n        this.duringEditMode = true;\r\n        this.changeEditMode(new EditModeArrow(this));\r\n        this.actionManager.clear();\r\n        this.dispatchEvent({ type: MarkupEvents.EVENT_EDITMODE_ENTER });\r\n        this.allowNavigation(false);\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Exits Edit mode.\r\n     *\r\n     * See also {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#enterEditMode|enterEditMode()}.\r\n     *\r\n     * @returns {boolean} Returns true if Edit mode has been deactivated\r\n     */\r\n    MarkupsCore.prototype.leaveEditMode = function() {\r\n\r\n        var NOT_IN_EDIT_MODE = true;\r\n        var WE_ARE_STILL_IN_EDIT_MODE = false;\r\n\r\n        if (!this.duringEditMode || !this.duringViewMode) {\r\n            return NOT_IN_EDIT_MODE;\r\n        }\r\n\r\n        var viewer = this.viewer;\r\n        if (!viewer) {\r\n            return WE_ARE_STILL_IN_EDIT_MODE; // something is very wrong...\r\n        }\r\n\r\n        this.editMode.destroy();\r\n        this.editMode = null;\r\n        this.duringEditMode = false;\r\n\r\n        if (this.snapper) {\r\n            this.snapper.indicator.clearOverlays();\r\n            this.snapper.clearSnapped();\r\n        }\r\n\r\n        // Remove the edit layer\r\n        if (this.editModeSvgLayerNode && this.editModeSvgLayerNode.svg.parentNode){\r\n            this.svg.removeChild(this.editModeSvgLayerNode.svg);\r\n        }\r\n        this.svg.setAttribute('cursor', 'default');\r\n\r\n        this.input.leaveEditMode();\r\n        this.editFrame.setMarkup(null);\r\n        this.activateTool(true);\r\n\r\n        this.allowNavigation(true);\r\n        this.dispatchEvent({ type: MarkupEvents.EVENT_EDITMODE_LEAVE });\r\n        return NOT_IN_EDIT_MODE;\r\n    };\r\n\r\n    /**\r\n     * Toggle between visible markups, i.e., show() and hidden markups, i.e., hide().\r\n     */\r\n    MarkupsCore.prototype.toggle = function() {\r\n\r\n        if (this.duringViewMode) {\r\n            this.hide();\r\n        } else {\r\n            this.show();\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Enables loading of previously saved markups.\r\n     * Exit Edit mode by calling {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#hide|hide()}.\r\n     *\r\n     * See also\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#enterEditMode|enterEditMode()}.\r\n     * @returns {boolean} Whether it successfully entered view mode or not.\r\n     */\r\n    MarkupsCore.prototype.show = function() {\r\n\r\n        var viewer = this.viewer;\r\n        if (!viewer || !viewer.model || !this.svg) {\r\n            return false;\r\n        }\r\n\r\n        // Return if already showing or in edit-mode.\r\n        // Notice that edit mode requires that we are currently show()-ing.\r\n        if (this.duringViewMode || this.duringEditMode) {\r\n            return true;\r\n        }\r\n\r\n        viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT, this.onCameraChangeBinded);\r\n        viewer.addEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT, this.onViewerResizeBinded);\r\n\r\n        // Add parent svg of all markups.\r\n        viewer.container.appendChild(this.svg);\r\n        viewer.reorderElements(this.svg);\r\n\r\n        this.input.enterViewMode();\r\n        hideLmvUi(viewer);\r\n\r\n        // TODO: Nasty hack, currently there is no API to disable mouse highlighting in 3d models.\r\n        // TODO: We nuke rollover function in viewer, for now, public api will be added soon.\r\n        this.onViewerRolloverObject = viewer.impl.rolloverObject;\r\n        viewer.impl.rolloverObject = function(){};\r\n\r\n        this.activateTool(true);\r\n        var camera = viewer.impl.camera;\r\n        this.onViewerResize({ width: camera.clientWidth, height: camera.clientHeight });\r\n\r\n        // See function loadMarkups() for when the actual SVG gets added onstage //\r\n        this.svgLayersMap = {};\r\n        this.duringViewMode = true;\r\n        this.allowNavigation(true);\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Removes any markup currently overlaid on the viewer. It exits Edit mode if it is active.\r\n     *\r\n     * See also\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#show|show()}\r\n     * @returns {boolean} Whether it successfully left view mode or not.\r\n     */\r\n    MarkupsCore.prototype.hide = function() {\r\n\r\n        var RESULT_HIDE_OK = true;\r\n        var RESULT_HIDE_FAIL = false;\r\n\r\n        var viewer = this.viewer;\r\n        if (!viewer || !this.duringViewMode) {\r\n            return RESULT_HIDE_OK;\r\n        }\r\n\r\n        if (this.duringEditMode) {\r\n            if (!this.leaveEditMode()) {\r\n                return RESULT_HIDE_FAIL;\r\n            }\r\n        }\r\n\r\n        viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT, this.onCameraChangeBinded);\r\n        viewer.removeEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT, this.onViewerResizeBinded);\r\n\r\n        var svg = this.svg;\r\n        svg.parentNode && svg.parentNode.removeChild(svg);\r\n\r\n        // Remove all Markups and metadata (if any)\r\n        this.unloadMarkupsAllLayers();\r\n        removeAllMetadata(svg);\r\n\r\n        this.input.leaveViewMode();\r\n        restoreLmvUi(viewer);\r\n        this.viewer.impl.rolloverObject = this.onViewerRolloverObject;\r\n\r\n        this.activateTool(false);\r\n        this.duringViewMode = false;\r\n        return RESULT_HIDE_OK;\r\n    };\r\n\r\n    /**\r\n     * Removes newly created markups in the current editing layer.\r\n     * Markups that were created in a specific layer will not be removed.\r\n     *\r\n     * Markups should have been added while in\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#enterEditMode|Edit mode}.\r\n     */\r\n    MarkupsCore.prototype.clear = function() {\r\n        // Can only clear specific layers when in the edit mode of that layer.\r\n        if (!this.duringEditMode) {\r\n            console.warn(\"Clear only removes markups when in Edit Mode.\");\r\n            return;\r\n        }\r\n        var editModeLayer = this.editingLayer ? this.svgLayersMap[this.editingLayer] : this.editModeSvgLayerNode;\r\n        if (editModeLayer) {\r\n            var markups = editModeLayer.markups;\r\n            var svg = editModeLayer.svg;\r\n            if (svg && svg.childNodes.length > 0) {\r\n                while (svg.childNodes.length) {\r\n                    svg.removeChild(svg.childNodes[0]);\r\n                }\r\n            }\r\n            while (markups.length > 0) {\r\n                var markup = markups[0];\r\n                this.removeMarkup(markup);\r\n                markup.destroy();\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Returns an SVG string with the markups created so far.\r\n     * The SVG string can be reloaded using\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#loadMarkups|loadMarkups()}.\r\n     *\r\n     * Markups should have been added while in\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#enterEditMode|Edit mode}.\r\n     * @returns {string} Returns an SVG element with all of the created markups in a string format.\r\n     */\r\n    MarkupsCore.prototype.generateData = function() {\r\n\r\n        var defaultLayer = this.editModeSvgLayerNode.svg;\r\n\r\n        if (this.editMode) {\r\n            this.editMode.onSave();\r\n        }\r\n\r\n        // Sanity check, remove any lingering metadata nodes\r\n        removeAllMetadata(this.svg);\r\n\r\n        if (this.activeLayer){\r\n            defaultLayer = this.svgLayersMap[this.activeLayer].svg;\r\n        }\r\n\r\n        var tmpNode = this.createSvgElement(\"svg\");\r\n        transferChildNodes(this.svg, tmpNode); // Transfer includes this.editModeSvgLayerNode\r\n        transferChildNodes(defaultLayer, this.svg);\r\n\r\n        // version 1: first implementation.\r\n        // version 2: added global offset to markup positions.\r\n        // version 3: change node structure to include hitareas, hit areas are not exported.\r\n        // version 4: scale perspective markups space by PERSPECTIVE_MODE_SCALE because bug in firefox. LMV-1150\r\n        var metadataObject = {\r\n            \"data-model-version\": \"4\"\r\n        };\r\n        var metadataNode = this.addSvgMetadata(this.svg, metadataObject);\r\n        var metadataNodes = [ metadataNode ];\r\n\r\n        // Notify each markup to inject metadata\r\n        this.markups.forEach(function(markup){\r\n            var addedNode = markup.setMetadata();\r\n            if (addedNode) {\r\n                metadataNodes.push(addedNode);\r\n            }\r\n        });\r\n\r\n        // Generate the data!\r\n        var data = svgNodeToString(this.svg);\r\n\r\n        // Remove metadataObject before returning\r\n        metadataNodes.forEach(function(metadataNode){\r\n            metadataNode.parentNode.removeChild(metadataNode);\r\n        });\r\n\r\n        transferChildNodes(this.svg, defaultLayer);\r\n        transferChildNodes(tmpNode, this.svg);\r\n        tmpNode = null; // get rid of it.\r\n\r\n        return  data;\r\n    };\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    MarkupsCore.prototype.generatePoints3d = function() {\r\n\r\n        var result = {markups: [], main: null};\r\n        var markups = this.markups;\r\n        var markupsCount = markups.length;\r\n\r\n        if (markupsCount === 0) {\r\n            return result;\r\n        }\r\n\r\n        // Gather a 3d point for markup.\r\n        var idTarget = this.viewer.impl.renderer().readbackTargetId();\r\n        for(var i = 0; i < markupsCount; ++i) {\r\n\r\n            var markup = markups[i];\r\n            var point = markup.generatePoint3d(idTarget) || null;\r\n            result.markups.push(\r\n                {\r\n                    id: markup.id,\r\n                    type: markup.type,\r\n                    point: point || null\r\n                });\r\n        }\r\n\r\n\r\n        // If there is 3d point associated with an arrow, we use that as main point.\r\n        if (markupsCount === 1) {\r\n\r\n            var main = result.markups[0].point;\r\n            result.main = main && main.clone();\r\n            return result;\r\n        }\r\n\r\n        for(var i = 0; i < markupsCount; ++i) {\r\n\r\n            var collision = result.markups[i];\r\n            if (collision.type === MarkupTypes.MARKUP_TYPE_ARROW && collision.point !== null) {\r\n\r\n                result.main = collision.point.clone();\r\n                return result;\r\n            }\r\n        }\r\n\r\n        // If there is no arrows, we average bounding boxes and get a 3d point inside it.\r\n        var bbX0 = Number.POSITIVE_INFINITY;\r\n        var bbY0 = Number.POSITIVE_INFINITY;\r\n        var bbX1 = Number.NEGATIVE_INFINITY;\r\n        var bbY1 = Number.NEGATIVE_INFINITY;\r\n\r\n        for(var i = 0; i < markupsCount; ++i) {\r\n\r\n            var boundingBox = markups[i].generateBoundingBox();\r\n\r\n            bbX0 = Math.min(bbX0, boundingBox.min.x);\r\n            bbY0 = Math.min(bbY0, boundingBox.min.y);\r\n            bbX1 = Math.max(bbX1, boundingBox.max.x);\r\n            bbY1 = Math.max(bbY1, boundingBox.max.y);\r\n        }\r\n\r\n        var polygon = {};\r\n\r\n        polygon.vertexCount = 4;\r\n        polygon.xVertices = new Float32Array([bbX0, bbX1, bbX1, bbX0]);\r\n        polygon.yVertices = new Float32Array([bbY0, bbY0, bbY1, bbY1]);\r\n\r\n        var point2d = this.checkPolygon(polygon, idTarget);\r\n        var point3d = point2d && this.viewer.clientToWorld(point2d.x, point2d.y);\r\n        result.main = point3d && point3d.point;\r\n\r\n        return result;\r\n    };\r\n\r\n    /**\r\n     * Renders the markups onto a 2D canvas context to generate an image.\r\n     * @param {CanvasRenderingContext2D} context - Markups are drawn using the context provided\r\n     */\r\n    MarkupsCore.prototype.renderToCanvas = function(context, callback, renderAllMarkups) {\r\n\r\n        var width = this.bounds.width;\r\n        var height = this.bounds.height;\r\n        var viewBox = this.getSvgViewBox(width, height);\r\n        var numberOfScreenshotsTaken = 0;\r\n        var markups = [];\r\n        var layer;\r\n\r\n        var onMarkupScreenshotTaken = function () {\r\n            if (callback && (++numberOfScreenshotsTaken === markups.length)) {\r\n                callback();\r\n            }\r\n        }.bind(this);\r\n\r\n        if (renderAllMarkups) {\r\n            var svgKeys = Object.keys(this.svg.childNodes);\r\n            var layersKeys = Object.keys(this.svgLayersMap);\r\n\r\n            // Append only markups that their parent layer is contained inside the svg main container.\r\n            for (var i = 0; i < svgKeys.length; i++) {                \r\n                for (var j = 0; j < layersKeys.length; j++) {\r\n                    layer = this.svgLayersMap[layersKeys[j]];\r\n                    if (this.svg.childNodes[svgKeys[i]] === layer.svg) {\r\n                        markups = markups.concat(layer.markups);\r\n                    }\r\n                }\r\n            }\r\n        } else {\r\n            layer = this.svgLayersMap[this.activeLayer] || this.editModeSvgLayerNode;\r\n            markups = layer.markups;\r\n        }\r\n\r\n        if (markups.length === 0) {\r\n            callback();\r\n        } else {\r\n            markups.forEach(function(markup) {\r\n                markup.renderToCanvas(context, viewBox, width, height, onMarkupScreenshotTaken);\r\n            });\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Changes the active drawing tool. For example, from the Arrow drawing tool to the Rectangle drawing tool.\r\n     * Only applicable while in {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#enterEditMode|Edit mode}.\r\n     *\r\n     * Supported values are:\r\n     * - `new Autodesk.Viewing.Extensions.Markups.Core.EditModeArrow(MarkupsCoreInstance)`\r\n     * - `new Autodesk.Viewing.Extensions.Markups.Core.EditModeRectangle(MarkupsCoreInstance)`\r\n     * - `new Autodesk.Viewing.Extensions.Markups.Core.EditModeCircle(MarkupsCoreInstance)`\r\n     * - `new Autodesk.Viewing.Extensions.Markups.Core.EditModeCloud(MarkupsCoreInstance)`\r\n     * - `new Autodesk.Viewing.Extensions.Markups.Core.EditModeText(MarkupsCoreInstance)`\r\n     * - `new Autodesk.Viewing.Extensions.Markups.Core.EditModeFreehand(MarkupsCoreInstance)`\r\n     * - `new Autodesk.Viewing.Extensions.Markups.Core.EditModePolyline(MarkupsCoreInstance)`\r\n     * - `new Autodesk.Viewing.Extensions.Markups.Core.EditModePolycloud(MarkupsCoreInstance)`\r\n     *\r\n     * This function fires event `Autodesk.Viewing.Extensions.Markups.Core.EVENT_EDITMODE_CHANGED`.\r\n     * @param {Object} editMode - Object instance for the drawing tool\r\n     */\r\n    MarkupsCore.prototype.changeEditMode = function(editMode) {\r\n\r\n        var oldEditMode = this.editMode;\r\n        oldEditMode && oldEditMode.destroy();\r\n\r\n        editMode.addEventListener(MarkupEvents.EVENT_EDITMODE_CREATION_BEGIN, function() {this.disableMarkupInteractions(true);}.bind(this));\r\n        editMode.addEventListener(MarkupEvents.EVENT_EDITMODE_CREATION_END, function(){this.disableMarkupInteractions(false);}.bind(this));\r\n        editMode.addEventListener(MarkupEvents.EVENT_MARKUP_DESELECT, function(event){this.dispatchEvent(event);}.bind(this));\r\n\r\n        this.editMode = editMode;\r\n        this.styles[editMode.type] = cloneStyle(editMode.getStyle());\r\n\r\n        this.dispatchEvent({type:MarkupEvents.EVENT_EDITMODE_CHANGED, target: editMode});\r\n    };\r\n\r\n    /**\r\n     * Check whether a user can perform camera navigation operations on the current loaded model.\r\n     * While the extension is active, the user can still draw markups.\r\n     * Panning and zooming are only supported for orthographic cameras.\r\n     *\r\n     * @return {boolean} Whether {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#allowNavigation|allowNavigation()} can succeed.\r\n     */\r\n    MarkupsCore.prototype.isNavigationAllowed = function() {\r\n\r\n        return !this.viewer.impl.camera.isPerspective;\r\n    };\r\n\r\n    /**\r\n     * Enables click, tap, and swipe behavior to allow camera zoom and panning operations. It is only available in\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#enterEditMode|Edit mode}.\r\n     *\r\n     * @param {boolean} allow - Whether camera navigation interactions are active or not.\r\n     */\r\n    MarkupsCore.prototype.allowNavigation = function(allow) {\r\n\r\n        //we will still need to update the markup styles even if in perspective mode\r\n        var editMode = this.editMode;\r\n        this.navigating = allow;\r\n\r\n        if (allow){\r\n            this.svg.setAttribute(\"pointer-events\", \"none\");\r\n            editMode && this.selectMarkup(null);\r\n        } else {\r\n            this.svg.setAttribute(\"pointer-events\", \"painted\");\r\n        }\r\n\r\n        // Update pointer events for all markups.\r\n        var markups = this.markups;\r\n        var markupsCount = markups.length;\r\n\r\n        for(var i = 0; i < markupsCount; ++i) {\r\n            markups[i].updateStyle();\r\n        }\r\n        editMode && editMode.notifyAllowNavigation(allow);\r\n\r\n        // Navigation is not allowed while in perspective mode.\r\n        if (allow && (this.duringEditMode || this.duringViewMode) && !this.isNavigationAllowed()) {\r\n            return false;\r\n        }\r\n\r\n        // Clear snapper.\r\n        if (allow && this.snapper) {\r\n            this.snapper.indicator.clearOverlays();\r\n            this.snapper.clearSnapped();\r\n        }\r\n\r\n        this.markupTool.allowNavigation(allow);\r\n\r\n    };\r\n\r\n    /**\r\n     * Sets mouse interactions and mobile device gestures with markups. Only applicable in\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#enterEditMode|Edit mode}.\r\n     * @param {boolean} disable - true to disable interactions with markups; false to enable interactions with markups; default false.\r\n     */\r\n    MarkupsCore.prototype.disableMarkupInteractions = function(disable) {\r\n\r\n        if (this.editModeSvgLayerNode) {\r\n            this.editModeSvgLayerNode.svg.setAttribute('cursor', disable ? 'inherit' : 'default');\r\n        }\r\n        this.markups.forEach(function(markup) {markup.disableInteractions(disable);});\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param isActive\r\n     * @private\r\n     */\r\n    MarkupsCore.prototype.activateTool = function(isActive) {\r\n        if (isActive) {\r\n            if (!this.cachedNavigationTool) {\r\n                this.cachedNavigationTool = this.viewer.getActiveNavigationTool();\r\n                this.viewer.addEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT, this.onToolChangeBinded);\r\n            }\r\n            this.viewer.setActiveNavigationTool(this.markupTool.getName());\r\n        } else {\r\n\r\n            if (this.cachedNavigationTool) {\r\n                this.viewer.setActiveNavigationTool(this.cachedNavigationTool);\r\n                this.cachedNavigationTool = null;\r\n            } else {\r\n                var defaultToolName = this.viewer.getDefaultNavigationToolName();\r\n                this.viewer.setActiveNavigationTool(defaultToolName);\r\n            }\r\n\r\n            this.viewer.removeEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT, this.onToolChangeBinded);\r\n        }\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param event\r\n     * @private\r\n     */\r\n    MarkupsCore.prototype.onToolChange = function(event) {\r\n\r\n        if (event.toolName !== this.markupTool.getName())\r\n            return;\r\n\r\n        if (event.active) {\r\n            var navAllowed = this.isNavigationAllowed();\r\n            this.viewer.setNavigationLockSettings({\r\n                pan      : navAllowed,\r\n                zoom     : navAllowed,\r\n                orbit    : false,\r\n                roll     : false,\r\n                fov      : false,\r\n                walk     : false,\r\n                gotoview : false\r\n            });\r\n        }\r\n        this.viewer.setNavigationLock(event.active);\r\n    };\r\n\r\n    MarkupsCore.prototype.onUnitsCalibrationStarts = function(event) {\r\n        if (this.duringEditMode) {\r\n            this.hide();\r\n        }\r\n    };\r\n\r\n    //// Input /////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n    proto.changeInputHandler = function(inputHandler) {\r\n\r\n        this.input.detachFrom(this);\r\n        inputHandler.attachTo(this);\r\n        this.input = inputHandler;\r\n\r\n        if (this.duringEditMode) {\r\n            inputHandler.enterEditMode();\r\n        }\r\n\r\n        if (this.duringViewMode) {\r\n            inputHandler.enterViewMode();\r\n        }\r\n    };\r\n\r\n    //// Copy and Paste System /////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n    /**\r\n     * Standard copy operation. Applies to any selected markup.<br>\r\n     * See also\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#cut|cut()} and\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#paste|paste()}.\r\n     */\r\n    MarkupsCore.prototype.copy = function() {\r\n\r\n        this.clipboard.copy();\r\n    };\r\n\r\n    /**\r\n     * Standard cut operation. Applies to any selected markup, which gets removed from the screen at call time.<br>\r\n     * See also\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#copy|copy()} and\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#paste|paste()}.\r\n     */\r\n    MarkupsCore.prototype.cut = function() {\r\n\r\n        this.clipboard.cut();\r\n    };\r\n\r\n    /**\r\n     * Standard paste operation. This function will paste any previously copied or cut markup.\r\n     * Can be called repeatedly after a single copy or cut operation.<br>\r\n     * See also\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#copy|copy()} and\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#cut|cut()}.\r\n     */\r\n    MarkupsCore.prototype.paste = function() {\r\n\r\n        this.clipboard.paste();\r\n    };\r\n\r\n    //// Undo and Redo System //////////////////////////////////////////////////////////////////////////////////////////\r\n    /**\r\n     * Will undo the previous operation.<br>\r\n     * The Undo/Redo stacks will track any change done to the existing markups.<br>\r\n     * See also\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#redo|redo()} and\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#isUndoStackEmpty|isUndoStackEmpty()}.\r\n     */\r\n    MarkupsCore.prototype.undo = function() {\r\n\r\n        this.actionManager.undo();\r\n    };\r\n\r\n    /**\r\n     * Will redo any previously undo operation.<br>\r\n     * See also\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#undo|undo()},\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#isRedoStackEmpty|isRedoStackEmpty()}.\r\n     */\r\n    MarkupsCore.prototype.redo = function() {\r\n\r\n        this.actionManager.redo();\r\n    };\r\n\r\n    /**\r\n     * Returns true when {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#undo|undo()}\r\n     * produces no changes.\r\n     * @return {boolean} true if there are no changes to undo; false if there are changes to undo.\r\n     */\r\n    MarkupsCore.prototype.isUndoStackEmpty = function() {\r\n\r\n        return this.actionManager.isUndoStackEmpty();\r\n    };\r\n\r\n    /**\r\n     * Returns true when {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#redo|redo()}\r\n     * produces no changes.\r\n     * @return {boolean} true if there are no changes to redo; false if there are changes to redo.\r\n     */\r\n    MarkupsCore.prototype.isRedoStackEmpty = function() {\r\n\r\n        return this.actionManager.isRedoStackEmpty();\r\n    };\r\n\r\n    proto.beginActionGroup = function() {\r\n\r\n        this.actionManager.beginActionGroup();\r\n    };\r\n\r\n    proto.closeActionGroup = function() {\r\n\r\n        this.actionManager.closeActionGroup();\r\n    };\r\n\r\n    proto.cancelActionGroup = function() {\r\n\r\n        this.actionManager.cancelActionGroup();\r\n    };\r\n\r\n    /**\r\n     * Helper function for generating unique markup ids.\r\n     * @returns {number}\r\n     */\r\n    proto.getId = function() {\r\n\r\n        return ++this.nextId;\r\n    };\r\n\r\n    /**\r\n     * @param event\r\n     * @private\r\n     */\r\n    proto.onEditActionHistoryChanged = function(event) {\r\n\r\n        var data = event.data;\r\n        if((data.action !== 'undo' && data.targetId !== -1)) {\r\n\r\n            // Markup can be null when deleting, that's ok, we unselect in that case.\r\n            var markup = this.getMarkup(data.targetId);\r\n            this.selectMarkup(markup);\r\n        }\r\n        if(data.action === 'undo' && !this.isUndoStackEmpty()) {\r\n\r\n          var markup = this.getMarkup(this.actionManager.getLastElementInUndoStack().getTargetId());\r\n          this.selectMarkup(markup);\r\n        }\r\n\r\n        this.dispatchEvent(event);\r\n    };\r\n\r\n    /**\r\n     * Returns a markup with the specified ID. Returns null when not found.\r\n     * The ID can be retrieved from the return value of getSelection(). <br>\r\n     * See also\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#getSelection|getSelection()}.\r\n     * @param {string} id Markup identifier.\r\n     * @returns {Autodesk.Viewing.Extensions.Markups.Core.Markup} Returns markup object.\r\n     */\r\n    MarkupsCore.prototype.getMarkup = function(id) {\r\n\r\n        var markups = this.markups;\r\n        var markupsCount = markups.length;\r\n\r\n        for(var i = 0; i < markupsCount; ++i) {\r\n            if (markups[i].id == id) {\r\n                return markups[i];\r\n            }\r\n        }\r\n\r\n        return null;\r\n    };\r\n\r\n\r\n    /**\r\n     * Selects or deselects a markup. A selected markup gets an overlayed UI that allows you to perform transformations\r\n     * such as resizing, rotations, and translations. To deselect a markup, send a null value. <br>\r\n     * See also\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#getMarkup|getMarkup()}.\r\n     * @param {Autodesk.Viewing.Extensions.Markups.Core.Markup|null} markup The markup instance to select. Set the value to null to deselect a markup.\r\n     */\r\n    MarkupsCore.prototype.selectMarkup = function(markup) {\r\n\r\n        if (markup) {\r\n\r\n            if (this.editMode.type === markup.type) {\r\n                this.editMode.setSelection(markup);\r\n            } else {\r\n\r\n                var editMode = markup.getEditMode();\r\n                editMode.setSelection(null);\r\n\r\n                this.changeEditMode(editMode);\r\n                this.setStyle(markup.getStyle());\r\n                this.editMode.setSelection(markup);\r\n            }\r\n        } else {\r\n            // fix for text markup in view mode\r\n            if (this.editMode){\r\n                this.editMode.setSelection(null);\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Returns the currently selected markup. A selected markup has a custom UI overlayed that allows you to perform\r\n     * resizing, rotations and translations.<br>\r\n     * See also\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#selectMarkup|selectMarkup()}.\r\n     * @returns {Autodesk.Viewing.Extensions.Markups.Core.Markup|null} Returns selected markup object; null if no markup is selected.\r\n     */\r\n    MarkupsCore.prototype.getSelection = function() {\r\n\r\n        return this.editMode.getSelection();\r\n    };\r\n\r\n    /**\r\n     * Deletes a markup from the canvas. Only applies while in\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#enterEditMode|Edit mode}.\r\n     * @param {Autodesk.Viewing.Extensions.Markups.Core.Markup} markup - Markup object.\r\n     * @param {boolean} [dontAddToHistory] Whether delete action can be {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#undo|undone}.\r\n     */\r\n    MarkupsCore.prototype.deleteMarkup = function(markup, dontAddToHistory) {\r\n\r\n        if (!this.editMode || (this.editMode && this.editMode.selectedMarkup.id !== markup.id)) {\r\n            this.editMode = markup.getEditMode();\r\n        }\r\n        this.editMode.deleteMarkup(markup, dontAddToHistory);\r\n    };\r\n\r\n    proto.addMarkup = function(markup) {\r\n\r\n        var markups;\r\n        var layer = this.activeLayer;\r\n        var layerObject = this.svgLayersMap[layer] || '';\r\n\r\n        if (layerObject) {\r\n            var svgParent = layerObject.svg;\r\n            // append markup svg to layer svg\r\n            markup.setParent(svgParent);\r\n            // Add markup to layer markups if it does not exist\r\n            layerObject.markups.push(markup);\r\n            markups = layerObject.markups.slice();\r\n        } else {\r\n            // if layer is undefined create a edit mode svg layer\r\n            markup.setParent(this.editModeSvgLayerNode.svg);\r\n            this.editModeSvgLayerNode.markups.push(markup);\r\n            markups = this.editModeSvgLayerNode.markups.slice();\r\n        }\r\n        \r\n        markup.addEventListener(MarkupEvents.EVENT_MARKUP_SELECTED, this.onMarkupSelectedBinded);\r\n        markup.addEventListener(MarkupEvents.EVENT_MARKUP_ENTER_EDITION, this.onMarkupEnterEditionBinded);\r\n        markup.addEventListener(MarkupEvents.EVENT_MARKUP_CANCEL_EDITION, this.onMarkupCancelEditionBinded);\r\n        markup.addEventListener(MarkupEvents.EVENT_MARKUP_DELETE_EDITION, this.onMarkupDeleteEditionBinded);\r\n        // Only set the global markups array when in edit mode\r\n        if (this.duringEditMode) {\r\n            this.markups = markups;\r\n        }\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param markup\r\n     * @private\r\n     */\r\n    proto.removeMarkup = function(markup) {\r\n\r\n        if (!markup){\r\n            return false;\r\n        }\r\n        var self = this;\r\n\r\n        /**\r\n         * Get the layer markups in which the markup exists.\r\n         * This function will remove the markup if it exists in the corresponding layer markups array.\r\n         * @param markup\r\n         * @returns {number} returns -1 if the markup does not exist in a layer markups array\r\n         */\r\n        function removeMarkupIfExists(markup){\r\n            var markupIndex;\r\n            var layerMarkups = -1;\r\n            // check if the markup exists in the edit layer\r\n            if (self.editModeSvgLayerNode){\r\n                var editLayerMarkups = self.editModeSvgLayerNode.markups;\r\n                markupIndex = editLayerMarkups.indexOf(markup);\r\n                if (markupIndex !== -1) {\r\n                    // remove the markup from the corresponding markup array\r\n                    editLayerMarkups.splice(markupIndex, 1);\r\n                    layerMarkups = editLayerMarkups.slice();\r\n                    // update the global markups array if the markup is in the active layer\r\n                    if (self.activeLayer === ''){\r\n                        self.markups = layerMarkups;\r\n                    }\r\n                    return layerMarkups;\r\n                }\r\n            }\r\n            // check if the markup exists in a layer\r\n            if (self.svgLayersMap) {\r\n                for (var layer in self.svgLayersMap) {\r\n                    var markups = self.svgLayersMap[layer].markups;\r\n                    markupIndex = markups.indexOf(markup);\r\n                    if (markupIndex !== -1) {\r\n                        // remove the markup from the corresponding markup array\r\n                        markups.splice(markupIndex, 1);\r\n                        layerMarkups = markups.slice();\r\n                        // update the global markups array if the markup is in the active layer\r\n                        if (self.activeLayer === layer){\r\n                            self.markups = layerMarkups;\r\n                        }\r\n                        return layerMarkups;\r\n                    }\r\n                }\r\n            }\r\n            return layerMarkups;\r\n        }\r\n\r\n        var layerMarkups = removeMarkupIfExists(markup);\r\n        if (layerMarkups === -1)\r\n            return false;\r\n\r\n        markup.setParent(null);\r\n\r\n        markup.removeEventListener(MarkupEvents.EVENT_MARKUP_SELECTED, this.onMarkupSelectedBinded);\r\n        markup.removeEventListener(MarkupEvents.EVENT_MARKUP_ENTER_EDITION, this.onMarkupEnterEditionBinded);\r\n        markup.removeEventListener(MarkupEvents.EVENT_MARKUP_CANCEL_EDITION, this.onMarkupCancelEditionBinded);\r\n        markup.removeEventListener(MarkupEvents.EVENT_MARKUP_DELETE_EDITION, this.onMarkupDeleteEditionBinded);\r\n\r\n        var editMode = this.editMode;\r\n        if (editMode) {\r\n            var selectedMarkup = editMode.getSelection();\r\n            if (selectedMarkup === markup) {\r\n                this.selectMarkup(null);\r\n            }\r\n        }\r\n    };\r\n\r\n    //// Markups style /////////////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n    MarkupsCore.prototype.setStyle = function(style) {\r\n\r\n        var styles = this.styles;\r\n        var editMode = this.editMode;\r\n\r\n        copyStyle(style, styles[editMode.type]);\r\n        // copyStyle(styles[editMode.type], style);\r\n        editMode.setStyle(styles[editMode.type]);\r\n    };\r\n\r\n    MarkupsCore.prototype.getStyle = function() {\r\n\r\n        return cloneStyle(this.styles[this.editMode.type]);\r\n    };\r\n\r\n    MarkupsCore.prototype.getDefaultStyle = function() {\r\n\r\n        var defaultStyleAttributes = [\r\n            'stroke-width',\r\n            'font-size',\r\n            'font-family',\r\n            'font-style',\r\n            'font-weight',\r\n            'stroke-color',\r\n            'stroke-opacity',\r\n            'fill-color',\r\n            'fill-opacity'];\r\n        this.defaultStyle = this.defaultStyle || createStyle(defaultStyleAttributes, this);\r\n\r\n        return this.defaultStyle;\r\n    };\r\n\r\n    //// Markups depth order ///////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n    /**\r\n     *\r\n     * @param markup\r\n     */\r\n    proto.bringToFront = function(markup) {\r\n\r\n        this.sendMarkupTo(markup, this.markups.length-1);\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param markup\r\n     */\r\n    proto.sendToBack = function(markup) {\r\n\r\n        this.sendMarkupTo(markup, 0);\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param markup\r\n     */\r\n    proto.bringForward = function(markup) {\r\n\r\n        var markupIndex = this.markups.indexOf(markup);\r\n        this.sendMarkupTo(markup, markupIndex+1);\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param markup\r\n     */\r\n    proto.bringBackward = function(markup) {\r\n\r\n        var markupIndex = this.markups.indexOf(markup);\r\n        this.sendMarkupTo(markup, markupIndex-1);\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param markup\r\n     * @param index\r\n     * @private\r\n     */\r\n    proto.sendMarkupTo = function(markup, index) {\r\n\r\n        var markups = this.markups;\r\n        var markupIndex = markups.indexOf(markup);\r\n\r\n        if (markupIndex === -1 || index < 0 || index >= markups.length) {\r\n            return;\r\n        }\r\n\r\n        markups.splice(markupIndex, 1);\r\n        index = markupIndex > index ? index -1 : index;\r\n        markups.splice(index, 0, markup);\r\n\r\n        // TODO: Add markup in right position not always at the end.\r\n        markup.setParent(null);\r\n        if (this.activeLayer){\r\n            var parent = this.svgLayersMap[this.activeLayer].svg;\r\n            markup.setParent(parent);\r\n        }else {\r\n            markup.setParent(this.editModeSvgLayerNode.svg);\r\n        }\r\n    };\r\n\r\n\r\n    /**\r\n     * Loads data (SVG string) for all markups in a specified layer (layerId) to the Viewer's canvas.<br>\r\n     *\r\n     * See also\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#unloadMarkups|unloadMarkups()}, and\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#hideMarkups|hideMarkups()}.\r\n     *\r\n     * @param {string} markupString - SVG string with markups. See also {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#generateData|generateData()}.\r\n     * @param {string} layerId - Identifier for the layer where the markup should be loaded to. Example \"Layer1\".\r\n     * @return {boolean} Whether the markup string was able to be loaded successfully\r\n     */\r\n    MarkupsCore.prototype.loadMarkups = function (markupString, layerId) {\r\n\r\n        function getDataModelVersion(node) {\r\n            var metadata = node.childNodes[0] ? node.childNodes[0].childNodes[0] : null;\r\n            var versionAttr = metadata && (typeof metadata.getAttribute === 'function') && metadata.getAttribute('data-model-version');\r\n\r\n            return (typeof versionAttr === 'string') ? parseFloat(versionAttr) : null;\r\n        }\r\n\r\n        if (this.duringEditMode) {\r\n            console.warn(\"Markups will not be loaded during the edit mode\");\r\n            return false;\r\n        }\r\n\r\n        if (!this.duringViewMode) {\r\n            return false;\r\n        }\r\n\r\n        if (!layerId) {\r\n            console.warn(\"loadMarkups failed; missing 2nd argument 'layerId'\");\r\n            return false;\r\n        }\r\n\r\n        // Can it be parsed into SVG?\r\n        var parent = stringToSvgNode(markupString);\r\n        if (!parent) {\r\n            return false;\r\n        }\r\n\r\n        // var version = getDataModelVersion(parent);\r\n\r\n        // If the supplied layerId exists in the svg layers map and there are children in the svg then return false.\r\n        if (layerId in this.svgLayersMap && this.svg.childNodes.length > 0) {\r\n            console.warn(\"This layer is already loaded, will not load again.\");\r\n            return false;\r\n        }\r\n        this.activeLayer = layerId;\r\n        var svgLayerNode = this.svgLayersMap[layerId];\r\n\r\n        // if the layer exists, delete it\r\n        if (svgLayerNode)\r\n            delete this.svgLayersMap[layerId];\r\n\r\n        // create an empty parent svg layer node for layerId\r\n        // Child markups will get added to th parent svg layer node in the addMarkup function\r\n        var newSvg = this.createLayerNode();\r\n\r\n        svgLayerNode = {\r\n            markups: [],\r\n            svgString: markupString,\r\n            svg: newSvg\r\n        };\r\n        this.svgLayersMap[layerId] = svgLayerNode;\r\n\r\n        var children = parent.childNodes;\r\n        for (var i = 0; i < children.length; i++) {\r\n            var child = children[i];\r\n            var markup = createMarkupFromSVG(child, this);\r\n            // Disable markups if already in edit mode and the active layer is different\r\n            if (markup && this.duringEditMode && this.editingLayer !== this.activeLayer) {\r\n                markup.disableInteractions(true);\r\n            }\r\n\r\n            if (!markup && child.localName !== \"metadata\") {\r\n                // Append child removes it from parent and copies it over to the new svg layer node,\r\n                // so we need to reduce index by 1 to continue proper iteration\r\n                svgLayerNode.svg.appendChild(child);\r\n                i--;\r\n                if (typeof child.setAttribute === 'function') {\r\n                    child.setAttribute(\"pointer-events\", \"none\");\r\n                }\r\n            }\r\n        }\r\n\r\n        var svgParentNode = this.svgLayersMap[this.activeLayer].svg;\r\n\r\n        this.svg.appendChild(svgParentNode);\r\n        // If already in an edit mode layer then reassign active layer to edit layer\r\n        if(this.duringEditMode && this.editingLayer !== this.activeLayer) {\r\n            this.activeLayer = this.editingLayer;\r\n            if (this.editingLayer)\r\n                this.markups = this.svgLayersMap[this.activeLayer].markups.slice();\r\n        }\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * TODO: Probably this function needs to be moved to MarkupCoreUtils.js\r\n     * Creates a new layer node\r\n     * */\r\n\r\n    proto.createLayerNode = function() {\r\n\r\n        var newSvgLayerNode = this.createSvgElement('g');\r\n        newSvgLayerNode.setAttribute('cursor', 'default');\r\n        return newSvgLayerNode;\r\n    };\r\n\r\n    /**\r\n     * Revert any changes made to the specific layer.\r\n     *\r\n     * See also\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#loadMarkups|loadMarkups()} and\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#enterEditMode|enterEditMode()}.\r\n     *\r\n     * @param {string} layerId - ID of the layer to revert any changes that were made to it.\r\n     * @returns {boolean} true if the layer was unloaded, false if the layer was not unloaded.\r\n     */\r\n    MarkupsCore.prototype.revertLayer = function(layerId){\r\n        if (!layerId) {\r\n            console.warn(\"revertLayer failed because no layerId was supplied.\");\r\n            return false;\r\n        }\r\n        var svgLayerNode = this.svgLayersMap[layerId];\r\n        if (!svgLayerNode){\r\n            console.warn(\"The supplied layer does not exist.\");\r\n            return false;\r\n        }\r\n        var inEditMode = this.duringEditMode;\r\n        // Leave editMode to revert a layer\r\n        if (inEditMode)\r\n            this.leaveEditMode();\r\n\r\n        // keep track of previous global markups.\r\n        var currentMarkups = this.markups.slice();\r\n        // Set the global markups to the markups in the current layer. These ones get removed in the unloadMarkups\r\n        this.markups = svgLayerNode.markups;\r\n        var layerSvg = svgLayerNode.svgString;\r\n        this.unloadMarkups(layerId);\r\n        this.loadMarkups(layerSvg, layerId);\r\n        // Assign markups\r\n        if (this.editingLayer){\r\n            if(this.editingLayer !== layerId) {\r\n                this.markups = currentMarkups;\r\n                var layerObject = this.svgLayersMap[this.editingLayer];\r\n                if (layerObject) {\r\n                    layerObject.markups = currentMarkups;\r\n                }\r\n            }\r\n        }else{\r\n            if(this.editModeSvgLayerNode){\r\n                this.editModeSvgLayerNode.markups = currentMarkups;\r\n            }\r\n        }\r\n\r\n        if(this.editingLayer || this.editingLayer.length === 0){\r\n            var svg = this.editingLayer.length === 0 ? this.editModeSvgLayerNode.svg : this.svgLayersMap[this.editingLayer].svg;\r\n            if (svg.parentNode == this.svg) {\r\n                this.svg.removeChild(svg);\r\n                this.svg.appendChild(svg);\r\n            }\r\n        }\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Removes markups from the DOM (Document Object Model). This is helpful for freeing up memory.<br>\r\n     *\r\n     * See also\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#loadMarkups|loadMarkups()},\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#unloadMarkupsAllLayers|unloadMarkupsAllLayers()},\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#clear|clear()},\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#hide|hide()}, and\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#hideMarkups|hideMarkups()}.\r\n     *\r\n     * @param {string} layerId - ID of the layer containing all markups to unload (from the DOM).\r\n     * @return {boolean} Whether the operation succeeded or not.\r\n     */\r\n    MarkupsCore.prototype.unloadMarkups = function(layerId) {\r\n\r\n        if (!layerId) {\r\n            console.warn(\"unloadMarkups failed; No layerId provided.\");\r\n            return false;\r\n        }\r\n\r\n        var svgLayerNode = this.svgLayersMap[layerId];\r\n        if (!svgLayerNode) {\r\n            // TODO: Do we need to log anything here?\r\n            console.warn('No such layer exists to unload.');\r\n            return false;\r\n        }\r\n\r\n        var layerMarkups = svgLayerNode.markups.slice();\r\n        var numMarkups = layerMarkups.length;\r\n        for (var i = 0; i < numMarkups; i++) {\r\n            var markup = layerMarkups[i];\r\n            this.removeMarkup(markup);\r\n            markup.destroy();\r\n        }\r\n\r\n        // Remove the markups in the layer from the svg canvas\r\n        if (svgLayerNode.svg.parentNode === this.svg)\r\n            this.svg.removeChild(svgLayerNode.svg);\r\n\r\n        // Delete the layer from the layer map.\r\n        delete this.svgLayersMap[layerId];\r\n        // Reset the active layer if the supplied layer id is the same as the active layer\r\n        if (this.activeLayer.toString() === layerId.toString()) {\r\n            this.activeLayer = '';\r\n        }\r\n        // Leave edit mode and reset the editing layer if the supplied layer is the same as the current editing layer\r\n        if (this.editingLayer && this.editingLayer.toString() === layerId.toString()){\r\n            this.editingLayer = '';\r\n            this.duringEditMode && this.leaveEditMode();\r\n        }\r\n\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Removes all markups loaded so far. Great for freeing up memory.\r\n     *\r\n     * See also\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#loadMarkups|loadMarkups()},\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#unloadMarkups|unloadMarkups()},\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#clear|clear()},\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#hide|hide()}, and\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#hideMarkups|hideMarkups()}.\r\n     */\r\n    MarkupsCore.prototype.unloadMarkupsAllLayers = function() {\r\n        this.activeLayer = '';\r\n        var self = this;\r\n\r\n        //this is specific to the editModeSvgLayerNode, enterEditMode().\r\n        var unloadSvgLayerNode = function(){\r\n            if (self.editModeSvgLayerNode){\r\n                var layerMarkups = self.editModeSvgLayerNode.markups.slice();\r\n                var numMarkups = layerMarkups.length;\r\n                for (var i = 0; i < numMarkups; i++) {\r\n                    var markup = layerMarkups[i];\r\n                    self.removeMarkup(markup);\r\n                    markup.destroy();\r\n                }\r\n            }\r\n        };\r\n\r\n        // Unload the markups in the editModeSvgLayerNode\r\n        unloadSvgLayerNode();\r\n        var layerId;\r\n        for (layerId in this.svgLayersMap){\r\n            this.unloadMarkups(layerId);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Hides all markups in a specified layer. Note that hidden markups will not be unloaded.\r\n     * Use the {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#showMarkups|showMarkups()} method to make\r\n     * them visible again; no additional parsing is required.\r\n     *\r\n     * See also\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#showMarkups|showMarkups()},\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#unloadMarkups|unloadMarkups()}, and\r\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#loadMarkups|loadMarkups()}.\r\n     *\r\n     * @param {string} layerId - ID of the layer containing all markups that should be hidden (in the DOM).\r\n     * @return {boolean} Whether the operation succeeded or not.\r\n     */\r\n    MarkupsCore.prototype.hideMarkups = function(layerId) {\r\n\r\n        if (!layerId) {\r\n            console.warn(\"hideMarkups failed; No layerId provided.\");\r\n            return false;\r\n        }\r\n\r\n        var svgLayerNode = this.svgLayersMap[layerId];\r\n        if (!svgLayerNode) {\r\n            // TODO: Do we need to log anything here?\r\n            return false;\r\n        }\r\n        var layerSvg = svgLayerNode.svg;\r\n\r\n        // Return false if the layer svg is not present in the main svg\r\n        if (layerSvg.parentNode != this.svg) {\r\n            console.warn(\"Layer is already hidden.\");\r\n            return false;\r\n        }\r\n        // remove the layer svg from the main svg\r\n        this.svg.removeChild(layerSvg);\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Unhides a layer of hidden markups\r\n     * ({@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#hideMarkups|hideMarkups()}).\r\n     *\r\n     * @param {string} layerId - ID of the layer containing all markups to unload (from the DOM).\r\n     * @return {boolean} Whether the operation succeeded or not.\r\n     */\r\n    MarkupsCore.prototype.showMarkups = function(layerId) {\r\n\r\n        if (!layerId) {\r\n            console.warn(\"showMarkups failed; No layerId provided.\");\r\n            return false;\r\n        }\r\n\r\n        var svgLayerNode = this.svgLayersMap[layerId];\r\n        if (!svgLayerNode) {\r\n            // TODO: Do we need to log anything here?\r\n            return false;\r\n        }\r\n        // Append the layer svg to the main svg\r\n        var layerSvg = svgLayerNode.svg;\r\n        this.svg.appendChild(layerSvg);\r\n    };\r\n\r\n    //// Client Space <-> Markup Space /////////////////////////////////////////////////////////////////////////////////\r\n\r\n    proto.positionFromClientToMarkups = function(x, y) {\r\n\r\n        return this.clientToMarkups(x, y);\r\n    };\r\n\r\n    proto.positionFromMarkupsToClient = function(x, y) {\r\n\r\n        return this.markupsToClient(x, y);\r\n    };\r\n\r\n    proto.vectorFromClientToMarkups = function(x, y) {\r\n\r\n        var a = this.clientToMarkups(0, 0);\r\n        var b = this.clientToMarkups(x, y);\r\n\r\n        return {x: b.x - a.x, y: b.y - a.y};\r\n    };\r\n\r\n    proto.vectorFromMarkupsToClient = function(x, y) {\r\n\r\n        var a = this.markupsToClient(0, 0);\r\n        var b = this.markupsToClient(x, y);\r\n\r\n        return {x: b.x - a.x, y: b.y - a.y};\r\n    };\r\n\r\n    proto.sizeFromClientToMarkups = function(w, h) {\r\n\r\n        var a = this.clientToMarkups(0, 0);\r\n        var b = this.clientToMarkups(w, h);\r\n\r\n        return {x: Math.abs(b.x - a.x), y: Math.abs(b.y - a.y)};\r\n    };\r\n\r\n    proto.sizeFromMarkupsToClient = function(w, h) {\r\n\r\n        var a = this.markupsToClient(0, 0);\r\n        var b = this.markupsToClient(w, h);\r\n\r\n        return {x: Math.abs(b.x - a.x), y: Math.abs(b.y - a.y)};\r\n    };\r\n\r\n    proto.markupsToClient = function(x, y) {\r\n\r\n        var camera = this.viewer.impl.camera;\r\n        var point = new THREE.Vector3(x, y, 0);\r\n\r\n        if (camera.isPerspective) {\r\n\r\n            var bb = this.viewer.impl.getCanvasBoundingClientRect();\r\n\r\n            point.x =( point.x / PERSPECTIVE_MODE_SCALE * (bb.height * 0.5) + bb.width  * 0.5);\r\n            point.y =(-point.y / PERSPECTIVE_MODE_SCALE * (bb.height * 0.5) + bb.height * 0.5);\r\n        } else {\r\n\r\n            point.applyMatrix4(camera.matrixWorld);\r\n            point.sub(camera.position);\r\n\r\n            // In LMV model is offset by a global offset, we correct this offset when transforming to markups space, so\r\n            // exported markups don't have the offset.\r\n            var globalOffset = this.viewer.model && this.viewer.model.getData().globalOffset;\r\n            if (globalOffset) {\r\n                point.sub(globalOffset);\r\n            }\r\n\r\n            point = worldToClient(point, this.viewer, false);\r\n            point.z = 0;\r\n        }\r\n\r\n        return point;\r\n    };\r\n\r\n    proto.clientToMarkups = function(x, y) {\r\n\r\n        var camera = this.viewer.impl.camera;\r\n        var point = new THREE.Vector3(x, y, 0);\r\n\r\n        if (camera.isPerspective) {\r\n\r\n            var bb = this.viewer.impl.getCanvasBoundingClientRect();\r\n\r\n            // Multiply by PERSPECTIVE_MODE_SCALE because Firfox on Windows machines have problems to deal with very small paths.\r\n            point.x = (point.x - bb.width  * 0.5) / (bb.height * 0.5) * PERSPECTIVE_MODE_SCALE;\r\n            point.y =-(point.y - bb.height * 0.5) / (bb.height * 0.5) * PERSPECTIVE_MODE_SCALE;\r\n        } else {\r\n\r\n            point = clientToWorld(point.x, point.y, 0, this.viewer);\r\n\r\n            // In LMV model is offset by a global offset, we correct this offset when transforming to markups space, so\r\n            // exported markups don't have the offset.\r\n            var globalOffset = this.viewer.model && this.viewer.model.getData().globalOffset;\r\n            if (globalOffset) {\r\n                point.add(globalOffset);\r\n            }\r\n\r\n            point.add(camera.position);\r\n            point.applyMatrix4(camera.matrixWorldInverse);\r\n            point.z = 0;\r\n        }\r\n\r\n        return point;\r\n    };\r\n\r\n    proto.getSvgViewBox = function(clientWidth, clientHeight) {\r\n\r\n        // Get pan offset.\r\n        var lt = this.clientToMarkups(0, 0);\r\n        var rb = this.clientToMarkups(clientWidth, clientHeight);\r\n\r\n        var l = Math.min(lt.x, rb.x);\r\n        var t = Math.min(lt.y, rb.y);\r\n        var r = Math.max(lt.x, rb.x);\r\n        var b = Math.max(lt.y, rb.y);\r\n\r\n        return [l , t, r-l, b-t].join(' ');\r\n    };\r\n\r\n    proto.getBounds = function () {\r\n\r\n        return this.bounds;\r\n    };\r\n\r\n    proto.getMousePosition = function() {\r\n\r\n        // When snapping, use the snap position instead of the mouse position\r\n        // as the start point of the markup drawing.\r\n        // For now only works for 2D.\r\n        if (this.editMode.useWithSnapping() && this.snapper && this.snapper.isSnapped()) {\r\n            return this.getSnapPosition();\r\n        }\r\n        return this.input.getMousePosition();\r\n    };\r\n\r\n    proto.getSnapPosition = function() {\r\n\r\n        var point = MeasureCommon.getSnapResultPosition(this.snapper.getSnapResult(), this.viewer);\r\n        var p = this.project(point);\r\n        return {x: p.x, y: p.y};\r\n    };\r\n\r\n    proto.project = function(position) {\r\n        var camera = this.viewer.navigation.getCamera();\r\n        var containerBounds = this.viewer.navigation.getScreenViewport();\r\n\r\n        var p = new THREE.Vector3().copy(position);\r\n        p.project(camera);\r\n\r\n        return new THREE.Vector3(Math.round((p.x + 1) / 2 * containerBounds.width),\r\n            Math.round((-p.y + 1) / 2 * containerBounds.height), p.z);\r\n    };\r\n\r\n    //// Handled Events ////////////////////////////////////////////////////////////////////////////////////////////////\r\n\r\n    proto.onCameraChange = function(event) {\r\n\r\n        // Update annotations' parent transform.\r\n        var viewBox = this.getSvgViewBox(this.bounds.width, this.bounds.height);\r\n\r\n        // HACK, for some reason the 2nd frame returns an empty canvas.\r\n        // The reason why this happens is that the code above calls into the viewer\r\n        // and a division by zero occurs due to LMV canvas having zero width and height\r\n        // When we detect this case, avoid setting the viewBox value and rely on one\r\n        // previously set.\r\n        if (viewBox === \"NaN NaN NaN NaN\") {\r\n            return;\r\n        }\r\n\r\n        if (this.svg) {\r\n            this.svg.setAttribute('viewBox', viewBox);\r\n        }\r\n\r\n\r\n        var editMode = this.editMode;\r\n\r\n        if (editMode) {\r\n            // Edit frame has to be updated, re-setting the selected markup does the job.\r\n            if (this.editFrame.isActive()) {\r\n                var selectedMarkup = editMode.getSelection();\r\n                this.editFrame.setMarkup(selectedMarkup);\r\n            }\r\n\r\n            if (editMode.updateTextBoxStyle) {\r\n                editMode.updateTextBoxStyle();\r\n            }\r\n\r\n            if (this.snapper && editMode.useWithSnapping()) {\r\n                this.snapper.indicator.render();\r\n            }\r\n        }\r\n    };\r\n\r\n    proto.onViewerResize = function(event) {\r\n\r\n        this.bounds.x = 0;\r\n        this.bounds.y = 0;\r\n        this.bounds.width = event.width;\r\n        this.bounds.height = event.height;\r\n\r\n        if (this.svg) {\r\n            this.svg.setAttribute('width', this.bounds.width);\r\n            this.svg.setAttribute('height', this.bounds.height);\r\n        }\r\n\r\n        this.onCameraChange();\r\n    };\r\n\r\n    proto.callSnapperMouseDown = function() {\r\n\r\n        // Disable snapper in freehand mode\r\n        if (this.editMode && this.editMode.useWithSnapping()){\r\n            var mousePosition = this.input.getMousePosition();\r\n            if (this.snapper) {\r\n                this.snapper.onMouseDown(mousePosition);\r\n                this.snapper.indicator.render();\r\n            }\r\n        }else{\r\n            // Clear the snapper when selecting a markup that does not allow snapping.\r\n            if (this.snapper){\r\n                this.snapper.clearSnapped();\r\n                this.snapper.indicator.clearOverlays();\r\n            }\r\n        }\r\n    };\r\n\r\n    proto.callSnapperMouseMove = function() {\r\n\r\n        if (this.editMode && this.editMode.useWithSnapping()) {\r\n            var mousePosition = this.input.getMousePosition();\r\n            if (this.snapper) {\r\n                this.snapper.onMouseMove(mousePosition);\r\n                this.snapper.indicator.render();\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Handler to mouse move events, used to create markups.\r\n     * @private\r\n     */\r\n    proto.onMouseMove = function(event) {\r\n\r\n        if (this.navigating) {\r\n            return;\r\n        }\r\n\r\n        if (this.editFrame.isActive() && event.type === 'mousemove') {\r\n            this.editFrame.onMouseMove(event);\r\n        }\r\n\r\n        this.callSnapperMouseMove();\r\n\r\n        this.editMode && this.editMode.onMouseMove(event);\r\n    };\r\n\r\n    /**\r\n     * Handler to mouse down events, used to start creation markups.\r\n     * @private\r\n     */\r\n    proto.onMouseDown = function(event) {\r\n\r\n        dismissLmvHudMessage();\r\n\r\n        this.callSnapperMouseDown();\r\n\r\n        var bounds = this.getBounds();\r\n        var mousePosition = this.getMousePosition();\r\n\r\n        if (mousePosition.x >= bounds.x && mousePosition.x <= bounds.x + bounds.width &&\r\n            mousePosition.y >= bounds.y && mousePosition.y <= bounds.y + bounds.height) {\r\n            this.editMode.onMouseDown(event);\r\n        }\r\n\r\n        // TODO: There is a better way to do this, implement when undo/redo group.\r\n        if(!this.editMode.creating && event.target === this.svg) {\r\n            this.selectMarkup(null);\r\n        }\r\n        this.ignoreNextMouseUp = false;\r\n    };\r\n\r\n    proto.onMouseUp = function(event) {\r\n\r\n        if (this.navigating) {\r\n            return;\r\n        }\r\n\r\n        if (this.editFrame.isActive()) {\r\n            this.editFrame.onMouseUp(event);\r\n            return;\r\n        }\r\n\r\n        if(!this.ignoreNextMouseUp) {\r\n            this.editMode.onMouseUp(event);\r\n        }\r\n    };\r\n\r\n    proto.onMouseDoubleClick = function(event) {\r\n\r\n        if (this.navigating) {\r\n            return;\r\n        }\r\n\r\n        if (this.editFrame.isActive()) {\r\n            return;\r\n        }\r\n\r\n        this.editMode.onMouseDoubleClick(event);\r\n    };\r\n\r\n    proto.onUserCancel = function() {\r\n        if (!this.editMode) {\r\n            return;\r\n        }\r\n        else if (this.editMode.creating) {\r\n            this.editMode.creationCancel();\r\n        } else {\r\n            this.editMode.unselect();\r\n        }\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param event\r\n     */\r\n    proto.onMarkupSelected = function(event) {\r\n\r\n        this.selectMarkup(event.markup);\r\n        this.dispatchEvent(event);\r\n    };\r\n\r\n    proto.onMarkupEnterEdition = function(event) {\r\n\r\n    };\r\n\r\n    proto.onMarkupCancelEdition = function(event) {\r\n\r\n        this.onUserCancel();\r\n    };\r\n\r\n    proto.onMarkupDeleteEdition = function(event) {\r\n\r\n        this.removeMarkup(event.markup);\r\n        this.editMode.deleteMarkup();\r\n    };\r\n\r\n    Autodesk.Viewing.theExtensionManager.registerExtension('Autodesk.Viewing.MarkupsCore', MarkupsCore);\r\n","\n      import API from \"!../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../node_modules/css-loader/dist/cjs.js!./MarkupsGui.css\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../node_modules/css-loader/dist/cjs.js!./MarkupsGui.css\";\n       export default content && content.locals ? content.locals : undefined;\n","import { getStyleDefaultValues } from '../core/StyleUtils'\r\nimport * as MarkupEvents from '../core/MarkupEvents' \r\nimport * as MarkupTypes from '../core/MarkupTypes'\r\nimport { theEditModeManager } from '../core/EditModeManager'\r\n\r\nimport CSS from './MarkupsGui.css' // IMPORTANT!!\r\n\r\n    var CORE_EXTENSION = 'Autodesk.Viewing.MarkupsCore';\r\n\r\n    export function MarkupsGui(viewer, options) {\r\n        Autodesk.Viewing.Extension.call(this, viewer, options);\r\n        this.domEvents = [];\r\n        this.name = 'markup';\r\n        this.onEditModeEnter = this.onEditModeEnter.bind(this);\r\n        this.onEditModeLeave = this.onEditModeLeave.bind(this);\r\n        this.onEditModeChange = this.onEditModeChange.bind(this);\r\n        this.onMarkupSelected = this.onMarkupSelected.bind(this);\r\n    }\r\n\r\n    MarkupsGui.prototype = Object.create(Autodesk.Viewing.Extension.prototype);\r\n    MarkupsGui.prototype.constructor = MarkupsGui;\r\n    var proto = MarkupsGui.prototype;\r\n    var av = Autodesk.Viewing;\r\n    var avp = av.Private;\r\n\r\n    proto.load = function () {\r\n\r\n        this.viewer.loadExtension(CORE_EXTENSION).then( coreExt => {\r\n\r\n            this.core = coreExt;\r\n\r\n            // Hook into markup core events\r\n            this.core.addEventListener(MarkupEvents.EVENT_EDITMODE_ENTER, this.onEditModeEnter);\r\n            this.core.addEventListener(MarkupEvents.EVENT_EDITMODE_LEAVE, this.onEditModeLeave);\r\n            this.core.addEventListener(MarkupEvents.EVENT_EDITMODE_CHANGED, this.onEditModeChange);\r\n            this.core.addEventListener(MarkupEvents.EVENT_MARKUP_SELECTED, this.onMarkupSelected);\r\n        });\r\n\r\n        return true;\r\n    };\r\n\r\n    proto.unload = function() {\r\n\r\n        this.deactivate(); // not necessary, but leaves the viewer in an unusable state without it\r\n        this.unhookAllEvents();\r\n\r\n        this.core.removeEventListener(MarkupEvents.EVENT_EDITMODE_ENTER, this.onEditModeEnter);\r\n        this.core.removeEventListener(MarkupEvents.EVENT_EDITMODE_LEAVE, this.onEditModeLeave);\r\n        this.core.removeEventListener(MarkupEvents.EVENT_EDITMODE_CHANGED, this.onEditModeChange);\r\n        this.core.removeEventListener(MarkupEvents.EVENT_MARKUP_SELECTED, this.onMarkupSelected);\r\n\r\n        this.destroyToolUi();\r\n        this.destroyToolbarUI();\r\n        this.core = null;\r\n\r\n        return true;\r\n    };\r\n\r\n    proto.onToolbarCreated = function(toolbar) {\r\n        \r\n        var self = this;\r\n        var viewer = this.viewer;\r\n\r\n        this.markupToolButton = new Autodesk.Viewing.UI.Button(\"toolbar-markupTool\");\r\n        this.markupToolButton.setToolTip(\"Markup\");\r\n        this.markupToolButton.setIcon(\"adsk-icon-markup\");\r\n        this.markupToolButton.onClick = function () {\r\n            // Since the bar will get hidden when closed, there\r\n            // is no need to track button state (active or not)\r\n            self.activate();\r\n        };\r\n\r\n        var modelTools = toolbar.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID);\r\n        if (modelTools) {\r\n            modelTools.addControl(this.markupToolButton, {index:0});\r\n        }\r\n    };\r\n\r\n    proto.destroyToolbarUI = function() {\r\n        if (this.markupToolButton) {\r\n            var toolbar = this.viewer.getToolbar();\r\n            if (toolbar) {\r\n                this.markupToolButton.removeFromParent();\r\n            }\r\n            this.markupToolButton = null;\r\n        }\r\n    };\r\n\r\n    proto.onEditModeEnter = function() {\r\n        avp.logger.log('ENTER edit mode');\r\n        this.showToolsUi();\r\n    };\r\n\r\n    proto.onEditModeLeave = function() {\r\n        avp.logger.log('LEAVE edit mode');\r\n        this.hideToolsUi();\r\n    };\r\n\r\n    proto.onEditModeChange = function(event) {\r\n        if (!this.domToolSelect || this.ignoreChangeEvent)\r\n            return;\r\n        var editMode = this.core.editMode;\r\n        var optionList = this.domToolSelect.options;\r\n        for (var i=0, len=optionList.length; i<len; i++) {\r\n            var option = optionList[i];\r\n            if (option.value === editMode.type) {\r\n                this.domToolSelect.selectedIndex = i; // doesn't fire event\r\n                break;\r\n            }\r\n        }\r\n    };\r\n\r\n    proto.onMarkupSelected = function(event) {\r\n\r\n        var markup = event.markup;\r\n        var editMode = this.core.editMode;\r\n        this.setStylesUi(editMode, markup);\r\n    };\r\n\r\n    proto.showToolsUi = function() {\r\n        this.createToolsUi();\r\n\r\n        // Hide some UI\r\n        var canNavigate = this.core.isNavigationAllowed();\r\n        this.setControlVisibility('.lmv-markup-gui-enterNavMode', canNavigate, 'inline-block');\r\n        this.exitNavigationMode();\r\n        this.domContent.style.display = 'block'; // remove collapsed state\r\n\r\n        // It's okay if we call these many times in a row, no biggie.\r\n        this.viewer.container.appendChild(this.domRoot);\r\n    };\r\n\r\n    proto.hideToolsUi = function() {\r\n        if (this.domRoot && this.domRoot.parentNode) {\r\n            this.domRoot.parentNode.removeChild(this.domRoot);\r\n        }\r\n    };\r\n\r\n    proto.createToolsUi = function() {\r\n\r\n        if (this.domRoot)\r\n            return;\r\n\r\n        var optionIndex = 0;\r\n        function createEditModeOption(locLabel, editModeType) {\r\n            return [\r\n                '<option value=\"', editModeType, '\">',\r\n                    locLabel,\r\n                '</option>'\r\n            ].join('');\r\n        }\r\n\r\n        var html = [\r\n            '<div class=\"lmv-markup-gui-toolbar-content\">',\r\n\r\n                '<button class=\"lmv-markup-gui-collapse-btn\">&lt;-&gt;</button>',\r\n                '<button class=\"lmv-markup-editmode-done\">Exit</button>',\r\n                '<div class=\"lmv-markup-gui-collapse-content\">',\r\n                    '<div class=\"lmv-markup-gui-editMode\">',\r\n                        '<button class=\"lmv-markup-gui-enterNavMode\">Navigate</button>',\r\n                        '<button class=\"lmv-markup-gui-undo\">&#8617;</button>',\r\n                        '<button class=\"lmv-markup-gui-redo\">&#8618;</button>',\r\n                        '<br>',\r\n                        '<button class=\"lmv-markup-gui-delete\">Delete</button>',\r\n                        '<button class=\"lmv-markup-gui-duplicate\">Duplicate</button>',\r\n                        '<br>',\r\n                        '<button class=\"lmv-markup-gui-cut\">Cut</button>',\r\n                        '<button class=\"lmv-markup-gui-copy\">Copy</button>',\r\n                        '<button class=\"lmv-markup-gui-paste\">Paste</button>',\r\n                        '<br>',\r\n                        '<span>Markup:</span>', // TODO: Localize\r\n                        '<select class=\"lmv-markup-tool-select\">',\r\n                            createEditModeOption('Arrow', MarkupTypes.MARKUP_TYPE_ARROW),\r\n                            createEditModeOption('Rectangle', MarkupTypes.MARKUP_TYPE_RECTANGLE),\r\n                            createEditModeOption('Circle', MarkupTypes.MARKUP_TYPE_CIRCLE),\r\n                            createEditModeOption('Text', MarkupTypes.MARKUP_TYPE_TEXT),\r\n                            createEditModeOption('Callout', MarkupTypes.MARKUP_TYPE_CALLOUT),\r\n                            createEditModeOption('Cloud', MarkupTypes.MARKUP_TYPE_CLOUD),\r\n                            createEditModeOption('PolyLine', MarkupTypes.MARKUP_TYPE_POLYLINE),\r\n                            createEditModeOption('Polycloud', MarkupTypes.MARKUP_TYPE_POLYCLOUD),\r\n                            createEditModeOption('Freehand', MarkupTypes.MARKUP_TYPE_FREEHAND),\r\n                            createEditModeOption('Highlight', MarkupTypes.MARKUP_TYPE_HIGHLIGHT),\r\n                            createEditModeOption('Dimension', MarkupTypes.MARKUP_TYPE_DIMENSION),\r\n                        '</select>',\r\n                        '<br>',\r\n                        '<div class=\"lmv-markup-gui-style-options\"></div>',\r\n                    '</div>',\r\n                    '<div class=\"lmv-markup-gui-navMode\" style=\"display:none;\">',\r\n                        '<button class=\"lmv-markup-gui-exitNavMode\">Back to Markup</button>',\r\n                    '</div>',\r\n                '</div>',\r\n            '</div>'\r\n        ].join('');\r\n\r\n        const _document = this.getDocument();\r\n        this.domRoot = _document.createElement('div');\r\n        this.domRoot.className = 'lmv-markup-gui-toolbar';\r\n        this.domRoot.innerHTML = html;\r\n\r\n        this.domContent = this.domRoot.querySelector('.lmv-markup-gui-collapse-content');\r\n        this.domToolSelect = this.domRoot.querySelector('.lmv-markup-tool-select');\r\n        this.domStylesRoot = this.domRoot.querySelector('.lmv-markup-gui-style-options');\r\n\r\n        // General\r\n        this.hookEvent('click', '.lmv-markup-gui-collapse-btn', this.onToggleCollapse.bind(this));\r\n        this.hookEvent('click', '.lmv-markup-editmode-done', this.onEditModeDone.bind(this));\r\n        this.hookEvent('click', '.lmv-markup-gui-enterNavMode', this.enterNavigationMode.bind(this));\r\n        this.hookEvent('click', '.lmv-markup-gui-exitNavMode', this.exitNavigationMode.bind(this));\r\n        this.hookEvent('click', '.lmv-markup-gui-undo', this.onUndoClick.bind(this));\r\n        this.hookEvent('click', '.lmv-markup-gui-redo', this.onRedoClick.bind(this));\r\n        this.hookEvent('click', '.lmv-markup-gui-delete', this.onDeleteClick.bind(this));\r\n        this.hookEvent('click', '.lmv-markup-gui-cut', this.onCutClick.bind(this));\r\n        this.hookEvent('click', '.lmv-markup-gui-copy', this.onCopyClick.bind(this));\r\n        this.hookEvent('click', '.lmv-markup-gui-paste', this.onPasteClick.bind(this));\r\n        this.hookEvent('click', '.lmv-markup-gui-duplicate', this.onDuplicateClick.bind(this));\r\n        // Tools\r\n        this.hookEvent('change', '.lmv-markup-tool-select', this.onSelectEditMode.bind(this));\r\n        this.hookEvent('change', '.lmv-markup-gui-style-select', this.onStyleChange.bind(this));\r\n\r\n        this.setStylesUi(this.core.editMode);\r\n    };\r\n\r\n    proto.destroyToolUi = function() {\r\n        if (this.domRoot) {\r\n            this.hideToolsUi();\r\n            this.domRoot = null;\r\n        }\r\n    };\r\n\r\n    proto.getEditMode = function(editModeType) {\r\n        var EditModeClass = theEditModeManager.getClass(editModeType);\r\n        if (!EditModeClass)\r\n            return null;\r\n\r\n        var editMode = new EditModeClass(this.core);\r\n        return editMode;\r\n    };\r\n\r\n    proto.onToggleCollapse = function() {\r\n        var curr = this.domContent.style.display;\r\n        if (curr === 'none')\r\n            this.domContent.style.display = 'block';\r\n        else\r\n            this.domContent.style.display = 'none';\r\n    };\r\n\r\n    proto.onEditModeDone = function() {\r\n        this.deactivate();\r\n    };\r\n\r\n    proto.enterNavigationMode = function() {\r\n        this.core.allowNavigation(true);\r\n        this.setControlVisibility('.lmv-markup-gui-editMode', false);\r\n        this.setControlVisibility('.lmv-markup-gui-navMode', true);\r\n    };\r\n    proto.exitNavigationMode = function() {\r\n        this.core.allowNavigation(false);\r\n        this.setControlVisibility('.lmv-markup-gui-editMode', true);\r\n        this.setControlVisibility('.lmv-markup-gui-navMode', false);\r\n    };\r\n\r\n    proto.onUndoClick = function() {\r\n        this.core.undo();\r\n    };\r\n    proto.onRedoClick = function() {\r\n        this.core.redo();\r\n    };\r\n    proto.onDeleteClick = function() {\r\n        var markup = this.core.getSelection();\r\n        if (markup) {\r\n            this.core.deleteMarkup(markup);\r\n        }\r\n    };\r\n    proto.onCutClick = function() {\r\n        this.core.cut();\r\n    };\r\n    proto.onCopyClick = function() {\r\n        this.core.copy();\r\n    };\r\n    proto.onPasteClick = function() {\r\n        this.core.paste();\r\n    };\r\n    proto.onDuplicateClick = function() {\r\n        // only when there's a selection\r\n        var markup = this.core.getSelection();\r\n        if (markup) {\r\n            this.core.copy();\r\n            this.core.paste();\r\n        }\r\n    };\r\n\r\n    proto.onSelectEditMode = function(event) {\r\n        var editModeType = event.target.value;\r\n        var editMode = this.getEditMode(editModeType);\r\n        if (!editMode) {\r\n            avp.logger.error('Markup editMode not found for type: ' + editModeType);\r\n            return;\r\n        }\r\n\r\n        if (editMode.cancelEditModeChange) {\r\n            avp.logger.warn('There was a problem selecting current editMode');\r\n            return;\r\n        }\r\n\r\n        this.ignoreChangeEvent = true;\r\n        this.core.changeEditMode(editMode);\r\n        this.ignoreChangeEvent = false;\r\n        this.setStylesUi(editMode);\r\n        this.domToolSelect.blur(); // remove focus from UI\r\n    };\r\n\r\n    proto.onStyleChange = function(event) {\r\n        var select = event.target;\r\n        var option = select.options[select.selectedIndex];\r\n        var styleKey = select.getAttribute('style-key');\r\n        var valueType = select.getAttribute('value-type');\r\n        select.blur(); // remove focus from UI\r\n\r\n        var markup = this.core.getSelection();\r\n        var style = markup ? markup.getStyle() : this.core.getStyle();\r\n        style[styleKey] = getTypedValue(option.value, valueType);\r\n        this.core.setStyle(style);\r\n\r\n        function getTypedValue(val, type) {\r\n            if (type === 'number')\r\n                return Number(val);\r\n            if (type === 'boolean')\r\n                return val === 'true';\r\n            return val;\r\n        }\r\n    };\r\n\r\n    proto.setStylesUi = function(editMode, markup) {\r\n        avp.logger.log('set ui for ' + editMode.type);\r\n\r\n        var style = markup ? markup.style : editMode.style;\r\n        var defaults = getStyleDefaultValues(style, this.core);\r\n\r\n        this.domStylesRoot.innerHTML = ''; // flush UI\r\n        for (var key in defaults) {\r\n            // Quite inefiient because we are re-creating DOM constantly\r\n            // Consider optimize if it becomes a problem\r\n            var domElem = this.getUiForStyleKey(key, defaults[key], style[key]);\r\n            this.domStylesRoot.appendChild(domElem);\r\n        }\r\n    };\r\n\r\n    proto.getUiForStyleKey = function(key, defaults, current) {\r\n\r\n        var selectionIndex = defaults.default;\r\n        var options = [];\r\n        var values = defaults.values;\r\n        for (var i=0, len=values.length; i<len; ++i) {\r\n            var optLine = [\r\n                '<option value=\"', values[i].value,'\">',\r\n                    values[i].name,\r\n                '</option>'\r\n            ].join('');\r\n            options.push(optLine);\r\n\r\n            if (this.valueEquals(values[i].value, current)) {\r\n                selectionIndex = i;\r\n            }\r\n        }\r\n\r\n        var valueType = typeof values[0].value;\r\n\r\n        // TODO: Build specialized controls for each style-attribute\r\n        const _document = this.getDocument();\r\n        var domElem = _document.createElement('div');\r\n        var html = [\r\n            '<span>',key,'</span>',\r\n            '<select class=\"lmv-markup-gui-style-select\" style-key=\"', key, '\" value-type=\"', valueType,'\">',\r\n                options.join(''),\r\n            '</select>'\r\n        ].join('');\r\n        domElem.innerHTML = html;\r\n\r\n        // select index\r\n        var domSelect = domElem.querySelector('select');\r\n        domSelect.selectedIndex = selectionIndex;\r\n\r\n        return domElem;\r\n    };\r\n    proto.valueEquals = function(value1, value2) {\r\n\r\n        return value1 === value2;\r\n    }\r\n\r\n    proto.setControlVisibility = function(selector, isVisible, visibleValue) {\r\n        var elem = this.domRoot.querySelector(selector);\r\n        if (!visibleValue)\r\n            visibleValue = 'block';\r\n        elem.style.display = isVisible ? visibleValue : 'none';\r\n    };\r\n\r\n    proto.hookEvent = function(eventStr, selector, callbackFn) {\r\n        var handler = function(event){\r\n            if (this.matchesSelector(event.target, selector)){\r\n                callbackFn(event);\r\n            }\r\n        }.bind(this);\r\n        this.domRoot.addEventListener(eventStr, handler);\r\n        this.domEvents.push({str: eventStr, handler: handler });\r\n    };\r\n\r\n    proto.unhookAllEvents = function() {\r\n        var domRoot = this.domRoot;\r\n        this.domEvents.forEach(function(event) {\r\n            domRoot.removeEventListener(event.str, event.handler);\r\n        });\r\n        this.domEvents = [];\r\n    };\r\n\r\n    proto.matchesSelector = function(domElem, selector) {\r\n        if (domElem.matches) return domElem.matches(selector); //Un-prefixed\r\n        if (domElem.msMatchesSelector) return domElem.msMatchesSelector(selector);  //IE\r\n        if (domElem.mozMatchesSelector) return domElem.mozMatchesSelector(selector); //Firefox (Gecko)\r\n        if (domElem.webkitMatchesSelector) return domElem.webkitMatchesSelector(selector); // Opera, Safari, Chrome\r\n        return false;\r\n    };\r\n\r\n    proto.getStyleOptions = function(editMode) {\r\n        var style = editMode.getStyle();\r\n        return getStyleDefaultValues(style, this.core);\r\n    };\r\n\r\n    proto.activate = function () {\r\n        if(!this.activeStatus) {\r\n            this.core.enterEditMode();\r\n            this.activeStatus = true;\r\n        }\r\n        return true;\r\n    };\r\n\r\n    proto.deactivate = function () {\r\n        if(this.activeStatus) {\r\n            this.core.hide();\r\n            this.activeStatus = false;\r\n        }\r\n        return true;\r\n    };\r\n\r\n\r\n    Autodesk.Viewing.theExtensionManager.registerExtension('Autodesk.Viewing.MarkupsGui', MarkupsGui);\r\n","'use strict';\r\n\r\nimport { MarkupsCore } from './core/MarkupsCore'\r\nimport { MarkupsGui } from './gui/MarkupsGui'\r\n\r\nimport { Clipboard } from './core/edit-clipboard/Clipboard'\r\nimport { CloneMarkup } from './core/edit-actions/CloneMarkup'\r\nimport { CreateArrow } from './core/edit-actions/CreateArrow'\r\nimport { CreateCallout } from './core/edit-actions/CreateCallout'\r\nimport { CreateCircle } from './core/edit-actions/CreateCircle'\r\nimport { CreateCloud } from './core/edit-actions/CreateCloud'\r\nimport { CreateDimension } from './core/edit-actions/CreateDimension'\r\nimport { CreateFreehand } from './core/edit-actions/CreateFreehand'\r\nimport { CreateHighlight } from './core/edit-actions/CreateHighlight'\r\nimport { CreatePolycloud } from './core/edit-actions/CreatePolycloud'\r\nimport { CreatePolyline } from './core/edit-actions/CreatePolyline'\r\nimport { CreateRectangle } from './core/edit-actions/CreateRectangle'\r\nimport { CreateText } from './core/edit-actions/CreateText'\r\nimport { DeleteArrow } from './core/edit-actions/DeleteArrow'\r\nimport { DeleteCallout } from './core/edit-actions/DeleteCallout'\r\nimport { DeleteCircle } from './core/edit-actions/DeleteCircle'\r\nimport { DeleteCloud } from './core/edit-actions/DeleteCloud'\r\nimport { DeleteDimension } from './core/edit-actions/DeleteDimension'\r\nimport { DeleteFreehand } from './core/edit-actions/DeleteFreehand'\r\nimport { DeleteHighlight } from './core/edit-actions/DeleteHighlight'\r\nimport { DeletePolycloud } from './core/edit-actions/DeletePolycloud'\r\nimport { DeletePolyline } from './core/edit-actions/DeletePolyline'\r\nimport { DeleteRectangle } from './core/edit-actions/DeleteRectangle'\r\nimport { DeleteText } from './core/edit-actions/DeleteText'\r\n\r\nimport { EditAction } from './core/edit-actions/EditAction' \r\nimport { EditActionGroup } from './core/edit-actions/EditActionGroup' \r\nimport { EditActionManager } from './core/edit-actions/EditActionManager' \r\nimport { EditFrame } from './core/EditFrame' \r\n\r\nimport { EditMode } from './core/edit-modes/EditMode'\r\nimport { EditModeArrow } from './core/edit-modes/EditModeArrow'\r\nimport { EditModeCallout } from './core/edit-modes/EditModeCallout'\r\nimport { EditModeCircle } from './core/edit-modes/EditModeCircle'\r\nimport { EditModeCloud } from './core/edit-modes/EditModeCloud'\r\nimport { EditModeDimension } from './core/edit-modes/EditModeDimension'\r\nimport { EditModeFreehand } from './core/edit-modes/EditModeFreehand'\r\nimport { EditModeHighlight } from './core/edit-modes/EditModeHighlight'\r\nimport { EditModePen } from './core/edit-modes/EditModePen'\r\nimport { EditModePolycloud } from './core/edit-modes/EditModePolycloud'\r\nimport { EditModePolyline } from './core/edit-modes/EditModePolyline'\r\nimport { EditModeRectangle } from './core/edit-modes/EditModeRectangle'\r\nimport { EditModeText } from './core/edit-modes/EditModeText'\r\nimport { EditorTextInput } from './core/edit-modes/EditorTextInput'\r\n\r\n\r\nimport { Markup } from './core/Markup'\r\nimport { MarkupArrow } from './core/MarkupArrow'\r\nimport { MarkupCallout } from './core/MarkupCallout'\r\nimport { MarkupCircle } from './core/MarkupCircle'\r\nimport { MarkupCloud } from './core/MarkupCloud'\r\nimport { MarkupDimension } from './core/MarkupDimension'\r\nimport { MarkupFreehand } from './core/MarkupFreehand'\r\nimport { MarkupHighlight } from './core/MarkupHighlight'\r\nimport { MarkupPen } from './core/MarkupPen'\r\nimport { MarkupPolycloud } from './core/MarkupPolycloud'\r\nimport { MarkupPolyline } from './core/MarkupPolyLine'\r\nimport { MarkupRectangle } from './core/MarkupRectangle'\r\nimport { MarkupText } from './core/MarkupText'\r\nimport { MarkupTool } from './core/MarkupTool'\r\n\r\nimport { SetArrow } from './core/edit-actions/SetArrow'\r\nimport { SetCallout } from './core/edit-actions/SetCallout'\r\nimport { SetCircle } from './core/edit-actions/SetCircle'\r\nimport { SetCloud } from './core/edit-actions/SetCloud'\r\nimport { SetDimension } from './core/edit-actions/SetDimension'\r\nimport { SetFreehand } from './core/edit-actions/SetFreehand'\r\nimport { SetHighlight } from './core/edit-actions/SetHighlight'\r\nimport { SetPolycloud } from './core/edit-actions/SetPolycloud'\r\nimport { SetPolyline } from './core/edit-actions/SetPolyline'\r\nimport { SetPosition } from './core/edit-actions/SetPosition'\r\nimport { SetRectangle } from './core/edit-actions/SetRectangle'\r\nimport { SetRotation } from './core/edit-actions/SetRotation'\r\nimport { SetSize } from './core/edit-actions/SetSize'\r\nimport { SetStyle } from './core/edit-actions/SetStyle'\r\nimport { SetText } from './core/edit-actions/SetText'\r\n\r\n\r\nimport * as MarkupEvents from './core/MarkupEvents'\r\nimport * as MarkupTypes from './core/MarkupTypes'\r\n\r\nimport * as Utils from './core/MarkupsCoreUtils'\r\nimport * as StyleUtils from './core/StyleUtils'\r\n\r\nimport { theEditModeManager } from './core/EditModeManager'\r\n\r\n// All the things\r\nexport const Core = {\r\n    Clipboard,\r\n    CloneMarkup,\r\n    CreateArrow,\r\n    CreateCallout,\r\n    CreateCircle,\r\n    CreateCloud,\r\n    CreateDimension,\r\n    CreateFreehand,\r\n    CreateHighlight,\r\n    CreatePolycloud,\r\n    CreatePolyline,\r\n    CreateRectangle,\r\n    CreateText,\r\n    DeleteArrow,\r\n    DeleteCallout,\r\n    DeleteCircle,\r\n    DeleteCloud,\r\n    DeleteDimension,\r\n    DeleteFreehand,\r\n    DeleteHighlight,\r\n    DeletePolycloud,\r\n    DeletePolyline,\r\n    DeleteRectangle,\r\n    DeleteText,\r\n\r\n    EditAction,\r\n    EditActionGroup,\r\n    EditActionManager,\r\n    EditFrame,\r\n\r\n    EditMode,\r\n    EditModeArrow,\r\n    EditModeCallout,\r\n    EditModeCircle,\r\n    EditModeCloud,\r\n    EditModeDimension,\r\n    EditModeFreehand,\r\n    EditModeHighlight,\r\n    EditModePen,\r\n    EditModePolycloud,\r\n    EditModePolyline,\r\n    EditModeRectangle,\r\n    EditModeText,\r\n    EditorTextInput,\r\n\r\n    Markup,\r\n    MarkupArrow,\r\n    MarkupCallout,\r\n    MarkupCircle,\r\n    MarkupCloud,\r\n    MarkupDimension,\r\n    MarkupFreehand,\r\n    MarkupHighlight,\r\n    MarkupPen,\r\n    MarkupPolycloud,\r\n    MarkupPolyline,\r\n    MarkupRectangle,\r\n    MarkupText,\r\n    MarkupTool,\r\n    \r\n    MarkupsCore,\r\n\r\n    SetArrow,\r\n    SetCallout,\r\n    SetCircle,\r\n    SetCloud,\r\n    SetDimension,\r\n    SetFreehand,\r\n    SetHighlight,\r\n    SetPolycloud,\r\n    SetPolyline,\r\n    SetPosition,\r\n    SetRectangle,\r\n    SetRotation,\r\n    SetSize,\r\n    SetStyle,\r\n    SetText,\r\n\r\n\r\n    MarkupEvents,\r\n    MarkupTypes,\r\n    theEditModeManager,\r\n    Utils,\r\n};\r\n\r\n// Spread the markup types to minimize breaking changes (sigh)\r\nfor (var markupType in MarkupTypes) {\r\n    Core[markupType] = MarkupTypes[markupType];\r\n}\r\n\r\n// Spread the event ids to minimize breaking changes (sigh)\r\nfor (var eventType in MarkupEvents) {\r\n    Core[eventType] = MarkupEvents[eventType];\r\n}\r\n\r\n// Merge StyleUtils with utils (because those methods used to live in Utils)\r\nfor (var thing in StyleUtils) {\r\n    if (thing in Core.Utils)\r\n        throw new Error(`Property ${thing} from StyleUtils already present in MarkupsCoreUtils.`);\r\n\r\n    Core.Utils[thing] = StyleUtils[thing];\r\n}\r\n\r\n\r\nexport const Gui = {\r\n    MarkupsGui\r\n}\r\n\r\n\r\n// Also map back to legacy namespace\r\nAutodesk.Viewing.Extensions.Markups = {\r\n    Core\r\n};\r\n"],"names":["___CSS_LOADER_EXPORT___","push","module","id","exports","cssWithMappingToString","list","toString","this","map","item","content","needLayer","concat","length","join","i","modules","media","dedupe","supports","layer","undefined","alreadyImportedModules","k","_k","cssMapping","btoa","base64","unescape","encodeURIComponent","JSON","stringify","data","sourceMapping","sourceURLs","sources","source","sourceRoot","stylesInDOM","getIndexByIdentifier","identifier","result","modulesToDom","options","idCountMap","identifiers","base","count","indexByIdentifier","obj","css","sourceMap","references","updater","addElementStyle","byIndex","splice","api","domAPI","update","newObj","remove","lastIdentifiers","newList","index","newLastIdentifiers","_i","_index","memo","insert","style","target","styleTarget","document","querySelector","window","HTMLIFrameElement","contentDocument","head","e","getTarget","Error","appendChild","element","createElement","setAttributes","attributes","styleElement","nonce","setAttribute","insertStyleElement","styleTagTransform","apply","parentNode","removeChild","removeStyleElement","styleSheet","cssText","firstChild","createTextNode","rgbcolor","stackblurCanvas","canvas","hasOwnProperty","canvg_1","fn","createCommonjsModule","windowEnv","DOMParser","doc","createCanvas","width","height","c","matchesSelector","canvg","s","opts","svg","console","log","msg","init","ctx","uniqueId","UniqueId","Definitions","Styles","StylesSpecificity","Animations","Images","ViewPort","viewPorts","Clear","SetCurrent","RemoveCurrent","pop","Current","ComputeSize","d","Math","sqrt","pow","ImagesLoaded","loaded","trim","replace","compressSpaces","ajax","url","AJAX","XMLHttpRequest","ActiveXObject","open","send","responseText","parseXml","xml","Windows","Data","Xml","xmlDoc","Dom","XmlDocument","settings","XmlLoadSettings","prohibitDtd","loadXml","async","loadXML","parser","xmldom","parseFromString","Property","name","value","prototype","getValue","hasValue","numValue","n","parseFloat","match","valueOrDefault","def","numValueOrDefault","addOpacity","opacityProp","newValue","color","ok","r","g","b","getDefinition","isUrlDefinition","indexOf","getFillStyleDefinition","createGradient","createPattern","getHrefAttribute","pt","attribute","getDPI","getREM","rootEmSize","getEM","emSize","getUnits","isPixels","toPixels","viewPort","processPercent","toMilliseconds","toRadians","PI","textBaselineMapping","toTextBaseline","Font","Variants","Weights","CreateFont","fontStyle","fontVariant","fontWeight","fontSize","fontFamily","inherit","f","Parse","font","that","split","set","ff","ToNumberArray","a","Point","x","y","angleTo","p","atan2","applyTransform","v","xp","yp","CreatePoint","CreatePath","path","BoundingBox","x1","y1","x2","y2","Number","NaN","addPoint","isNaN","addX","addY","addBoundingBox","bb","addQuadraticCurve","p0x","p0y","p1x","p1y","p2x","p2y","cp1x","cp1y","cp2x","cp2y","addBezierCurve","p3x","p3y","p0","p1","p2","p3","t","b2ac","t1","t2","isPointInBox","Transform","Type","translate","unapply","applyToPoint","rotate","angle","cx","cy","cos","sin","scale","matrix","m","transform","h","det","SkewBase","skewX","tan","skewY","transforms","type","transformType","AspectRatio","aspectRatio","desiredWidth","desiredHeight","minX","minY","refX","refY","align","meetOrSlice","scaleX","scaleY","scaleMin","min","scaleMax","max","Element","EmptyProperty","ElementBase","node","styles","stylesSpecificity","children","createIfNotExists","skipAncestors","parent","ps","render","save","mask","filter","setContext","renderChildren","clearContext","restore","addChild","childNode","create","child","CreateElement","addStylesFromStyleDefinition","selector","specificity","existingSpecificity","allUppercase","RegExp","normalizeAttributeName","test","toLowerCase","nodeType","nodeName","childNodes","captureTextNodes","text","textContent","tspan","RenderedElementBase","calculateOpacity","opacity","el","opacityStyle","fromMeasure","fs","fillStyle","strokeStyle","newLineWidth","lineWidth","lineCap","lineJoin","miterLimit","paintOrder","gaps","setLineDash","webkitLineDash","mozDash","offset","lineDashOffset","webkitLineDashOffset","mozDashOffset","currentFontSize","clip","globalAlpha","PathElementBase","beginPath","Mouse","checkPath","fill","stroke","markers","getMarkers","marker","getBoundingBox","baseClearContext","baseSetContext","getComputedStyle","getPropertyValue","root","moveTo","lineTo","closePath","viewBox","rect","rx","ry","KAPPA","bezierCurveTo","circle","arc","ellipse","line","getPoints","points","polyline","polygon","basePath","PathParser","tokens","reset","command","previousCommand","start","control","current","angles","isEnd","isCommandOrEnd","isRelativeCommand","getToken","getScalar","nextCommand","getPoint","makeAbsolute","getAsControlPoint","getAsCurrentPoint","getReflectedControlPoint","addMarker","from","priorTo","addMarkerAngle","getMarkerPoints","getMarkerAngles","j","pp","newP","curr","cntrl","cp","quadraticCurveTo","xAxisRotation","largeArcFlag","sweepFlag","currp","l","cpp","centp","u","acos","a1","ad","dir","ah","halfWay","sx","sy","pattern","tempSvg","cctx","getContext","baseRender","point","defs","GradientBase","stops","getGradient","gradientUnits","attributesToInherit","inheritStopContainer","stopsContainer","attributeToInherit","parentOpacityProp","addParentOpacity","addColorStop","rootView","MAX_VIRTUAL_PIXELS","group","tempCtx","linearGradient","createLinearGradient","radialGradient","fx","fy","createRadialGradient","stop","stopColor","AnimateBase","duration","begin","maxDuration","getProperty","attributeType","attributeName","initialValue","initialUnits","removed","calcValue","delta","frozen","animationFrozen","animationFrozenValue","updated","to","values","progress","ret","lb","floor","ub","ceil","animate","animateColor","parseInt","animateTransform","horizAdvX","isRTL","isArabic","fontFace","missingGlyph","glyphs","arabicForm","unicode","fontface","ascent","descent","unitsPerEm","missingglyph","glyph","textBaseline","initializeCoordinates","getAnchorDelta","childBB","getChildBoundingBox","renderChild","startI","textAnchor","measureTextRecursive","adjustChildCoordinates","textParent","measureText","TextElementBase","getGlyph","customFont","strokeText","getText","fillText","reverse","dx","lw","measure","textToMeasure","tref","hasText","baseRenderChildren","checkBoundingBox","onclick","onmousemove","cursor","image","href","isSvg","img","crossOrigin","self","onload","onerror","src","drawSvg","complete","drawImage","symbol","cssDefs","cssDef","cssClasses","cssProps","cssClass","props","prop","substr","getSelectorSpecificity","srcs","urlStart","urlEnd","fonts","getElementsByTagName","use","elementTransform","oldParent","cMask","maskCtx","globalCompositeOperation","fillRect","clipPath","hasContext2D","CanvasRenderingContext2D","oldBeginPath","oldClosePath","call","px","py","efd","extraFilterDistance","feDropShadow","feMorphology","feComposite","feColorMatrix","m1","m2","m3","imGet","rgba","imSet","val","mi","srcData","getImageData","clearRect","putImageData","feGaussianBlur","blurRadius","canvasRGBA","display","body","title","desc","MISSING","className","load","loadXmlDoc","dom","mapXY","offsetLeft","offsetTop","offsetParent","scrollX","scrollY","clientX","event","clientY","documentElement","isFirstRender","draw","clientWidth","clientHeight","cWidth","cHeight","xRatio","yRatio","waitingForImages","intervalID","setInterval","needUpdate","hasEvents","needAnimationUpdate","FRAMERATE","runEvents","clearInterval","events","run","eventElements","isPointInPath","build","getElementById","svgTags","querySelectorAll","svgTag","getBoundingClientRect","insertBefore","div","innerHTML","matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector","jQuery","Zepto","$","is","Sizzle","attributeRegex","idRegex","classRegex","pseudoElementRegex","pseudoClassWithBracketsRegex","pseudoClassRegex","elementRegex","typeCount","findMatch","regex","dy","dw","dh","cOpts","ignoreMouse","ignoreAnimation","ignoreDimensions","ignoreClear","offsetX","offsetY","scaleWidth","scaleHeight","factory","global","RGBColor","color_string","charAt","simple_colors","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dodgerblue","feldspar","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgrey","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslateblue","lightslategray","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","snow","springgreen","steelblue","teal","thistle","tomato","turquoise","violet","violetred","wheat","white","whitesmoke","yellow","yellowgreen","key","color_defs","re","example","process","bits","processor","exec","channels","toRGB","toHex","getHelpXML","examples","Array","sc","list_item","list_color","example_div","list_item_value","Map","some","__entries__","size","configurable","get","delete","has","clear","forEach","Object","defineProperties","Function","requestAnimationFrame","bind","setTimeout","Date","now","o","MutationObserver","connected_","mutationEventsAdded_","mutationsObserver_","observers_","onTransitionEnd_","refresh","addObserver","connect_","removeObserver","disconnect_","updateObservers_","gatherActive","hasActive","broadcastActive","addEventListener","observe","childList","characterData","subtree","removeEventListener","disconnect","propertyName","getInstance","instance_","keys","defineProperty","enumerable","writable","ownerDocument","defaultView","_","arguments","reduce","SVGGraphicsElement","SVGElement","getBBox","broadcastWidth","broadcastHeight","contentRect_","isActive","left","right","top","bottom","boxSizing","round","abs","broadcastRect","DOMRectReadOnly","contentRect","activeObservations_","observations_","TypeError","callback_","controller_","callbackCtx_","unobserve","clearActive","WeakMap","w","ResizeObserver","define","amd","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","getter","__esModule","definition","Symbol","toStringTag","nc","MARKUP_TYPE_ARROW","MARKUP_TYPE_TEXT","MARKUP_TYPE_RECTANGLE","MARKUP_TYPE_CIRCLE","MARKUP_TYPE_CLOUD","MARKUP_TYPE_FREEHAND","MARKUP_TYPE_HIGHLIGHT","MARKUP_TYPE_POLYLINE","MARKUP_TYPE_POLYCLOUD","MARKUP_TYPE_CALLOUT","MARKUP_TYPE_DIMENSION","EditAction","editor","targetId","addToHistory","selectOnExecution","execute","actionManager","redo","undo","merge","action","isIdentity","createStyle","defaults","getStyleDefaultValues","default","copyStyle","destination","isStyleEqual","cloneStyle","clone","getFontSizes","normalWidth","getOpacities","defaultTransparent","normaStrokeWidth","getStrokeWidth","normaFontWidth","getFontWidth","EVENT_EDITMODE_CHANGED","EVENT_EDITMODE_ENTER","EVENT_EDITMODE_LEAVE","EVENT_MARKUP_SELECTED","EVENT_MARKUP_DRAGGING","EVENT_MARKUP_ENTER_EDITION","EVENT_MARKUP_CANCEL_EDITION","EVENT_MARKUP_DELETE_EDITION","EVENT_HISTORY_CHANGED","EVENT_EDITMODE_CREATION_BEGIN","EVENT_EDITMODE_CREATION_END","EVENT_MARKUP_DESELECT","EVENT_EDITFRAME_EDITION_START","EVENT_EDITFRAME_EDITION_END","av","Autodesk","Viewing","Markup","styleAttributes","viewer","setGlobalManager","globalManager","position","rotation","getDefaultStyle","highlightColor","constraintWidth","constraintHeight","constraintRotation","minWidth","minHeight","highlighted","selected","checkLineSegment","checkPolygon","renderToCanvasX","renderToCanvas","addTraitEventDispatcher","GlobalManagerMixin","proto","SetStyle","markup","newStyle","oldStyle","getStyle","destroy","unselect","setParent","shape","__proto__","overrides","getCloneOverrides","member","cloneNode","GlobalManager","parse","cloneShape","hitarea","bindDomEvents","hammer","listeners","select","updateStyle","dispatchEvent","highlight","interactionsDisabled","setStyle","edit","cancel","deleteMarkup","getEditMode","warn","getClientPosition","positionFromMarkupsToClient","getClientSize","sizeFromMarkupsToClient","getBoundingRect","setRotation","parentRect","impl","getCanvasBoundingClientRect","boundRect","strokeWidth","getRotation","setPosition","setSize","isWidthConstrained","isHeightConstrained","isRotationConstrained","setMinWidth","setMinHeight","getMinWidth","getMinHeight","disableInteractions","disable","setStrokeWidth","constrainsToBounds","bounds","onMouseDown","editFrame","startDrag","generatePoint3d","idTarget","generateBoundingPolygon","checkLineSegmentAux","point2d","point3d","clientToWorld","xVertices","yVertices","midAB","THREE","Vector2","multiplyScalar","midAC","midDB","midDC","center","add","checkPolygonAux","generateBoundingBox","boundingBox","vertexCount","bbX0","POSITIVE_INFINITY","bbY0","bbX1","NEGATIVE_INFINITY","bbY1","bbX","bbY","halfSize","lt","Vector3","rt","rb","Matrix4","makeTranslation","makeRotationZ","multiply","applyMatrix4","Float32Array","setMetadata","setMouseDisabledWhenTouching","isFirst","onMouseDownBinded","isFinal","_this","isTouchDevice","Hammer","Manager","recognizers","GestureRecognizers","singletap","handlePointerEventMouse","inputClass","isIE11","PointerEventInput","TouchInput","onSingleTapBinded","onHammerInputBinded","on","onMouseOutBinded","onMouseOverBinded","callback","getPath","getTransform","radiansToDegrees","constructor","EditMode","selectedMarkup","dragging","draggingAnnotationIniPosition","draggingMouseIniPosition","initialX","initialY","minSize","creating","CREATION_METHOD_DRAG","CREATION_METHOD_CLICK","CREATION_METHOD_CLICKS","creationMethod","getMarkup","DeleteArrow","arrow","createArrow","CreateArrow","tail","removeTraitEventDispatcher","fireEv","selectedId","setMarkup","markupId","creationBegin","creationEnd","isCancelling","isMinSizeValid","creationCancel","finishDragging","closeActionGroup","creationCancelled","cancelActionGroup","setSelection","bringToFront","isTextInputHelperActive","textInputHelper","setEditFrame","getSelection","cantUndo","tmp","startDragging","mousePosition","getMousePosition","getFinalMouseDraggingPosition","getBounds","finalX","finalY","input","makeSameXY","maxDelta","sign","notifyAllowNavigation","allows","onMouseMove","onMouseUp","onMouseDoubleClick","onSave","getDraggingPosition","isInsideBounds","useWithSnapping","model","is2d","SetArrow","newHead","newTail","oldHead","oldTail","applyState","epsilon","MeasureCommon","EditModeArrow","MarkupArrow","addMarkupMetadata","createMarkupPathSvg","deleteArrow","lineSnapped","snapper","geomType","getGeometryType","SnapType","SNAP_VERTEX","SNAP_EDGE","SNAP_MIDPOINT","SNAP_CIRCLE_CENTER","getEdge","arrowMinSize","positionFromClientToMarkups","constrain","beginActionGroup","arrowVector","lengthSq","normalize","arrowId","getId","final","isSnapped","project","vertices","end","z","parallel","nearestPointInPointToLine","pEnd","pStart","perpendicular","distanceTo","sizeFromClientToMarkups","xO","yO","xF","yF","vO","vF","vDir","sub","dot","vFDir","vCenter","strokeColor","composeRGBAString","setAttributeToMarkupSvg","updateMarkupPathSvgHitarea","xo","yo","direction","metadata","String","sizeX","sizeY","sizeYOver3","tailW","headW","spikeOffset","addMarkup","removeMarkup","DeleteRectangle","rectangle","createRectangle","CreateRectangle","SetRectangle","newPosition","newSize","oldPosition","oldSize","EditModeRectangle","MarkupRectangle","deleteRectangle","pos","clientToMarkups","firstCorner","startZ","fillColor","createRectanglePath","DeleteText","createText","CreateText","SetCallout","isFrameUsed","newText","oldText","newIsFrameUsed","oldIsFrameUsed","SetSize","newWidth","oldWidth","newHeight","oldHeight","callout","createEvent","Event","bubbles","evt","getGlobal","initEvent","ta","heightOffset","cachedHeight","changeOverflow","offsetWidth","overflow","resize","originalHeight","overflows","arr","scrollTop","getParentOverflows","_document","getDocument","docTop","endHeight","scrollHeight","_window","getWindow","styleHeight","computed","actualHeight","offsetHeight","err","pageResize","removeWindowEventListener","overflowX","wordWrap","addWindowEventListener","paddingTop","paddingBottom","borderTopWidth","borderBottomWidth","methods","RUNTIME_SUPPORTED","autosize","DomElementStyle","BROWSER_PREFIXES","dirty","styleString","allBrowsers","prefix","removeAttribute","isArray","getStyleString","elements","generateStyle","EditorTextInput","parentDiv","singleLine","defaultText","maxLength","EVENT_TEXT_CHANGE","EVENT_TEXT_SET_ACTIVE","EVENT_TEXT_SET_INACTIVE","textArea","rows","firstEdit","startingHeight","entries","observer","styleTextArea","measureDiv","trimRight","lastNonSpace","trimLeft","firstNonSpace","EditModeCallout","helper","container","onHelperTextChange","onHelperSetActive","onHistoryChangeBinded","onHistoryChange","setInactive","setActive","textMarkup","placeholderText","i18n","constrainToCanvas","initFromMarkup","isIOSDevice","txtArea","focus","dataBag","blur","onResizeBinded","frameWidth","frameHeight","xPos","yPos","updateStyleFirst","padding","getClientFontSize","lineHeightPercentage","lineHeight","setPosAndSize","temp","injectSizeValues","newPos","fontHeight","textAreaStyle","getTextValuesForMarkup","sizeUpdateRequired","active","activeMarkup","activeFirstEdit","textValues","getTextValues","lines","generateLines","acceptAndExit","newLines","ox","oy","onCameraChanged","str","linesBreaks","styleMeasureStr","maxLineLength","linesOutput","len","splitLine","output","remaining","done","innerText","parts","getShorterLine","splitWord","iLastSpace","lastIndexOf","trailingWord","word","lenSoFar","part","okayWord","extraWord","deleteCallout","DeleteCallout","clientFontSize","initialWidth","initialHeight","createCallout","CreateCallout","selectMarkup","databag","setIsHelperTextActive","setIsShapeVisible","textStyle","curSelection","updateTextBoxStyle","FONT_SIZE_SCALE","MarkupCallout","createSvgElement","textShape","createMarkupTextSvg","rectShape","createMarkupGroupSvg","currentText","currentTextLines","prevHighlight","isHelperTextActive","textString","setIsFilledFrameUsed","setText","stylesEqual","getTextLines","highlightChanged","editMode","duringEditMode","rebuildTextSvg","textContainerTransform","getTextContainerTransform","textTransform","getTextTransform","setMarkupTextSvgTransform","updateMarkupTextSvgClipper","updateMarkupTextSvgHitarea","textHelperValues","yOffset","getLineHeight","hasRectShape","setIsFilledFrameVisible","isVisible","isframeused","margin","EDIT_FRAME_DEFAULT_MARGIN","SetText","EditModeText","deleteText","MarkupText","textDirty","textSize","updateMarkupTextSvgBackground","DeleteCircle","createCircle","CreateCircle","SetCircle","EditModeCircle","MarkupCircle","deleteCircle","firstPosition","ellipseW","ellipseH","createEllipsePath","DeleteCloud","cloud","createCloud","CreateCloud","SetCloud","EditModeCloud","newStrokeWidth","newColor","oldStrokeWidth","oldColor","MarkupCloud","deleteCloud","radius","createArcTo","xRadius","yRadius","createCorner","corner","getSideParameters","diameter","xValueInset","yValueOffset","hSidesParameters","vSidesParameters","cornerSizeX","cornerSizeY","cornerRadiusX","cornerRadiusY","halfStrokeWidth","sp","createTSide","createRSide","createBSide","createLSide","MarkupPen","EditModePen","smoothen","bufferSize","locations","isAbsoluteCoords","updatePath","slice","locationsCount","toFixed","locationA","locationB","DeleteFreehand","freehand","createFreehand","CreateFreehand","deletePen","movements","location","appendToBuffer","amendPath","lastX","lastY","removeFromAbsolutePath","addToAbsolutePath","setPen","absolutePath","clearSnapped","buffer","movementsLastIndex","createPen","createAbsolutePath","cameraWidth","camera","cameraHeight","xs","simplify","ys","error","absolutePathIndexes","numToRemove","shift","getAveragePoint","tmpBuffer","totalX","totalY","SetFreehand","EditModeFreehand","MarkupFreehand","DeletePolyline","createPolyline","CreatePolyline","closed","SetPolyline","EditModePolyline","setPositionAndSize","minFn","collection","targets","maxFn","MarkupPolyline","deletePolyline","lastIndex","lastMove","areMarkupsPointsInClientRange","DeletePolycloud","polycloud","createPolycloud","CreatePolycloud","SetPolycloud","EditModePolycloud","MarkupPolycloud","deletePolycloud","updateCorners","side","cornerA","cornerB","orientation","rA","rB","D","pointA","pointB","xS","xT","yS","yT","intersec","cross","vecAB","createSidePath","bodyCount","bodyRadius","bodyDiameter","createCornerPath","first","large","fstPoint","sndPoint","pointC","getOrientation","sides","sidesCount","vecBA","getSides","corners","sideA","sideB","getCorners","cornersCount","bodyA","bodyB","updateSides","DeleteHighlight","createHighlight","CreateHighlight","SetHighlight","EditModeHighlight","MarkupHighlight","DeleteDimension","dimension","createDimension","CreateDimension","secondAnchor","firstAnchor","SetDimension","newFirstAnchor","newSecondAnchor","oldFirstAnchor","oldSecondAnchor","_cursorPosition","EditModeDimension","measurement","Measurement","MeasurementTypes","MEASUREMENT_DISTANCE","measureExt","getExtension","abortDimensionMarkup","cancelEditModeChange","enterEditMode","sharedMeasureConfig","forceCalibrate","getData","isLeaflet","isPdf","calibrationTool","isCalibrated","openCalibrationRequiredDialog","MarkupDimension","measureTextLines","initialText","preventReposition","deleteDimension","updateTextBox","updateViewportId","getDistance","computeResult","picks","distanceXYZ","Private","convertUnits","getUnitString","units","calibrationFactor","formatValueWithUnits","precision","updateMeasurement","measurementNumber","pick","getPick","geomVertex","intersectPoint","copyResults","viewportId","setViewportId","pickFirstAnchor","clearAllPicks","dimensionId","viewportIndex2d","pickSecondAnchor","mouseDown","correctPerpendicularPicks","getSnapResultPosition","indicator","isRightClick","navigation","inverseProject","constrainAxis","isVisibleChar","keyCode","measureTextLine","handleKeyDown","KeyCode","ENTER","BACKSPACE","substring","handleKeyDownBinded","getTextAreaTransform","shouldFlip","degreesToRadians","lineSize","edgeH","textOffset","backgroundTransform","inverse","flip","segmentLength","avp","_gWindow","_gDocument","MARKUP_DEFAULT_STROKE_WIDTH_IN_PIXELS","MARKUP_DEFAULT_FONT_WIDTH_IN_PIXELS","MARKUP_DEFAULT_HITAREAS_MARGIN_IN_PIXELS","createElementNS","setSvgParentAttributes","hitareaMargin","getAttribute","markupFill","markupStroke","strokeEnabled","fillEnabled","navigating","clipperId","getUniqueID","clipperUrl","clipper","background","clippedArea","addSvgMetadata","metadataNode","dataVersionNode","markupNode","removeAllMetadata","svgNode","nodes","svgChildren","transferChildNodes","nodeFrom","nodeInto","tmpArray","generateUUID","svgNodeToString","domNode","hitareas","removeHitareas","hitareaParent","childrenCount","XMLSerializer","serializeToString","hitareasCount","addHitareas","stringToSvgNode","stringNode","client","listener","hasEventListener","li","typeListeners","worldToClient","snap","worldToViewport","viewportToClient","depth","clientToViewport","unproject","viewportX","viewportY","metersToModel","meters","getUnitScale","radians","degrees","range","hideLmvUi","toolbar","setActiveNavigationTool","dismissLmvHudMessage","hideLmvPanels","hideLmvToolsAndPanels","restoreLmvUi","showLmvToolsAndPanels","hide","dockingPanels","panel","panelContainer","classList","contains","visibilityChanged","ext","displayViewCube","displayHomeButton","anim","getElementsByClassName","viewerContainer","viewerContainerChildrenCount","animator","keyFrameAnimator","isPaused","pauseCameraAnimations","pause","playButton","modelTools","getControl","setIcon","setToolTip","keepDismissing","HudMessage","dismiss","ignore","widthInPixels","createMarkupFromSVG","meta","isClosed","getLocations","locStr","pointPair","getAttributeVector","posVec","strPos","getPosition","getSize","strRot","createMarkup","logger","getCurrentStyle","markupList","svgLayersMap","activeLayer","markups","hexRGBString","x0","y0","deviceRatio","devicePixelRatio","idTargetWidth","idTargetHeight","idTargetBuffer","check","verxtexCount","isInsidePolygon","bbW","bbH","endX","endY","createStyleSheet","sheet","addRuleToStyleSheet","insertRule","addRule","measureStyle","linesCount","relative","halfW","halfH","tmpSvg","markupGroup","renderWithCanvg","renderCallback","Image","tolerance","highestQuality","getSqSegDist","simplifyDPStep","last","sqTolerance","simplified","maxSqDist","sqDist","prevPoint","newPoints","simplifyRadialDist","simplifyDouglasPeucker","EditActionGroup","actions","EditActionManager","historySize","undoStack","redoStack","close","actionsCount","isOpen","isEmpty","addAction","compact","actionA","actionB","getTargetId","CloneMarkup","getEditActionGroup","undoStackCount","isUndoStackEmpty","isRedoStackEmpty","getLastElementInUndoStack","Clipboard","pastePosition","copy","cut","paste","_mouseEnabled","_mousePrevValue","_lock","InputHandler","snapRotations","keepAspectRatio","onWheelBinded","onWheel","onTouchDragBinded","onTouchDrag","onTouchPanBinded","onTouchPan","onTouchPinchBinded","onTouchPinch","onSingleTap","onDoubleTapBinded","onDoubleTap","onMouseMoveBinded","onMouseUpBinded","onMouseDoubleClickBinded","onHammerInput","isMouseDown","processMouseEvent","shiftKey","convertEventHammerToMouse","pointers","SetPosition","attachTo","detachFrom","drag","doubletap","doubletap2","singletap2","press","pan","pinch","recognizeWith","requireFailure","enableMouseButtons","state","addDocumentEventListener","removeDocumentEventListener","isMobileDevice","leaveEditMode","off","enterViewMode","leaveViewMode","toolController","mousewheel","preventDefault","mousemove","onMouseDownRightClick","inFullscreen","activeElement","__clientToCanvasCoords","markupTool","handleButtonDown","onMouseUpRightClick","handleButtonUp","isMiddleClick","getTool","distributeGesture","callSnapperMouseMove","SetRotation","curAngle","newRotation","oldRotation","EditFrame","containingDiv","selectionLayer","createSelectionLayer","frameMargin","selection","resizing","handle","createSelectorBox","onHammerDragBinded","onHammerDrag","onHammerDoubleTapBinded","onHammerDoubleTap","handleSelectionBoxDragging","handleSelectionBoxResizing","handleSelectionDoubleClick","handleSelectionBoxRotating","pageX","pageY","visibility","togglePointerEvents","createDragPoint","setResizeCursor","createRotatePoint","createRotationBridge","rotationBridge","createDragPoints","isDragPoint","matchesSelectorAux","isRotatePoint","selectorBox","rotationHandle","updateSelectionBoxState","updateSelectorBoxPosition","toTranslate3d","transformOrigin","msTransform","webkitTransform","msTransformOrigin","webkitTransformOrigin","updateSelectorBoxDimensions","_onRepositionMouseDown","unload","doubleMargin","enable","enableResizeHandles","enableRotationHandle","_onRepositionMouseMove","_onRepositionMouseUp","isDragging","isResizing","isRotating","rotating","updateEditorInput","callSnapperMouseDown","_onRotationMouseDown","_onResizeMouseDown","_handleRightClickDown","initialRotation","initialHandlePosition","ignoreFirstMouseMove","setHandleSelected","isSelected","doubleClick","defaultPrevented","pointerEvents","getAngleBetweenPoints","domElem","syntheticStart","MouseEvent","initialCursor","initialPosition","areAxisConstrained","axisConstrains","altKey","movement","initial","mouseX","mouseY","_onResizeMouseMove","_onResizeMouseUp","vector","undoRotation","localSpaceDelta","projectOnVector","nw","ne","sw","se","redoRotation","actualDelta","_onRotationMouseMove","_onRotationMouseUp","MarkupTool","ToolInterface","names","panTool","allowNav","coreExt","hotkeysEnabled","_ctrlDown","_shiftDown","allowNavigation","allow","setCoreExtension","setHotkeysEnabled","enabled","activate","viewerApi","deactivate","CONTROL","SHIFT","ESCAPE","onUserCancel","DELETE","F12","handleKeyUp","handleSingleClick","button","handleDoubleClick","handleSingleTap","handleDoubleTap","handleWheelInput","handleMouseMove","handleGesture","handleBlur","_editModes","theEditModeManager","register","clazz","unregister","getClass","getRegistered","PERSPECTIVE_MODE_SCALE","MarkupsCore","Extension","duringViewMode","onEditActionHistoryChanged","nextId","clipboard","CAMERA_CHANGE_EVENT","once","onCameraChangeBinded","onCameraChange","onViewerResizeBinded","onViewerResize","onMarkupSelectedBinded","onMarkupSelected","onMarkupEnterEditionBinded","onMarkupEnterEdition","onMarkupCancelEditionBinded","onMarkupCancelEdition","onMarkupDeleteEditionBinded","onMarkupDeleteEdition","onToolChangeBinded","onToolChange","onUnitsCalibrationStartsBinded","onUnitsCalibrationStarts","Events","UNITS_CALIBRATION_STARTS_EVENT","svgStyle","disableMarkupInteractions","toolClass","markupToolClass","changeMarkupTool","markupDisableHotkeys","loadExtension","Extensions","Snapping","Snapper","markupMode","registerTool","enableHotKeys","deregisterTool","editModeSvgLayerNode","initialStrokeWidth","initialFontWidth","toggleEditMode","layerId","disableLayerMarkups","layerMarkups","show","parSvg","editModeLayerParentNode","editingLayer","svgParent","activateTool","defaultStyle","changeEditMode","clearOverlays","toggle","VIEWER_RESIZE_EVENT","reorderElements","onViewerRolloverObject","rolloverObject","unloadMarkupsAllLayers","editModeLayer","generateData","defaultLayer","tmpNode","metadataNodes","addedNode","generatePoints3d","main","markupsCount","renderer","readbackTargetId","collision","context","renderAllMarkups","getSvgViewBox","numberOfScreenshotsTaken","onMarkupScreenshotTaken","svgKeys","layersKeys","oldEditMode","isNavigationAllowed","isPerspective","cachedNavigationTool","getActiveNavigationTool","TOOL_CHANGE_EVENT","getName","defaultToolName","getDefaultNavigationToolName","toolName","navAllowed","setNavigationLockSettings","zoom","orbit","roll","fov","walk","gotoview","setNavigationLock","changeInputHandler","inputHandler","dontAddToHistory","layerObject","markupIndex","editLayerMarkups","removeMarkupIfExists","sendMarkupTo","sendToBack","bringForward","bringBackward","loadMarkups","markupString","svgLayerNode","svgString","createLayerNode","localName","svgParentNode","newSvgLayerNode","revertLayer","currentMarkups","layerSvg","unloadMarkups","numMarkups","unloadSvgLayerNode","hideMarkups","showMarkups","markupsToClient","vectorFromClientToMarkups","vectorFromMarkupsToClient","matrixWorld","globalOffset","matrixWorldInverse","getSnapPosition","getSnapResult","getCamera","containerBounds","getScreenViewport","ignoreNextMouseUp","theExtensionManager","registerExtension","domEvents","onEditModeEnter","onEditModeLeave","onEditModeChange","then","core","unhookAllEvents","destroyToolUi","destroyToolbarUI","onToolbarCreated","markupToolButton","UI","Button","onClick","TOOLBAR","MODELTOOLSID","addControl","getToolbar","removeFromParent","showToolsUi","hideToolsUi","domToolSelect","ignoreChangeEvent","optionList","selectedIndex","setStylesUi","createToolsUi","canNavigate","setControlVisibility","exitNavigationMode","domContent","domRoot","createEditModeOption","locLabel","editModeType","html","domStylesRoot","hookEvent","onToggleCollapse","onEditModeDone","enterNavigationMode","onUndoClick","onRedoClick","onDeleteClick","onCutClick","onCopyClick","onPasteClick","onDuplicateClick","onSelectEditMode","onStyleChange","EditModeClass","option","styleKey","valueType","getUiForStyleKey","selectionIndex","optLine","valueEquals","value1","value2","visibleValue","eventStr","callbackFn","handler","getStyleOptions","activeStatus","Core","MarkupEvents","MarkupTypes","Utils","markupType","eventType","thing","Gui","MarkupsGui","Markups"],"sourceRoot":""}